{
  "version": 3,
  "sources": ["../../node_modules/commander/lib/error.js", "../../node_modules/commander/lib/argument.js", "../../node_modules/commander/lib/help.js", "../../node_modules/commander/lib/option.js", "../../node_modules/commander/lib/suggestSimilar.js", "../../node_modules/commander/lib/command.js", "../../node_modules/commander/index.js", "mock-electron:electron", "../../node_modules/commander/esm.mjs", "../../src/cli/index.ts", "../../src/cli/commands/archive.ts", "../../src/main/services/archival/archival.service.ts", "../../src/main/utils/logger.ts", "../../src/main/utils/binary.ts", "../../src/main/services/library/metadata.service.ts", "../../src/main/services/transcription/whisper.service.ts", "../../src/shared/types/archival.types.ts", "../../src/main/services/archival/archival-command-builder.ts", "../../src/main/services/archival/encoder-detector.ts", "../../src/main/services/archival/archival-state-persistence.ts", "../../src/main/services/hw-accel-detector.ts", "../../src/cli/ui/tui.ts", "../../src/cli/ui/browser.ts", "../../src/cli/ui/wizard.ts"],
  "sourcesContent": ["/**\n * CommanderError class\n */\nclass CommanderError extends Error {\n  /**\n   * Constructs the CommanderError class\n   * @param {number} exitCode suggested exit code which could be used with process.exit\n   * @param {string} code an id string representing the error\n   * @param {string} message human-readable description of the error\n   */\n  constructor(exitCode, code, message) {\n    super(message);\n    // properly capture stack trace in Node.js\n    Error.captureStackTrace(this, this.constructor);\n    this.name = this.constructor.name;\n    this.code = code;\n    this.exitCode = exitCode;\n    this.nestedError = undefined;\n  }\n}\n\n/**\n * InvalidArgumentError class\n */\nclass InvalidArgumentError extends CommanderError {\n  /**\n   * Constructs the InvalidArgumentError class\n   * @param {string} [message] explanation of why argument is invalid\n   */\n  constructor(message) {\n    super(1, 'commander.invalidArgument', message);\n    // properly capture stack trace in Node.js\n    Error.captureStackTrace(this, this.constructor);\n    this.name = this.constructor.name;\n  }\n}\n\nexports.CommanderError = CommanderError;\nexports.InvalidArgumentError = InvalidArgumentError;\n", "const { InvalidArgumentError } = require('./error.js');\n\nclass Argument {\n  /**\n   * Initialize a new command argument with the given name and description.\n   * The default is that the argument is required, and you can explicitly\n   * indicate this with <> around the name. Put [] around the name for an optional argument.\n   *\n   * @param {string} name\n   * @param {string} [description]\n   */\n\n  constructor(name, description) {\n    this.description = description || '';\n    this.variadic = false;\n    this.parseArg = undefined;\n    this.defaultValue = undefined;\n    this.defaultValueDescription = undefined;\n    this.argChoices = undefined;\n\n    switch (name[0]) {\n      case '<': // e.g. <required>\n        this.required = true;\n        this._name = name.slice(1, -1);\n        break;\n      case '[': // e.g. [optional]\n        this.required = false;\n        this._name = name.slice(1, -1);\n        break;\n      default:\n        this.required = true;\n        this._name = name;\n        break;\n    }\n\n    if (this._name.length > 3 && this._name.slice(-3) === '...') {\n      this.variadic = true;\n      this._name = this._name.slice(0, -3);\n    }\n  }\n\n  /**\n   * Return argument name.\n   *\n   * @return {string}\n   */\n\n  name() {\n    return this._name;\n  }\n\n  /**\n   * @package\n   */\n\n  _concatValue(value, previous) {\n    if (previous === this.defaultValue || !Array.isArray(previous)) {\n      return [value];\n    }\n\n    return previous.concat(value);\n  }\n\n  /**\n   * Set the default value, and optionally supply the description to be displayed in the help.\n   *\n   * @param {*} value\n   * @param {string} [description]\n   * @return {Argument}\n   */\n\n  default(value, description) {\n    this.defaultValue = value;\n    this.defaultValueDescription = description;\n    return this;\n  }\n\n  /**\n   * Set the custom handler for processing CLI command arguments into argument values.\n   *\n   * @param {Function} [fn]\n   * @return {Argument}\n   */\n\n  argParser(fn) {\n    this.parseArg = fn;\n    return this;\n  }\n\n  /**\n   * Only allow argument value to be one of choices.\n   *\n   * @param {string[]} values\n   * @return {Argument}\n   */\n\n  choices(values) {\n    this.argChoices = values.slice();\n    this.parseArg = (arg, previous) => {\n      if (!this.argChoices.includes(arg)) {\n        throw new InvalidArgumentError(\n          `Allowed choices are ${this.argChoices.join(', ')}.`,\n        );\n      }\n      if (this.variadic) {\n        return this._concatValue(arg, previous);\n      }\n      return arg;\n    };\n    return this;\n  }\n\n  /**\n   * Make argument required.\n   *\n   * @returns {Argument}\n   */\n  argRequired() {\n    this.required = true;\n    return this;\n  }\n\n  /**\n   * Make argument optional.\n   *\n   * @returns {Argument}\n   */\n  argOptional() {\n    this.required = false;\n    return this;\n  }\n}\n\n/**\n * Takes an argument and returns its human readable equivalent for help usage.\n *\n * @param {Argument} arg\n * @return {string}\n * @private\n */\n\nfunction humanReadableArgName(arg) {\n  const nameOutput = arg.name() + (arg.variadic === true ? '...' : '');\n\n  return arg.required ? '<' + nameOutput + '>' : '[' + nameOutput + ']';\n}\n\nexports.Argument = Argument;\nexports.humanReadableArgName = humanReadableArgName;\n", "const { humanReadableArgName } = require('./argument.js');\n\n/**\n * TypeScript import types for JSDoc, used by Visual Studio Code IntelliSense and `npm run typescript-checkJS`\n * https://www.typescriptlang.org/docs/handbook/jsdoc-supported-types.html#import-types\n * @typedef { import(\"./argument.js\").Argument } Argument\n * @typedef { import(\"./command.js\").Command } Command\n * @typedef { import(\"./option.js\").Option } Option\n */\n\n// Although this is a class, methods are static in style to allow override using subclass or just functions.\nclass Help {\n  constructor() {\n    this.helpWidth = undefined;\n    this.sortSubcommands = false;\n    this.sortOptions = false;\n    this.showGlobalOptions = false;\n  }\n\n  /**\n   * Get an array of the visible subcommands. Includes a placeholder for the implicit help command, if there is one.\n   *\n   * @param {Command} cmd\n   * @returns {Command[]}\n   */\n\n  visibleCommands(cmd) {\n    const visibleCommands = cmd.commands.filter((cmd) => !cmd._hidden);\n    const helpCommand = cmd._getHelpCommand();\n    if (helpCommand && !helpCommand._hidden) {\n      visibleCommands.push(helpCommand);\n    }\n    if (this.sortSubcommands) {\n      visibleCommands.sort((a, b) => {\n        // @ts-ignore: because overloaded return type\n        return a.name().localeCompare(b.name());\n      });\n    }\n    return visibleCommands;\n  }\n\n  /**\n   * Compare options for sort.\n   *\n   * @param {Option} a\n   * @param {Option} b\n   * @returns {number}\n   */\n  compareOptions(a, b) {\n    const getSortKey = (option) => {\n      // WYSIWYG for order displayed in help. Short used for comparison if present. No special handling for negated.\n      return option.short\n        ? option.short.replace(/^-/, '')\n        : option.long.replace(/^--/, '');\n    };\n    return getSortKey(a).localeCompare(getSortKey(b));\n  }\n\n  /**\n   * Get an array of the visible options. Includes a placeholder for the implicit help option, if there is one.\n   *\n   * @param {Command} cmd\n   * @returns {Option[]}\n   */\n\n  visibleOptions(cmd) {\n    const visibleOptions = cmd.options.filter((option) => !option.hidden);\n    // Built-in help option.\n    const helpOption = cmd._getHelpOption();\n    if (helpOption && !helpOption.hidden) {\n      // Automatically hide conflicting flags. Bit dubious but a historical behaviour that is convenient for single-command programs.\n      const removeShort = helpOption.short && cmd._findOption(helpOption.short);\n      const removeLong = helpOption.long && cmd._findOption(helpOption.long);\n      if (!removeShort && !removeLong) {\n        visibleOptions.push(helpOption); // no changes needed\n      } else if (helpOption.long && !removeLong) {\n        visibleOptions.push(\n          cmd.createOption(helpOption.long, helpOption.description),\n        );\n      } else if (helpOption.short && !removeShort) {\n        visibleOptions.push(\n          cmd.createOption(helpOption.short, helpOption.description),\n        );\n      }\n    }\n    if (this.sortOptions) {\n      visibleOptions.sort(this.compareOptions);\n    }\n    return visibleOptions;\n  }\n\n  /**\n   * Get an array of the visible global options. (Not including help.)\n   *\n   * @param {Command} cmd\n   * @returns {Option[]}\n   */\n\n  visibleGlobalOptions(cmd) {\n    if (!this.showGlobalOptions) return [];\n\n    const globalOptions = [];\n    for (\n      let ancestorCmd = cmd.parent;\n      ancestorCmd;\n      ancestorCmd = ancestorCmd.parent\n    ) {\n      const visibleOptions = ancestorCmd.options.filter(\n        (option) => !option.hidden,\n      );\n      globalOptions.push(...visibleOptions);\n    }\n    if (this.sortOptions) {\n      globalOptions.sort(this.compareOptions);\n    }\n    return globalOptions;\n  }\n\n  /**\n   * Get an array of the arguments if any have a description.\n   *\n   * @param {Command} cmd\n   * @returns {Argument[]}\n   */\n\n  visibleArguments(cmd) {\n    // Side effect! Apply the legacy descriptions before the arguments are displayed.\n    if (cmd._argsDescription) {\n      cmd.registeredArguments.forEach((argument) => {\n        argument.description =\n          argument.description || cmd._argsDescription[argument.name()] || '';\n      });\n    }\n\n    // If there are any arguments with a description then return all the arguments.\n    if (cmd.registeredArguments.find((argument) => argument.description)) {\n      return cmd.registeredArguments;\n    }\n    return [];\n  }\n\n  /**\n   * Get the command term to show in the list of subcommands.\n   *\n   * @param {Command} cmd\n   * @returns {string}\n   */\n\n  subcommandTerm(cmd) {\n    // Legacy. Ignores custom usage string, and nested commands.\n    const args = cmd.registeredArguments\n      .map((arg) => humanReadableArgName(arg))\n      .join(' ');\n    return (\n      cmd._name +\n      (cmd._aliases[0] ? '|' + cmd._aliases[0] : '') +\n      (cmd.options.length ? ' [options]' : '') + // simplistic check for non-help option\n      (args ? ' ' + args : '')\n    );\n  }\n\n  /**\n   * Get the option term to show in the list of options.\n   *\n   * @param {Option} option\n   * @returns {string}\n   */\n\n  optionTerm(option) {\n    return option.flags;\n  }\n\n  /**\n   * Get the argument term to show in the list of arguments.\n   *\n   * @param {Argument} argument\n   * @returns {string}\n   */\n\n  argumentTerm(argument) {\n    return argument.name();\n  }\n\n  /**\n   * Get the longest command term length.\n   *\n   * @param {Command} cmd\n   * @param {Help} helper\n   * @returns {number}\n   */\n\n  longestSubcommandTermLength(cmd, helper) {\n    return helper.visibleCommands(cmd).reduce((max, command) => {\n      return Math.max(max, helper.subcommandTerm(command).length);\n    }, 0);\n  }\n\n  /**\n   * Get the longest option term length.\n   *\n   * @param {Command} cmd\n   * @param {Help} helper\n   * @returns {number}\n   */\n\n  longestOptionTermLength(cmd, helper) {\n    return helper.visibleOptions(cmd).reduce((max, option) => {\n      return Math.max(max, helper.optionTerm(option).length);\n    }, 0);\n  }\n\n  /**\n   * Get the longest global option term length.\n   *\n   * @param {Command} cmd\n   * @param {Help} helper\n   * @returns {number}\n   */\n\n  longestGlobalOptionTermLength(cmd, helper) {\n    return helper.visibleGlobalOptions(cmd).reduce((max, option) => {\n      return Math.max(max, helper.optionTerm(option).length);\n    }, 0);\n  }\n\n  /**\n   * Get the longest argument term length.\n   *\n   * @param {Command} cmd\n   * @param {Help} helper\n   * @returns {number}\n   */\n\n  longestArgumentTermLength(cmd, helper) {\n    return helper.visibleArguments(cmd).reduce((max, argument) => {\n      return Math.max(max, helper.argumentTerm(argument).length);\n    }, 0);\n  }\n\n  /**\n   * Get the command usage to be displayed at the top of the built-in help.\n   *\n   * @param {Command} cmd\n   * @returns {string}\n   */\n\n  commandUsage(cmd) {\n    // Usage\n    let cmdName = cmd._name;\n    if (cmd._aliases[0]) {\n      cmdName = cmdName + '|' + cmd._aliases[0];\n    }\n    let ancestorCmdNames = '';\n    for (\n      let ancestorCmd = cmd.parent;\n      ancestorCmd;\n      ancestorCmd = ancestorCmd.parent\n    ) {\n      ancestorCmdNames = ancestorCmd.name() + ' ' + ancestorCmdNames;\n    }\n    return ancestorCmdNames + cmdName + ' ' + cmd.usage();\n  }\n\n  /**\n   * Get the description for the command.\n   *\n   * @param {Command} cmd\n   * @returns {string}\n   */\n\n  commandDescription(cmd) {\n    // @ts-ignore: because overloaded return type\n    return cmd.description();\n  }\n\n  /**\n   * Get the subcommand summary to show in the list of subcommands.\n   * (Fallback to description for backwards compatibility.)\n   *\n   * @param {Command} cmd\n   * @returns {string}\n   */\n\n  subcommandDescription(cmd) {\n    // @ts-ignore: because overloaded return type\n    return cmd.summary() || cmd.description();\n  }\n\n  /**\n   * Get the option description to show in the list of options.\n   *\n   * @param {Option} option\n   * @return {string}\n   */\n\n  optionDescription(option) {\n    const extraInfo = [];\n\n    if (option.argChoices) {\n      extraInfo.push(\n        // use stringify to match the display of the default value\n        `choices: ${option.argChoices.map((choice) => JSON.stringify(choice)).join(', ')}`,\n      );\n    }\n    if (option.defaultValue !== undefined) {\n      // default for boolean and negated more for programmer than end user,\n      // but show true/false for boolean option as may be for hand-rolled env or config processing.\n      const showDefault =\n        option.required ||\n        option.optional ||\n        (option.isBoolean() && typeof option.defaultValue === 'boolean');\n      if (showDefault) {\n        extraInfo.push(\n          `default: ${option.defaultValueDescription || JSON.stringify(option.defaultValue)}`,\n        );\n      }\n    }\n    // preset for boolean and negated are more for programmer than end user\n    if (option.presetArg !== undefined && option.optional) {\n      extraInfo.push(`preset: ${JSON.stringify(option.presetArg)}`);\n    }\n    if (option.envVar !== undefined) {\n      extraInfo.push(`env: ${option.envVar}`);\n    }\n    if (extraInfo.length > 0) {\n      return `${option.description} (${extraInfo.join(', ')})`;\n    }\n\n    return option.description;\n  }\n\n  /**\n   * Get the argument description to show in the list of arguments.\n   *\n   * @param {Argument} argument\n   * @return {string}\n   */\n\n  argumentDescription(argument) {\n    const extraInfo = [];\n    if (argument.argChoices) {\n      extraInfo.push(\n        // use stringify to match the display of the default value\n        `choices: ${argument.argChoices.map((choice) => JSON.stringify(choice)).join(', ')}`,\n      );\n    }\n    if (argument.defaultValue !== undefined) {\n      extraInfo.push(\n        `default: ${argument.defaultValueDescription || JSON.stringify(argument.defaultValue)}`,\n      );\n    }\n    if (extraInfo.length > 0) {\n      const extraDescripton = `(${extraInfo.join(', ')})`;\n      if (argument.description) {\n        return `${argument.description} ${extraDescripton}`;\n      }\n      return extraDescripton;\n    }\n    return argument.description;\n  }\n\n  /**\n   * Generate the built-in help text.\n   *\n   * @param {Command} cmd\n   * @param {Help} helper\n   * @returns {string}\n   */\n\n  formatHelp(cmd, helper) {\n    const termWidth = helper.padWidth(cmd, helper);\n    const helpWidth = helper.helpWidth || 80;\n    const itemIndentWidth = 2;\n    const itemSeparatorWidth = 2; // between term and description\n    function formatItem(term, description) {\n      if (description) {\n        const fullText = `${term.padEnd(termWidth + itemSeparatorWidth)}${description}`;\n        return helper.wrap(\n          fullText,\n          helpWidth - itemIndentWidth,\n          termWidth + itemSeparatorWidth,\n        );\n      }\n      return term;\n    }\n    function formatList(textArray) {\n      return textArray.join('\\n').replace(/^/gm, ' '.repeat(itemIndentWidth));\n    }\n\n    // Usage\n    let output = [`Usage: ${helper.commandUsage(cmd)}`, ''];\n\n    // Description\n    const commandDescription = helper.commandDescription(cmd);\n    if (commandDescription.length > 0) {\n      output = output.concat([\n        helper.wrap(commandDescription, helpWidth, 0),\n        '',\n      ]);\n    }\n\n    // Arguments\n    const argumentList = helper.visibleArguments(cmd).map((argument) => {\n      return formatItem(\n        helper.argumentTerm(argument),\n        helper.argumentDescription(argument),\n      );\n    });\n    if (argumentList.length > 0) {\n      output = output.concat(['Arguments:', formatList(argumentList), '']);\n    }\n\n    // Options\n    const optionList = helper.visibleOptions(cmd).map((option) => {\n      return formatItem(\n        helper.optionTerm(option),\n        helper.optionDescription(option),\n      );\n    });\n    if (optionList.length > 0) {\n      output = output.concat(['Options:', formatList(optionList), '']);\n    }\n\n    if (this.showGlobalOptions) {\n      const globalOptionList = helper\n        .visibleGlobalOptions(cmd)\n        .map((option) => {\n          return formatItem(\n            helper.optionTerm(option),\n            helper.optionDescription(option),\n          );\n        });\n      if (globalOptionList.length > 0) {\n        output = output.concat([\n          'Global Options:',\n          formatList(globalOptionList),\n          '',\n        ]);\n      }\n    }\n\n    // Commands\n    const commandList = helper.visibleCommands(cmd).map((cmd) => {\n      return formatItem(\n        helper.subcommandTerm(cmd),\n        helper.subcommandDescription(cmd),\n      );\n    });\n    if (commandList.length > 0) {\n      output = output.concat(['Commands:', formatList(commandList), '']);\n    }\n\n    return output.join('\\n');\n  }\n\n  /**\n   * Calculate the pad width from the maximum term length.\n   *\n   * @param {Command} cmd\n   * @param {Help} helper\n   * @returns {number}\n   */\n\n  padWidth(cmd, helper) {\n    return Math.max(\n      helper.longestOptionTermLength(cmd, helper),\n      helper.longestGlobalOptionTermLength(cmd, helper),\n      helper.longestSubcommandTermLength(cmd, helper),\n      helper.longestArgumentTermLength(cmd, helper),\n    );\n  }\n\n  /**\n   * Wrap the given string to width characters per line, with lines after the first indented.\n   * Do not wrap if insufficient room for wrapping (minColumnWidth), or string is manually formatted.\n   *\n   * @param {string} str\n   * @param {number} width\n   * @param {number} indent\n   * @param {number} [minColumnWidth=40]\n   * @return {string}\n   *\n   */\n\n  wrap(str, width, indent, minColumnWidth = 40) {\n    // Full \\s characters, minus the linefeeds.\n    const indents =\n      ' \\\\f\\\\t\\\\v\\u00a0\\u1680\\u2000-\\u200a\\u202f\\u205f\\u3000\\ufeff';\n    // Detect manually wrapped and indented strings by searching for line break followed by spaces.\n    const manualIndent = new RegExp(`[\\\\n][${indents}]+`);\n    if (str.match(manualIndent)) return str;\n    // Do not wrap if not enough room for a wrapped column of text (as could end up with a word per line).\n    const columnWidth = width - indent;\n    if (columnWidth < minColumnWidth) return str;\n\n    const leadingStr = str.slice(0, indent);\n    const columnText = str.slice(indent).replace('\\r\\n', '\\n');\n    const indentString = ' '.repeat(indent);\n    const zeroWidthSpace = '\\u200B';\n    const breaks = `\\\\s${zeroWidthSpace}`;\n    // Match line end (so empty lines don't collapse),\n    // or as much text as will fit in column, or excess text up to first break.\n    const regex = new RegExp(\n      `\\n|.{1,${columnWidth - 1}}([${breaks}]|$)|[^${breaks}]+?([${breaks}]|$)`,\n      'g',\n    );\n    const lines = columnText.match(regex) || [];\n    return (\n      leadingStr +\n      lines\n        .map((line, i) => {\n          if (line === '\\n') return ''; // preserve empty lines\n          return (i > 0 ? indentString : '') + line.trimEnd();\n        })\n        .join('\\n')\n    );\n  }\n}\n\nexports.Help = Help;\n", "const { InvalidArgumentError } = require('./error.js');\n\nclass Option {\n  /**\n   * Initialize a new `Option` with the given `flags` and `description`.\n   *\n   * @param {string} flags\n   * @param {string} [description]\n   */\n\n  constructor(flags, description) {\n    this.flags = flags;\n    this.description = description || '';\n\n    this.required = flags.includes('<'); // A value must be supplied when the option is specified.\n    this.optional = flags.includes('['); // A value is optional when the option is specified.\n    // variadic test ignores <value,...> et al which might be used to describe custom splitting of single argument\n    this.variadic = /\\w\\.\\.\\.[>\\]]$/.test(flags); // The option can take multiple values.\n    this.mandatory = false; // The option must have a value after parsing, which usually means it must be specified on command line.\n    const optionFlags = splitOptionFlags(flags);\n    this.short = optionFlags.shortFlag;\n    this.long = optionFlags.longFlag;\n    this.negate = false;\n    if (this.long) {\n      this.negate = this.long.startsWith('--no-');\n    }\n    this.defaultValue = undefined;\n    this.defaultValueDescription = undefined;\n    this.presetArg = undefined;\n    this.envVar = undefined;\n    this.parseArg = undefined;\n    this.hidden = false;\n    this.argChoices = undefined;\n    this.conflictsWith = [];\n    this.implied = undefined;\n  }\n\n  /**\n   * Set the default value, and optionally supply the description to be displayed in the help.\n   *\n   * @param {*} value\n   * @param {string} [description]\n   * @return {Option}\n   */\n\n  default(value, description) {\n    this.defaultValue = value;\n    this.defaultValueDescription = description;\n    return this;\n  }\n\n  /**\n   * Preset to use when option used without option-argument, especially optional but also boolean and negated.\n   * The custom processing (parseArg) is called.\n   *\n   * @example\n   * new Option('--color').default('GREYSCALE').preset('RGB');\n   * new Option('--donate [amount]').preset('20').argParser(parseFloat);\n   *\n   * @param {*} arg\n   * @return {Option}\n   */\n\n  preset(arg) {\n    this.presetArg = arg;\n    return this;\n  }\n\n  /**\n   * Add option name(s) that conflict with this option.\n   * An error will be displayed if conflicting options are found during parsing.\n   *\n   * @example\n   * new Option('--rgb').conflicts('cmyk');\n   * new Option('--js').conflicts(['ts', 'jsx']);\n   *\n   * @param {(string | string[])} names\n   * @return {Option}\n   */\n\n  conflicts(names) {\n    this.conflictsWith = this.conflictsWith.concat(names);\n    return this;\n  }\n\n  /**\n   * Specify implied option values for when this option is set and the implied options are not.\n   *\n   * The custom processing (parseArg) is not called on the implied values.\n   *\n   * @example\n   * program\n   *   .addOption(new Option('--log', 'write logging information to file'))\n   *   .addOption(new Option('--trace', 'log extra details').implies({ log: 'trace.txt' }));\n   *\n   * @param {object} impliedOptionValues\n   * @return {Option}\n   */\n  implies(impliedOptionValues) {\n    let newImplied = impliedOptionValues;\n    if (typeof impliedOptionValues === 'string') {\n      // string is not documented, but easy mistake and we can do what user probably intended.\n      newImplied = { [impliedOptionValues]: true };\n    }\n    this.implied = Object.assign(this.implied || {}, newImplied);\n    return this;\n  }\n\n  /**\n   * Set environment variable to check for option value.\n   *\n   * An environment variable is only used if when processed the current option value is\n   * undefined, or the source of the current value is 'default' or 'config' or 'env'.\n   *\n   * @param {string} name\n   * @return {Option}\n   */\n\n  env(name) {\n    this.envVar = name;\n    return this;\n  }\n\n  /**\n   * Set the custom handler for processing CLI option arguments into option values.\n   *\n   * @param {Function} [fn]\n   * @return {Option}\n   */\n\n  argParser(fn) {\n    this.parseArg = fn;\n    return this;\n  }\n\n  /**\n   * Whether the option is mandatory and must have a value after parsing.\n   *\n   * @param {boolean} [mandatory=true]\n   * @return {Option}\n   */\n\n  makeOptionMandatory(mandatory = true) {\n    this.mandatory = !!mandatory;\n    return this;\n  }\n\n  /**\n   * Hide option in help.\n   *\n   * @param {boolean} [hide=true]\n   * @return {Option}\n   */\n\n  hideHelp(hide = true) {\n    this.hidden = !!hide;\n    return this;\n  }\n\n  /**\n   * @package\n   */\n\n  _concatValue(value, previous) {\n    if (previous === this.defaultValue || !Array.isArray(previous)) {\n      return [value];\n    }\n\n    return previous.concat(value);\n  }\n\n  /**\n   * Only allow option value to be one of choices.\n   *\n   * @param {string[]} values\n   * @return {Option}\n   */\n\n  choices(values) {\n    this.argChoices = values.slice();\n    this.parseArg = (arg, previous) => {\n      if (!this.argChoices.includes(arg)) {\n        throw new InvalidArgumentError(\n          `Allowed choices are ${this.argChoices.join(', ')}.`,\n        );\n      }\n      if (this.variadic) {\n        return this._concatValue(arg, previous);\n      }\n      return arg;\n    };\n    return this;\n  }\n\n  /**\n   * Return option name.\n   *\n   * @return {string}\n   */\n\n  name() {\n    if (this.long) {\n      return this.long.replace(/^--/, '');\n    }\n    return this.short.replace(/^-/, '');\n  }\n\n  /**\n   * Return option name, in a camelcase format that can be used\n   * as a object attribute key.\n   *\n   * @return {string}\n   */\n\n  attributeName() {\n    return camelcase(this.name().replace(/^no-/, ''));\n  }\n\n  /**\n   * Check if `arg` matches the short or long flag.\n   *\n   * @param {string} arg\n   * @return {boolean}\n   * @package\n   */\n\n  is(arg) {\n    return this.short === arg || this.long === arg;\n  }\n\n  /**\n   * Return whether a boolean option.\n   *\n   * Options are one of boolean, negated, required argument, or optional argument.\n   *\n   * @return {boolean}\n   * @package\n   */\n\n  isBoolean() {\n    return !this.required && !this.optional && !this.negate;\n  }\n}\n\n/**\n * This class is to make it easier to work with dual options, without changing the existing\n * implementation. We support separate dual options for separate positive and negative options,\n * like `--build` and `--no-build`, which share a single option value. This works nicely for some\n * use cases, but is tricky for others where we want separate behaviours despite\n * the single shared option value.\n */\nclass DualOptions {\n  /**\n   * @param {Option[]} options\n   */\n  constructor(options) {\n    this.positiveOptions = new Map();\n    this.negativeOptions = new Map();\n    this.dualOptions = new Set();\n    options.forEach((option) => {\n      if (option.negate) {\n        this.negativeOptions.set(option.attributeName(), option);\n      } else {\n        this.positiveOptions.set(option.attributeName(), option);\n      }\n    });\n    this.negativeOptions.forEach((value, key) => {\n      if (this.positiveOptions.has(key)) {\n        this.dualOptions.add(key);\n      }\n    });\n  }\n\n  /**\n   * Did the value come from the option, and not from possible matching dual option?\n   *\n   * @param {*} value\n   * @param {Option} option\n   * @returns {boolean}\n   */\n  valueFromOption(value, option) {\n    const optionKey = option.attributeName();\n    if (!this.dualOptions.has(optionKey)) return true;\n\n    // Use the value to deduce if (probably) came from the option.\n    const preset = this.negativeOptions.get(optionKey).presetArg;\n    const negativeValue = preset !== undefined ? preset : false;\n    return option.negate === (negativeValue === value);\n  }\n}\n\n/**\n * Convert string from kebab-case to camelCase.\n *\n * @param {string} str\n * @return {string}\n * @private\n */\n\nfunction camelcase(str) {\n  return str.split('-').reduce((str, word) => {\n    return str + word[0].toUpperCase() + word.slice(1);\n  });\n}\n\n/**\n * Split the short and long flag out of something like '-m,--mixed <value>'\n *\n * @private\n */\n\nfunction splitOptionFlags(flags) {\n  let shortFlag;\n  let longFlag;\n  // Use original very loose parsing to maintain backwards compatibility for now,\n  // which allowed for example unintended `-sw, --short-word` [sic].\n  const flagParts = flags.split(/[ |,]+/);\n  if (flagParts.length > 1 && !/^[[<]/.test(flagParts[1]))\n    shortFlag = flagParts.shift();\n  longFlag = flagParts.shift();\n  // Add support for lone short flag without significantly changing parsing!\n  if (!shortFlag && /^-[^-]$/.test(longFlag)) {\n    shortFlag = longFlag;\n    longFlag = undefined;\n  }\n  return { shortFlag, longFlag };\n}\n\nexports.Option = Option;\nexports.DualOptions = DualOptions;\n", "const maxDistance = 3;\n\nfunction editDistance(a, b) {\n  // https://en.wikipedia.org/wiki/Damerau\u2013Levenshtein_distance\n  // Calculating optimal string alignment distance, no substring is edited more than once.\n  // (Simple implementation.)\n\n  // Quick early exit, return worst case.\n  if (Math.abs(a.length - b.length) > maxDistance)\n    return Math.max(a.length, b.length);\n\n  // distance between prefix substrings of a and b\n  const d = [];\n\n  // pure deletions turn a into empty string\n  for (let i = 0; i <= a.length; i++) {\n    d[i] = [i];\n  }\n  // pure insertions turn empty string into b\n  for (let j = 0; j <= b.length; j++) {\n    d[0][j] = j;\n  }\n\n  // fill matrix\n  for (let j = 1; j <= b.length; j++) {\n    for (let i = 1; i <= a.length; i++) {\n      let cost = 1;\n      if (a[i - 1] === b[j - 1]) {\n        cost = 0;\n      } else {\n        cost = 1;\n      }\n      d[i][j] = Math.min(\n        d[i - 1][j] + 1, // deletion\n        d[i][j - 1] + 1, // insertion\n        d[i - 1][j - 1] + cost, // substitution\n      );\n      // transposition\n      if (i > 1 && j > 1 && a[i - 1] === b[j - 2] && a[i - 2] === b[j - 1]) {\n        d[i][j] = Math.min(d[i][j], d[i - 2][j - 2] + 1);\n      }\n    }\n  }\n\n  return d[a.length][b.length];\n}\n\n/**\n * Find close matches, restricted to same number of edits.\n *\n * @param {string} word\n * @param {string[]} candidates\n * @returns {string}\n */\n\nfunction suggestSimilar(word, candidates) {\n  if (!candidates || candidates.length === 0) return '';\n  // remove possible duplicates\n  candidates = Array.from(new Set(candidates));\n\n  const searchingOptions = word.startsWith('--');\n  if (searchingOptions) {\n    word = word.slice(2);\n    candidates = candidates.map((candidate) => candidate.slice(2));\n  }\n\n  let similar = [];\n  let bestDistance = maxDistance;\n  const minSimilarity = 0.4;\n  candidates.forEach((candidate) => {\n    if (candidate.length <= 1) return; // no one character guesses\n\n    const distance = editDistance(word, candidate);\n    const length = Math.max(word.length, candidate.length);\n    const similarity = (length - distance) / length;\n    if (similarity > minSimilarity) {\n      if (distance < bestDistance) {\n        // better edit distance, throw away previous worse matches\n        bestDistance = distance;\n        similar = [candidate];\n      } else if (distance === bestDistance) {\n        similar.push(candidate);\n      }\n    }\n  });\n\n  similar.sort((a, b) => a.localeCompare(b));\n  if (searchingOptions) {\n    similar = similar.map((candidate) => `--${candidate}`);\n  }\n\n  if (similar.length > 1) {\n    return `\\n(Did you mean one of ${similar.join(', ')}?)`;\n  }\n  if (similar.length === 1) {\n    return `\\n(Did you mean ${similar[0]}?)`;\n  }\n  return '';\n}\n\nexports.suggestSimilar = suggestSimilar;\n", "const EventEmitter = require('node:events').EventEmitter;\nconst childProcess = require('node:child_process');\nconst path = require('node:path');\nconst fs = require('node:fs');\nconst process = require('node:process');\n\nconst { Argument, humanReadableArgName } = require('./argument.js');\nconst { CommanderError } = require('./error.js');\nconst { Help } = require('./help.js');\nconst { Option, DualOptions } = require('./option.js');\nconst { suggestSimilar } = require('./suggestSimilar');\n\nclass Command extends EventEmitter {\n  /**\n   * Initialize a new `Command`.\n   *\n   * @param {string} [name]\n   */\n\n  constructor(name) {\n    super();\n    /** @type {Command[]} */\n    this.commands = [];\n    /** @type {Option[]} */\n    this.options = [];\n    this.parent = null;\n    this._allowUnknownOption = false;\n    this._allowExcessArguments = true;\n    /** @type {Argument[]} */\n    this.registeredArguments = [];\n    this._args = this.registeredArguments; // deprecated old name\n    /** @type {string[]} */\n    this.args = []; // cli args with options removed\n    this.rawArgs = [];\n    this.processedArgs = []; // like .args but after custom processing and collecting variadic\n    this._scriptPath = null;\n    this._name = name || '';\n    this._optionValues = {};\n    this._optionValueSources = {}; // default, env, cli etc\n    this._storeOptionsAsProperties = false;\n    this._actionHandler = null;\n    this._executableHandler = false;\n    this._executableFile = null; // custom name for executable\n    this._executableDir = null; // custom search directory for subcommands\n    this._defaultCommandName = null;\n    this._exitCallback = null;\n    this._aliases = [];\n    this._combineFlagAndOptionalValue = true;\n    this._description = '';\n    this._summary = '';\n    this._argsDescription = undefined; // legacy\n    this._enablePositionalOptions = false;\n    this._passThroughOptions = false;\n    this._lifeCycleHooks = {}; // a hash of arrays\n    /** @type {(boolean | string)} */\n    this._showHelpAfterError = false;\n    this._showSuggestionAfterError = true;\n\n    // see .configureOutput() for docs\n    this._outputConfiguration = {\n      writeOut: (str) => process.stdout.write(str),\n      writeErr: (str) => process.stderr.write(str),\n      getOutHelpWidth: () =>\n        process.stdout.isTTY ? process.stdout.columns : undefined,\n      getErrHelpWidth: () =>\n        process.stderr.isTTY ? process.stderr.columns : undefined,\n      outputError: (str, write) => write(str),\n    };\n\n    this._hidden = false;\n    /** @type {(Option | null | undefined)} */\n    this._helpOption = undefined; // Lazy created on demand. May be null if help option is disabled.\n    this._addImplicitHelpCommand = undefined; // undecided whether true or false yet, not inherited\n    /** @type {Command} */\n    this._helpCommand = undefined; // lazy initialised, inherited\n    this._helpConfiguration = {};\n  }\n\n  /**\n   * Copy settings that are useful to have in common across root command and subcommands.\n   *\n   * (Used internally when adding a command using `.command()` so subcommands inherit parent settings.)\n   *\n   * @param {Command} sourceCommand\n   * @return {Command} `this` command for chaining\n   */\n  copyInheritedSettings(sourceCommand) {\n    this._outputConfiguration = sourceCommand._outputConfiguration;\n    this._helpOption = sourceCommand._helpOption;\n    this._helpCommand = sourceCommand._helpCommand;\n    this._helpConfiguration = sourceCommand._helpConfiguration;\n    this._exitCallback = sourceCommand._exitCallback;\n    this._storeOptionsAsProperties = sourceCommand._storeOptionsAsProperties;\n    this._combineFlagAndOptionalValue =\n      sourceCommand._combineFlagAndOptionalValue;\n    this._allowExcessArguments = sourceCommand._allowExcessArguments;\n    this._enablePositionalOptions = sourceCommand._enablePositionalOptions;\n    this._showHelpAfterError = sourceCommand._showHelpAfterError;\n    this._showSuggestionAfterError = sourceCommand._showSuggestionAfterError;\n\n    return this;\n  }\n\n  /**\n   * @returns {Command[]}\n   * @private\n   */\n\n  _getCommandAndAncestors() {\n    const result = [];\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    for (let command = this; command; command = command.parent) {\n      result.push(command);\n    }\n    return result;\n  }\n\n  /**\n   * Define a command.\n   *\n   * There are two styles of command: pay attention to where to put the description.\n   *\n   * @example\n   * // Command implemented using action handler (description is supplied separately to `.command`)\n   * program\n   *   .command('clone <source> [destination]')\n   *   .description('clone a repository into a newly created directory')\n   *   .action((source, destination) => {\n   *     console.log('clone command called');\n   *   });\n   *\n   * // Command implemented using separate executable file (description is second parameter to `.command`)\n   * program\n   *   .command('start <service>', 'start named service')\n   *   .command('stop [service]', 'stop named service, or all if no name supplied');\n   *\n   * @param {string} nameAndArgs - command name and arguments, args are `<required>` or `[optional]` and last may also be `variadic...`\n   * @param {(object | string)} [actionOptsOrExecDesc] - configuration options (for action), or description (for executable)\n   * @param {object} [execOpts] - configuration options (for executable)\n   * @return {Command} returns new command for action handler, or `this` for executable command\n   */\n\n  command(nameAndArgs, actionOptsOrExecDesc, execOpts) {\n    let desc = actionOptsOrExecDesc;\n    let opts = execOpts;\n    if (typeof desc === 'object' && desc !== null) {\n      opts = desc;\n      desc = null;\n    }\n    opts = opts || {};\n    const [, name, args] = nameAndArgs.match(/([^ ]+) *(.*)/);\n\n    const cmd = this.createCommand(name);\n    if (desc) {\n      cmd.description(desc);\n      cmd._executableHandler = true;\n    }\n    if (opts.isDefault) this._defaultCommandName = cmd._name;\n    cmd._hidden = !!(opts.noHelp || opts.hidden); // noHelp is deprecated old name for hidden\n    cmd._executableFile = opts.executableFile || null; // Custom name for executable file, set missing to null to match constructor\n    if (args) cmd.arguments(args);\n    this._registerCommand(cmd);\n    cmd.parent = this;\n    cmd.copyInheritedSettings(this);\n\n    if (desc) return this;\n    return cmd;\n  }\n\n  /**\n   * Factory routine to create a new unattached command.\n   *\n   * See .command() for creating an attached subcommand, which uses this routine to\n   * create the command. You can override createCommand to customise subcommands.\n   *\n   * @param {string} [name]\n   * @return {Command} new command\n   */\n\n  createCommand(name) {\n    return new Command(name);\n  }\n\n  /**\n   * You can customise the help with a subclass of Help by overriding createHelp,\n   * or by overriding Help properties using configureHelp().\n   *\n   * @return {Help}\n   */\n\n  createHelp() {\n    return Object.assign(new Help(), this.configureHelp());\n  }\n\n  /**\n   * You can customise the help by overriding Help properties using configureHelp(),\n   * or with a subclass of Help by overriding createHelp().\n   *\n   * @param {object} [configuration] - configuration options\n   * @return {(Command | object)} `this` command for chaining, or stored configuration\n   */\n\n  configureHelp(configuration) {\n    if (configuration === undefined) return this._helpConfiguration;\n\n    this._helpConfiguration = configuration;\n    return this;\n  }\n\n  /**\n   * The default output goes to stdout and stderr. You can customise this for special\n   * applications. You can also customise the display of errors by overriding outputError.\n   *\n   * The configuration properties are all functions:\n   *\n   *     // functions to change where being written, stdout and stderr\n   *     writeOut(str)\n   *     writeErr(str)\n   *     // matching functions to specify width for wrapping help\n   *     getOutHelpWidth()\n   *     getErrHelpWidth()\n   *     // functions based on what is being written out\n   *     outputError(str, write) // used for displaying errors, and not used for displaying help\n   *\n   * @param {object} [configuration] - configuration options\n   * @return {(Command | object)} `this` command for chaining, or stored configuration\n   */\n\n  configureOutput(configuration) {\n    if (configuration === undefined) return this._outputConfiguration;\n\n    Object.assign(this._outputConfiguration, configuration);\n    return this;\n  }\n\n  /**\n   * Display the help or a custom message after an error occurs.\n   *\n   * @param {(boolean|string)} [displayHelp]\n   * @return {Command} `this` command for chaining\n   */\n  showHelpAfterError(displayHelp = true) {\n    if (typeof displayHelp !== 'string') displayHelp = !!displayHelp;\n    this._showHelpAfterError = displayHelp;\n    return this;\n  }\n\n  /**\n   * Display suggestion of similar commands for unknown commands, or options for unknown options.\n   *\n   * @param {boolean} [displaySuggestion]\n   * @return {Command} `this` command for chaining\n   */\n  showSuggestionAfterError(displaySuggestion = true) {\n    this._showSuggestionAfterError = !!displaySuggestion;\n    return this;\n  }\n\n  /**\n   * Add a prepared subcommand.\n   *\n   * See .command() for creating an attached subcommand which inherits settings from its parent.\n   *\n   * @param {Command} cmd - new subcommand\n   * @param {object} [opts] - configuration options\n   * @return {Command} `this` command for chaining\n   */\n\n  addCommand(cmd, opts) {\n    if (!cmd._name) {\n      throw new Error(`Command passed to .addCommand() must have a name\n- specify the name in Command constructor or using .name()`);\n    }\n\n    opts = opts || {};\n    if (opts.isDefault) this._defaultCommandName = cmd._name;\n    if (opts.noHelp || opts.hidden) cmd._hidden = true; // modifying passed command due to existing implementation\n\n    this._registerCommand(cmd);\n    cmd.parent = this;\n    cmd._checkForBrokenPassThrough();\n\n    return this;\n  }\n\n  /**\n   * Factory routine to create a new unattached argument.\n   *\n   * See .argument() for creating an attached argument, which uses this routine to\n   * create the argument. You can override createArgument to return a custom argument.\n   *\n   * @param {string} name\n   * @param {string} [description]\n   * @return {Argument} new argument\n   */\n\n  createArgument(name, description) {\n    return new Argument(name, description);\n  }\n\n  /**\n   * Define argument syntax for command.\n   *\n   * The default is that the argument is required, and you can explicitly\n   * indicate this with <> around the name. Put [] around the name for an optional argument.\n   *\n   * @example\n   * program.argument('<input-file>');\n   * program.argument('[output-file]');\n   *\n   * @param {string} name\n   * @param {string} [description]\n   * @param {(Function|*)} [fn] - custom argument processing function\n   * @param {*} [defaultValue]\n   * @return {Command} `this` command for chaining\n   */\n  argument(name, description, fn, defaultValue) {\n    const argument = this.createArgument(name, description);\n    if (typeof fn === 'function') {\n      argument.default(defaultValue).argParser(fn);\n    } else {\n      argument.default(fn);\n    }\n    this.addArgument(argument);\n    return this;\n  }\n\n  /**\n   * Define argument syntax for command, adding multiple at once (without descriptions).\n   *\n   * See also .argument().\n   *\n   * @example\n   * program.arguments('<cmd> [env]');\n   *\n   * @param {string} names\n   * @return {Command} `this` command for chaining\n   */\n\n  arguments(names) {\n    names\n      .trim()\n      .split(/ +/)\n      .forEach((detail) => {\n        this.argument(detail);\n      });\n    return this;\n  }\n\n  /**\n   * Define argument syntax for command, adding a prepared argument.\n   *\n   * @param {Argument} argument\n   * @return {Command} `this` command for chaining\n   */\n  addArgument(argument) {\n    const previousArgument = this.registeredArguments.slice(-1)[0];\n    if (previousArgument && previousArgument.variadic) {\n      throw new Error(\n        `only the last argument can be variadic '${previousArgument.name()}'`,\n      );\n    }\n    if (\n      argument.required &&\n      argument.defaultValue !== undefined &&\n      argument.parseArg === undefined\n    ) {\n      throw new Error(\n        `a default value for a required argument is never used: '${argument.name()}'`,\n      );\n    }\n    this.registeredArguments.push(argument);\n    return this;\n  }\n\n  /**\n   * Customise or override default help command. By default a help command is automatically added if your command has subcommands.\n   *\n   * @example\n   *    program.helpCommand('help [cmd]');\n   *    program.helpCommand('help [cmd]', 'show help');\n   *    program.helpCommand(false); // suppress default help command\n   *    program.helpCommand(true); // add help command even if no subcommands\n   *\n   * @param {string|boolean} enableOrNameAndArgs - enable with custom name and/or arguments, or boolean to override whether added\n   * @param {string} [description] - custom description\n   * @return {Command} `this` command for chaining\n   */\n\n  helpCommand(enableOrNameAndArgs, description) {\n    if (typeof enableOrNameAndArgs === 'boolean') {\n      this._addImplicitHelpCommand = enableOrNameAndArgs;\n      return this;\n    }\n\n    enableOrNameAndArgs = enableOrNameAndArgs ?? 'help [command]';\n    const [, helpName, helpArgs] = enableOrNameAndArgs.match(/([^ ]+) *(.*)/);\n    const helpDescription = description ?? 'display help for command';\n\n    const helpCommand = this.createCommand(helpName);\n    helpCommand.helpOption(false);\n    if (helpArgs) helpCommand.arguments(helpArgs);\n    if (helpDescription) helpCommand.description(helpDescription);\n\n    this._addImplicitHelpCommand = true;\n    this._helpCommand = helpCommand;\n\n    return this;\n  }\n\n  /**\n   * Add prepared custom help command.\n   *\n   * @param {(Command|string|boolean)} helpCommand - custom help command, or deprecated enableOrNameAndArgs as for `.helpCommand()`\n   * @param {string} [deprecatedDescription] - deprecated custom description used with custom name only\n   * @return {Command} `this` command for chaining\n   */\n  addHelpCommand(helpCommand, deprecatedDescription) {\n    // If not passed an object, call through to helpCommand for backwards compatibility,\n    // as addHelpCommand was originally used like helpCommand is now.\n    if (typeof helpCommand !== 'object') {\n      this.helpCommand(helpCommand, deprecatedDescription);\n      return this;\n    }\n\n    this._addImplicitHelpCommand = true;\n    this._helpCommand = helpCommand;\n    return this;\n  }\n\n  /**\n   * Lazy create help command.\n   *\n   * @return {(Command|null)}\n   * @package\n   */\n  _getHelpCommand() {\n    const hasImplicitHelpCommand =\n      this._addImplicitHelpCommand ??\n      (this.commands.length &&\n        !this._actionHandler &&\n        !this._findCommand('help'));\n\n    if (hasImplicitHelpCommand) {\n      if (this._helpCommand === undefined) {\n        this.helpCommand(undefined, undefined); // use default name and description\n      }\n      return this._helpCommand;\n    }\n    return null;\n  }\n\n  /**\n   * Add hook for life cycle event.\n   *\n   * @param {string} event\n   * @param {Function} listener\n   * @return {Command} `this` command for chaining\n   */\n\n  hook(event, listener) {\n    const allowedValues = ['preSubcommand', 'preAction', 'postAction'];\n    if (!allowedValues.includes(event)) {\n      throw new Error(`Unexpected value for event passed to hook : '${event}'.\nExpecting one of '${allowedValues.join(\"', '\")}'`);\n    }\n    if (this._lifeCycleHooks[event]) {\n      this._lifeCycleHooks[event].push(listener);\n    } else {\n      this._lifeCycleHooks[event] = [listener];\n    }\n    return this;\n  }\n\n  /**\n   * Register callback to use as replacement for calling process.exit.\n   *\n   * @param {Function} [fn] optional callback which will be passed a CommanderError, defaults to throwing\n   * @return {Command} `this` command for chaining\n   */\n\n  exitOverride(fn) {\n    if (fn) {\n      this._exitCallback = fn;\n    } else {\n      this._exitCallback = (err) => {\n        if (err.code !== 'commander.executeSubCommandAsync') {\n          throw err;\n        } else {\n          // Async callback from spawn events, not useful to throw.\n        }\n      };\n    }\n    return this;\n  }\n\n  /**\n   * Call process.exit, and _exitCallback if defined.\n   *\n   * @param {number} exitCode exit code for using with process.exit\n   * @param {string} code an id string representing the error\n   * @param {string} message human-readable description of the error\n   * @return never\n   * @private\n   */\n\n  _exit(exitCode, code, message) {\n    if (this._exitCallback) {\n      this._exitCallback(new CommanderError(exitCode, code, message));\n      // Expecting this line is not reached.\n    }\n    process.exit(exitCode);\n  }\n\n  /**\n   * Register callback `fn` for the command.\n   *\n   * @example\n   * program\n   *   .command('serve')\n   *   .description('start service')\n   *   .action(function() {\n   *      // do work here\n   *   });\n   *\n   * @param {Function} fn\n   * @return {Command} `this` command for chaining\n   */\n\n  action(fn) {\n    const listener = (args) => {\n      // The .action callback takes an extra parameter which is the command or options.\n      const expectedArgsCount = this.registeredArguments.length;\n      const actionArgs = args.slice(0, expectedArgsCount);\n      if (this._storeOptionsAsProperties) {\n        actionArgs[expectedArgsCount] = this; // backwards compatible \"options\"\n      } else {\n        actionArgs[expectedArgsCount] = this.opts();\n      }\n      actionArgs.push(this);\n\n      return fn.apply(this, actionArgs);\n    };\n    this._actionHandler = listener;\n    return this;\n  }\n\n  /**\n   * Factory routine to create a new unattached option.\n   *\n   * See .option() for creating an attached option, which uses this routine to\n   * create the option. You can override createOption to return a custom option.\n   *\n   * @param {string} flags\n   * @param {string} [description]\n   * @return {Option} new option\n   */\n\n  createOption(flags, description) {\n    return new Option(flags, description);\n  }\n\n  /**\n   * Wrap parseArgs to catch 'commander.invalidArgument'.\n   *\n   * @param {(Option | Argument)} target\n   * @param {string} value\n   * @param {*} previous\n   * @param {string} invalidArgumentMessage\n   * @private\n   */\n\n  _callParseArg(target, value, previous, invalidArgumentMessage) {\n    try {\n      return target.parseArg(value, previous);\n    } catch (err) {\n      if (err.code === 'commander.invalidArgument') {\n        const message = `${invalidArgumentMessage} ${err.message}`;\n        this.error(message, { exitCode: err.exitCode, code: err.code });\n      }\n      throw err;\n    }\n  }\n\n  /**\n   * Check for option flag conflicts.\n   * Register option if no conflicts found, or throw on conflict.\n   *\n   * @param {Option} option\n   * @private\n   */\n\n  _registerOption(option) {\n    const matchingOption =\n      (option.short && this._findOption(option.short)) ||\n      (option.long && this._findOption(option.long));\n    if (matchingOption) {\n      const matchingFlag =\n        option.long && this._findOption(option.long)\n          ? option.long\n          : option.short;\n      throw new Error(`Cannot add option '${option.flags}'${this._name && ` to command '${this._name}'`} due to conflicting flag '${matchingFlag}'\n-  already used by option '${matchingOption.flags}'`);\n    }\n\n    this.options.push(option);\n  }\n\n  /**\n   * Check for command name and alias conflicts with existing commands.\n   * Register command if no conflicts found, or throw on conflict.\n   *\n   * @param {Command} command\n   * @private\n   */\n\n  _registerCommand(command) {\n    const knownBy = (cmd) => {\n      return [cmd.name()].concat(cmd.aliases());\n    };\n\n    const alreadyUsed = knownBy(command).find((name) =>\n      this._findCommand(name),\n    );\n    if (alreadyUsed) {\n      const existingCmd = knownBy(this._findCommand(alreadyUsed)).join('|');\n      const newCmd = knownBy(command).join('|');\n      throw new Error(\n        `cannot add command '${newCmd}' as already have command '${existingCmd}'`,\n      );\n    }\n\n    this.commands.push(command);\n  }\n\n  /**\n   * Add an option.\n   *\n   * @param {Option} option\n   * @return {Command} `this` command for chaining\n   */\n  addOption(option) {\n    this._registerOption(option);\n\n    const oname = option.name();\n    const name = option.attributeName();\n\n    // store default value\n    if (option.negate) {\n      // --no-foo is special and defaults foo to true, unless a --foo option is already defined\n      const positiveLongFlag = option.long.replace(/^--no-/, '--');\n      if (!this._findOption(positiveLongFlag)) {\n        this.setOptionValueWithSource(\n          name,\n          option.defaultValue === undefined ? true : option.defaultValue,\n          'default',\n        );\n      }\n    } else if (option.defaultValue !== undefined) {\n      this.setOptionValueWithSource(name, option.defaultValue, 'default');\n    }\n\n    // handler for cli and env supplied values\n    const handleOptionValue = (val, invalidValueMessage, valueSource) => {\n      // val is null for optional option used without an optional-argument.\n      // val is undefined for boolean and negated option.\n      if (val == null && option.presetArg !== undefined) {\n        val = option.presetArg;\n      }\n\n      // custom processing\n      const oldValue = this.getOptionValue(name);\n      if (val !== null && option.parseArg) {\n        val = this._callParseArg(option, val, oldValue, invalidValueMessage);\n      } else if (val !== null && option.variadic) {\n        val = option._concatValue(val, oldValue);\n      }\n\n      // Fill-in appropriate missing values. Long winded but easy to follow.\n      if (val == null) {\n        if (option.negate) {\n          val = false;\n        } else if (option.isBoolean() || option.optional) {\n          val = true;\n        } else {\n          val = ''; // not normal, parseArg might have failed or be a mock function for testing\n        }\n      }\n      this.setOptionValueWithSource(name, val, valueSource);\n    };\n\n    this.on('option:' + oname, (val) => {\n      const invalidValueMessage = `error: option '${option.flags}' argument '${val}' is invalid.`;\n      handleOptionValue(val, invalidValueMessage, 'cli');\n    });\n\n    if (option.envVar) {\n      this.on('optionEnv:' + oname, (val) => {\n        const invalidValueMessage = `error: option '${option.flags}' value '${val}' from env '${option.envVar}' is invalid.`;\n        handleOptionValue(val, invalidValueMessage, 'env');\n      });\n    }\n\n    return this;\n  }\n\n  /**\n   * Internal implementation shared by .option() and .requiredOption()\n   *\n   * @return {Command} `this` command for chaining\n   * @private\n   */\n  _optionEx(config, flags, description, fn, defaultValue) {\n    if (typeof flags === 'object' && flags instanceof Option) {\n      throw new Error(\n        'To add an Option object use addOption() instead of option() or requiredOption()',\n      );\n    }\n    const option = this.createOption(flags, description);\n    option.makeOptionMandatory(!!config.mandatory);\n    if (typeof fn === 'function') {\n      option.default(defaultValue).argParser(fn);\n    } else if (fn instanceof RegExp) {\n      // deprecated\n      const regex = fn;\n      fn = (val, def) => {\n        const m = regex.exec(val);\n        return m ? m[0] : def;\n      };\n      option.default(defaultValue).argParser(fn);\n    } else {\n      option.default(fn);\n    }\n\n    return this.addOption(option);\n  }\n\n  /**\n   * Define option with `flags`, `description`, and optional argument parsing function or `defaultValue` or both.\n   *\n   * The `flags` string contains the short and/or long flags, separated by comma, a pipe or space. A required\n   * option-argument is indicated by `<>` and an optional option-argument by `[]`.\n   *\n   * See the README for more details, and see also addOption() and requiredOption().\n   *\n   * @example\n   * program\n   *     .option('-p, --pepper', 'add pepper')\n   *     .option('-p, --pizza-type <TYPE>', 'type of pizza') // required option-argument\n   *     .option('-c, --cheese [CHEESE]', 'add extra cheese', 'mozzarella') // optional option-argument with default\n   *     .option('-t, --tip <VALUE>', 'add tip to purchase cost', parseFloat) // custom parse function\n   *\n   * @param {string} flags\n   * @param {string} [description]\n   * @param {(Function|*)} [parseArg] - custom option processing function or default value\n   * @param {*} [defaultValue]\n   * @return {Command} `this` command for chaining\n   */\n\n  option(flags, description, parseArg, defaultValue) {\n    return this._optionEx({}, flags, description, parseArg, defaultValue);\n  }\n\n  /**\n   * Add a required option which must have a value after parsing. This usually means\n   * the option must be specified on the command line. (Otherwise the same as .option().)\n   *\n   * The `flags` string contains the short and/or long flags, separated by comma, a pipe or space.\n   *\n   * @param {string} flags\n   * @param {string} [description]\n   * @param {(Function|*)} [parseArg] - custom option processing function or default value\n   * @param {*} [defaultValue]\n   * @return {Command} `this` command for chaining\n   */\n\n  requiredOption(flags, description, parseArg, defaultValue) {\n    return this._optionEx(\n      { mandatory: true },\n      flags,\n      description,\n      parseArg,\n      defaultValue,\n    );\n  }\n\n  /**\n   * Alter parsing of short flags with optional values.\n   *\n   * @example\n   * // for `.option('-f,--flag [value]'):\n   * program.combineFlagAndOptionalValue(true);  // `-f80` is treated like `--flag=80`, this is the default behaviour\n   * program.combineFlagAndOptionalValue(false) // `-fb` is treated like `-f -b`\n   *\n   * @param {boolean} [combine] - if `true` or omitted, an optional value can be specified directly after the flag.\n   * @return {Command} `this` command for chaining\n   */\n  combineFlagAndOptionalValue(combine = true) {\n    this._combineFlagAndOptionalValue = !!combine;\n    return this;\n  }\n\n  /**\n   * Allow unknown options on the command line.\n   *\n   * @param {boolean} [allowUnknown] - if `true` or omitted, no error will be thrown for unknown options.\n   * @return {Command} `this` command for chaining\n   */\n  allowUnknownOption(allowUnknown = true) {\n    this._allowUnknownOption = !!allowUnknown;\n    return this;\n  }\n\n  /**\n   * Allow excess command-arguments on the command line. Pass false to make excess arguments an error.\n   *\n   * @param {boolean} [allowExcess] - if `true` or omitted, no error will be thrown for excess arguments.\n   * @return {Command} `this` command for chaining\n   */\n  allowExcessArguments(allowExcess = true) {\n    this._allowExcessArguments = !!allowExcess;\n    return this;\n  }\n\n  /**\n   * Enable positional options. Positional means global options are specified before subcommands which lets\n   * subcommands reuse the same option names, and also enables subcommands to turn on passThroughOptions.\n   * The default behaviour is non-positional and global options may appear anywhere on the command line.\n   *\n   * @param {boolean} [positional]\n   * @return {Command} `this` command for chaining\n   */\n  enablePositionalOptions(positional = true) {\n    this._enablePositionalOptions = !!positional;\n    return this;\n  }\n\n  /**\n   * Pass through options that come after command-arguments rather than treat them as command-options,\n   * so actual command-options come before command-arguments. Turning this on for a subcommand requires\n   * positional options to have been enabled on the program (parent commands).\n   * The default behaviour is non-positional and options may appear before or after command-arguments.\n   *\n   * @param {boolean} [passThrough] for unknown options.\n   * @return {Command} `this` command for chaining\n   */\n  passThroughOptions(passThrough = true) {\n    this._passThroughOptions = !!passThrough;\n    this._checkForBrokenPassThrough();\n    return this;\n  }\n\n  /**\n   * @private\n   */\n\n  _checkForBrokenPassThrough() {\n    if (\n      this.parent &&\n      this._passThroughOptions &&\n      !this.parent._enablePositionalOptions\n    ) {\n      throw new Error(\n        `passThroughOptions cannot be used for '${this._name}' without turning on enablePositionalOptions for parent command(s)`,\n      );\n    }\n  }\n\n  /**\n   * Whether to store option values as properties on command object,\n   * or store separately (specify false). In both cases the option values can be accessed using .opts().\n   *\n   * @param {boolean} [storeAsProperties=true]\n   * @return {Command} `this` command for chaining\n   */\n\n  storeOptionsAsProperties(storeAsProperties = true) {\n    if (this.options.length) {\n      throw new Error('call .storeOptionsAsProperties() before adding options');\n    }\n    if (Object.keys(this._optionValues).length) {\n      throw new Error(\n        'call .storeOptionsAsProperties() before setting option values',\n      );\n    }\n    this._storeOptionsAsProperties = !!storeAsProperties;\n    return this;\n  }\n\n  /**\n   * Retrieve option value.\n   *\n   * @param {string} key\n   * @return {object} value\n   */\n\n  getOptionValue(key) {\n    if (this._storeOptionsAsProperties) {\n      return this[key];\n    }\n    return this._optionValues[key];\n  }\n\n  /**\n   * Store option value.\n   *\n   * @param {string} key\n   * @param {object} value\n   * @return {Command} `this` command for chaining\n   */\n\n  setOptionValue(key, value) {\n    return this.setOptionValueWithSource(key, value, undefined);\n  }\n\n  /**\n   * Store option value and where the value came from.\n   *\n   * @param {string} key\n   * @param {object} value\n   * @param {string} source - expected values are default/config/env/cli/implied\n   * @return {Command} `this` command for chaining\n   */\n\n  setOptionValueWithSource(key, value, source) {\n    if (this._storeOptionsAsProperties) {\n      this[key] = value;\n    } else {\n      this._optionValues[key] = value;\n    }\n    this._optionValueSources[key] = source;\n    return this;\n  }\n\n  /**\n   * Get source of option value.\n   * Expected values are default | config | env | cli | implied\n   *\n   * @param {string} key\n   * @return {string}\n   */\n\n  getOptionValueSource(key) {\n    return this._optionValueSources[key];\n  }\n\n  /**\n   * Get source of option value. See also .optsWithGlobals().\n   * Expected values are default | config | env | cli | implied\n   *\n   * @param {string} key\n   * @return {string}\n   */\n\n  getOptionValueSourceWithGlobals(key) {\n    // global overwrites local, like optsWithGlobals\n    let source;\n    this._getCommandAndAncestors().forEach((cmd) => {\n      if (cmd.getOptionValueSource(key) !== undefined) {\n        source = cmd.getOptionValueSource(key);\n      }\n    });\n    return source;\n  }\n\n  /**\n   * Get user arguments from implied or explicit arguments.\n   * Side-effects: set _scriptPath if args included script. Used for default program name, and subcommand searches.\n   *\n   * @private\n   */\n\n  _prepareUserArgs(argv, parseOptions) {\n    if (argv !== undefined && !Array.isArray(argv)) {\n      throw new Error('first parameter to parse must be array or undefined');\n    }\n    parseOptions = parseOptions || {};\n\n    // auto-detect argument conventions if nothing supplied\n    if (argv === undefined && parseOptions.from === undefined) {\n      if (process.versions?.electron) {\n        parseOptions.from = 'electron';\n      }\n      // check node specific options for scenarios where user CLI args follow executable without scriptname\n      const execArgv = process.execArgv ?? [];\n      if (\n        execArgv.includes('-e') ||\n        execArgv.includes('--eval') ||\n        execArgv.includes('-p') ||\n        execArgv.includes('--print')\n      ) {\n        parseOptions.from = 'eval'; // internal usage, not documented\n      }\n    }\n\n    // default to using process.argv\n    if (argv === undefined) {\n      argv = process.argv;\n    }\n    this.rawArgs = argv.slice();\n\n    // extract the user args and scriptPath\n    let userArgs;\n    switch (parseOptions.from) {\n      case undefined:\n      case 'node':\n        this._scriptPath = argv[1];\n        userArgs = argv.slice(2);\n        break;\n      case 'electron':\n        // @ts-ignore: because defaultApp is an unknown property\n        if (process.defaultApp) {\n          this._scriptPath = argv[1];\n          userArgs = argv.slice(2);\n        } else {\n          userArgs = argv.slice(1);\n        }\n        break;\n      case 'user':\n        userArgs = argv.slice(0);\n        break;\n      case 'eval':\n        userArgs = argv.slice(1);\n        break;\n      default:\n        throw new Error(\n          `unexpected parse option { from: '${parseOptions.from}' }`,\n        );\n    }\n\n    // Find default name for program from arguments.\n    if (!this._name && this._scriptPath)\n      this.nameFromFilename(this._scriptPath);\n    this._name = this._name || 'program';\n\n    return userArgs;\n  }\n\n  /**\n   * Parse `argv`, setting options and invoking commands when defined.\n   *\n   * Use parseAsync instead of parse if any of your action handlers are async.\n   *\n   * Call with no parameters to parse `process.argv`. Detects Electron and special node options like `node --eval`. Easy mode!\n   *\n   * Or call with an array of strings to parse, and optionally where the user arguments start by specifying where the arguments are `from`:\n   * - `'node'`: default, `argv[0]` is the application and `argv[1]` is the script being run, with user arguments after that\n   * - `'electron'`: `argv[0]` is the application and `argv[1]` varies depending on whether the electron application is packaged\n   * - `'user'`: just user arguments\n   *\n   * @example\n   * program.parse(); // parse process.argv and auto-detect electron and special node flags\n   * program.parse(process.argv); // assume argv[0] is app and argv[1] is script\n   * program.parse(my-args, { from: 'user' }); // just user supplied arguments, nothing special about argv[0]\n   *\n   * @param {string[]} [argv] - optional, defaults to process.argv\n   * @param {object} [parseOptions] - optionally specify style of options with from: node/user/electron\n   * @param {string} [parseOptions.from] - where the args are from: 'node', 'user', 'electron'\n   * @return {Command} `this` command for chaining\n   */\n\n  parse(argv, parseOptions) {\n    const userArgs = this._prepareUserArgs(argv, parseOptions);\n    this._parseCommand([], userArgs);\n\n    return this;\n  }\n\n  /**\n   * Parse `argv`, setting options and invoking commands when defined.\n   *\n   * Call with no parameters to parse `process.argv`. Detects Electron and special node options like `node --eval`. Easy mode!\n   *\n   * Or call with an array of strings to parse, and optionally where the user arguments start by specifying where the arguments are `from`:\n   * - `'node'`: default, `argv[0]` is the application and `argv[1]` is the script being run, with user arguments after that\n   * - `'electron'`: `argv[0]` is the application and `argv[1]` varies depending on whether the electron application is packaged\n   * - `'user'`: just user arguments\n   *\n   * @example\n   * await program.parseAsync(); // parse process.argv and auto-detect electron and special node flags\n   * await program.parseAsync(process.argv); // assume argv[0] is app and argv[1] is script\n   * await program.parseAsync(my-args, { from: 'user' }); // just user supplied arguments, nothing special about argv[0]\n   *\n   * @param {string[]} [argv]\n   * @param {object} [parseOptions]\n   * @param {string} parseOptions.from - where the args are from: 'node', 'user', 'electron'\n   * @return {Promise}\n   */\n\n  async parseAsync(argv, parseOptions) {\n    const userArgs = this._prepareUserArgs(argv, parseOptions);\n    await this._parseCommand([], userArgs);\n\n    return this;\n  }\n\n  /**\n   * Execute a sub-command executable.\n   *\n   * @private\n   */\n\n  _executeSubCommand(subcommand, args) {\n    args = args.slice();\n    let launchWithNode = false; // Use node for source targets so do not need to get permissions correct, and on Windows.\n    const sourceExt = ['.js', '.ts', '.tsx', '.mjs', '.cjs'];\n\n    function findFile(baseDir, baseName) {\n      // Look for specified file\n      const localBin = path.resolve(baseDir, baseName);\n      if (fs.existsSync(localBin)) return localBin;\n\n      // Stop looking if candidate already has an expected extension.\n      if (sourceExt.includes(path.extname(baseName))) return undefined;\n\n      // Try all the extensions.\n      const foundExt = sourceExt.find((ext) =>\n        fs.existsSync(`${localBin}${ext}`),\n      );\n      if (foundExt) return `${localBin}${foundExt}`;\n\n      return undefined;\n    }\n\n    // Not checking for help first. Unlikely to have mandatory and executable, and can't robustly test for help flags in external command.\n    this._checkForMissingMandatoryOptions();\n    this._checkForConflictingOptions();\n\n    // executableFile and executableDir might be full path, or just a name\n    let executableFile =\n      subcommand._executableFile || `${this._name}-${subcommand._name}`;\n    let executableDir = this._executableDir || '';\n    if (this._scriptPath) {\n      let resolvedScriptPath; // resolve possible symlink for installed npm binary\n      try {\n        resolvedScriptPath = fs.realpathSync(this._scriptPath);\n      } catch (err) {\n        resolvedScriptPath = this._scriptPath;\n      }\n      executableDir = path.resolve(\n        path.dirname(resolvedScriptPath),\n        executableDir,\n      );\n    }\n\n    // Look for a local file in preference to a command in PATH.\n    if (executableDir) {\n      let localFile = findFile(executableDir, executableFile);\n\n      // Legacy search using prefix of script name instead of command name\n      if (!localFile && !subcommand._executableFile && this._scriptPath) {\n        const legacyName = path.basename(\n          this._scriptPath,\n          path.extname(this._scriptPath),\n        );\n        if (legacyName !== this._name) {\n          localFile = findFile(\n            executableDir,\n            `${legacyName}-${subcommand._name}`,\n          );\n        }\n      }\n      executableFile = localFile || executableFile;\n    }\n\n    launchWithNode = sourceExt.includes(path.extname(executableFile));\n\n    let proc;\n    if (process.platform !== 'win32') {\n      if (launchWithNode) {\n        args.unshift(executableFile);\n        // add executable arguments to spawn\n        args = incrementNodeInspectorPort(process.execArgv).concat(args);\n\n        proc = childProcess.spawn(process.argv[0], args, { stdio: 'inherit' });\n      } else {\n        proc = childProcess.spawn(executableFile, args, { stdio: 'inherit' });\n      }\n    } else {\n      args.unshift(executableFile);\n      // add executable arguments to spawn\n      args = incrementNodeInspectorPort(process.execArgv).concat(args);\n      proc = childProcess.spawn(process.execPath, args, { stdio: 'inherit' });\n    }\n\n    if (!proc.killed) {\n      // testing mainly to avoid leak warnings during unit tests with mocked spawn\n      const signals = ['SIGUSR1', 'SIGUSR2', 'SIGTERM', 'SIGINT', 'SIGHUP'];\n      signals.forEach((signal) => {\n        process.on(signal, () => {\n          if (proc.killed === false && proc.exitCode === null) {\n            // @ts-ignore because signals not typed to known strings\n            proc.kill(signal);\n          }\n        });\n      });\n    }\n\n    // By default terminate process when spawned process terminates.\n    const exitCallback = this._exitCallback;\n    proc.on('close', (code) => {\n      code = code ?? 1; // code is null if spawned process terminated due to a signal\n      if (!exitCallback) {\n        process.exit(code);\n      } else {\n        exitCallback(\n          new CommanderError(\n            code,\n            'commander.executeSubCommandAsync',\n            '(close)',\n          ),\n        );\n      }\n    });\n    proc.on('error', (err) => {\n      // @ts-ignore: because err.code is an unknown property\n      if (err.code === 'ENOENT') {\n        const executableDirMessage = executableDir\n          ? `searched for local subcommand relative to directory '${executableDir}'`\n          : 'no directory for search for local subcommand, use .executableDir() to supply a custom directory';\n        const executableMissing = `'${executableFile}' does not exist\n - if '${subcommand._name}' is not meant to be an executable command, remove description parameter from '.command()' and use '.description()' instead\n - if the default executable name is not suitable, use the executableFile option to supply a custom name or path\n - ${executableDirMessage}`;\n        throw new Error(executableMissing);\n        // @ts-ignore: because err.code is an unknown property\n      } else if (err.code === 'EACCES') {\n        throw new Error(`'${executableFile}' not executable`);\n      }\n      if (!exitCallback) {\n        process.exit(1);\n      } else {\n        const wrappedError = new CommanderError(\n          1,\n          'commander.executeSubCommandAsync',\n          '(error)',\n        );\n        wrappedError.nestedError = err;\n        exitCallback(wrappedError);\n      }\n    });\n\n    // Store the reference to the child process\n    this.runningCommand = proc;\n  }\n\n  /**\n   * @private\n   */\n\n  _dispatchSubcommand(commandName, operands, unknown) {\n    const subCommand = this._findCommand(commandName);\n    if (!subCommand) this.help({ error: true });\n\n    let promiseChain;\n    promiseChain = this._chainOrCallSubCommandHook(\n      promiseChain,\n      subCommand,\n      'preSubcommand',\n    );\n    promiseChain = this._chainOrCall(promiseChain, () => {\n      if (subCommand._executableHandler) {\n        this._executeSubCommand(subCommand, operands.concat(unknown));\n      } else {\n        return subCommand._parseCommand(operands, unknown);\n      }\n    });\n    return promiseChain;\n  }\n\n  /**\n   * Invoke help directly if possible, or dispatch if necessary.\n   * e.g. help foo\n   *\n   * @private\n   */\n\n  _dispatchHelpCommand(subcommandName) {\n    if (!subcommandName) {\n      this.help();\n    }\n    const subCommand = this._findCommand(subcommandName);\n    if (subCommand && !subCommand._executableHandler) {\n      subCommand.help();\n    }\n\n    // Fallback to parsing the help flag to invoke the help.\n    return this._dispatchSubcommand(\n      subcommandName,\n      [],\n      [this._getHelpOption()?.long ?? this._getHelpOption()?.short ?? '--help'],\n    );\n  }\n\n  /**\n   * Check this.args against expected this.registeredArguments.\n   *\n   * @private\n   */\n\n  _checkNumberOfArguments() {\n    // too few\n    this.registeredArguments.forEach((arg, i) => {\n      if (arg.required && this.args[i] == null) {\n        this.missingArgument(arg.name());\n      }\n    });\n    // too many\n    if (\n      this.registeredArguments.length > 0 &&\n      this.registeredArguments[this.registeredArguments.length - 1].variadic\n    ) {\n      return;\n    }\n    if (this.args.length > this.registeredArguments.length) {\n      this._excessArguments(this.args);\n    }\n  }\n\n  /**\n   * Process this.args using this.registeredArguments and save as this.processedArgs!\n   *\n   * @private\n   */\n\n  _processArguments() {\n    const myParseArg = (argument, value, previous) => {\n      // Extra processing for nice error message on parsing failure.\n      let parsedValue = value;\n      if (value !== null && argument.parseArg) {\n        const invalidValueMessage = `error: command-argument value '${value}' is invalid for argument '${argument.name()}'.`;\n        parsedValue = this._callParseArg(\n          argument,\n          value,\n          previous,\n          invalidValueMessage,\n        );\n      }\n      return parsedValue;\n    };\n\n    this._checkNumberOfArguments();\n\n    const processedArgs = [];\n    this.registeredArguments.forEach((declaredArg, index) => {\n      let value = declaredArg.defaultValue;\n      if (declaredArg.variadic) {\n        // Collect together remaining arguments for passing together as an array.\n        if (index < this.args.length) {\n          value = this.args.slice(index);\n          if (declaredArg.parseArg) {\n            value = value.reduce((processed, v) => {\n              return myParseArg(declaredArg, v, processed);\n            }, declaredArg.defaultValue);\n          }\n        } else if (value === undefined) {\n          value = [];\n        }\n      } else if (index < this.args.length) {\n        value = this.args[index];\n        if (declaredArg.parseArg) {\n          value = myParseArg(declaredArg, value, declaredArg.defaultValue);\n        }\n      }\n      processedArgs[index] = value;\n    });\n    this.processedArgs = processedArgs;\n  }\n\n  /**\n   * Once we have a promise we chain, but call synchronously until then.\n   *\n   * @param {(Promise|undefined)} promise\n   * @param {Function} fn\n   * @return {(Promise|undefined)}\n   * @private\n   */\n\n  _chainOrCall(promise, fn) {\n    // thenable\n    if (promise && promise.then && typeof promise.then === 'function') {\n      // already have a promise, chain callback\n      return promise.then(() => fn());\n    }\n    // callback might return a promise\n    return fn();\n  }\n\n  /**\n   *\n   * @param {(Promise|undefined)} promise\n   * @param {string} event\n   * @return {(Promise|undefined)}\n   * @private\n   */\n\n  _chainOrCallHooks(promise, event) {\n    let result = promise;\n    const hooks = [];\n    this._getCommandAndAncestors()\n      .reverse()\n      .filter((cmd) => cmd._lifeCycleHooks[event] !== undefined)\n      .forEach((hookedCommand) => {\n        hookedCommand._lifeCycleHooks[event].forEach((callback) => {\n          hooks.push({ hookedCommand, callback });\n        });\n      });\n    if (event === 'postAction') {\n      hooks.reverse();\n    }\n\n    hooks.forEach((hookDetail) => {\n      result = this._chainOrCall(result, () => {\n        return hookDetail.callback(hookDetail.hookedCommand, this);\n      });\n    });\n    return result;\n  }\n\n  /**\n   *\n   * @param {(Promise|undefined)} promise\n   * @param {Command} subCommand\n   * @param {string} event\n   * @return {(Promise|undefined)}\n   * @private\n   */\n\n  _chainOrCallSubCommandHook(promise, subCommand, event) {\n    let result = promise;\n    if (this._lifeCycleHooks[event] !== undefined) {\n      this._lifeCycleHooks[event].forEach((hook) => {\n        result = this._chainOrCall(result, () => {\n          return hook(this, subCommand);\n        });\n      });\n    }\n    return result;\n  }\n\n  /**\n   * Process arguments in context of this command.\n   * Returns action result, in case it is a promise.\n   *\n   * @private\n   */\n\n  _parseCommand(operands, unknown) {\n    const parsed = this.parseOptions(unknown);\n    this._parseOptionsEnv(); // after cli, so parseArg not called on both cli and env\n    this._parseOptionsImplied();\n    operands = operands.concat(parsed.operands);\n    unknown = parsed.unknown;\n    this.args = operands.concat(unknown);\n\n    if (operands && this._findCommand(operands[0])) {\n      return this._dispatchSubcommand(operands[0], operands.slice(1), unknown);\n    }\n    if (\n      this._getHelpCommand() &&\n      operands[0] === this._getHelpCommand().name()\n    ) {\n      return this._dispatchHelpCommand(operands[1]);\n    }\n    if (this._defaultCommandName) {\n      this._outputHelpIfRequested(unknown); // Run the help for default command from parent rather than passing to default command\n      return this._dispatchSubcommand(\n        this._defaultCommandName,\n        operands,\n        unknown,\n      );\n    }\n    if (\n      this.commands.length &&\n      this.args.length === 0 &&\n      !this._actionHandler &&\n      !this._defaultCommandName\n    ) {\n      // probably missing subcommand and no handler, user needs help (and exit)\n      this.help({ error: true });\n    }\n\n    this._outputHelpIfRequested(parsed.unknown);\n    this._checkForMissingMandatoryOptions();\n    this._checkForConflictingOptions();\n\n    // We do not always call this check to avoid masking a \"better\" error, like unknown command.\n    const checkForUnknownOptions = () => {\n      if (parsed.unknown.length > 0) {\n        this.unknownOption(parsed.unknown[0]);\n      }\n    };\n\n    const commandEvent = `command:${this.name()}`;\n    if (this._actionHandler) {\n      checkForUnknownOptions();\n      this._processArguments();\n\n      let promiseChain;\n      promiseChain = this._chainOrCallHooks(promiseChain, 'preAction');\n      promiseChain = this._chainOrCall(promiseChain, () =>\n        this._actionHandler(this.processedArgs),\n      );\n      if (this.parent) {\n        promiseChain = this._chainOrCall(promiseChain, () => {\n          this.parent.emit(commandEvent, operands, unknown); // legacy\n        });\n      }\n      promiseChain = this._chainOrCallHooks(promiseChain, 'postAction');\n      return promiseChain;\n    }\n    if (this.parent && this.parent.listenerCount(commandEvent)) {\n      checkForUnknownOptions();\n      this._processArguments();\n      this.parent.emit(commandEvent, operands, unknown); // legacy\n    } else if (operands.length) {\n      if (this._findCommand('*')) {\n        // legacy default command\n        return this._dispatchSubcommand('*', operands, unknown);\n      }\n      if (this.listenerCount('command:*')) {\n        // skip option check, emit event for possible misspelling suggestion\n        this.emit('command:*', operands, unknown);\n      } else if (this.commands.length) {\n        this.unknownCommand();\n      } else {\n        checkForUnknownOptions();\n        this._processArguments();\n      }\n    } else if (this.commands.length) {\n      checkForUnknownOptions();\n      // This command has subcommands and nothing hooked up at this level, so display help (and exit).\n      this.help({ error: true });\n    } else {\n      checkForUnknownOptions();\n      this._processArguments();\n      // fall through for caller to handle after calling .parse()\n    }\n  }\n\n  /**\n   * Find matching command.\n   *\n   * @private\n   * @return {Command | undefined}\n   */\n  _findCommand(name) {\n    if (!name) return undefined;\n    return this.commands.find(\n      (cmd) => cmd._name === name || cmd._aliases.includes(name),\n    );\n  }\n\n  /**\n   * Return an option matching `arg` if any.\n   *\n   * @param {string} arg\n   * @return {Option}\n   * @package\n   */\n\n  _findOption(arg) {\n    return this.options.find((option) => option.is(arg));\n  }\n\n  /**\n   * Display an error message if a mandatory option does not have a value.\n   * Called after checking for help flags in leaf subcommand.\n   *\n   * @private\n   */\n\n  _checkForMissingMandatoryOptions() {\n    // Walk up hierarchy so can call in subcommand after checking for displaying help.\n    this._getCommandAndAncestors().forEach((cmd) => {\n      cmd.options.forEach((anOption) => {\n        if (\n          anOption.mandatory &&\n          cmd.getOptionValue(anOption.attributeName()) === undefined\n        ) {\n          cmd.missingMandatoryOptionValue(anOption);\n        }\n      });\n    });\n  }\n\n  /**\n   * Display an error message if conflicting options are used together in this.\n   *\n   * @private\n   */\n  _checkForConflictingLocalOptions() {\n    const definedNonDefaultOptions = this.options.filter((option) => {\n      const optionKey = option.attributeName();\n      if (this.getOptionValue(optionKey) === undefined) {\n        return false;\n      }\n      return this.getOptionValueSource(optionKey) !== 'default';\n    });\n\n    const optionsWithConflicting = definedNonDefaultOptions.filter(\n      (option) => option.conflictsWith.length > 0,\n    );\n\n    optionsWithConflicting.forEach((option) => {\n      const conflictingAndDefined = definedNonDefaultOptions.find((defined) =>\n        option.conflictsWith.includes(defined.attributeName()),\n      );\n      if (conflictingAndDefined) {\n        this._conflictingOption(option, conflictingAndDefined);\n      }\n    });\n  }\n\n  /**\n   * Display an error message if conflicting options are used together.\n   * Called after checking for help flags in leaf subcommand.\n   *\n   * @private\n   */\n  _checkForConflictingOptions() {\n    // Walk up hierarchy so can call in subcommand after checking for displaying help.\n    this._getCommandAndAncestors().forEach((cmd) => {\n      cmd._checkForConflictingLocalOptions();\n    });\n  }\n\n  /**\n   * Parse options from `argv` removing known options,\n   * and return argv split into operands and unknown arguments.\n   *\n   * Examples:\n   *\n   *     argv => operands, unknown\n   *     --known kkk op => [op], []\n   *     op --known kkk => [op], []\n   *     sub --unknown uuu op => [sub], [--unknown uuu op]\n   *     sub -- --unknown uuu op => [sub --unknown uuu op], []\n   *\n   * @param {string[]} argv\n   * @return {{operands: string[], unknown: string[]}}\n   */\n\n  parseOptions(argv) {\n    const operands = []; // operands, not options or values\n    const unknown = []; // first unknown option and remaining unknown args\n    let dest = operands;\n    const args = argv.slice();\n\n    function maybeOption(arg) {\n      return arg.length > 1 && arg[0] === '-';\n    }\n\n    // parse options\n    let activeVariadicOption = null;\n    while (args.length) {\n      const arg = args.shift();\n\n      // literal\n      if (arg === '--') {\n        if (dest === unknown) dest.push(arg);\n        dest.push(...args);\n        break;\n      }\n\n      if (activeVariadicOption && !maybeOption(arg)) {\n        this.emit(`option:${activeVariadicOption.name()}`, arg);\n        continue;\n      }\n      activeVariadicOption = null;\n\n      if (maybeOption(arg)) {\n        const option = this._findOption(arg);\n        // recognised option, call listener to assign value with possible custom processing\n        if (option) {\n          if (option.required) {\n            const value = args.shift();\n            if (value === undefined) this.optionMissingArgument(option);\n            this.emit(`option:${option.name()}`, value);\n          } else if (option.optional) {\n            let value = null;\n            // historical behaviour is optional value is following arg unless an option\n            if (args.length > 0 && !maybeOption(args[0])) {\n              value = args.shift();\n            }\n            this.emit(`option:${option.name()}`, value);\n          } else {\n            // boolean flag\n            this.emit(`option:${option.name()}`);\n          }\n          activeVariadicOption = option.variadic ? option : null;\n          continue;\n        }\n      }\n\n      // Look for combo options following single dash, eat first one if known.\n      if (arg.length > 2 && arg[0] === '-' && arg[1] !== '-') {\n        const option = this._findOption(`-${arg[1]}`);\n        if (option) {\n          if (\n            option.required ||\n            (option.optional && this._combineFlagAndOptionalValue)\n          ) {\n            // option with value following in same argument\n            this.emit(`option:${option.name()}`, arg.slice(2));\n          } else {\n            // boolean option, emit and put back remainder of arg for further processing\n            this.emit(`option:${option.name()}`);\n            args.unshift(`-${arg.slice(2)}`);\n          }\n          continue;\n        }\n      }\n\n      // Look for known long flag with value, like --foo=bar\n      if (/^--[^=]+=/.test(arg)) {\n        const index = arg.indexOf('=');\n        const option = this._findOption(arg.slice(0, index));\n        if (option && (option.required || option.optional)) {\n          this.emit(`option:${option.name()}`, arg.slice(index + 1));\n          continue;\n        }\n      }\n\n      // Not a recognised option by this command.\n      // Might be a command-argument, or subcommand option, or unknown option, or help command or option.\n\n      // An unknown option means further arguments also classified as unknown so can be reprocessed by subcommands.\n      if (maybeOption(arg)) {\n        dest = unknown;\n      }\n\n      // If using positionalOptions, stop processing our options at subcommand.\n      if (\n        (this._enablePositionalOptions || this._passThroughOptions) &&\n        operands.length === 0 &&\n        unknown.length === 0\n      ) {\n        if (this._findCommand(arg)) {\n          operands.push(arg);\n          if (args.length > 0) unknown.push(...args);\n          break;\n        } else if (\n          this._getHelpCommand() &&\n          arg === this._getHelpCommand().name()\n        ) {\n          operands.push(arg);\n          if (args.length > 0) operands.push(...args);\n          break;\n        } else if (this._defaultCommandName) {\n          unknown.push(arg);\n          if (args.length > 0) unknown.push(...args);\n          break;\n        }\n      }\n\n      // If using passThroughOptions, stop processing options at first command-argument.\n      if (this._passThroughOptions) {\n        dest.push(arg);\n        if (args.length > 0) dest.push(...args);\n        break;\n      }\n\n      // add arg\n      dest.push(arg);\n    }\n\n    return { operands, unknown };\n  }\n\n  /**\n   * Return an object containing local option values as key-value pairs.\n   *\n   * @return {object}\n   */\n  opts() {\n    if (this._storeOptionsAsProperties) {\n      // Preserve original behaviour so backwards compatible when still using properties\n      const result = {};\n      const len = this.options.length;\n\n      for (let i = 0; i < len; i++) {\n        const key = this.options[i].attributeName();\n        result[key] =\n          key === this._versionOptionName ? this._version : this[key];\n      }\n      return result;\n    }\n\n    return this._optionValues;\n  }\n\n  /**\n   * Return an object containing merged local and global option values as key-value pairs.\n   *\n   * @return {object}\n   */\n  optsWithGlobals() {\n    // globals overwrite locals\n    return this._getCommandAndAncestors().reduce(\n      (combinedOptions, cmd) => Object.assign(combinedOptions, cmd.opts()),\n      {},\n    );\n  }\n\n  /**\n   * Display error message and exit (or call exitOverride).\n   *\n   * @param {string} message\n   * @param {object} [errorOptions]\n   * @param {string} [errorOptions.code] - an id string representing the error\n   * @param {number} [errorOptions.exitCode] - used with process.exit\n   */\n  error(message, errorOptions) {\n    // output handling\n    this._outputConfiguration.outputError(\n      `${message}\\n`,\n      this._outputConfiguration.writeErr,\n    );\n    if (typeof this._showHelpAfterError === 'string') {\n      this._outputConfiguration.writeErr(`${this._showHelpAfterError}\\n`);\n    } else if (this._showHelpAfterError) {\n      this._outputConfiguration.writeErr('\\n');\n      this.outputHelp({ error: true });\n    }\n\n    // exit handling\n    const config = errorOptions || {};\n    const exitCode = config.exitCode || 1;\n    const code = config.code || 'commander.error';\n    this._exit(exitCode, code, message);\n  }\n\n  /**\n   * Apply any option related environment variables, if option does\n   * not have a value from cli or client code.\n   *\n   * @private\n   */\n  _parseOptionsEnv() {\n    this.options.forEach((option) => {\n      if (option.envVar && option.envVar in process.env) {\n        const optionKey = option.attributeName();\n        // Priority check. Do not overwrite cli or options from unknown source (client-code).\n        if (\n          this.getOptionValue(optionKey) === undefined ||\n          ['default', 'config', 'env'].includes(\n            this.getOptionValueSource(optionKey),\n          )\n        ) {\n          if (option.required || option.optional) {\n            // option can take a value\n            // keep very simple, optional always takes value\n            this.emit(`optionEnv:${option.name()}`, process.env[option.envVar]);\n          } else {\n            // boolean\n            // keep very simple, only care that envVar defined and not the value\n            this.emit(`optionEnv:${option.name()}`);\n          }\n        }\n      }\n    });\n  }\n\n  /**\n   * Apply any implied option values, if option is undefined or default value.\n   *\n   * @private\n   */\n  _parseOptionsImplied() {\n    const dualHelper = new DualOptions(this.options);\n    const hasCustomOptionValue = (optionKey) => {\n      return (\n        this.getOptionValue(optionKey) !== undefined &&\n        !['default', 'implied'].includes(this.getOptionValueSource(optionKey))\n      );\n    };\n    this.options\n      .filter(\n        (option) =>\n          option.implied !== undefined &&\n          hasCustomOptionValue(option.attributeName()) &&\n          dualHelper.valueFromOption(\n            this.getOptionValue(option.attributeName()),\n            option,\n          ),\n      )\n      .forEach((option) => {\n        Object.keys(option.implied)\n          .filter((impliedKey) => !hasCustomOptionValue(impliedKey))\n          .forEach((impliedKey) => {\n            this.setOptionValueWithSource(\n              impliedKey,\n              option.implied[impliedKey],\n              'implied',\n            );\n          });\n      });\n  }\n\n  /**\n   * Argument `name` is missing.\n   *\n   * @param {string} name\n   * @private\n   */\n\n  missingArgument(name) {\n    const message = `error: missing required argument '${name}'`;\n    this.error(message, { code: 'commander.missingArgument' });\n  }\n\n  /**\n   * `Option` is missing an argument.\n   *\n   * @param {Option} option\n   * @private\n   */\n\n  optionMissingArgument(option) {\n    const message = `error: option '${option.flags}' argument missing`;\n    this.error(message, { code: 'commander.optionMissingArgument' });\n  }\n\n  /**\n   * `Option` does not have a value, and is a mandatory option.\n   *\n   * @param {Option} option\n   * @private\n   */\n\n  missingMandatoryOptionValue(option) {\n    const message = `error: required option '${option.flags}' not specified`;\n    this.error(message, { code: 'commander.missingMandatoryOptionValue' });\n  }\n\n  /**\n   * `Option` conflicts with another option.\n   *\n   * @param {Option} option\n   * @param {Option} conflictingOption\n   * @private\n   */\n  _conflictingOption(option, conflictingOption) {\n    // The calling code does not know whether a negated option is the source of the\n    // value, so do some work to take an educated guess.\n    const findBestOptionFromValue = (option) => {\n      const optionKey = option.attributeName();\n      const optionValue = this.getOptionValue(optionKey);\n      const negativeOption = this.options.find(\n        (target) => target.negate && optionKey === target.attributeName(),\n      );\n      const positiveOption = this.options.find(\n        (target) => !target.negate && optionKey === target.attributeName(),\n      );\n      if (\n        negativeOption &&\n        ((negativeOption.presetArg === undefined && optionValue === false) ||\n          (negativeOption.presetArg !== undefined &&\n            optionValue === negativeOption.presetArg))\n      ) {\n        return negativeOption;\n      }\n      return positiveOption || option;\n    };\n\n    const getErrorMessage = (option) => {\n      const bestOption = findBestOptionFromValue(option);\n      const optionKey = bestOption.attributeName();\n      const source = this.getOptionValueSource(optionKey);\n      if (source === 'env') {\n        return `environment variable '${bestOption.envVar}'`;\n      }\n      return `option '${bestOption.flags}'`;\n    };\n\n    const message = `error: ${getErrorMessage(option)} cannot be used with ${getErrorMessage(conflictingOption)}`;\n    this.error(message, { code: 'commander.conflictingOption' });\n  }\n\n  /**\n   * Unknown option `flag`.\n   *\n   * @param {string} flag\n   * @private\n   */\n\n  unknownOption(flag) {\n    if (this._allowUnknownOption) return;\n    let suggestion = '';\n\n    if (flag.startsWith('--') && this._showSuggestionAfterError) {\n      // Looping to pick up the global options too\n      let candidateFlags = [];\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      let command = this;\n      do {\n        const moreFlags = command\n          .createHelp()\n          .visibleOptions(command)\n          .filter((option) => option.long)\n          .map((option) => option.long);\n        candidateFlags = candidateFlags.concat(moreFlags);\n        command = command.parent;\n      } while (command && !command._enablePositionalOptions);\n      suggestion = suggestSimilar(flag, candidateFlags);\n    }\n\n    const message = `error: unknown option '${flag}'${suggestion}`;\n    this.error(message, { code: 'commander.unknownOption' });\n  }\n\n  /**\n   * Excess arguments, more than expected.\n   *\n   * @param {string[]} receivedArgs\n   * @private\n   */\n\n  _excessArguments(receivedArgs) {\n    if (this._allowExcessArguments) return;\n\n    const expected = this.registeredArguments.length;\n    const s = expected === 1 ? '' : 's';\n    const forSubcommand = this.parent ? ` for '${this.name()}'` : '';\n    const message = `error: too many arguments${forSubcommand}. Expected ${expected} argument${s} but got ${receivedArgs.length}.`;\n    this.error(message, { code: 'commander.excessArguments' });\n  }\n\n  /**\n   * Unknown command.\n   *\n   * @private\n   */\n\n  unknownCommand() {\n    const unknownName = this.args[0];\n    let suggestion = '';\n\n    if (this._showSuggestionAfterError) {\n      const candidateNames = [];\n      this.createHelp()\n        .visibleCommands(this)\n        .forEach((command) => {\n          candidateNames.push(command.name());\n          // just visible alias\n          if (command.alias()) candidateNames.push(command.alias());\n        });\n      suggestion = suggestSimilar(unknownName, candidateNames);\n    }\n\n    const message = `error: unknown command '${unknownName}'${suggestion}`;\n    this.error(message, { code: 'commander.unknownCommand' });\n  }\n\n  /**\n   * Get or set the program version.\n   *\n   * This method auto-registers the \"-V, --version\" option which will print the version number.\n   *\n   * You can optionally supply the flags and description to override the defaults.\n   *\n   * @param {string} [str]\n   * @param {string} [flags]\n   * @param {string} [description]\n   * @return {(this | string | undefined)} `this` command for chaining, or version string if no arguments\n   */\n\n  version(str, flags, description) {\n    if (str === undefined) return this._version;\n    this._version = str;\n    flags = flags || '-V, --version';\n    description = description || 'output the version number';\n    const versionOption = this.createOption(flags, description);\n    this._versionOptionName = versionOption.attributeName();\n    this._registerOption(versionOption);\n\n    this.on('option:' + versionOption.name(), () => {\n      this._outputConfiguration.writeOut(`${str}\\n`);\n      this._exit(0, 'commander.version', str);\n    });\n    return this;\n  }\n\n  /**\n   * Set the description.\n   *\n   * @param {string} [str]\n   * @param {object} [argsDescription]\n   * @return {(string|Command)}\n   */\n  description(str, argsDescription) {\n    if (str === undefined && argsDescription === undefined)\n      return this._description;\n    this._description = str;\n    if (argsDescription) {\n      this._argsDescription = argsDescription;\n    }\n    return this;\n  }\n\n  /**\n   * Set the summary. Used when listed as subcommand of parent.\n   *\n   * @param {string} [str]\n   * @return {(string|Command)}\n   */\n  summary(str) {\n    if (str === undefined) return this._summary;\n    this._summary = str;\n    return this;\n  }\n\n  /**\n   * Set an alias for the command.\n   *\n   * You may call more than once to add multiple aliases. Only the first alias is shown in the auto-generated help.\n   *\n   * @param {string} [alias]\n   * @return {(string|Command)}\n   */\n\n  alias(alias) {\n    if (alias === undefined) return this._aliases[0]; // just return first, for backwards compatibility\n\n    /** @type {Command} */\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    let command = this;\n    if (\n      this.commands.length !== 0 &&\n      this.commands[this.commands.length - 1]._executableHandler\n    ) {\n      // assume adding alias for last added executable subcommand, rather than this\n      command = this.commands[this.commands.length - 1];\n    }\n\n    if (alias === command._name)\n      throw new Error(\"Command alias can't be the same as its name\");\n    const matchingCommand = this.parent?._findCommand(alias);\n    if (matchingCommand) {\n      // c.f. _registerCommand\n      const existingCmd = [matchingCommand.name()]\n        .concat(matchingCommand.aliases())\n        .join('|');\n      throw new Error(\n        `cannot add alias '${alias}' to command '${this.name()}' as already have command '${existingCmd}'`,\n      );\n    }\n\n    command._aliases.push(alias);\n    return this;\n  }\n\n  /**\n   * Set aliases for the command.\n   *\n   * Only the first alias is shown in the auto-generated help.\n   *\n   * @param {string[]} [aliases]\n   * @return {(string[]|Command)}\n   */\n\n  aliases(aliases) {\n    // Getter for the array of aliases is the main reason for having aliases() in addition to alias().\n    if (aliases === undefined) return this._aliases;\n\n    aliases.forEach((alias) => this.alias(alias));\n    return this;\n  }\n\n  /**\n   * Set / get the command usage `str`.\n   *\n   * @param {string} [str]\n   * @return {(string|Command)}\n   */\n\n  usage(str) {\n    if (str === undefined) {\n      if (this._usage) return this._usage;\n\n      const args = this.registeredArguments.map((arg) => {\n        return humanReadableArgName(arg);\n      });\n      return []\n        .concat(\n          this.options.length || this._helpOption !== null ? '[options]' : [],\n          this.commands.length ? '[command]' : [],\n          this.registeredArguments.length ? args : [],\n        )\n        .join(' ');\n    }\n\n    this._usage = str;\n    return this;\n  }\n\n  /**\n   * Get or set the name of the command.\n   *\n   * @param {string} [str]\n   * @return {(string|Command)}\n   */\n\n  name(str) {\n    if (str === undefined) return this._name;\n    this._name = str;\n    return this;\n  }\n\n  /**\n   * Set the name of the command from script filename, such as process.argv[1],\n   * or require.main.filename, or __filename.\n   *\n   * (Used internally and public although not documented in README.)\n   *\n   * @example\n   * program.nameFromFilename(require.main.filename);\n   *\n   * @param {string} filename\n   * @return {Command}\n   */\n\n  nameFromFilename(filename) {\n    this._name = path.basename(filename, path.extname(filename));\n\n    return this;\n  }\n\n  /**\n   * Get or set the directory for searching for executable subcommands of this command.\n   *\n   * @example\n   * program.executableDir(__dirname);\n   * // or\n   * program.executableDir('subcommands');\n   *\n   * @param {string} [path]\n   * @return {(string|null|Command)}\n   */\n\n  executableDir(path) {\n    if (path === undefined) return this._executableDir;\n    this._executableDir = path;\n    return this;\n  }\n\n  /**\n   * Return program help documentation.\n   *\n   * @param {{ error: boolean }} [contextOptions] - pass {error:true} to wrap for stderr instead of stdout\n   * @return {string}\n   */\n\n  helpInformation(contextOptions) {\n    const helper = this.createHelp();\n    if (helper.helpWidth === undefined) {\n      helper.helpWidth =\n        contextOptions && contextOptions.error\n          ? this._outputConfiguration.getErrHelpWidth()\n          : this._outputConfiguration.getOutHelpWidth();\n    }\n    return helper.formatHelp(this, helper);\n  }\n\n  /**\n   * @private\n   */\n\n  _getHelpContext(contextOptions) {\n    contextOptions = contextOptions || {};\n    const context = { error: !!contextOptions.error };\n    let write;\n    if (context.error) {\n      write = (arg) => this._outputConfiguration.writeErr(arg);\n    } else {\n      write = (arg) => this._outputConfiguration.writeOut(arg);\n    }\n    context.write = contextOptions.write || write;\n    context.command = this;\n    return context;\n  }\n\n  /**\n   * Output help information for this command.\n   *\n   * Outputs built-in help, and custom text added using `.addHelpText()`.\n   *\n   * @param {{ error: boolean } | Function} [contextOptions] - pass {error:true} to write to stderr instead of stdout\n   */\n\n  outputHelp(contextOptions) {\n    let deprecatedCallback;\n    if (typeof contextOptions === 'function') {\n      deprecatedCallback = contextOptions;\n      contextOptions = undefined;\n    }\n    const context = this._getHelpContext(contextOptions);\n\n    this._getCommandAndAncestors()\n      .reverse()\n      .forEach((command) => command.emit('beforeAllHelp', context));\n    this.emit('beforeHelp', context);\n\n    let helpInformation = this.helpInformation(context);\n    if (deprecatedCallback) {\n      helpInformation = deprecatedCallback(helpInformation);\n      if (\n        typeof helpInformation !== 'string' &&\n        !Buffer.isBuffer(helpInformation)\n      ) {\n        throw new Error('outputHelp callback must return a string or a Buffer');\n      }\n    }\n    context.write(helpInformation);\n\n    if (this._getHelpOption()?.long) {\n      this.emit(this._getHelpOption().long); // deprecated\n    }\n    this.emit('afterHelp', context);\n    this._getCommandAndAncestors().forEach((command) =>\n      command.emit('afterAllHelp', context),\n    );\n  }\n\n  /**\n   * You can pass in flags and a description to customise the built-in help option.\n   * Pass in false to disable the built-in help option.\n   *\n   * @example\n   * program.helpOption('-?, --help' 'show help'); // customise\n   * program.helpOption(false); // disable\n   *\n   * @param {(string | boolean)} flags\n   * @param {string} [description]\n   * @return {Command} `this` command for chaining\n   */\n\n  helpOption(flags, description) {\n    // Support disabling built-in help option.\n    if (typeof flags === 'boolean') {\n      if (flags) {\n        this._helpOption = this._helpOption ?? undefined; // preserve existing option\n      } else {\n        this._helpOption = null; // disable\n      }\n      return this;\n    }\n\n    // Customise flags and description.\n    flags = flags ?? '-h, --help';\n    description = description ?? 'display help for command';\n    this._helpOption = this.createOption(flags, description);\n\n    return this;\n  }\n\n  /**\n   * Lazy create help option.\n   * Returns null if has been disabled with .helpOption(false).\n   *\n   * @returns {(Option | null)} the help option\n   * @package\n   */\n  _getHelpOption() {\n    // Lazy create help option on demand.\n    if (this._helpOption === undefined) {\n      this.helpOption(undefined, undefined);\n    }\n    return this._helpOption;\n  }\n\n  /**\n   * Supply your own option to use for the built-in help option.\n   * This is an alternative to using helpOption() to customise the flags and description etc.\n   *\n   * @param {Option} option\n   * @return {Command} `this` command for chaining\n   */\n  addHelpOption(option) {\n    this._helpOption = option;\n    return this;\n  }\n\n  /**\n   * Output help information and exit.\n   *\n   * Outputs built-in help, and custom text added using `.addHelpText()`.\n   *\n   * @param {{ error: boolean }} [contextOptions] - pass {error:true} to write to stderr instead of stdout\n   */\n\n  help(contextOptions) {\n    this.outputHelp(contextOptions);\n    let exitCode = process.exitCode || 0;\n    if (\n      exitCode === 0 &&\n      contextOptions &&\n      typeof contextOptions !== 'function' &&\n      contextOptions.error\n    ) {\n      exitCode = 1;\n    }\n    // message: do not have all displayed text available so only passing placeholder.\n    this._exit(exitCode, 'commander.help', '(outputHelp)');\n  }\n\n  /**\n   * Add additional text to be displayed with the built-in help.\n   *\n   * Position is 'before' or 'after' to affect just this command,\n   * and 'beforeAll' or 'afterAll' to affect this command and all its subcommands.\n   *\n   * @param {string} position - before or after built-in help\n   * @param {(string | Function)} text - string to add, or a function returning a string\n   * @return {Command} `this` command for chaining\n   */\n  addHelpText(position, text) {\n    const allowedValues = ['beforeAll', 'before', 'after', 'afterAll'];\n    if (!allowedValues.includes(position)) {\n      throw new Error(`Unexpected value for position to addHelpText.\nExpecting one of '${allowedValues.join(\"', '\")}'`);\n    }\n    const helpEvent = `${position}Help`;\n    this.on(helpEvent, (context) => {\n      let helpStr;\n      if (typeof text === 'function') {\n        helpStr = text({ error: context.error, command: context.command });\n      } else {\n        helpStr = text;\n      }\n      // Ignore falsy value when nothing to output.\n      if (helpStr) {\n        context.write(`${helpStr}\\n`);\n      }\n    });\n    return this;\n  }\n\n  /**\n   * Output help information if help flags specified\n   *\n   * @param {Array} args - array of options to search for help flags\n   * @private\n   */\n\n  _outputHelpIfRequested(args) {\n    const helpOption = this._getHelpOption();\n    const helpRequested = helpOption && args.find((arg) => helpOption.is(arg));\n    if (helpRequested) {\n      this.outputHelp();\n      // (Do not have all displayed text available so only passing placeholder.)\n      this._exit(0, 'commander.helpDisplayed', '(outputHelp)');\n    }\n  }\n}\n\n/**\n * Scan arguments and increment port number for inspect calls (to avoid conflicts when spawning new command).\n *\n * @param {string[]} args - array of arguments from node.execArgv\n * @returns {string[]}\n * @private\n */\n\nfunction incrementNodeInspectorPort(args) {\n  // Testing for these options:\n  //  --inspect[=[host:]port]\n  //  --inspect-brk[=[host:]port]\n  //  --inspect-port=[host:]port\n  return args.map((arg) => {\n    if (!arg.startsWith('--inspect')) {\n      return arg;\n    }\n    let debugOption;\n    let debugHost = '127.0.0.1';\n    let debugPort = '9229';\n    let match;\n    if ((match = arg.match(/^(--inspect(-brk)?)$/)) !== null) {\n      // e.g. --inspect\n      debugOption = match[1];\n    } else if (\n      (match = arg.match(/^(--inspect(-brk|-port)?)=([^:]+)$/)) !== null\n    ) {\n      debugOption = match[1];\n      if (/^\\d+$/.test(match[3])) {\n        // e.g. --inspect=1234\n        debugPort = match[3];\n      } else {\n        // e.g. --inspect=localhost\n        debugHost = match[3];\n      }\n    } else if (\n      (match = arg.match(/^(--inspect(-brk|-port)?)=([^:]+):(\\d+)$/)) !== null\n    ) {\n      // e.g. --inspect=localhost:1234\n      debugOption = match[1];\n      debugHost = match[3];\n      debugPort = match[4];\n    }\n\n    if (debugOption && debugPort !== '0') {\n      return `${debugOption}=${debugHost}:${parseInt(debugPort) + 1}`;\n    }\n    return arg;\n  });\n}\n\nexports.Command = Command;\n", "const { Argument } = require('./lib/argument.js');\nconst { Command } = require('./lib/command.js');\nconst { CommanderError, InvalidArgumentError } = require('./lib/error.js');\nconst { Help } = require('./lib/help.js');\nconst { Option } = require('./lib/option.js');\n\nexports.program = new Command();\n\nexports.createCommand = (name) => new Command(name);\nexports.createOption = (flags, description) => new Option(flags, description);\nexports.createArgument = (name, description) => new Argument(name, description);\n\n/**\n * Expose classes\n */\n\nexports.Command = Command;\nexports.Option = Option;\nexports.Argument = Argument;\nexports.Help = Help;\n\nexports.CommanderError = CommanderError;\nexports.InvalidArgumentError = InvalidArgumentError;\nexports.InvalidOptionArgumentError = InvalidArgumentError; // Deprecated\n", "\n        // Mock electron module for CLI\n        export const app = null\n        export default { app: null }\n      ", "import commander from './index.js';\n\n// wrapper to provide named exports for ESM.\nexport const {\n  program,\n  createCommand,\n  createArgument,\n  createOption,\n  CommanderError,\n  InvalidArgumentError,\n  InvalidOptionArgumentError, // deprecated old name\n  Command,\n  Argument,\n  Option,\n  Help,\n} = commander;\n", "/**\n * Drapp CLI - Video Archival Tool\n *\n * A command-line interface for batch video encoding using AV1/H.265\n * Designed for Linux terminal-only environments\n */\n\nimport { Command } from 'commander'\nimport { existsSync, mkdirSync, writeFileSync, readFileSync } from 'node:fs'\nimport { join } from 'node:path'\nimport { homedir } from 'node:os'\nimport { archiveCommand } from './commands/archive.js'\nimport { style } from './ui/tui.js'\n\n// Config directory\nconst CONFIG_DIR = join(homedir(), '.drapp')\nconst CONFIG_FILE = join(CONFIG_DIR, 'cli-config.json')\n\ninterface CLIConfig {\n  firstRunComplete: boolean\n  version: string\n}\n\nfunction loadConfig(): CLIConfig {\n  try {\n    if (existsSync(CONFIG_FILE)) {\n      return JSON.parse(readFileSync(CONFIG_FILE, 'utf-8'))\n    }\n  } catch {\n    // Ignore errors, return default\n  }\n  return { firstRunComplete: false, version: '0.1.0' }\n}\n\nfunction saveConfig(config: CLIConfig): void {\n  try {\n    if (!existsSync(CONFIG_DIR)) {\n      mkdirSync(CONFIG_DIR, { recursive: true })\n    }\n    writeFileSync(CONFIG_FILE, JSON.stringify(config, null, 2))\n  } catch {\n    // Ignore errors\n  }\n}\n\nfunction showFirstRunWelcome(): void {\n  console.log(`\n${style.cyan}\u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E${style.reset}\n${style.cyan}\u2502${style.reset}                                                            ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.bold}Welcome to Drapp CLI!${style.reset}                                   ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.dim}Video archival made simple${style.reset}                              ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}                                                            ${style.cyan}\u2502${style.reset}\n${style.cyan}\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524${style.reset}\n${style.cyan}\u2502${style.reset}                                                            ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.bold}Quick Start:${style.reset}                                           ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}                                                            ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.green}Interactive mode${style.reset} (recommended for beginners):          ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}    ${style.cyan}drapp archive --interactive${style.reset}                          ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}    ${style.cyan}drapp archive -i${style.reset}                                     ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}                                                            ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.green}Direct mode${style.reset} (for automation/scripts):                  ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}    ${style.cyan}drapp archive /path/to/videos /path/to/output${style.reset}        ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}                                                            ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.green}Get help:${style.reset}                                              ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}    ${style.cyan}drapp archive --help${style.reset}                                 ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}                                                            ${style.cyan}\u2502${style.reset}\n${style.cyan}\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524${style.reset}\n${style.cyan}\u2502${style.reset}                                                            ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.dim}Tip: Use the interactive wizard to browse files and${style.reset}      ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.dim}configure settings without memorizing command flags!${style.reset}     ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}                                                            ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F${style.reset}\n`)\n}\n\n// Check for first run\nconst config = loadConfig()\nconst args = process.argv.slice(2)\n\n// Show welcome on first run (only if no arguments or just 'help')\nif (!config.firstRunComplete && (args.length === 0 || args[0] === 'help' || args[0] === '--help' || args[0] === '-h')) {\n  showFirstRunWelcome()\n  config.firstRunComplete = true\n  saveConfig(config)\n\n  // If no arguments, exit after showing welcome\n  if (args.length === 0) {\n    process.exit(0)\n  }\n}\n\nconst program = new Command()\n\nprogram\n  .name('drapp')\n  .description('Video archival tool - batch encode videos using AV1/H.265')\n  .version('0.1.0')\n\n// Register commands\nprogram.addCommand(archiveCommand)\n\n// Default action - show help or launch interactive\nprogram.action(() => {\n  // No subcommand provided, suggest interactive mode\n  console.log(`\n${style.bold}Drapp CLI${style.reset} - Video archival tool\n\n${style.dim}Usage:${style.reset}\n  drapp archive [options] <input> <output>\n  drapp archive --interactive\n\n${style.dim}Quick start:${style.reset}\n  ${style.cyan}drapp archive -i${style.reset}  Launch interactive wizard\n\n${style.dim}For more options:${style.reset}\n  ${style.cyan}drapp archive --help${style.reset}\n`)\n})\n\n// Parse arguments\nprogram.parse()\n", "/**\n * Archive Command - Batch encode videos using AV1/H.265\n * Features a friendly TUI for non-technical users\n * Full feature parity with GUI version\n */\n\nimport { Command } from 'commander'\nimport { readdir, stat, access, mkdir } from 'node:fs/promises'\nimport { join, extname, basename, relative } from 'node:path'\nimport { ArchivalService } from '../../main/services/archival/archival.service.js'\nimport {\n  DEFAULT_ARCHIVAL_CONFIG,\n  formatEta,\n  formatSpeed,\n  type ArchivalEncodingConfig,\n  type ArchivalProgressEvent,\n  type ArchivalCodec,\n  type ArchivalPreset,\n  type ArchivalResolution,\n  type Av1Encoder,\n  ARCHIVAL_PRESETS\n} from '../../shared/types/archival.types.js'\nimport { TUI, printWelcome, printError, printSummary, style } from '../ui/tui.js'\nimport { runWizard } from '../ui/wizard.js'\n\n// Supported video extensions\nconst VIDEO_EXTENSIONS = new Set([\n  '.mp4', '.mkv', '.mov', '.webm', '.avi',\n  '.m4v', '.ts', '.mts', '.m2ts', '.flv', '.wmv'\n])\n\n/**\n * Recursively find all video files in a directory\n */\nasync function findVideoFiles(\n  rootPath: string,\n  basePath: string = rootPath\n): Promise<Array<{ absolutePath: string; relativePath: string }>> {\n  const files: Array<{ absolutePath: string; relativePath: string }> = []\n  const ignoredDirs = new Set(['.drapp', '.git', 'node_modules', '$RECYCLE.BIN', 'System Volume Information'])\n\n  async function walk(dir: string): Promise<void> {\n    try {\n      const entries = await readdir(dir, { withFileTypes: true })\n\n      for (const entry of entries) {\n        const fullPath = join(dir, entry.name)\n\n        if (entry.isDirectory()) {\n          if (ignoredDirs.has(entry.name) || entry.name.startsWith('.')) {\n            continue\n          }\n          await walk(fullPath)\n        } else if (entry.isFile()) {\n          const ext = extname(entry.name).toLowerCase()\n          if (VIDEO_EXTENSIONS.has(ext)) {\n            files.push({\n              absolutePath: fullPath,\n              relativePath: relative(basePath, fullPath)\n            })\n          }\n        }\n      }\n    } catch {\n      // Skip directories we can't read\n    }\n  }\n\n  await walk(rootPath)\n  return files\n}\n\n// Track state for TUI updates\ninterface TUITracker {\n  completed: number\n  skipped: number\n  failed: number\n  savedBytes: number\n}\n\n/**\n * Create progress handler that updates the TUI\n */\nfunction createTUIProgressHandler(\n  tui: TUI,\n  fileNames: string[],\n  tracker: TUITracker\n): (event: ArchivalProgressEvent) => void {\n  return (event: ArchivalProgressEvent) => {\n    switch (event.kind) {\n      case 'item_start':\n        tui.update({\n          status: 'analyzing',\n          currentFile: fileNames[event.processedItems ?? 0] || 'Unknown',\n          currentFileIndex: (event.processedItems ?? 0) + 1,\n          fileProgress: 0\n        })\n        break\n\n      case 'item_progress':\n        tui.update({\n          status: 'encoding',\n          fileProgress: event.progress ?? 0,\n          batchProgress: event.batchProgress ?? 0,\n          speed: event.encodingSpeed ? formatSpeed(event.encodingSpeed) : '--',\n          fileEta: event.itemEtaSeconds !== undefined ? formatEta(event.itemEtaSeconds) : '--',\n          batchEta: event.batchEtaSeconds !== undefined ? formatEta(event.batchEtaSeconds) : '--',\n          currentFileIndex: (event.processedItems ?? 0) + 1\n        })\n        break\n\n      case 'item_complete':\n        if (event.status === 'completed') {\n          tracker.completed++\n          // Track compression savings\n          if (event.outputSize && event.compressionRatio && event.compressionRatio > 1) {\n            const inputSize = event.outputSize * event.compressionRatio\n            tracker.savedBytes += inputSize - event.outputSize\n          }\n          tui.update({\n            completed: tracker.completed,\n            savedBytes: tracker.savedBytes,\n            fileProgress: 100\n          })\n        } else if (event.status === 'skipped') {\n          tracker.skipped++\n          tui.update({ skipped: tracker.skipped })\n        }\n        break\n\n      case 'item_error':\n        tracker.failed++\n        tui.update({ failed: tracker.failed })\n        break\n\n      case 'batch_complete':\n        tui.update({\n          status: 'complete',\n          batchProgress: 100,\n          fileProgress: 100\n        })\n        break\n    }\n  }\n}\n\n/**\n * Simple progress handler for non-TUI mode\n */\nfunction createSimpleProgressHandler(): (event: ArchivalProgressEvent) => void {\n  let lastUpdate = 0\n\n  return (event: ArchivalProgressEvent) => {\n    const now = Date.now()\n\n    // Throttle updates\n    if (now - lastUpdate < 200 && event.kind === 'item_progress') {\n      return\n    }\n    lastUpdate = now\n\n    switch (event.kind) {\n      case 'item_start':\n        console.log(`\\n${style.cyan}\u2192${style.reset} Starting video...`)\n        break\n\n      case 'item_progress':\n        if (event.progress !== undefined) {\n          const progress = event.progress\n          const speed = event.encodingSpeed ? formatSpeed(event.encodingSpeed) : '--'\n          const eta = event.itemEtaSeconds !== undefined ? formatEta(event.itemEtaSeconds) : '--'\n\n          process.stdout.write(`\\r  Progress: ${progress}%  Speed: ${speed}  ETA: ${eta}    `)\n        }\n        break\n\n      case 'item_complete':\n        process.stdout.write('\\r\\x1b[K')\n        if (event.status === 'completed') {\n          console.log(`  ${style.green}\u2713${style.reset} Completed`)\n        } else if (event.status === 'skipped') {\n          console.log(`  ${style.yellow}\u25CB${style.reset} Skipped`)\n        }\n        break\n\n      case 'item_error':\n        process.stdout.write('\\r\\x1b[K')\n        console.log(`  ${style.red}\u2717${style.reset} Failed: ${event.error || 'Unknown error'}`)\n        break\n\n      case 'batch_complete':\n        console.log(`\\n${style.green}\u2713 Batch complete${style.reset}`)\n        break\n    }\n  }\n}\n\nexport const archiveCommand = new Command('archive')\n  .description('Batch encode videos using AV1 or H.265')\n  .argument('[input]', 'Input file or directory (optional with --interactive)')\n  .argument('[output]', 'Output directory (optional with --interactive)')\n\n  // === Interactive Mode ===\n  .option('-i, --interactive', 'Launch interactive wizard to select files and configure settings', false)\n\n  // === Basic Settings ===\n  .option('-c, --codec <codec>', 'Codec: av1 or h265', 'av1')\n  .option('-p, --preset <preset>', 'Quality preset: archive, max-compression, or fast', 'archive')\n  .option('--container <format>', 'Container: mkv, mp4, or webm', 'mkv')\n\n  // === Resolution ===\n  .option('--resolution <res>', 'Target resolution: source, 4k, 1440p, 1080p, 720p, 480p, 360p', 'source')\n\n  // === AV1 Settings ===\n  .option('--av1-encoder <encoder>', 'AV1 encoder: libsvtav1 (fast) or libaom-av1 (quality)', 'libsvtav1')\n  .option('--av1-preset <number>', 'AV1 speed preset: 0-13 for SVT, 0-8 for libaom (lower=slower/better)', '6')\n  .option('--av1-crf <number>', 'AV1 CRF value: 0-63 (lower=better quality)')\n  .option('--film-grain <number>', 'Film grain synthesis: 0-50 (0=off, helps with noisy video)', '10')\n\n  // === H.265 Settings ===\n  .option('--h265-preset <preset>', 'H.265 speed: ultrafast,superfast,veryfast,faster,fast,medium,slow,slower,veryslow', 'medium')\n  .option('--h265-crf <number>', 'H.265 CRF value: 0-51 (lower=better quality)')\n  .option('--h265-tune <tune>', 'H.265 tune: film, animation, grain, fastdecode, zerolatency')\n  .option('--h265-bframes <number>', 'H.265 B-frames: 0-16', '4')\n\n  // === Audio Settings ===\n  .option('--audio-copy', 'Copy audio without re-encoding (default)', true)\n  .option('--no-audio-copy', 'Re-encode audio')\n  .option('--audio-codec <codec>', 'Audio codec if re-encoding: opus, aac, flac', 'aac')\n  .option('--audio-bitrate <kbps>', 'Audio bitrate in kbps', '160')\n\n  // === Encoding Options ===\n  .option('--two-pass', 'Enable two-pass encoding (better quality, slower)', false)\n  .option('--threads <number>', 'Limit encoder threads: 0, 4, or 6 (0=unlimited)', '0')\n\n  // === Output Behavior ===\n  .option('--overwrite', 'Overwrite existing output files', false)\n  .option('--fill-mode', 'Skip files that would conflict with existing outputs', false)\n  .option('--preserve-structure', 'Preserve folder structure from input', false)\n  .option('--delete-if-larger', 'Delete output if larger than input', true)\n  .option('--no-delete-if-larger', 'Keep output even if larger than input')\n  .option('--delete-original', 'Delete original files after successful encoding (DANGEROUS)', false)\n\n  // === Extras ===\n  .option('--thumbnail', 'Extract thumbnail from encoded video', false)\n  .option('--captions', 'Extract captions using Whisper transcription', false)\n  .option('--caption-lang <lang>', 'Language for captions: en, es, auto, etc.', 'auto')\n\n  // === UI ===\n  .option('--simple', 'Use simple text output instead of visual interface', false)\n\n  .action(async (input: string | undefined, output: string | undefined, options) => {\n    // Handle interactive mode\n    if (options.interactive || (!input && !output)) {\n      if (!process.stdout.isTTY) {\n        console.error(`${style.red}Error:${style.reset} Interactive mode requires a terminal`)\n        process.exit(1)\n      }\n\n      const wizardResult = await runWizard()\n      if (wizardResult.cancelled) {\n        console.log(`\\n${style.yellow}Cancelled${style.reset}`)\n        process.exit(0)\n      }\n\n      // Use wizard results\n      input = wizardResult.inputPaths[0]\n      output = wizardResult.outputPath\n\n      // Apply wizard options to command options\n      options = {\n        ...options,\n        codec: wizardResult.options.codec,\n        preset: wizardResult.options.preset,\n        resolution: wizardResult.options.resolution,\n        container: wizardResult.options.container,\n        av1Encoder: wizardResult.options.av1Encoder,\n        av1Preset: String(wizardResult.options.av1Preset),\n        av1Crf: wizardResult.options.av1Crf ? String(wizardResult.options.av1Crf) : undefined,\n        filmGrain: String(wizardResult.options.filmGrain),\n        h265Preset: wizardResult.options.h265Preset,\n        h265Crf: wizardResult.options.h265Crf ? String(wizardResult.options.h265Crf) : undefined,\n        h265Tune: wizardResult.options.h265Tune,\n        audioCopy: wizardResult.options.audioCopy,\n        audioCodec: wizardResult.options.audioCodec,\n        audioBitrate: String(wizardResult.options.audioBitrate),\n        twoPass: wizardResult.options.twoPass,\n        overwrite: wizardResult.options.overwrite,\n        fillMode: wizardResult.options.fillMode,\n        deleteIfLarger: wizardResult.options.deleteIfLarger,\n        deleteOriginal: wizardResult.options.deleteOriginal,\n        preserveStructure: wizardResult.options.preserveStructure,\n        thumbnail: wizardResult.options.extractThumbnail,\n        captions: wizardResult.options.extractCaptions,\n        captionLang: wizardResult.options.captionLanguage,\n        threads: String(wizardResult.options.threadLimit),\n        simple: wizardResult.options.simple\n      }\n\n      // If wizard provided folder root and relative paths, use them\n      if (wizardResult.folderRoot && wizardResult.relativePaths) {\n        ;(options as any)._wizardFolderRoot = wizardResult.folderRoot\n        ;(options as any)._wizardRelativePaths = wizardResult.relativePaths\n      }\n\n      // If files were selected (even just 1), use them directly\n      // This handles both multi-select and folder selection with any number of videos\n      if (wizardResult.inputPaths.length >= 1) {\n        ;(options as any)._wizardInputPaths = wizardResult.inputPaths\n      }\n    }\n\n    // Validate that we have input and output\n    if (!input || !output) {\n      console.error(`${style.red}Error:${style.reset} Input and output paths are required`)\n      console.log(`\\nUsage: drapp archive <input> <output>`)\n      console.log(`   or: drapp archive --interactive`)\n      process.exit(1)\n    }\n\n    const useTUI = !options.simple && process.stdout.isTTY\n\n    // Initialize TUI\n    let tui: TUI | null = null\n    let service: ArchivalService | null = null\n    const tracker: TUITracker = { completed: 0, skipped: 0, failed: 0, savedBytes: 0 }\n\n    // Graceful shutdown handler\n    const shutdown = () => {\n      if (tui) {\n        tui.stop()\n      }\n      if (service) {\n        service.cancel()\n      }\n      console.log(`\\n${style.yellow}Encoding cancelled${style.reset}`)\n      process.exit(130) // Standard exit code for SIGINT\n    }\n\n    // Register shutdown handlers\n    process.on('SIGINT', shutdown)\n    process.on('SIGTERM', shutdown)\n\n    try {\n      // Validate input\n      try {\n        await access(input)\n      } catch {\n        if (useTUI) {\n          printError('Input path not found', input)\n        } else {\n          console.error(`${style.red}Error:${style.reset} Input path not found: ${input}`)\n        }\n        process.exit(1)\n      }\n\n      const codec = options.codec as ArchivalCodec\n      const preset = options.preset as ArchivalPreset\n\n      // Show welcome in simple mode\n      if (!useTUI) {\n        printWelcome(codec, preset)\n      }\n\n      // Check if input is file or directory\n      const inputStat = await stat(input)\n      let inputPaths: string[] = []\n      let relativePaths: string[] = []\n      let folderRoot: string | undefined\n      let fileNames: string[] = []\n\n      // Check if wizard provided multiple paths with folder structure\n      const wizardPaths = (options as any)._wizardInputPaths as string[] | undefined\n      const wizardFolderRoot = (options as any)._wizardFolderRoot as string | undefined\n      const wizardRelativePaths = (options as any)._wizardRelativePaths as string[] | undefined\n\n      if (wizardPaths && wizardPaths.length > 0) {\n        // Use wizard-selected paths directly\n        inputPaths = wizardPaths\n\n        // Use wizard relative paths if provided (for preserve structure)\n        if (wizardRelativePaths && wizardRelativePaths.length === wizardPaths.length) {\n          relativePaths = wizardRelativePaths\n          folderRoot = wizardFolderRoot\n        } else {\n          relativePaths = wizardPaths.map(p => basename(p))\n        }\n        fileNames = relativePaths\n\n        if (!useTUI) {\n          console.log(`Selected ${style.cyan}${inputPaths.length}${style.reset} files`)\n          if (options.preserveStructure && folderRoot) {\n            console.log(`${style.dim}Preserving folder structure from: ${folderRoot}${style.reset}`)\n          }\n          console.log()\n        }\n      } else if (inputStat.isDirectory()) {\n        if (!useTUI) {\n          console.log(`${style.dim}Scanning directory...${style.reset}`)\n        }\n\n        const files = await findVideoFiles(input)\n\n        if (files.length === 0) {\n          if (useTUI) {\n            printError('No video files found', `in ${input}`)\n          } else {\n            console.error(`${style.red}Error:${style.reset} No video files found in ${input}`)\n          }\n          process.exit(1)\n        }\n\n        inputPaths = files.map(f => f.absolutePath)\n        relativePaths = files.map(f => f.relativePath)\n        fileNames = files.map(f => f.relativePath)\n        folderRoot = input\n\n        if (!useTUI) {\n          console.log(`Found ${style.cyan}${files.length}${style.reset} video files\\n`)\n        }\n      } else {\n        inputPaths = [input]\n        relativePaths = [basename(input)]\n        fileNames = [basename(input)]\n      }\n\n      // Create output directory\n      await mkdir(output, { recursive: true })\n\n      // Build config from preset\n      const presetConfig = ARCHIVAL_PRESETS[preset] || {}\n\n      // Start with defaults and apply preset\n      const config: Partial<ArchivalEncodingConfig> = {\n        ...DEFAULT_ARCHIVAL_CONFIG,\n        ...presetConfig,\n        codec,\n        container: options.container as 'mkv' | 'mp4' | 'webm',\n        resolution: options.resolution as ArchivalResolution,\n        overwriteExisting: options.overwrite,\n        fillMode: options.fillMode,\n        preserveStructure: options.preserveStructure,\n        deleteOutputIfLarger: options.deleteIfLarger,\n        deleteOriginal: options.deleteOriginal,\n        extractThumbnail: options.thumbnail,\n        extractCaptions: options.captions,\n        captionLanguage: options.captionLang,\n        audioCopy: options.audioCopy,\n        audioCodec: options.audioCodec as 'opus' | 'aac' | 'flac',\n        audioBitrate: parseInt(options.audioBitrate, 10),\n        threadLimit: parseInt(options.threads, 10) as 0 | 4 | 6\n      }\n\n      // Build AV1 options\n      config.av1 = {\n        ...DEFAULT_ARCHIVAL_CONFIG.av1,\n        ...presetConfig.av1,\n        encoder: options.av1Encoder as Av1Encoder,\n        preset: parseInt(options.av1Preset, 10),\n        filmGrainSynthesis: parseInt(options.filmGrain, 10),\n        twoPass: options.twoPass\n      }\n\n      // Apply custom AV1 CRF if specified\n      if (options.av1Crf) {\n        config.av1.crf = parseInt(options.av1Crf, 10)\n      }\n\n      // Build H.265 options\n      config.h265 = {\n        ...DEFAULT_ARCHIVAL_CONFIG.h265,\n        ...presetConfig.h265,\n        preset: options.h265Preset as typeof DEFAULT_ARCHIVAL_CONFIG.h265.preset,\n        bframes: parseInt(options.h265Bframes, 10),\n        twoPass: options.twoPass\n      }\n\n      // Apply custom H.265 CRF if specified\n      if (options.h265Crf) {\n        config.h265.crf = parseInt(options.h265Crf, 10)\n      }\n\n      // Apply H.265 tune if specified\n      if (options.h265Tune) {\n        config.h265.tune = options.h265Tune as typeof DEFAULT_ARCHIVAL_CONFIG.h265.tune\n      }\n\n      // Initialize TUI or use simple mode\n      let progressHandler: (event: ArchivalProgressEvent) => void\n\n      if (useTUI) {\n        tui = new TUI()\n        tui.update({\n          codec: codec.toUpperCase(),\n          preset,\n          totalFiles: inputPaths.length,\n          subtitle: `Output: ${output}`,\n          status: 'scanning'\n        })\n        tui.start()\n        progressHandler = createTUIProgressHandler(tui, fileNames, tracker)\n      } else {\n        // Show config summary in simple mode\n        console.log(`${style.dim}Configuration:${style.reset}`)\n        console.log(`  Codec: ${style.cyan}${codec.toUpperCase()}${style.reset}`)\n        console.log(`  Preset: ${style.cyan}${preset}${style.reset}`)\n        console.log(`  Resolution: ${style.cyan}${options.resolution}${style.reset}`)\n        console.log(`  Container: ${style.cyan}${options.container}${style.reset}`)\n        if (codec === 'av1') {\n          console.log(`  AV1 Encoder: ${style.cyan}${options.av1Encoder}${style.reset}`)\n          console.log(`  AV1 Preset: ${style.cyan}${options.av1Preset}${style.reset}`)\n          console.log(`  Film Grain: ${style.cyan}${options.filmGrain}${style.reset}`)\n        } else {\n          console.log(`  H.265 Preset: ${style.cyan}${options.h265Preset}${style.reset}`)\n          if (options.h265Tune) {\n            console.log(`  H.265 Tune: ${style.cyan}${options.h265Tune}${style.reset}`)\n          }\n        }\n        console.log(`  Two-pass: ${style.cyan}${options.twoPass ? 'yes' : 'no'}${style.reset}`)\n        console.log(`  Audio: ${style.cyan}${options.audioCopy ? 'copy' : options.audioCodec}${style.reset}`)\n        if (options.captions) {\n          console.log(`  Captions: ${style.cyan}${options.captionLang}${style.reset}`)\n        }\n        console.log(`  Output: ${style.cyan}${output}${style.reset}`)\n        console.log()\n        console.log(`${style.bold}Starting encoding...${style.reset}\\n`)\n        progressHandler = createSimpleProgressHandler()\n      }\n\n      // Create service with progress handler\n      service = new ArchivalService(progressHandler)\n\n      // Start batch processing\n      await service.startBatch(\n        inputPaths,\n        output,\n        config,\n        folderRoot,\n        relativePaths\n      )\n\n      // Wait for completion\n      await new Promise<void>((resolve) => {\n        const checkStatus = setInterval(() => {\n          const status = service.getStatus()\n          if (!status || status.status === 'completed' || status.status === 'cancelled') {\n            clearInterval(checkStatus)\n            resolve()\n          }\n        }, 500)\n      })\n\n      // Stop TUI before showing summary\n      if (tui) {\n        tui.stop()\n      }\n\n      // Show final summary\n      const finalStatus = service.getStatus()\n\n      if (finalStatus) {\n        // Calculate total savings\n        let totalSaved = 0\n        for (const item of finalStatus.items) {\n          if (item.status === 'completed' && item.inputSize && item.outputSize) {\n            totalSaved += item.inputSize - item.outputSize\n          }\n        }\n\n        printSummary(\n          finalStatus.completedItems,\n          finalStatus.skippedItems,\n          finalStatus.failedItems,\n          Math.max(0, totalSaved)\n        )\n      }\n\n    } catch (error) {\n      if (tui) {\n        tui.stop()\n      }\n\n      const message = error instanceof Error ? error.message : String(error)\n      if (useTUI) {\n        printError(message.slice(0, 40))\n      } else {\n        console.error(`\\n${style.red}Error:${style.reset}`, message)\n      }\n      process.exit(1)\n    }\n  })\n", "import { spawn, type ChildProcess } from 'node:child_process'\nimport { randomUUID } from 'node:crypto'\nimport { access, mkdir, rename, rm, stat, unlink } from 'node:fs/promises'\nimport { basename, dirname, extname, join, parse } from 'node:path'\nimport { Logger } from '../../utils/logger'\nimport { resolveBundledBinary } from '../../utils/binary'\nimport { MetadataService, type MetadataResult } from '../library/metadata.service'\nimport { WhisperService } from '../transcription/whisper.service'\nimport {\n  buildArchivalFFmpegArgs,\n  buildTwoPassArgs,\n  isTwoPassEnabled,\n  describeArchivalSettings,\n  estimateArchivalFileSize\n} from './archival-command-builder'\nimport {\n  detectAv1Encoders,\n  getBestEncoder,\n  type EncoderInfo\n} from './encoder-detector'\nimport {\n  DEFAULT_ARCHIVAL_CONFIG,\n  detectHdr,\n  getOptimalCrf,\n  classifyError,\n  type ArchivalBatchItem,\n  type ArchivalBatchJob,\n  type ArchivalEncodingConfig,\n  type ArchivalProgressEvent,\n  type ArchivalErrorType,\n  type VideoSourceInfo,\n  type PersistedArchivalState,\n  type ArchivalQueueState\n} from '../../../shared/types/archival.types'\nimport { ArchivalStatePersistence } from './archival-state-persistence'\nimport { detectCPUSIMDCapabilities, type CPUSIMDCapabilities } from '../hw-accel-detector'\nimport { platform } from 'node:os'\nimport { exec } from 'node:child_process'\nimport { promisify } from 'node:util'\n\nconst execAsync = promisify(exec)\n\nexport type ArchivalEventHandler = (event: ArchivalProgressEvent) => void\n\n/**\n * Service for batch archival video encoding using SVT-AV1\n *\n * Key features:\n * - Processes multiple videos sequentially\n * - Auto-detects HDR and adjusts CRF accordingly\n * - Scene-aware keyframes (long GOPs without crossing scene cuts)\n * - Film grain synthesis for better compression\n * - Skips database entirely - outputs directly to specified folder\n */\nexport class ArchivalService {\n  private readonly logger = new Logger('ArchivalService')\n  private readonly metadata = new MetadataService()\n  private readonly whisperService = new WhisperService()\n  private readonly persistence = new ArchivalStatePersistence()\n  private activeJob: ArchivalBatchJob | null = null\n  private activeProcess: ChildProcess | null = null\n  private abortController: AbortController | null = null\n  private fillModeSeenOutputs: Set<string> | null = null\n\n  // Pause/Resume state\n  private isPaused: boolean = false\n  private currentEncodingItemId: string | null = null\n\n  // ETA tracking\n  private encodingStartTime: number = 0\n  private speedSamples: number[] = []\n  private readonly maxSpeedSamples = 10 // Moving average window\n\n  // CPU capabilities for SIMD optimizations (AVX-512, etc.)\n  private cpuCapabilities: CPUSIMDCapabilities | null = null\n  private cpuCapabilitiesDetected = false\n\n  // Whisper model path getter (injected from outside)\n  private whisperModelPathGetter: (() => string | null) | null = null\n  // Whisper provider settings getter\n  private whisperProviderGetter: (() => { provider: string; endpoint: string }) | null = null\n  // Whisper GPU settings getter\n  private whisperGpuEnabledGetter: (() => boolean) | null = null\n\n  constructor(private readonly onEvent?: ArchivalEventHandler) {}\n\n  /**\n   * Detect and cache CPU SIMD capabilities\n   * Called lazily on first encoding job\n   */\n  private async ensureCpuCapabilities(): Promise<CPUSIMDCapabilities | null> {\n    if (this.cpuCapabilitiesDetected) {\n      return this.cpuCapabilities\n    }\n\n    try {\n      this.cpuCapabilities = await detectCPUSIMDCapabilities()\n      this.cpuCapabilitiesDetected = true\n\n      if (this.cpuCapabilities) {\n        this.logger.info('CPU capabilities detected', {\n          architecture: this.cpuCapabilities.architecture,\n          avx512: this.cpuCapabilities.avx512,\n          avx2: this.cpuCapabilities.avx2,\n          neon: this.cpuCapabilities.neon,\n          sve: this.cpuCapabilities.sve,\n          model: this.cpuCapabilities.cpuModel\n        })\n      }\n    } catch (error) {\n      this.logger.warn('Failed to detect CPU capabilities', { error })\n      this.cpuCapabilitiesDetected = true\n    }\n\n    return this.cpuCapabilities\n  }\n\n  /**\n   * Set the function to get the Whisper model path from settings\n   * This is called from the IPC handler to inject the settings getter\n   */\n  setWhisperModelPathGetter(getter: () => string | null): void {\n    this.whisperModelPathGetter = getter\n  }\n\n  /**\n   * Set the function to get the Whisper provider settings\n   * This is called from the IPC handler to inject the settings getter\n   */\n  setWhisperProviderGetter(getter: () => { provider: string; endpoint: string }): void {\n    this.whisperProviderGetter = getter\n  }\n\n  /**\n   * Set the function to get the Whisper GPU enabled setting\n   * GPU acceleration is only available on Apple Silicon (Metal)\n   */\n  setWhisperGpuEnabledGetter(getter: () => boolean): void {\n    this.whisperGpuEnabledGetter = getter\n  }\n\n  /**\n   * Get available AV1 encoders\n   * Useful for UI to show available options\n   */\n  async getAvailableEncoders(): Promise<EncoderInfo> {\n    return detectAv1Encoders()\n  }\n\n  /**\n   * Check if there's enough disk space for the encoding job\n   * Returns estimated required space and available space\n   */\n  async checkDiskSpace(\n    outputDir: string,\n    inputPaths: string[]\n  ): Promise<{\n    ok: boolean\n    requiredBytes: number\n    availableBytes: number\n    safetyMarginBytes: number\n  }> {\n    let totalInputSize = 0\n\n    // Sum up all input file sizes\n    for (const inputPath of inputPaths) {\n      try {\n        const inputStat = await stat(inputPath)\n        totalInputSize += inputStat.size\n      } catch {\n        // File may not exist, skip\n      }\n    }\n\n    // Estimate output size (assume 50% compression ratio as conservative estimate)\n    // AV1 typically achieves 30-50% of original size, but we use 70% for safety\n    const estimatedOutputSize = Math.ceil(totalInputSize * 0.7)\n\n    // Add 10% safety margin for temp files and metadata\n    const safetyMargin = Math.ceil(estimatedOutputSize * 0.1)\n    const requiredSpace = estimatedOutputSize + safetyMargin\n\n    try {\n      const freeSpace = await this.getFreeDiskSpace(outputDir)\n      return {\n        ok: freeSpace >= requiredSpace,\n        requiredBytes: requiredSpace,\n        availableBytes: freeSpace,\n        safetyMarginBytes: safetyMargin\n      }\n    } catch (error) {\n      this.logger.warn('Could not check disk space', { error })\n      // If we can't check, assume it's okay and let encoding fail if needed\n      return {\n        ok: true,\n        requiredBytes: requiredSpace,\n        availableBytes: Number.MAX_SAFE_INTEGER,\n        safetyMarginBytes: safetyMargin\n      }\n    }\n  }\n\n  /**\n   * Get free disk space for a given path\n   * Uses platform-specific commands\n   */\n  private async getFreeDiskSpace(dirPath: string): Promise<number> {\n    const os = platform()\n\n    if (os === 'win32') {\n      // Windows: use wmic or PowerShell\n      // Handle both local paths (C:\\...) and UNC paths (\\\\server\\share\\...)\n      const driveMatch = dirPath.match(/^([A-Za-z]):/)\n      const isUncPath = dirPath.startsWith('\\\\\\\\')\n\n      if (driveMatch) {\n        // Local drive path\n        const driveLetter = driveMatch[1]\n        try {\n          const { stdout } = await execAsync(\n            `powershell -Command \"(Get-PSDrive ${driveLetter}).Free\"`,\n            { timeout: 5000 }\n          )\n          const freeBytes = parseInt(stdout.trim(), 10)\n          if (!isNaN(freeBytes)) {\n            return freeBytes\n          }\n        } catch {\n          // Try wmic as fallback\n          try {\n            const { stdout } = await execAsync(\n              `wmic logicaldisk where \"DeviceID='${driveLetter}:'\" get FreeSpace /value`,\n              { timeout: 5000 }\n            )\n            const match = stdout.match(/FreeSpace=(\\d+)/)\n            if (match) {\n              return parseInt(match[1], 10)\n            }\n          } catch {\n            // Both methods failed\n          }\n        }\n      } else if (isUncPath) {\n        // UNC path - use fsutil or PowerShell with directory path\n        try {\n          // Escape backslashes for PowerShell\n          const escapedPath = dirPath.replace(/\\\\/g, '\\\\\\\\')\n          const { stdout } = await execAsync(\n            `powershell -Command \"(Get-PSDrive -PSProvider FileSystem | Where-Object { '${escapedPath}'.StartsWith($_.Root) } | Select-Object -First 1).Free\"`,\n            { timeout: 5000 }\n          )\n          const freeBytes = parseInt(stdout.trim(), 10)\n          if (!isNaN(freeBytes)) {\n            return freeBytes\n          }\n        } catch {\n          // UNC path space check failed - fall through to throw\n        }\n      } else {\n        // Relative path or other format - try to get current drive\n        try {\n          const { stdout } = await execAsync(\n            `powershell -Command \"(Get-PSDrive -PSProvider FileSystem | Where-Object { $_.Name -eq (Get-Location).Drive.Name } | Select-Object -First 1).Free\"`,\n            { timeout: 5000 }\n          )\n          const freeBytes = parseInt(stdout.trim(), 10)\n          if (!isNaN(freeBytes)) {\n            return freeBytes\n          }\n        } catch {\n          // Fallback failed\n        }\n      }\n    } else {\n      // Unix-like (macOS, Linux): use df\n      try {\n        const { stdout } = await execAsync(`df -k \"${dirPath}\" | tail -1`, { timeout: 5000 })\n        const parts = stdout.trim().split(/\\s+/)\n        // df -k returns KB, convert to bytes\n        const freeKB = parseInt(parts[3], 10)\n        if (!isNaN(freeKB)) {\n          return freeKB * 1024\n        }\n      } catch {\n        // df failed\n      }\n    }\n\n    throw new Error('Could not determine free disk space')\n  }\n\n  /**\n   * Start a batch archival job\n   */\n  async startBatch(\n    inputPaths: string[],\n    outputDir: string,\n    configOverrides?: Partial<ArchivalEncodingConfig>,\n    folderRoot?: string,\n    relativePaths?: string[]\n  ): Promise<ArchivalBatchJob> {\n    if (this.activeJob && this.activeJob.status === 'running') {\n      throw new Error('Another archival job is already running')\n    }\n\n    // Clear any old recovery state when starting a new batch\n    await this.persistence.clearState()\n\n    // Validate inputs\n    if (!inputPaths || inputPaths.length === 0) {\n      throw new Error('No input files provided')\n    }\n\n    if (!outputDir || outputDir.trim() === '') {\n      throw new Error('No output directory provided')\n    }\n\n    // Validate output directory\n    try {\n      await mkdir(outputDir, { recursive: true })\n    } catch (error) {\n      throw new Error(`Failed to create output directory: ${outputDir}`)\n    }\n\n    // Pre-flight disk space check\n    const diskCheck = await this.checkDiskSpace(outputDir, inputPaths)\n    if (!diskCheck.ok) {\n      const requiredGB = (diskCheck.requiredBytes / (1024 * 1024 * 1024)).toFixed(1)\n      const availableGB = (diskCheck.availableBytes / (1024 * 1024 * 1024)).toFixed(1)\n      throw new Error(\n        `Not enough disk space. Need approximately ${requiredGB} GB but only ${availableGB} GB available.`\n      )\n    }\n\n    // Build config\n    const config: ArchivalEncodingConfig = {\n      ...DEFAULT_ARCHIVAL_CONFIG,\n      ...configOverrides,\n      outputDir\n    }\n    if (config.fillMode) {\n      config.overwriteExisting = false\n    }\n    this.fillModeSeenOutputs = config.fillMode ? new Set<string>() : null\n\n    // Auto-detect best encoder if the configured one isn't available\n    const bestEncoder = await getBestEncoder(config.av1.encoder)\n    if (!bestEncoder) {\n      throw new Error(\n        'No AV1 encoder available. The bundled FFmpeg does not support libaom-av1 or libsvtav1.'\n      )\n    }\n\n    // Update config with the best available encoder\n    if (bestEncoder !== config.av1.encoder) {\n      this.logger.info(`Encoder ${config.av1.encoder} not available, using ${bestEncoder}`)\n      config.av1 = { ...config.av1, encoder: bestEncoder }\n    }\n\n    // Create batch job\n    const batchId = randomUUID()\n    const items: ArchivalBatchItem[] = inputPaths.map((inputPath, index) => ({\n      id: randomUUID(),\n      inputPath,\n      outputPath: this.buildOutputPath(\n        inputPath,\n        outputDir,\n        config,\n        relativePaths?.[index]\n      ),\n      status: 'queued',\n      progress: 0\n    }))\n\n    // Handle duplicate filenames from different directories\n    if (!config.fillMode) {\n      this.deduplicateOutputPaths(items)\n    }\n\n    this.activeJob = {\n      id: batchId,\n      items,\n      config,\n      status: 'pending',\n      totalItems: items.length,\n      completedItems: 0,\n      failedItems: 0,\n      skippedItems: 0,\n      createdAt: new Date().toISOString(),\n      // Initialize batch-level tracking\n      totalDurationSeconds: 0,\n      processedDurationSeconds: 0,\n      batchEtaSeconds: undefined,\n      averageSpeed: undefined,\n      estimatedTotalOutputBytes: diskCheck.requiredBytes,\n      actualOutputBytes: 0\n    }\n\n    // Reset speed samples for new batch\n    this.speedSamples = []\n\n    // Start processing in background\n    void this.processQueue()\n\n    return this.activeJob\n  }\n\n  /**\n   * Get current job status\n   */\n  getStatus(): ArchivalBatchJob | null {\n    return this.activeJob\n  }\n\n  /**\n   * Cancel the active batch job\n   */\n  cancel(): boolean {\n    if (!this.activeJob || this.activeJob.status !== 'running') {\n      return false\n    }\n\n    this.abortController?.abort()\n    this.activeJob.status = 'cancelled'\n\n    // Kill active FFmpeg process\n    if (this.activeProcess) {\n      // Use appropriate signal for platform\n      if (platform() === 'win32') {\n        this.activeProcess.kill() // Default signal, more reliable on Windows\n      } else {\n        this.activeProcess.kill('SIGTERM')\n      }\n      this.activeProcess = null\n    }\n\n    // Clear persisted state on cancel\n    void this.persistence.clearState()\n\n    return true\n  }\n\n  /**\n   * Pause the active batch job immediately\n   * Kills the current FFmpeg process and saves state for later resume\n   */\n  async pause(): Promise<boolean> {\n    if (!this.activeJob || this.activeJob.status !== 'running') {\n      return false\n    }\n\n    this.logger.info('Pausing encoding job', { jobId: this.activeJob.id })\n\n    // Set paused flag\n    this.isPaused = true\n\n    // Kill active FFmpeg process immediately\n    if (this.activeProcess) {\n      if (platform() === 'win32') {\n        this.activeProcess.kill()\n      } else {\n        this.activeProcess.kill('SIGTERM')\n      }\n      this.activeProcess = null\n    }\n\n    // Clean up partial output for the interrupted item\n    if (this.currentEncodingItemId) {\n      const currentItem = this.activeJob.items.find(i => i.id === this.currentEncodingItemId)\n      if (currentItem && currentItem.status === 'encoding') {\n        // Clean up partial output\n        await this.cleanupPartialOutput(currentItem.outputPath)\n        // Reset item to queued so it will restart on resume\n        currentItem.status = 'queued'\n        currentItem.progress = 0\n        currentItem.startedAt = undefined\n        currentItem.encodingSpeed = undefined\n        currentItem.etaSeconds = undefined\n        currentItem.elapsedSeconds = undefined\n      }\n    }\n\n    // Save state for recovery\n    await this.saveCurrentState()\n\n    // Emit pause event\n    this.emitEvent({\n      batchId: this.activeJob.id,\n      itemId: '',\n      kind: 'queue_paused',\n      queueState: 'paused'\n    })\n\n    this.logger.info('Encoding job paused', { jobId: this.activeJob.id })\n    return true\n  }\n\n  /**\n   * Resume a paused batch job\n   */\n  async resume(): Promise<boolean> {\n    if (!this.activeJob || !this.isPaused) {\n      return false\n    }\n\n    this.logger.info('Resuming encoding job', { jobId: this.activeJob.id })\n\n    // Clear pause flag\n    this.isPaused = false\n\n    // Re-check disk space before resuming\n    const remainingInputPaths = this.activeJob.items\n      .filter(i => i.status === 'queued')\n      .map(i => i.inputPath)\n\n    if (remainingInputPaths.length > 0) {\n      const diskCheck = await this.checkDiskSpace(this.activeJob.config.outputDir, remainingInputPaths)\n      if (!diskCheck.ok) {\n        this.logger.error('Not enough disk space to resume', { diskCheck })\n        this.isPaused = true // Re-pause\n        throw new Error('Not enough disk space to resume encoding')\n      }\n    }\n\n    // Emit resume event\n    this.emitEvent({\n      batchId: this.activeJob.id,\n      itemId: '',\n      kind: 'queue_resumed',\n      queueState: 'running'\n    })\n\n    // Continue processing\n    void this.processQueue()\n\n    return true\n  }\n\n  /**\n   * Check if a job is currently paused\n   */\n  getIsPaused(): boolean {\n    return this.isPaused\n  }\n\n  /**\n   * Check if there's a recoverable state from a previous crash or exit\n   * Returns null if there's already an active job (nothing to recover)\n   */\n  async checkForRecovery(): Promise<PersistedArchivalState | null> {\n    // If there's already an active job, no recovery needed\n    if (this.activeJob && (this.activeJob.status === 'running' || this.isPaused)) {\n      return null\n    }\n\n    try {\n      const state = await this.persistence.loadState()\n      if (state && state.job.status === 'running') {\n        // Found an interrupted job\n        this.logger.info('Found recoverable job state', {\n          jobId: state.job.id,\n          totalItems: state.job.totalItems,\n          completedItems: state.job.completedItems,\n          savedAt: state.savedAt\n        })\n        return state\n      }\n      return null\n    } catch (error) {\n      this.logger.warn('Failed to check for recovery state', { error })\n      return null\n    }\n  }\n\n  /**\n   * Resume from a recovered state after crash/restart\n   * Validates files and restarts the queue\n   */\n  async resumeFromRecovery(state: PersistedArchivalState): Promise<ArchivalBatchJob> {\n    if (this.activeJob && this.activeJob.status === 'running') {\n      throw new Error('Another archival job is already running')\n    }\n\n    this.logger.info('Resuming from recovery state', { jobId: state.job.id })\n\n    // Restore job state\n    this.activeJob = state.job\n\n    // Reset interrupted item to queued and clean up partial outputs\n    for (const item of this.activeJob.items) {\n      if (item.status === 'encoding' || item.status === 'analyzing') {\n        // Clean up any partial output\n        await this.cleanupPartialOutput(item.outputPath)\n        // Reset to queued\n        item.status = 'queued'\n        item.progress = 0\n        item.startedAt = undefined\n        item.encodingSpeed = undefined\n        item.etaSeconds = undefined\n        item.elapsedSeconds = undefined\n      }\n\n      // Validate source file still exists for queued items\n      if (item.status === 'queued') {\n        try {\n          await access(item.inputPath)\n        } catch {\n          // Source file missing\n          item.status = 'failed'\n          item.error = 'Source file no longer exists'\n          item.errorType = 'file_not_found'\n          item.completedAt = new Date().toISOString()\n          this.activeJob.failedItems++\n          this.logger.warn('Source file missing during recovery', { inputPath: item.inputPath })\n        }\n      }\n    }\n\n    // Clean up any two-pass log files from interrupted encoding\n    if (state.twoPassState) {\n      try {\n        await rm(state.twoPassState.passLogDir, { recursive: true, force: true })\n        this.logger.debug('Cleaned up two-pass log files', { dir: state.twoPassState.passLogDir })\n      } catch {\n        // Ignore cleanup errors\n      }\n    }\n\n    // Reset speed samples\n    this.speedSamples = []\n    this.isPaused = false\n\n    // Validate output directory still exists and is accessible\n    try {\n      await access(this.activeJob.config.outputDir)\n    } catch {\n      this.activeJob = null\n      throw new Error('Output directory no longer exists or is not accessible')\n    }\n\n    // Re-check disk space\n    const remainingInputPaths = this.activeJob.items\n      .filter(i => i.status === 'queued')\n      .map(i => i.inputPath)\n\n    if (remainingInputPaths.length > 0) {\n      const diskCheck = await this.checkDiskSpace(this.activeJob.config.outputDir, remainingInputPaths)\n      if (!diskCheck.ok) {\n        this.activeJob = null\n        throw new Error('Not enough disk space to resume encoding')\n      }\n    }\n\n    // Start processing\n    void this.processQueue()\n\n    return this.activeJob\n  }\n\n  /**\n   * Discard a recovered state and clean up\n   */\n  async discardRecovery(state: PersistedArchivalState): Promise<void> {\n    this.logger.info('Discarding recovery state', { jobId: state.job.id })\n\n    // Clean up partial outputs for any in-progress items\n    for (const item of state.job.items) {\n      if (item.status === 'encoding' || item.status === 'analyzing') {\n        await this.cleanupPartialOutput(item.outputPath)\n      }\n    }\n\n    // Clean up two-pass log files\n    if (state.twoPassState) {\n      try {\n        await rm(state.twoPassState.passLogDir, { recursive: true, force: true })\n      } catch {\n        // Ignore cleanup errors\n      }\n    }\n\n    // Clear persisted state\n    await this.persistence.clearState()\n\n    this.logger.info('Recovery state discarded')\n  }\n\n  /**\n   * Check if there's an active job (running or paused)\n   */\n  hasActiveJob(): boolean {\n    return this.activeJob !== null && (this.activeJob.status === 'running' || this.isPaused)\n  }\n\n  /**\n   * Save current state for graceful shutdown or crash recovery\n   */\n  async saveCurrentState(): Promise<void> {\n    if (!this.activeJob) return\n\n    const state: PersistedArchivalState = {\n      version: 1,\n      savedAt: new Date().toISOString(),\n      job: this.activeJob,\n      currentItemId: this.currentEncodingItemId\n    }\n\n    await this.persistence.saveState(state)\n    this.logger.debug('State saved', { jobId: this.activeJob.id })\n  }\n\n  /**\n   * Preview the FFmpeg command for a single file\n   */\n  async previewCommand(\n    inputPath: string,\n    outputDir: string,\n    configOverrides?: Partial<ArchivalEncodingConfig>\n  ): Promise<{ command: string[]; description: string; sourceInfo: VideoSourceInfo }> {\n    const config: ArchivalEncodingConfig = {\n      ...DEFAULT_ARCHIVAL_CONFIG,\n      ...configOverrides,\n      outputDir\n    }\n\n    const sourceInfo = await this.analyzeVideo(inputPath)\n    const outputPath = this.buildOutputPath(inputPath, outputDir, config)\n    const command = buildArchivalFFmpegArgs(inputPath, outputPath, config, sourceInfo)\n    const description = describeArchivalSettings(config, sourceInfo)\n\n    return { command, description, sourceInfo }\n  }\n\n  /**\n   * Get estimated output size for a video\n   */\n  async estimateSize(inputPath: string): Promise<{\n    sourceInfo: VideoSourceInfo\n    effectiveCrf: number\n    estimatedMB: number\n    minMB: number\n    maxMB: number\n  }> {\n    const sourceInfo = await this.analyzeVideo(inputPath)\n    const effectiveCrf = getOptimalCrf(sourceInfo)\n    const estimate = estimateArchivalFileSize(sourceInfo, effectiveCrf)\n\n    return {\n      sourceInfo,\n      effectiveCrf,\n      ...estimate\n    }\n  }\n\n  /**\n   * Get batch info including total duration and existing files count\n   * Used for pre-flight checks before starting encoding\n   */\n  async getBatchInfo(\n    inputPaths: string[],\n    outputDir: string\n  ): Promise<{\n    totalDurationSeconds: number\n    totalInputBytes: number\n    existingCount: number\n  }> {\n    let totalDurationSeconds = 0\n    let totalInputBytes = 0\n    let existingCount = 0\n\n    // Check for all possible container formats\n    const containerExtensions = ['mkv', 'mp4', 'webm']\n\n    for (const inputPath of inputPaths) {\n      try {\n        // Get file size\n        const inputStat = await stat(inputPath)\n        totalInputBytes += inputStat.size\n\n        // Get duration via quick metadata probe\n        const meta = await this.metadata.extract({ filePath: inputPath })\n        if (meta.duration) {\n          totalDurationSeconds += meta.duration\n        }\n\n        // Check if output would already exist in any container format\n        const inputName = basename(inputPath, extname(inputPath))\n        for (const ext of containerExtensions) {\n          const outputPath = join(outputDir, `${inputName}.${ext}`)\n          try {\n            await access(outputPath)\n            existingCount++\n            break // Count each input file only once even if multiple outputs exist\n          } catch {\n            // Output doesn't exist with this extension\n          }\n        }\n      } catch {\n        // Skip files we can't read\n      }\n    }\n\n    return {\n      totalDurationSeconds,\n      totalInputBytes,\n      existingCount\n    }\n  }\n\n  /**\n   * Process the job queue\n   */\n  private async processQueue(): Promise<void> {\n    if (!this.activeJob) return\n\n    this.activeJob.status = 'running'\n    if (!this.activeJob.startedAt) {\n      this.activeJob.startedAt = new Date().toISOString()\n    }\n    this.abortController = new AbortController()\n\n    for (const item of this.activeJob.items) {\n      // Skip already completed/failed/skipped items (for recovery)\n      if (item.status === 'completed' || item.status === 'failed' || item.status === 'skipped') {\n        continue\n      }\n\n      // Check if paused\n      if (this.isPaused) {\n        this.logger.info('Queue paused, stopping processing')\n        this.abortController = null\n        return // Exit without completing batch\n      }\n\n      if (this.abortController.signal.aborted) {\n        item.status = 'cancelled'\n        continue\n      }\n\n      // Track current encoding item\n      this.currentEncodingItemId = item.id\n\n      // Save state before starting item (for crash recovery)\n      await this.saveCurrentState()\n\n      try {\n        await this.processItem(item)\n      } catch (error) {\n        this.logger.error('Failed to process item', {\n          itemId: item.id,\n          error: error instanceof Error ? error.message : 'Unknown error'\n        })\n      }\n\n      // Save state after item completes (for crash recovery)\n      await this.saveCurrentState()\n    }\n\n    // Clear current encoding item\n    this.currentEncodingItemId = null\n\n    const finalStatus = this.abortController.signal.aborted ? 'cancelled' : 'completed'\n    this.activeJob.status = finalStatus\n    this.activeJob.completedAt = new Date().toISOString()\n\n    this.emitEvent({\n      batchId: this.activeJob.id,\n      itemId: '',\n      kind: 'batch_complete',\n      // Include final stats for UI\n      processedItems: this.activeJob.completedItems,\n      totalItems: this.activeJob.totalItems\n    })\n\n    // Clear persisted state on successful completion\n    await this.persistence.clearState()\n\n    this.abortController = null\n    this.fillModeSeenOutputs = null\n    this.isPaused = false\n  }\n\n  /**\n   * Process a single item in the batch\n   */\n  private async processItem(item: ArchivalBatchItem): Promise<void> {\n    if (!this.activeJob) return\n\n    item.status = 'analyzing'\n    item.startedAt = new Date().toISOString()\n\n    this.emitEvent({\n      batchId: this.activeJob.id,\n      itemId: item.id,\n      kind: 'item_start',\n      status: 'analyzing'\n    })\n\n    try {\n      if (this.activeJob.config.fillMode) {\n        const shouldSkip = await this.shouldSkipForFillMode(item.outputPath)\n        if (shouldSkip) {\n          this.logger.info('Skipping due to name conflict (fill mode)', {\n            outputPath: item.outputPath\n          })\n          this.markItemSkipped(item)\n          return\n        }\n      }\n\n      // Check if input exists\n      await access(item.inputPath)\n\n      // Get input file size\n      const inputStat = await stat(item.inputPath)\n      item.inputSize = inputStat.size\n\n      // Analyze source video\n      const sourceInfo = await this.analyzeVideo(item.inputPath)\n      item.sourceInfo = sourceInfo\n\n      // Determine effective CRF\n      item.effectiveCrf = getOptimalCrf(sourceInfo)\n\n      // Check if output already exists\n      if (!this.activeJob.config.overwriteExisting) {\n        try {\n          await access(item.outputPath)\n          this.logger.info('Skipping existing output', { outputPath: item.outputPath })\n          this.markItemSkipped(item)\n          return\n        } catch {\n          // Output doesn't exist, proceed\n        }\n      }\n\n      // Create output directory if needed\n      await mkdir(dirname(item.outputPath), { recursive: true })\n\n      // Start encoding\n      item.status = 'encoding'\n\n      this.emitEvent({\n        batchId: this.activeJob.id,\n        itemId: item.id,\n        kind: 'item_progress',\n        progress: 0,\n        status: 'encoding',\n        sourceInfo,\n        effectiveCrf: item.effectiveCrf\n      })\n\n      await this.encodeVideo(item, sourceInfo)\n\n      // Get output size and calculate compression ratio\n      const outputStat = await stat(item.outputPath)\n      item.outputSize = outputStat.size\n      item.compressionRatio = item.inputSize ? item.inputSize / item.outputSize : undefined\n\n      // Check if output is larger than input\n      const outputLarger = item.inputSize && item.outputSize > item.inputSize\n\n      if (outputLarger && this.activeJob.config.deleteOutputIfLarger) {\n        // Delete the larger output file\n        await this.cleanupPartialOutput(item.outputPath)\n\n        item.status = 'skipped'\n        item.error = `Output (${this.formatBytes(item.outputSize)}) larger than input (${this.formatBytes(item.inputSize!)})`\n        item.errorType = 'output_larger'\n        item.outputDeleted = true // Mark that output was deleted\n        item.completedAt = new Date().toISOString()\n        this.activeJob.skippedItems++\n\n        this.emitEvent({\n          batchId: this.activeJob.id,\n          itemId: item.id,\n          kind: 'item_complete',\n          progress: 100,\n          status: 'skipped',\n          error: item.error,\n          errorType: 'output_larger',\n          outputSize: item.outputSize,\n          compressionRatio: item.compressionRatio\n        })\n\n        this.logger.info('Skipped - output larger than input', {\n          input: basename(item.inputPath),\n          inputSize: item.inputSize,\n          outputSize: item.outputSize\n        })\n\n        return\n      }\n\n      // Update batch-level tracking\n      if (this.activeJob) {\n        this.activeJob.actualOutputBytes = (this.activeJob.actualOutputBytes ?? 0) + item.outputSize\n        if (sourceInfo.duration) {\n          this.activeJob.processedDurationSeconds =\n            (this.activeJob.processedDurationSeconds ?? 0) + sourceInfo.duration\n        }\n      }\n\n      // Extract thumbnail if enabled\n      if (this.activeJob.config.extractThumbnail) {\n        try {\n          const thumbnailPath = await this.extractThumbnail(\n            item.outputPath,\n            sourceInfo,\n            this.activeJob.config.thumbnailTimestamp\n          )\n          item.thumbnailPath = thumbnailPath\n        } catch (thumbnailError) {\n          // Log but don't fail the item if thumbnail extraction fails\n          this.logger.warn('Thumbnail extraction failed, continuing without thumbnail', {\n            input: item.inputPath,\n            error: thumbnailError instanceof Error ? thumbnailError.message : 'Unknown error'\n          })\n        }\n      }\n\n      // Extract captions if enabled\n      if (this.activeJob.config.extractCaptions) {\n        try {\n          const captionPath = await this.extractCaptions(\n            item.outputPath,\n            this.activeJob.config.captionLanguage\n          )\n          item.captionPath = captionPath\n        } catch (captionError) {\n          // Log but don't fail the item if caption extraction fails\n          this.logger.warn('Caption extraction failed, continuing without captions', {\n            input: item.inputPath,\n            error: captionError instanceof Error ? captionError.message : 'Unknown error'\n          })\n        }\n      }\n\n      item.status = 'completed'\n      item.completedAt = new Date().toISOString()\n      item.progress = 100\n      this.activeJob.completedItems++\n\n      // Warn if output is larger but we kept it\n      const warningMsg = outputLarger\n        ? ` (WARNING: output larger than input)`\n        : ''\n\n      this.emitEvent({\n        batchId: this.activeJob.id,\n        itemId: item.id,\n        kind: 'item_complete',\n        progress: 100,\n        status: 'completed',\n        outputSize: item.outputSize,\n        compressionRatio: item.compressionRatio,\n        thumbnailPath: item.thumbnailPath,\n        captionPath: item.captionPath\n      })\n\n      this.logger.info(`Completed archival encoding${warningMsg}`, {\n        input: basename(item.inputPath),\n        output: basename(item.outputPath),\n        ratio: item.compressionRatio?.toFixed(2),\n        outputLarger\n      })\n\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Unknown error'\n      const errorType = (error as Error & { errorType?: ArchivalErrorType }).errorType ?? classifyError(message)\n\n      item.status = 'failed'\n      item.error = message\n      item.errorType = errorType\n      item.completedAt = new Date().toISOString()\n      this.activeJob.failedItems++\n\n      this.emitEvent({\n        batchId: this.activeJob.id,\n        itemId: item.id,\n        kind: 'item_error',\n        status: 'failed',\n        error: message,\n        errorType\n      })\n\n      this.logger.error('Failed to encode', {\n        input: item.inputPath,\n        error: message,\n        errorType\n      })\n    }\n  }\n\n  /**\n   * Analyze video to get source info\n   */\n  private async analyzeVideo(filePath: string): Promise<VideoSourceInfo> {\n    const meta = await this.metadata.extract({ filePath })\n    const extendedMeta = await this.getExtendedMetadata(filePath)\n\n    const isHdr = detectHdr(\n      extendedMeta.colorSpace,\n      extendedMeta.hdrFormat,\n      extendedMeta.bitDepth\n    )\n\n    // Extract container format from file extension\n    const container = extname(filePath).toLowerCase().replace('.', '') || undefined\n\n    return {\n      width: meta.width ?? 1920,\n      height: meta.height ?? 1080,\n      frameRate: meta.fps ?? 30,\n      duration: meta.duration ?? 0,\n      bitDepth: extendedMeta.bitDepth,\n      colorSpace: extendedMeta.colorSpace,\n      hdrFormat: extendedMeta.hdrFormat,\n      isHdr,\n      bitrate: meta.bitrate ?? undefined,\n      videoCodec: extendedMeta.videoCodec,\n      audioCodec: extendedMeta.audioCodec,\n      container,\n      // HDR10 static metadata\n      masteringDisplay: extendedMeta.masteringDisplay,\n      contentLightLevel: extendedMeta.contentLightLevel,\n      // Individual color components for precise encoder configuration\n      colorPrimaries: extendedMeta.colorPrimaries,\n      colorTransfer: extendedMeta.colorTransfer,\n      colorMatrix: extendedMeta.colorMatrix\n    }\n  }\n\n  /**\n   * Get extended metadata including HDR info, HDR10 static metadata, and audio codec\n   */\n  private async getExtendedMetadata(filePath: string): Promise<{\n    bitDepth?: number\n    colorSpace?: string\n    hdrFormat?: string | null\n    videoCodec?: string\n    audioCodec?: string\n    colorPrimaries?: string\n    colorTransfer?: string\n    colorMatrix?: string\n    masteringDisplay?: import('../../../shared/types/archival.types').HdrMasteringDisplayMetadata\n    contentLightLevel?: import('../../../shared/types/archival.types').HdrContentLightLevel\n  }> {\n    const ffprobePath = resolveBundledBinary('ffprobe')\n\n    return new Promise((resolve) => {\n      const proc = spawn(ffprobePath, [\n        '-v', 'quiet',\n        '-print_format', 'json',\n        '-show_streams',\n        '-show_frames', '-read_intervals', '%+#1', // Read first frame for side_data\n        filePath\n      ])\n\n      let stdout = ''\n      proc.stdout.on('data', (data) => { stdout += data.toString() })\n\n      proc.on('close', () => {\n        try {\n          const parsed = JSON.parse(stdout) as {\n            streams?: Array<{\n              codec_type?: string\n              codec_name?: string\n              bits_per_raw_sample?: string\n              color_space?: string\n              color_primaries?: string\n              color_transfer?: string\n              side_data_list?: Array<{\n                side_data_type?: string\n                // Mastering display metadata\n                red_x?: string\n                red_y?: string\n                green_x?: string\n                green_y?: string\n                blue_x?: string\n                blue_y?: string\n                white_point_x?: string\n                white_point_y?: string\n                min_luminance?: string\n                max_luminance?: string\n                // Content light level\n                max_content?: number\n                max_average?: number\n              }>\n            }>\n            frames?: Array<{\n              side_data_list?: Array<{\n                side_data_type?: string\n                red_x?: string\n                red_y?: string\n                green_x?: string\n                green_y?: string\n                blue_x?: string\n                blue_y?: string\n                white_point_x?: string\n                white_point_y?: string\n                min_luminance?: string\n                max_luminance?: string\n                max_content?: number\n                max_average?: number\n              }>\n            }>\n          }\n\n          // Find video and audio streams\n          const videoStream = parsed.streams?.find(s => s.codec_type === 'video')\n          const audioStream = parsed.streams?.find(s => s.codec_type === 'audio')\n\n          if (!videoStream) {\n            resolve({ audioCodec: audioStream?.codec_name, videoCodec: undefined })\n            return\n          }\n\n          // Get video codec\n          const videoCodec = videoStream.codec_name\n\n          // Detect bit depth\n          const bitDepth = videoStream.bits_per_raw_sample\n            ? parseInt(videoStream.bits_per_raw_sample, 10)\n            : undefined\n\n          // Store individual color components\n          const colorPrimaries = videoStream.color_primaries\n          const colorTransfer = videoStream.color_transfer\n          const colorMatrix = videoStream.color_space\n\n          // Build color space string from components (for backward compatibility)\n          const colorParts = [colorPrimaries, colorTransfer, colorMatrix].filter(Boolean)\n          const colorSpace = colorParts.length > 0 ? colorParts.join('/') : undefined\n\n          // Check for HDR metadata in side data (both stream and frame level)\n          let hdrFormat: string | null = null\n          let masteringDisplay: import('../../../shared/types/archival.types').HdrMasteringDisplayMetadata | undefined\n          let contentLightLevel: import('../../../shared/types/archival.types').HdrContentLightLevel | undefined\n\n          // Combine side_data from stream and first frame\n          const allSideData = [\n            ...(videoStream.side_data_list || []),\n            ...(parsed.frames?.[0]?.side_data_list || [])\n          ]\n\n          for (const sideData of allSideData) {\n            const sideDataType = sideData.side_data_type?.toLowerCase() || ''\n\n            // Detect HDR format\n            if (sideDataType.includes('mastering display') || sideDataType.includes('hdr')) {\n              if (!hdrFormat) hdrFormat = 'HDR10'\n\n              // Extract mastering display metadata\n              if (sideData.red_x && sideData.green_x && sideData.blue_x) {\n                // ffprobe returns values as fractions like \"13250/50000\"\n                const parseCoord = (val: string | undefined): number => {\n                  if (!val) return 0\n                  if (val.includes('/')) {\n                    const [num, den] = val.split('/')\n                    return Math.round((parseInt(num, 10) / parseInt(den, 10)) * 50000)\n                  }\n                  return parseInt(val, 10)\n                }\n\n                const parseLuminance = (val: string | undefined): number => {\n                  if (!val) return 0\n                  if (val.includes('/')) {\n                    const [num, den] = val.split('/')\n                    return parseInt(num, 10) / parseInt(den, 10)\n                  }\n                  return parseFloat(val)\n                }\n\n                masteringDisplay = {\n                  redX: parseCoord(sideData.red_x),\n                  redY: parseCoord(sideData.red_y),\n                  greenX: parseCoord(sideData.green_x),\n                  greenY: parseCoord(sideData.green_y),\n                  blueX: parseCoord(sideData.blue_x),\n                  blueY: parseCoord(sideData.blue_y),\n                  whitePointX: parseCoord(sideData.white_point_x),\n                  whitePointY: parseCoord(sideData.white_point_y),\n                  maxLuminance: parseLuminance(sideData.max_luminance),\n                  minLuminance: parseLuminance(sideData.min_luminance)\n                }\n              }\n            }\n\n            // Extract content light level\n            if (sideDataType.includes('content light level')) {\n              if (sideData.max_content !== undefined && sideData.max_average !== undefined) {\n                contentLightLevel = {\n                  maxCll: sideData.max_content,\n                  maxFall: sideData.max_average\n                }\n              }\n            }\n\n            if (sideDataType.includes('dolby')) {\n              hdrFormat = 'Dolby Vision'\n            }\n          }\n\n          // Infer HDR from transfer characteristics if not detected from side data\n          if (!hdrFormat && colorTransfer) {\n            const transfer = colorTransfer.toLowerCase()\n            if (transfer.includes('smpte2084') || transfer.includes('pq')) {\n              hdrFormat = 'HDR10'\n            } else if (transfer.includes('arib-std-b67') || transfer.includes('hlg')) {\n              hdrFormat = 'HLG'\n            }\n          }\n\n          // Get audio codec\n          const audioCodec = audioStream?.codec_name\n\n          resolve({\n            bitDepth,\n            colorSpace,\n            hdrFormat,\n            videoCodec,\n            audioCodec,\n            colorPrimaries,\n            colorTransfer,\n            colorMatrix,\n            masteringDisplay,\n            contentLightLevel\n          })\n        } catch {\n          resolve({})\n        }\n      })\n\n      proc.on('error', () => resolve({}))\n    })\n  }\n\n  /**\n   * Encode video using FFmpeg with SVT-AV1 or H.265\n   * Supports both single-pass and two-pass encoding\n   */\n  private async encodeVideo(item: ArchivalBatchItem, sourceInfo: VideoSourceInfo): Promise<void> {\n    if (!this.activeJob) {\n      throw new Error('No active job')\n    }\n\n    const config = this.activeJob.config\n\n    // Detect CPU capabilities for SIMD optimizations (AVX-512, etc.)\n    const cpuCapabilities = await this.ensureCpuCapabilities()\n\n    // Check if two-pass encoding is enabled\n    if (isTwoPassEnabled(config)) {\n      await this.encodeTwoPass(item, sourceInfo, cpuCapabilities)\n    } else {\n      await this.encodeSinglePass(item, sourceInfo, cpuCapabilities)\n    }\n  }\n\n  /**\n   * Perform two-pass encoding\n   */\n  private async encodeTwoPass(\n    item: ArchivalBatchItem,\n    sourceInfo: VideoSourceInfo,\n    cpuCapabilities: CPUSIMDCapabilities | null\n  ): Promise<void> {\n    if (!this.activeJob) {\n      throw new Error('No active job')\n    }\n\n    const config = this.activeJob.config\n    const batchId = this.activeJob.id\n\n    // Create temp directory for pass log files\n    const passLogDir = join(dirname(item.outputPath), '.pass-logs')\n    await mkdir(passLogDir, { recursive: true })\n\n    try {\n      // Build two-pass arguments (includes AVX-512 optimization when available)\n      const twoPassArgs = buildTwoPassArgs(\n        item.inputPath,\n        item.outputPath,\n        config,\n        sourceInfo,\n        passLogDir,\n        cpuCapabilities\n      )\n\n      // ===== PASS 1 =====\n      this.logger.info('Starting two-pass encoding - Pass 1', { input: basename(item.inputPath) })\n\n      // Emit progress event for pass 1\n      this.emitEvent({\n        batchId,\n        itemId: item.id,\n        kind: 'item_progress',\n        progress: 0,\n        status: 'encoding'\n      })\n\n      await this.runFFmpegPass(item, sourceInfo, twoPassArgs.pass1, 1, batchId)\n\n      // Check for cancellation between passes\n      if (this.abortController?.signal.aborted) {\n        throw new Error('Encoding cancelled')\n      }\n\n      // ===== PASS 2 =====\n      this.logger.info('Starting two-pass encoding - Pass 2', { input: basename(item.inputPath) })\n\n      await this.runFFmpegPass(item, sourceInfo, twoPassArgs.pass2, 2, batchId)\n\n    } finally {\n      // Clean up pass log files\n      try {\n        await rm(passLogDir, { recursive: true, force: true })\n      } catch {\n        // Ignore cleanup errors\n      }\n    }\n  }\n\n  /**\n   * Run a single FFmpeg pass (for two-pass encoding)\n   */\n  private runFFmpegPass(\n    item: ArchivalBatchItem,\n    sourceInfo: VideoSourceInfo,\n    args: string[],\n    passNumber: 1 | 2,\n    batchId: string\n  ): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const ffmpegPath = resolveBundledBinary('ffmpeg')\n\n      // Add progress output\n      const fullArgs = ['-progress', 'pipe:1', '-nostats', ...args]\n\n      // For pass 2, we need to clean up partial output on failure/cancel\n      const isPass2 = passNumber === 2\n      const outputPath = isPass2 ? item.outputPath : null\n\n      this.logger.debug(`Starting FFmpeg pass ${passNumber}`, { args: fullArgs.join(' ') })\n\n      const proc = spawn(ffmpegPath, fullArgs, { stdio: ['ignore', 'pipe', 'pipe'] })\n      this.activeProcess = proc\n\n      // Initialize timing\n      const startTime = Date.now()\n      const durationMs = (sourceInfo.duration ?? 0) * 1000\n      const durationSeconds = sourceInfo.duration ?? 0\n      let lastProgressUpdate = 0\n\n      // Parse progress from stdout\n      proc.stdout.on('data', (data: Buffer) => {\n        const lines = data.toString().split('\\n')\n        let encodedTimeMs: number | null = null\n\n        for (const line of lines) {\n          if (line.startsWith('out_time_ms=')) {\n            const timeMs = parseInt(line.split('=')[1], 10)\n            if (!isNaN(timeMs)) {\n              encodedTimeMs = timeMs\n            }\n          }\n          if (line.startsWith('out_time=')) {\n            const timeStr = line.split('=')[1]\n            const timeMs = this.parseTimeToMs(timeStr)\n            if (timeMs !== null) {\n              encodedTimeMs = timeMs\n            }\n          }\n        }\n\n        if (encodedTimeMs !== null) {\n          const now = Date.now()\n          const elapsedMs = now - startTime\n          const elapsedSeconds = elapsedMs / 1000\n\n          // Calculate progress for this pass (each pass is 50% of total for two-pass)\n          let passProgress: number\n          if (durationMs > 0) {\n            passProgress = Math.min(99, Math.max(0, Math.round((encodedTimeMs / durationMs) * 100)))\n          } else {\n            passProgress = Math.min(99, Math.round(elapsedSeconds / 60))\n          }\n\n          // Overall progress: pass 1 is 0-50%, pass 2 is 50-100%\n          const overallProgress = passNumber === 1\n            ? Math.round(passProgress / 2)\n            : 50 + Math.round(passProgress / 2)\n\n          // Throttle progress updates\n          if (now - lastProgressUpdate > 500) {\n            lastProgressUpdate = now\n            item.progress = overallProgress\n\n            this.emitEvent({\n              batchId,\n              itemId: item.id,\n              kind: 'item_progress',\n              progress: overallProgress,\n              status: 'encoding',\n              elapsedSeconds\n            })\n          }\n        }\n      })\n\n      // Capture stderr\n      let stderr = ''\n      proc.stderr.on('data', (data: Buffer) => {\n        const chunk = data.toString()\n        stderr += chunk\n        if (stderr.length > 8192) {\n          stderr = stderr.slice(-8192)\n        }\n      })\n\n      proc.on('close', (code) => {\n        this.activeProcess = null\n\n        if (code === 0) {\n          resolve()\n        } else if (this.abortController?.signal.aborted) {\n          // Clean up partial output file on cancel (pass 2 only)\n          if (outputPath) {\n            void this.cleanupPartialOutput(outputPath)\n          }\n          const error = new Error('Encoding cancelled')\n          ;(error as Error & { errorType: ArchivalErrorType }).errorType = 'cancelled'\n          reject(error)\n        } else {\n          // Clean up partial output file on error (pass 2 only)\n          if (outputPath) {\n            void this.cleanupPartialOutput(outputPath)\n          }\n\n          const errorPatterns = [\n            /Error[^\\n]*/i,\n            /error[^\\n]*/i,\n            /Invalid[^\\n]*/i\n          ]\n\n          let errorMsg = `FFmpeg pass ${passNumber} exited with code ${code}`\n          for (const pattern of errorPatterns) {\n            const match = stderr.match(pattern)\n            if (match) {\n              errorMsg = match[0].trim()\n              break\n            }\n          }\n\n          const errorType = classifyError(stderr || errorMsg)\n          const error = new Error(errorMsg)\n          ;(error as Error & { errorType: ArchivalErrorType }).errorType = errorType\n          reject(error)\n        }\n      })\n\n      proc.on('error', (error) => {\n        this.activeProcess = null\n        // Clean up partial output file on error (pass 2 only)\n        if (outputPath) {\n          void this.cleanupPartialOutput(outputPath)\n        }\n        const typedError = error as Error & { errorType?: ArchivalErrorType }\n        typedError.errorType = classifyError(error.message)\n        reject(typedError)\n      })\n\n      // Handle abort signal\n      const abortHandler = (): void => {\n        if (platform() === 'win32') {\n          proc.kill()\n        } else {\n          proc.kill('SIGTERM')\n        }\n      }\n\n      if (this.abortController) {\n        this.abortController.signal.addEventListener('abort', abortHandler, { once: true })\n      }\n    })\n  }\n\n  /**\n   * Perform single-pass encoding (original implementation)\n   */\n  private encodeSinglePass(\n    item: ArchivalBatchItem,\n    sourceInfo: VideoSourceInfo,\n    cpuCapabilities: CPUSIMDCapabilities | null\n  ): Promise<void> {\n    return new Promise((resolve, reject) => {\n      if (!this.activeJob) {\n        reject(new Error('No active job'))\n        return\n      }\n\n      const ffmpegPath = resolveBundledBinary('ffmpeg')\n      const batchId = this.activeJob.id\n      // Build FFmpeg args (includes AVX-512 optimization when available for x265)\n      const args = buildArchivalFFmpegArgs(\n        item.inputPath,\n        item.outputPath,\n        this.activeJob.config,\n        sourceInfo,\n        cpuCapabilities\n      )\n\n      // Add progress output\n      args.unshift('-progress', 'pipe:1', '-nostats')\n\n      this.logger.debug('Starting FFmpeg', { args: args.join(' ') })\n\n      const proc = spawn(ffmpegPath, args, { stdio: ['ignore', 'pipe', 'pipe'] })\n      this.activeProcess = proc\n\n      // Initialize timing\n      this.encodingStartTime = Date.now()\n      const durationMs = (sourceInfo.duration ?? 0) * 1000\n      const durationSeconds = sourceInfo.duration ?? 0\n      let lastProgressUpdate = 0\n\n      // Parse progress from stdout\n      proc.stdout.on('data', (data: Buffer) => {\n        const lines = data.toString().split('\\n')\n        let encodedTimeMs: number | null = null\n\n        for (const line of lines) {\n          // Parse out_time_ms for progress calculation\n          if (line.startsWith('out_time_ms=')) {\n            const timeMs = parseInt(line.split('=')[1], 10)\n            if (!isNaN(timeMs)) {\n              encodedTimeMs = timeMs\n            }\n          }\n          // Also check out_time format (HH:MM:SS.mmm)\n          if (line.startsWith('out_time=')) {\n            const timeStr = line.split('=')[1]\n            const timeMs = this.parseTimeToMs(timeStr)\n            if (timeMs !== null) {\n              encodedTimeMs = timeMs\n            }\n          }\n        }\n\n        if (encodedTimeMs !== null) {\n          const now = Date.now()\n          const elapsedMs = now - this.encodingStartTime\n          const elapsedSeconds = elapsedMs / 1000\n\n          // Calculate progress\n          let progress: number\n          if (durationMs > 0) {\n            progress = Math.min(99, Math.max(0, Math.round((encodedTimeMs / durationMs) * 100)))\n          } else {\n            // Fallback: use frame-based progress if duration is 0\n            // Estimate based on elapsed time and fps (assume we're making progress)\n            progress = Math.min(99, Math.round(elapsedSeconds / 60)) // Cap at 99%, assume 1% per minute\n          }\n\n          // Calculate encoding speed (x realtime)\n          const encodedSeconds = encodedTimeMs / 1000\n          let speed = 0\n          if (elapsedSeconds > 0) {\n            speed = encodedSeconds / elapsedSeconds\n            // Update speed samples for moving average\n            this.speedSamples.push(speed)\n            if (this.speedSamples.length > this.maxSpeedSamples) {\n              this.speedSamples.shift()\n            }\n          }\n\n          // Calculate average speed\n          const avgSpeed = this.speedSamples.length > 0\n            ? this.speedSamples.reduce((a, b) => a + b, 0) / this.speedSamples.length\n            : speed\n\n          // Calculate ETA for current item\n          let itemEtaSeconds: number | undefined\n          if (durationSeconds > 0 && avgSpeed > 0) {\n            const remainingSeconds = durationSeconds - encodedSeconds\n            itemEtaSeconds = remainingSeconds / avgSpeed\n          }\n\n          // Calculate batch ETA\n          let batchEtaSeconds: number | undefined\n          if (this.activeJob && avgSpeed > 0) {\n            // Remaining duration for current item\n            const currentItemRemaining = durationSeconds > 0\n              ? Math.max(0, durationSeconds - encodedSeconds)\n              : 0\n\n            // Sum remaining items' durations (those still queued)\n            // For items without duration info, estimate using average of known durations\n            let remainingItemsDuration = 0\n            let knownDurations: number[] = []\n            let unknownCount = 0\n\n            for (const i of this.activeJob.items) {\n              if (i.status === 'queued') {\n                if (i.sourceInfo?.duration) {\n                  remainingItemsDuration += i.sourceInfo.duration\n                  knownDurations.push(i.sourceInfo.duration)\n                } else {\n                  unknownCount++\n                }\n              }\n            }\n\n            // Estimate unknown durations using average of known ones, or current item's duration\n            if (unknownCount > 0) {\n              const avgDuration = knownDurations.length > 0\n                ? knownDurations.reduce((a, b) => a + b, 0) / knownDurations.length\n                : durationSeconds > 0\n                  ? durationSeconds\n                  : 300 // Default to 5 minutes if no info available\n              remainingItemsDuration += avgDuration * unknownCount\n            }\n\n            const totalRemainingDuration = currentItemRemaining + remainingItemsDuration\n            batchEtaSeconds = totalRemainingDuration / avgSpeed\n          }\n\n          // Update item tracking\n          item.progress = progress\n          item.encodingSpeed = avgSpeed\n          item.etaSeconds = itemEtaSeconds\n          item.elapsedSeconds = elapsedSeconds\n\n          // Update batch-level tracking\n          if (this.activeJob) {\n            this.activeJob.averageSpeed = avgSpeed\n            this.activeJob.batchEtaSeconds = batchEtaSeconds\n          }\n\n          // Throttle progress updates (every 500ms)\n          if (now - lastProgressUpdate > 500) {\n            lastProgressUpdate = now\n\n            // Calculate batch progress (guard against division by zero)\n            const processedItems = this.activeJob?.completedItems ?? 0\n            const totalItems = Math.max(1, this.activeJob?.totalItems ?? 1)\n            const batchProgress = Math.round(\n              ((processedItems + progress / 100) / totalItems) * 100\n            )\n\n            this.emitEvent({\n              batchId,\n              itemId: item.id,\n              kind: 'item_progress',\n              progress,\n              status: 'encoding',\n              encodingSpeed: avgSpeed,\n              itemEtaSeconds,\n              batchEtaSeconds,\n              elapsedSeconds,\n              batchProgress,\n              processedItems,\n              totalItems\n            })\n          }\n        }\n      })\n\n      // Capture stderr for error messages and logging\n      let stderr = ''\n      proc.stderr.on('data', (data: Buffer) => {\n        const chunk = data.toString()\n        stderr += chunk\n\n        // Log stderr for debugging (limit to prevent log spam)\n        if (stderr.length <= 8192) {\n          this.logger.debug('FFmpeg stderr', { chunk: chunk.trim() })\n        }\n\n        // Keep only last 8KB for error extraction\n        if (stderr.length > 8192) {\n          stderr = stderr.slice(-8192)\n        }\n      })\n\n      proc.on('close', (code) => {\n        this.activeProcess = null\n\n        if (code === 0) {\n          resolve()\n        } else if (this.abortController?.signal.aborted) {\n          // Clean up partial output file on cancel\n          void this.cleanupPartialOutput(item.outputPath)\n          const error = new Error('Encoding cancelled')\n          ;(error as Error & { errorType: ArchivalErrorType }).errorType = 'cancelled'\n          reject(error)\n        } else {\n          // Clean up partial output file on error\n          void this.cleanupPartialOutput(item.outputPath)\n\n          // Log full stderr for debugging\n          this.logger.error('FFmpeg encoding failed', {\n            input: item.inputPath,\n            exitCode: code,\n            stderr: stderr.slice(-2048) // Last 2KB in log\n          })\n\n          // Extract meaningful error from stderr\n          // Look for common FFmpeg error patterns\n          const errorPatterns = [\n            /Error[^\\n]*/i,\n            /error[^\\n]*/i,\n            /Invalid[^\\n]*/i,\n            /No space[^\\n]*/i,\n            /Unknown encoder[^\\n]*/i,\n            /Encoder .* not found[^\\n]*/i,\n            /Option .* not found[^\\n]*/i,\n            /Unrecognized option[^\\n]*/i,\n            /Could not[^\\n]*/i,\n            /Cannot[^\\n]*/i\n          ]\n\n          let errorMsg = `FFmpeg exited with code ${code}`\n          for (const pattern of errorPatterns) {\n            const match = stderr.match(pattern)\n            if (match) {\n              errorMsg = match[0].trim()\n              break\n            }\n          }\n\n          // Include last few lines of stderr for more context\n          const stderrLines = stderr.trim().split('\\n').filter(l => l.trim())\n          const lastLines = stderrLines.slice(-3).join(' | ')\n          if (lastLines && !errorMsg.includes(lastLines.slice(0, 50))) {\n            errorMsg = `${errorMsg} - ${lastLines.slice(0, 200)}`\n          }\n\n          // Classify the error\n          const errorType = classifyError(stderr || errorMsg)\n\n          const error = new Error(errorMsg)\n          ;(error as Error & { errorType: ArchivalErrorType }).errorType = errorType\n          reject(error)\n        }\n      })\n\n      proc.on('error', (error) => {\n        this.activeProcess = null\n        void this.cleanupPartialOutput(item.outputPath)\n\n        // Classify the error\n        const typedError = error as Error & { errorType?: ArchivalErrorType }\n        typedError.errorType = classifyError(error.message)\n        reject(typedError)\n      })\n\n      // Handle abort signal with proper cleanup\n      const abortHandler = (): void => {\n        // Use SIGKILL on Windows (SIGTERM may not work), SIGTERM on Unix\n        if (platform() === 'win32') {\n          proc.kill() // Default signal, more reliable on Windows\n        } else {\n          proc.kill('SIGTERM')\n        }\n      }\n\n      if (this.abortController) {\n        this.abortController.signal.addEventListener('abort', abortHandler, { once: true })\n      }\n    })\n  }\n\n  /**\n   * Determine whether an item should be skipped in fill mode.\n   * Fill mode avoids output name conflicts by skipping items that would collide.\n   */\n  private async shouldSkipForFillMode(outputPath: string): Promise<boolean> {\n    if (!this.activeJob?.config.fillMode) return false\n\n    if (!this.fillModeSeenOutputs) {\n      this.fillModeSeenOutputs = new Set<string>()\n    }\n\n    const normalizedOutput = this.normalizeOutputPath(outputPath)\n    if (this.fillModeSeenOutputs.has(normalizedOutput)) {\n      return true\n    }\n\n    try {\n      await access(outputPath)\n      this.fillModeSeenOutputs.add(normalizedOutput)\n      return true\n    } catch {\n      // Output doesn't exist, proceed\n    }\n\n    this.fillModeSeenOutputs.add(normalizedOutput)\n    return false\n  }\n\n  /**\n   * Mark an item as skipped and emit a completion event.\n   */\n  private markItemSkipped(item: ArchivalBatchItem): void {\n    if (!this.activeJob) return\n\n    item.status = 'skipped'\n    item.completedAt = new Date().toISOString()\n    this.activeJob.skippedItems++\n\n    this.emitEvent({\n      batchId: this.activeJob.id,\n      itemId: item.id,\n      kind: 'item_complete',\n      progress: 100,\n      status: 'skipped'\n    })\n  }\n\n  private normalizeOutputPath(filePath: string): string {\n    const normalized = filePath.replace(/\\\\/g, '/')\n    return platform() === 'win32' ? normalized.toLowerCase() : normalized\n  }\n\n  /**\n   * Clean up partial output file on error/cancel\n   */\n  private async cleanupPartialOutput(outputPath: string): Promise<void> {\n    try {\n      await unlink(outputPath)\n      this.logger.debug('Cleaned up partial output', { outputPath })\n    } catch {\n      // File may not exist, ignore\n    }\n  }\n\n  /**\n   * Format bytes to human-readable string\n   */\n  private formatBytes(bytes: number): string {\n    if (bytes < 1024) return `${bytes} B`\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(2)} GB`\n  }\n\n  /**\n   * Parse time string (HH:MM:SS.mmm or HH:MM:SS) to milliseconds\n   */\n  private parseTimeToMs(timeStr: string): number | null {\n    if (!timeStr || typeof timeStr !== 'string') return null\n\n    // Try with milliseconds first: HH:MM:SS.mmm\n    const matchWithMs = timeStr.match(/(\\d+):(\\d+):(\\d+)\\.(\\d+)/)\n    if (matchWithMs) {\n      const hours = parseInt(matchWithMs[1], 10)\n      const minutes = parseInt(matchWithMs[2], 10)\n      const seconds = parseInt(matchWithMs[3], 10)\n      const ms = parseInt(matchWithMs[4].padEnd(3, '0').slice(0, 3), 10)\n      return (hours * 3600 + minutes * 60 + seconds) * 1000 + ms\n    }\n\n    // Try without milliseconds: HH:MM:SS\n    const matchNoMs = timeStr.match(/(\\d+):(\\d+):(\\d+)/)\n    if (matchNoMs) {\n      const hours = parseInt(matchNoMs[1], 10)\n      const minutes = parseInt(matchNoMs[2], 10)\n      const seconds = parseInt(matchNoMs[3], 10)\n      return (hours * 3600 + minutes * 60 + seconds) * 1000\n    }\n\n    return null\n  }\n\n  /**\n   * Build output path for a video, handling duplicates\n   * Also handles the case where input and output would be the same file\n   */\n  private buildOutputPath(\n    inputPath: string,\n    outputDir: string,\n    config: ArchivalEncodingConfig,\n    relativePath?: string\n  ): string {\n    const inputName = basename(inputPath, extname(inputPath))\n    const extension = config.container\n\n    let outputPath: string\n\n    // Preserve folder structure when enabled and relative path is provided\n    if (config.preserveStructure && relativePath) {\n      const relativeDir = dirname(relativePath)\n      if (relativeDir && relativeDir !== '.') {\n        outputPath = join(outputDir, relativeDir, `${inputName}.${extension}`)\n      } else {\n        outputPath = join(outputDir, `${inputName}.${extension}`)\n      }\n    } else {\n      // Simple flat output structure\n      outputPath = join(outputDir, `${inputName}.${extension}`)\n    }\n\n    // Check if output would be the same as input (FFmpeg can't edit in-place)\n    // Normalize paths for comparison (handle case sensitivity on Windows)\n    const normalizedInput = inputPath.toLowerCase().replace(/\\\\/g, '/')\n    const normalizedOutput = outputPath.toLowerCase().replace(/\\\\/g, '/')\n\n    if (normalizedInput === normalizedOutput) {\n      // Add codec suffix to differentiate output from input\n      const codecSuffix = config.codec === 'h265' ? '.hevc' : '.av1'\n      outputPath = join(\n        dirname(outputPath),\n        `${inputName}${codecSuffix}.${extension}`\n      )\n    }\n\n    return outputPath\n  }\n\n  /**\n   * Deduplicate output paths to handle files with same name from different folders\n   * Uses a set to track all used paths and finds unique suffixes\n   */\n  private deduplicateOutputPaths(items: ArchivalBatchItem[]): void {\n    const usedPaths = new Set<string>()\n\n    for (const item of items) {\n      let outputPath = item.outputPath\n      let counter = 1\n\n      // Find a unique path\n      while (usedPaths.has(outputPath)) {\n        const ext = extname(item.outputPath)\n        const base = item.outputPath.slice(0, -ext.length)\n        outputPath = `${base}_${counter}${ext}`\n        counter++\n      }\n\n      item.outputPath = outputPath\n      usedPaths.add(outputPath)\n    }\n  }\n\n  /**\n   * Extract a thumbnail from the encoded video\n   */\n  private async extractThumbnail(\n    videoPath: string,\n    sourceInfo: VideoSourceInfo,\n    thumbnailTimestamp?: number\n  ): Promise<string> {\n    // Check if cancelled before starting\n    if (this.abortController?.signal.aborted) {\n      throw new Error('Thumbnail extraction cancelled')\n    }\n\n    const ffmpegPath = resolveBundledBinary('ffmpeg')\n\n    // Determine thumbnail timestamp\n    // For custom timestamp, clamp to video duration\n    // For auto, use 10% into video but handle very short videos\n    const duration = sourceInfo.duration ?? 10\n    let timestampSec: number\n    if (thumbnailTimestamp !== undefined) {\n      // Clamp custom timestamp to video duration (with small buffer)\n      timestampSec = Math.min(thumbnailTimestamp, Math.max(0, duration - 0.1))\n    } else {\n      // Auto: 10% into video, but at least 0.5s and at most duration - 0.1s\n      timestampSec = Math.min(Math.max(0.5, duration * 0.1), Math.max(0, duration - 0.1))\n    }\n\n    // Build thumbnail path next to video file\n    const videoDir = dirname(videoPath)\n    const videoName = basename(videoPath, extname(videoPath))\n    const thumbnailPath = join(videoDir, `${videoName}.jpg`)\n\n    return new Promise((resolve, reject) => {\n      const args = [\n        '-ss', String(timestampSec),\n        '-i', videoPath,\n        '-vf', \"scale='min(480,iw)':-2\",\n        '-vframes', '1',\n        '-q:v', '5',\n        '-y',\n        thumbnailPath\n      ]\n\n      this.logger.debug('Extracting thumbnail', { videoPath, thumbnailPath, timestampSec })\n\n      const proc = spawn(ffmpegPath, args, { stdio: ['ignore', 'pipe', 'pipe'] })\n\n      let stderr = ''\n      proc.stderr.on('data', (data: Buffer) => {\n        stderr += data.toString()\n      })\n\n      // Handle cancellation during extraction\n      const abortHandler = (): void => {\n        proc.kill()\n        // Clean up partial thumbnail\n        void unlink(thumbnailPath).catch(() => {})\n      }\n      this.abortController?.signal.addEventListener('abort', abortHandler, { once: true })\n\n      proc.on('close', async (code) => {\n        // Remove abort listener\n        this.abortController?.signal.removeEventListener('abort', abortHandler)\n\n        if (this.abortController?.signal.aborted) {\n          // Clean up if cancelled\n          await unlink(thumbnailPath).catch(() => {})\n          reject(new Error('Thumbnail extraction cancelled'))\n          return\n        }\n\n        if (code === 0) {\n          this.logger.info('Thumbnail extracted', { thumbnailPath })\n          resolve(thumbnailPath)\n        } else {\n          // Clean up failed/partial thumbnail\n          await unlink(thumbnailPath).catch(() => {})\n          this.logger.warn('Thumbnail extraction failed', { code, stderr: stderr.slice(-500) })\n          reject(new Error(`Thumbnail extraction failed with code ${code}`))\n        }\n      })\n\n      proc.on('error', async (error) => {\n        // Remove abort listener\n        this.abortController?.signal.removeEventListener('abort', abortHandler)\n        // Clean up failed/partial thumbnail\n        await unlink(thumbnailPath).catch(() => {})\n        this.logger.warn('Thumbnail extraction error', { error: error.message })\n        reject(error)\n      })\n    })\n  }\n\n  /**\n   * Extract captions from video using Whisper (bundled or LM Studio)\n   * Extracts audio, runs transcription, produces VTT subtitles\n   */\n  private async extractCaptions(\n    videoPath: string,\n    language?: string\n  ): Promise<string> {\n    // Check if cancelled before starting\n    if (this.abortController?.signal.aborted) {\n      throw new Error('Caption extraction cancelled')\n    }\n\n    // Get provider settings\n    const providerSettings = this.whisperProviderGetter?.() ?? { provider: 'bundled', endpoint: '' }\n    const useLmStudio = providerSettings.provider === 'lmstudio'\n\n    // For bundled provider, verify model exists\n    if (!useLmStudio) {\n      const modelPath = this.whisperModelPathGetter?.()\n      if (!modelPath) {\n        throw new Error('Whisper model not configured. Please select a model in Settings.')\n      }\n      try {\n        await access(modelPath)\n      } catch {\n        throw new Error(`Whisper model not found at: ${modelPath}`)\n      }\n    }\n\n    const ffmpegPath = resolveBundledBinary('ffmpeg')\n\n    // Build paths\n    const videoDir = dirname(videoPath)\n    const videoName = parse(videoPath).name\n    // Use a unique temp name for audio to avoid conflicts\n    const tempAudioName = `${videoName}_whisper_temp`\n    const audioPath = join(videoDir, `${tempAudioName}.wav`)\n    // WhisperService outputs files based on audio file basename, so VTT will be at:\n    const vttOutputPath = join(videoDir, `${tempAudioName}.vtt`)\n    const txtOutputPath = join(videoDir, `${tempAudioName}.txt`)\n    // Final VTT path (renamed to match video name)\n    const finalVttPath = join(videoDir, `${videoName}.vtt`)\n\n    this.logger.info('Starting caption extraction', {\n      videoPath,\n      language,\n      provider: useLmStudio ? 'lmstudio' : 'bundled'\n    })\n\n    try {\n      // Step 1: Extract audio to WAV format for Whisper\n      await this.extractAudioForWhisper(videoPath, audioPath, ffmpegPath)\n\n      // Step 2: Run transcription based on provider\n      if (useLmStudio) {\n        await this.transcribeWithLmStudio(audioPath, finalVttPath, providerSettings.endpoint, language)\n        // LM Studio writes directly to final path, no rename needed\n        this.logger.info('Caption extraction completed (LM Studio)', { vttPath: finalVttPath })\n        return finalVttPath\n      } else {\n        // Use bundled whisper\n        const modelPath = this.whisperModelPathGetter?.()!\n        const useGpu = this.whisperGpuEnabledGetter?.() ?? true // Default to GPU if available\n        this.logger.info('Running Whisper transcription', { audioPath, modelPath, useGpu })\n\n        await this.whisperService.transcribe({\n          audioPath,\n          modelPath,\n          outputDir: videoDir,\n          language: language || undefined,\n          signal: this.abortController?.signal,\n          useGpu,\n          onLog: (chunk) => {\n            this.logger.debug('Whisper output', { chunk: chunk.trim() })\n          }\n        })\n\n        // Step 3: Rename VTT file to match video name\n        try {\n          // Check if final path already exists and remove it\n          await unlink(finalVttPath).catch(() => {})\n          // Rename temp VTT to final name\n          await rename(vttOutputPath, finalVttPath)\n        } catch (renameError) {\n          // If rename fails, the temp VTT is still usable\n          this.logger.warn('Failed to rename VTT file, using temp name', {\n            from: vttOutputPath,\n            to: finalVttPath,\n            error: renameError instanceof Error ? renameError.message : 'Unknown'\n          })\n          // Return the temp path if rename failed\n          this.logger.info('Caption extraction completed', { vttPath: vttOutputPath })\n          return vttOutputPath\n        }\n\n        this.logger.info('Caption extraction completed', { vttPath: finalVttPath })\n        return finalVttPath\n      }\n    } finally {\n      // Clean up temporary files\n      await unlink(audioPath).catch(() => {})\n      await unlink(txtOutputPath).catch(() => {}) // Clean up .txt file too (bundled whisper)\n      // Don't clean up vttOutputPath here - it's either renamed or returned\n    }\n  }\n\n  /**\n   * Extract audio from video to WAV format for Whisper transcription\n   */\n  private async extractAudioForWhisper(\n    videoPath: string,\n    audioPath: string,\n    ffmpegPath: string\n  ): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      const args = [\n        '-i', videoPath,\n        '-vn', // No video\n        '-acodec', 'pcm_s16le', // 16-bit PCM\n        '-ar', '16000', // 16kHz sample rate (required by Whisper)\n        '-ac', '1', // Mono\n        '-y', // Overwrite\n        audioPath\n      ]\n\n      this.logger.debug('Extracting audio for transcription', { args: args.join(' ') })\n\n      const proc = spawn(ffmpegPath, args, { stdio: ['ignore', 'pipe', 'pipe'] })\n\n      let stderr = ''\n      proc.stderr.on('data', (data: Buffer) => {\n        stderr += data.toString()\n      })\n\n      // Handle cancellation during audio extraction\n      const abortHandler = (): void => {\n        proc.kill()\n        void unlink(audioPath).catch(() => {})\n      }\n      this.abortController?.signal.addEventListener('abort', abortHandler, { once: true })\n\n      proc.on('close', (code) => {\n        this.abortController?.signal.removeEventListener('abort', abortHandler)\n\n        if (this.abortController?.signal.aborted) {\n          void unlink(audioPath).catch(() => {})\n          reject(new Error('Caption extraction cancelled'))\n          return\n        }\n\n        if (code === 0) {\n          resolve()\n        } else {\n          void unlink(audioPath).catch(() => {})\n          // Check for no audio stream\n          if (stderr.includes('does not contain any stream') || stderr.includes('Output file is empty')) {\n            reject(new Error('Video has no audio stream'))\n          } else {\n            reject(new Error(`Audio extraction failed with code ${code}`))\n          }\n        }\n      })\n\n      proc.on('error', (error) => {\n        this.abortController?.signal.removeEventListener('abort', abortHandler)\n        void unlink(audioPath).catch(() => {})\n        reject(error)\n      })\n    })\n  }\n\n  /**\n   * Transcribe audio using LM Studio's OpenAI-compatible API\n   * Sends audio to the /v1/audio/transcriptions endpoint\n   */\n  private async transcribeWithLmStudio(\n    audioPath: string,\n    outputVttPath: string,\n    endpoint: string,\n    language?: string\n  ): Promise<void> {\n    const { readFile, writeFile } = await import('node:fs/promises')\n\n    this.logger.info('Transcribing with LM Studio', { endpoint, audioPath })\n\n    // Read the audio file\n    const audioData = await readFile(audioPath)\n    const audioBlob = new Blob([audioData], { type: 'audio/wav' })\n\n    // Create form data for the OpenAI-compatible API\n    const formData = new FormData()\n    formData.append('file', audioBlob, 'audio.wav')\n    formData.append('model', 'whisper-1') // LM Studio ignores this, uses loaded model\n    formData.append('response_format', 'vtt') // Request VTT format directly\n    if (language) {\n      formData.append('language', language)\n    }\n\n    // Make the request with abort signal support\n    const response = await fetch(endpoint, {\n      method: 'POST',\n      body: formData,\n      signal: this.abortController?.signal\n    })\n\n    if (!response.ok) {\n      const errorText = await response.text().catch(() => 'Unknown error')\n      throw new Error(`LM Studio transcription failed: ${response.status} ${response.statusText} - ${errorText}`)\n    }\n\n    // Get the VTT content\n    const vttContent = await response.text()\n\n    // Write VTT file\n    await writeFile(outputVttPath, vttContent, 'utf-8')\n\n    this.logger.info('LM Studio transcription completed', { outputVttPath })\n  }\n\n  /**\n   * Emit progress event\n   */\n  private emitEvent(event: ArchivalProgressEvent): void {\n    this.onEvent?.(event)\n  }\n}\n", "export type LogLevel = 'debug' | 'info' | 'warn' | 'error'\n\nexport class Logger {\n  constructor(private readonly scope: string) {}\n\n  private write(level: LogLevel, message: string, meta?: Record<string, unknown>): void {\n    const timestamp = new Date().toISOString()\n    const suffix = meta ? ` ${JSON.stringify(meta)}` : ''\n    // eslint-disable-next-line no-console\n    console[level](`[${timestamp}] [${this.scope}] ${message}${suffix}`)\n  }\n\n  debug(message: string, meta?: Record<string, unknown>): void {\n    this.write('debug', message, meta)\n  }\n\n  info(message: string, meta?: Record<string, unknown>): void {\n    this.write('info', message, meta)\n  }\n\n  warn(message: string, meta?: Record<string, unknown>): void {\n    this.write('warn', message, meta)\n  }\n\n  error(message: string, meta?: Record<string, unknown>): void {\n    this.write('error', message, meta)\n  }\n}\n", "import { join, dirname } from 'node:path'\nimport { existsSync } from 'node:fs'\nimport { execSync } from 'node:child_process'\n\nexport type BinaryName = 'yt-dlp' | 'ffmpeg' | 'ffprobe' | 'whisper' | 'faster-whisper'\n\n// Get current directory - works in both ESM and CJS\nfunction getCurrentDir(): string {\n  // Try CJS __dirname first (available when bundled as CJS)\n  if (typeof __dirname !== 'undefined') {\n    return __dirname\n  }\n  // Fall back to ESM import.meta.url\n  try {\n    const { fileURLToPath } = require('node:url')\n    return dirname(fileURLToPath(import.meta.url))\n  } catch {\n    return process.cwd()\n  }\n}\n\n// Check if running in Electron context\nfunction isElectron(): boolean {\n  // Check for CLI_MODE environment variable set by build\n  if (process.env.CLI_MODE === 'true') return false\n  return typeof process !== 'undefined' &&\n    process.versions != null &&\n    process.versions.electron != null\n}\n\n// Get Electron app if available\nasync function getElectronAppAsync(): Promise<{ isPackaged: boolean; getAppPath: () => string } | null> {\n  if (!isElectron()) return null\n  try {\n    // Dynamic import to avoid bundling issues in CLI mode\n    const electron = await import('electron')\n    return electron.app\n  } catch {\n    return null\n  }\n}\n\n// Synchronous version for compatibility - returns cached value or null\nlet cachedApp: { isPackaged: boolean; getAppPath: () => string } | null | undefined = undefined\n\nfunction getElectronApp(): { isPackaged: boolean; getAppPath: () => string } | null {\n  if (cachedApp !== undefined) return cachedApp\n  if (!isElectron()) {\n    cachedApp = null\n    return null\n  }\n  try {\n    // eslint-disable-next-line @typescript-eslint/no-require-imports\n    const { app } = require('electron')\n    cachedApp = app\n    return app\n  } catch {\n    cachedApp = null\n    return null\n  }\n}\n\n/**\n * Get resources path - works in both Electron and CLI mode\n */\nfunction getResourcesPath(): string {\n  const app = getElectronApp()\n\n  if (app) {\n    // Electron mode\n    return app.isPackaged ? process.resourcesPath : join(app.getAppPath(), 'resources')\n  }\n\n  // CLI mode - find resources relative to current file or cwd\n  const possiblePaths = [\n    join(process.cwd(), 'resources'),\n    join(getCurrentDir(), '..', '..', '..', 'resources')\n  ]\n\n  for (const p of possiblePaths) {\n    if (existsSync(p)) return p\n  }\n\n  return join(process.cwd(), 'resources')\n}\n\n/**\n * Whisper backend types\n * - whisper.cpp: C++ implementation, fast on Apple Silicon with Metal\n * - faster-whisper: Python-based CTranslate2 implementation, faster on CPU (especially Linux)\n */\nexport type WhisperBackend = 'whisper.cpp' | 'faster-whisper' | 'none'\n\nfunction platformDir(): string {\n  if (process.platform === 'darwin') {\n    return 'darwin'\n  }\n\n  if (process.platform === 'win32') {\n    return 'win32'\n  }\n\n  return 'linux'\n}\n\n/**\n * Try to find a binary in the system PATH\n * Returns the path if found, null otherwise\n */\nfunction findInSystemPath(name: string): string | null {\n  if (process.platform === 'win32') {\n    // On Windows, we don't fall back to system PATH - always use bundled\n    return null\n  }\n\n  try {\n    // Use 'which' to find the binary in PATH\n    const result = execSync(`which ${name}`, { encoding: 'utf-8', stdio: ['pipe', 'pipe', 'pipe'] })\n    const path = result.trim()\n    if (path && existsSync(path)) {\n      return path\n    }\n  } catch {\n    // 'which' failed or binary not found\n  }\n\n  // Check common installation paths on Linux/macOS\n  const commonPaths = [\n    `/usr/bin/${name}`,\n    `/usr/local/bin/${name}`,\n    `/opt/homebrew/bin/${name}`, // macOS Homebrew ARM\n    `/home/linuxbrew/.linuxbrew/bin/${name}` // Linux Homebrew\n  ]\n\n  for (const path of commonPaths) {\n    if (existsSync(path)) {\n      return path\n    }\n  }\n\n  return null\n}\n\n/**\n * Resolve the path to a bundled binary\n * On Linux, falls back to system PATH if bundled binary doesn't exist\n */\nexport function resolveBundledBinary(name: BinaryName): string {\n  const resourcesPath = getResourcesPath()\n  const binaryName = process.platform === 'win32' ? `${name}.exe` : name\n  const bundledPath = join(resourcesPath, 'bin', platformDir(), binaryName)\n\n  // If bundled binary exists, use it\n  if (existsSync(bundledPath)) {\n    return bundledPath\n  }\n\n  // On Linux/macOS, fall back to system PATH if bundled binary doesn't exist\n  // This allows users who installed ffmpeg via package manager to use the app\n  if (process.platform !== 'win32') {\n    const systemPath = findInSystemPath(name)\n    if (systemPath) {\n      return systemPath\n    }\n  }\n\n  // Return the bundled path even if it doesn't exist\n  // The caller will handle the missing binary error\n  return bundledPath\n}\n\nexport function getBundledBinaryDir(): string {\n  const resourcesPath = getResourcesPath()\n  return join(resourcesPath, 'bin', platformDir())\n}\n\n/**\n * Check if a binary is available (either bundled or in system PATH)\n */\nexport function isBinaryAvailable(name: BinaryName): boolean {\n  const path = resolveBundledBinary(name)\n  return existsSync(path)\n}\n\n/**\n * Check if faster-whisper CLI is available\n * Returns the command to invoke it, or null if not available\n *\n * Note: faster-whisper is a Python library - the CLI comes from separate packages:\n * - `faster-whisper` CLI (from faster-whisper-xxl or similar)\n * - `whisper-ctranslate2` CLI (alternative faster-whisper CLI)\n */\nexport function detectFasterWhisper(): { available: boolean; command: string[] } {\n  // CLI tools to check for (in order of preference)\n  const cliTools = [\n    'faster-whisper',      // Main CLI (from faster-whisper package with CLI extras)\n    'whisper-ctranslate2'  // Alternative CLI that uses faster-whisper\n  ]\n\n  for (const tool of cliTools) {\n    try {\n      execSync(`${tool} --help`, { encoding: 'utf-8', stdio: ['pipe', 'pipe', 'pipe'] })\n      return { available: true, command: [tool] }\n    } catch {\n      // Not available\n    }\n  }\n\n  return { available: false, command: [] }\n}\n\n/**\n * Determine the best available Whisper backend for the current platform\n * - macOS: Prefer whisper.cpp (Metal GPU support)\n * - Linux: Prefer faster-whisper (better CPU performance)\n * - Windows: Prefer whisper.cpp\n */\nexport function detectBestWhisperBackend(): {\n  backend: WhisperBackend\n  reason: string\n  command?: string[]\n} {\n  const whisperCppAvailable = isBinaryAvailable('whisper')\n  const fasterWhisper = detectFasterWhisper()\n\n  // On Linux, prefer faster-whisper if available (much better CPU performance)\n  if (process.platform === 'linux') {\n    if (fasterWhisper.available) {\n      return {\n        backend: 'faster-whisper',\n        reason: 'faster-whisper provides better CPU performance on Linux',\n        command: fasterWhisper.command\n      }\n    }\n    if (whisperCppAvailable) {\n      return {\n        backend: 'whisper.cpp',\n        reason: 'whisper.cpp is available (consider installing faster-whisper for better performance)',\n        command: undefined\n      }\n    }\n    return {\n      backend: 'none',\n      reason: 'No whisper backend available. Install faster-whisper: pip install faster-whisper'\n    }\n  }\n\n  // On macOS, prefer whisper.cpp (Metal GPU support on Apple Silicon)\n  if (process.platform === 'darwin') {\n    if (whisperCppAvailable) {\n      return {\n        backend: 'whisper.cpp',\n        reason: 'whisper.cpp with Metal GPU acceleration',\n        command: undefined\n      }\n    }\n    if (fasterWhisper.available) {\n      return {\n        backend: 'faster-whisper',\n        reason: 'faster-whisper (whisper.cpp not available)',\n        command: fasterWhisper.command\n      }\n    }\n    return {\n      backend: 'none',\n      reason: 'No whisper backend available'\n    }\n  }\n\n  // On Windows, prefer whisper.cpp\n  if (whisperCppAvailable) {\n    return {\n      backend: 'whisper.cpp',\n      reason: 'whisper.cpp',\n      command: undefined\n    }\n  }\n  if (fasterWhisper.available) {\n    return {\n      backend: 'faster-whisper',\n      reason: 'faster-whisper (whisper.cpp not available)',\n      command: fasterWhisper.command\n    }\n  }\n\n  return {\n    backend: 'none',\n    reason: 'No whisper backend available'\n  }\n}\n", "import { spawn } from 'node:child_process'\nimport { statSync } from 'node:fs'\nimport { Logger } from '../../utils/logger'\nimport { resolveBundledBinary } from '../../utils/binary'\n\nexport type MetadataRequest = {\n  filePath: string\n}\n\nexport type MetadataResult = {\n  duration: number | null\n  width: number | null\n  height: number | null\n  fps: number | null\n  codec: string | null\n  container: string | null\n  bitrate: number | null\n  fileSize: number | null\n}\n\nexport class MetadataService {\n  private readonly logger = new Logger('MetadataService')\n\n  async extract(request: MetadataRequest): Promise<MetadataResult> {\n    this.logger.info('metadata extraction requested', { file: request.filePath })\n    const binaryPath = resolveBundledBinary('ffprobe')\n    const args = ['-v', 'error', '-print_format', 'json', '-show_format', '-show_streams', request.filePath]\n\n    const raw = await new Promise<string>((resolve, reject) => {\n      const child = spawn(binaryPath, args, { stdio: 'pipe' })\n      let stdout = ''\n      let stderr = ''\n\n      child.stdout.on('data', (chunk: Buffer) => {\n        stdout += chunk.toString()\n      })\n\n      child.stderr.on('data', (chunk: Buffer) => {\n        stderr += chunk.toString()\n      })\n\n      child.on('error', (error) => {\n        reject(error)\n      })\n\n      child.on('close', (code) => {\n        if (code === 0) {\n          resolve(stdout)\n        } else {\n          reject(new Error(stderr || `ffprobe exited with code ${code ?? 'unknown'}`))\n        }\n      })\n    })\n\n    const parsed = JSON.parse(raw) as {\n      format?: { duration?: string; size?: string; bit_rate?: string; format_name?: string }\n      streams?: Array<{\n        codec_type?: string\n        codec_name?: string\n        width?: number\n        height?: number\n        avg_frame_rate?: string\n        r_frame_rate?: string\n      }>\n    }\n\n    const format = parsed.format ?? {}\n    const streams = parsed.streams ?? []\n    const videoStream = streams.find((stream) => stream.codec_type === 'video')\n\n    const duration = this.parseFloatOrNull(format.duration)\n    const bitrate = this.parseIntOrNull(format.bit_rate)\n    const container = format.format_name ? format.format_name.split(',')[0] : null\n    const fileSize = this.parseIntOrNull(format.size) ?? this.statSize(request.filePath)\n\n    return {\n      duration,\n      width: videoStream?.width ?? null,\n      height: videoStream?.height ?? null,\n      fps: this.parseFps(videoStream?.avg_frame_rate ?? videoStream?.r_frame_rate),\n      codec: videoStream?.codec_name ?? null,\n      container,\n      bitrate,\n      fileSize\n    }\n  }\n\n  private parseFloatOrNull(value?: string): number | null {\n    if (!value) {\n      return null\n    }\n    const parsed = Number.parseFloat(value)\n    return Number.isFinite(parsed) ? parsed : null\n  }\n\n  private parseIntOrNull(value?: string): number | null {\n    if (!value) {\n      return null\n    }\n    const parsed = Number.parseInt(value, 10)\n    return Number.isFinite(parsed) ? parsed : null\n  }\n\n  private parseFps(value?: string): number | null {\n    if (!value) {\n      return null\n    }\n    const [num, den] = value.split('/').map((part) => Number.parseFloat(part))\n    if (!Number.isFinite(num) || !Number.isFinite(den) || den === 0) {\n      return null\n    }\n    return num / den\n  }\n\n  private statSize(filePath: string): number | null {\n    try {\n      return statSync(filePath).size\n    } catch {\n      return null\n    }\n  }\n}\n", "import { spawn } from 'node:child_process'\nimport { accessSync, constants, existsSync, mkdirSync, readFileSync } from 'node:fs'\nimport { basename, dirname, join, parse } from 'node:path'\nimport { Logger } from '../../utils/logger'\nimport { resolveBundledBinary, detectBestWhisperBackend } from '../../utils/binary'\n\nexport type TranscriptionRequest = {\n  audioPath: string\n  modelPath: string\n  outputDir?: string\n  language?: string\n  signal?: AbortSignal\n  onLog?: (chunk: string) => void\n  /**\n   * Enable GPU acceleration (Metal on Apple Silicon)\n   * When false, passes -ng flag to disable GPU\n   * Only effective on Apple Silicon Macs with Metal-compiled whisper binary\n   */\n  useGpu?: boolean\n  /**\n   * For faster-whisper: model size name (tiny, base, small, medium, large-v3)\n   * If not provided, will try to infer from modelPath\n   */\n  modelSize?: string\n}\n\nexport class WhisperService {\n  private readonly logger = new Logger('WhisperService')\n  private cachedBackend: ReturnType<typeof detectBestWhisperBackend> | null = null\n\n  /**\n   * Get the best available whisper backend for this platform\n   */\n  getBackend(): ReturnType<typeof detectBestWhisperBackend> {\n    if (!this.cachedBackend) {\n      this.cachedBackend = detectBestWhisperBackend()\n      this.logger.info('detected whisper backend', {\n        backend: this.cachedBackend.backend,\n        reason: this.cachedBackend.reason\n      })\n    }\n    return this.cachedBackend\n  }\n\n  /**\n   * Check if any whisper backend is available\n   */\n  isAvailable(): boolean {\n    return this.getBackend().backend !== 'none'\n  }\n\n  async transcribe(request: TranscriptionRequest): Promise<{ transcript: string; outputPath: string }> {\n    const backend = this.getBackend()\n\n    this.logger.info('transcription requested', {\n      audio: request.audioPath,\n      backend: backend.backend,\n      useGpu: request.useGpu ?? 'default'\n    })\n\n    if (backend.backend === 'none') {\n      throw new Error(`No whisper backend available. ${backend.reason}`)\n    }\n\n    if (backend.backend === 'faster-whisper') {\n      return this.transcribeWithFasterWhisper(request, backend.command!)\n    }\n\n    return this.transcribeWithWhisperCpp(request)\n  }\n\n  /**\n   * Transcribe using whisper.cpp binary\n   */\n  private async transcribeWithWhisperCpp(\n    request: TranscriptionRequest\n  ): Promise<{ transcript: string; outputPath: string }> {\n    const binaryPath = resolveBundledBinary('whisper')\n    const outputDir = request.outputDir ?? dirname(request.audioPath)\n    const baseName = parse(request.audioPath).name\n    const outputPrefix = join(outputDir, baseName)\n    const outputPath = `${outputPrefix}.txt`\n\n    try {\n      accessSync(binaryPath, constants.X_OK)\n    } catch {\n      throw new Error(`whisper not executable at ${binaryPath}`)\n    }\n\n    mkdirSync(outputDir, { recursive: true })\n\n    await this.runProcess(\n      binaryPath,\n      this.buildWhisperCppArgs(request, outputPrefix),\n      request.signal,\n      request.onLog\n    )\n\n    // Verify output file was created\n    if (!existsSync(outputPath)) {\n      throw new Error(`Transcription completed but output file not found: ${outputPath}`)\n    }\n\n    const transcript = readFileSync(outputPath, 'utf-8')\n    return { transcript, outputPath }\n  }\n\n  /**\n   * Transcribe using faster-whisper (Python-based)\n   */\n  private async transcribeWithFasterWhisper(\n    request: TranscriptionRequest,\n    command: string[]\n  ): Promise<{ transcript: string; outputPath: string }> {\n    // Guard against empty command array\n    if (command.length === 0) {\n      throw new Error('faster-whisper command not configured')\n    }\n\n    const outputDir = request.outputDir ?? dirname(request.audioPath)\n    const baseName = parse(request.audioPath).name\n    const outputPath = join(outputDir, `${baseName}.txt`)\n\n    mkdirSync(outputDir, { recursive: true })\n\n    // Determine model - faster-whisper uses model names or paths\n    const modelArg = this.resolveModelForFasterWhisper(request.modelPath, request.modelSize)\n\n    const [cmd, ...baseArgs] = command\n    const args = [\n      ...baseArgs,\n      request.audioPath,\n      '--model', modelArg,\n      '--output_dir', outputDir,\n      '--output_format', 'txt'\n    ]\n\n    if (request.language) {\n      args.push('--language', request.language)\n    }\n\n    // faster-whisper auto-detects GPU (CUDA/cuDNN), but we can force CPU if needed\n    if (request.useGpu === false) {\n      args.push('--device', 'cpu')\n    }\n\n    await this.runProcess(cmd, args, request.signal, request.onLog)\n\n    // Verify output file was created\n    if (!existsSync(outputPath)) {\n      throw new Error(`Transcription completed but output file not found: ${outputPath}`)\n    }\n\n    const transcript = readFileSync(outputPath, 'utf-8')\n    return { transcript, outputPath }\n  }\n\n  /**\n   * Build arguments for whisper.cpp\n   */\n  private buildWhisperCppArgs(request: TranscriptionRequest, outputPrefix: string): string[] {\n    const args = [\n      '-m', request.modelPath,\n      '-f', request.audioPath,\n      '-otxt', '-ovtt',\n      '-of', outputPrefix\n    ]\n\n    if (request.language) {\n      args.push('-l', request.language)\n    }\n\n    // Disable GPU if explicitly set to false (default is to use GPU if available)\n    if (request.useGpu === false) {\n      args.push('-ng') // --no-gpu flag for whisper.cpp\n    }\n\n    return args\n  }\n\n  /**\n   * Resolve model argument for faster-whisper\n   * Can be a model size name (tiny, base, small, medium, large-v3) or a path\n   */\n  private resolveModelForFasterWhisper(modelPath: string, modelSize?: string): string {\n    // If explicit model size provided, use it\n    if (modelSize) {\n      return modelSize\n    }\n\n    // Try to infer from model path\n    const modelName = basename(modelPath).toLowerCase()\n\n    // Common whisper model naming patterns\n    const sizePatterns = [\n      { pattern: /large-v3/i, size: 'large-v3' },\n      { pattern: /large-v2/i, size: 'large-v2' },\n      { pattern: /large/i, size: 'large' },\n      { pattern: /medium/i, size: 'medium' },\n      { pattern: /small/i, size: 'small' },\n      { pattern: /base/i, size: 'base' },\n      { pattern: /tiny/i, size: 'tiny' }\n    ]\n\n    for (const { pattern, size } of sizePatterns) {\n      if (pattern.test(modelName)) {\n        this.logger.info(`inferred model size '${size}' from path`)\n        return size\n      }\n    }\n\n    // If path exists as a directory, it might be a downloaded model\n    if (existsSync(modelPath)) {\n      return modelPath\n    }\n\n    // Default to base model\n    this.logger.warn('could not infer model size, defaulting to base')\n    return 'base'\n  }\n\n  /**\n   * Run a process with abort signal support\n   */\n  private async runProcess(\n    command: string,\n    args: string[],\n    signal?: AbortSignal,\n    onLog?: (chunk: string) => void\n  ): Promise<void> {\n    return new Promise<void>((resolve, reject) => {\n      if (signal?.aborted) {\n        const error = new Error('canceled')\n        error.name = 'AbortError'\n        reject(error)\n        return\n      }\n\n      const child = spawn(command, args, { stdio: 'pipe' })\n      let stderr = ''\n      let settled = false\n\n      const finalize = (error?: Error): void => {\n        if (settled) return\n        settled = true\n        if (signal) {\n          signal.removeEventListener('abort', onAbort)\n        }\n        if (error) {\n          reject(error)\n        } else {\n          resolve()\n        }\n      }\n\n      const onAbort = (): void => {\n        child.kill()\n        const error = new Error('canceled')\n        error.name = 'AbortError'\n        finalize(error)\n      }\n\n      if (signal) {\n        signal.addEventListener('abort', onAbort, { once: true })\n      }\n\n      // Capture stdout for faster-whisper (it logs to stdout)\n      child.stdout?.on('data', (chunk: Buffer) => {\n        const text = chunk.toString()\n        onLog?.(text)\n      })\n\n      child.stderr.on('data', (chunk: Buffer) => {\n        const text = chunk.toString()\n        onLog?.(text)\n        stderr += text\n        if (stderr.length > 8000) {\n          stderr = stderr.slice(-8000)\n        }\n      })\n\n      child.on('error', (error) => {\n        finalize(error)\n      })\n\n      child.on('close', (code) => {\n        if (code === 0) {\n          finalize()\n        } else {\n          finalize(new Error(stderr || `process exited with code ${code ?? 'unknown'}`))\n        }\n      })\n    })\n  }\n}\n", "// Archival Processing Types for SVT-AV1 Encoding\n// Designed for long-term video archival with optimal compression\n\nexport type ArchivalResolution = '4k' | '1440p' | '1080p' | '720p' | '480p' | '360p' | 'source'\n\nexport type ArchivalColorMode = 'hdr' | 'sdr' | 'auto'\n\n/**\n * HDR10 static metadata for mastering display\n * Chromaticity values are stored as integers where 50000 = 1.0 (e.g., 13250 = 0.265)\n * Luminance values are stored in nits (cd/m\u00B2)\n */\nexport interface HdrMasteringDisplayMetadata {\n  // Display primaries (xy chromaticity coordinates as integers, 50000 = 1.0)\n  // e.g., for BT.2020: G(8500,39850) B(6550,2300) R(35400,14600)\n  greenX: number\n  greenY: number\n  blueX: number\n  blueY: number\n  redX: number\n  redY: number\n  // White point (xy chromaticity coordinates as integers, 50000 = 1.0)\n  whitePointX: number\n  whitePointY: number\n  // Luminance in nits (cd/m\u00B2) - will be multiplied by 10000 for x265/SVT-AV1 format\n  maxLuminance: number // e.g., 1000 for 1000 nits peak brightness\n  minLuminance: number // e.g., 0.0001 for very dark blacks\n}\n\n/**\n * Content light level metadata (MaxCLL, MaxFALL)\n */\nexport interface HdrContentLightLevel {\n  maxCll: number // Maximum Content Light Level in nits\n  maxFall: number // Maximum Frame Average Light Level in nits\n}\n\n/**\n * Video metadata used for determining optimal encoding settings\n */\nexport interface VideoSourceInfo {\n  width: number\n  height: number\n  frameRate: number\n  duration: number // in seconds\n  bitDepth?: number // 8, 10, or 12\n  colorSpace?: string // bt709, bt2020, etc.\n  hdrFormat?: string | null // HDR10, HLG, DolbyVision, etc.\n  isHdr: boolean\n  bitrate?: number // Source bitrate in bits per second\n  videoCodec?: string // Source video codec (h264, hevc, vp9, av1, etc.)\n  audioCodec?: string // Source audio codec (aac, opus, vorbis, flac, pcm_s16le, etc.)\n  container?: string // Source container format (mp4, mkv, webm, mov, avi, etc.)\n  // HDR10 static metadata (for proper HDR preservation)\n  masteringDisplay?: HdrMasteringDisplayMetadata\n  contentLightLevel?: HdrContentLightLevel\n  // Color primaries and transfer characteristics from source\n  colorPrimaries?: string // bt709, bt2020, etc.\n  colorTransfer?: string // smpte2084 (PQ), arib-std-b67 (HLG), bt709, etc.\n  colorMatrix?: string // bt709, bt2020nc, bt2020c, etc.\n}\n\n/**\n * CRF settings based on resolution and HDR status\n * Lower CRF = higher quality = larger files\n */\nexport interface ArchivalCrfMatrix {\n  hdr: {\n    '4k': number\n    '1440p': number\n    '1080p': number\n    '720p': number\n    '480p': number\n    '360p': number\n  }\n  sdr: {\n    '4k': number\n    '1440p': number\n    '1080p': number\n    '720p': number\n    '480p': number\n    '360p': number\n  }\n}\n\n/**\n * Default CRF values for archival encoding\n * These are tuned for SVT-AV1 and optimized for archival quality:\n * - HDR content uses lower CRF (higher quality) to preserve dynamic range\n * - Lower resolutions can use higher CRF while maintaining perceptual quality\n *\n * CRF Scale:\n * - 18-24: Visually lossless (large files)\n * - 25-30: Very high quality (good archival)\n * - 31-35: Good quality (aggressive archival)\n * - 36+: Acceptable quality (very aggressive)\n */\nexport const ARCHIVAL_CRF_DEFAULTS: ArchivalCrfMatrix = {\n  hdr: {\n    '4k': 29,    // Ultra-safe: 28, aggressive: 30 max\n    '1440p': 28, // aggressive: 29 max\n    '1080p': 28, // default 28, aggressive: 29 max\n    '720p': 27,  // aggressive: 28 max\n    '480p': 27,\n    '360p': 27\n  },\n  sdr: {\n    '4k': 30,    // aggressive: 31 max\n    '1440p': 31, // aggressive: 32 max\n    '1080p': 29, // aggressive: 31-32 max\n    '720p': 32,  // default 32, aggressive: 34 max\n    '480p': 34,  // default 34\n    '360p': 36   // default 36, aggressive: 37 max\n  }\n}\n\n/**\n * Maximum CRF values - going beyond these will cause visible quality loss\n */\nexport const ARCHIVAL_CRF_MAX: ArchivalCrfMatrix = {\n  hdr: {\n    '4k': 30,\n    '1440p': 29,\n    '1080p': 29,\n    '720p': 28,\n    '480p': 28,\n    '360p': 28\n  },\n  sdr: {\n    '4k': 32,\n    '1440p': 33,\n    '1080p': 32,\n    '720p': 34,\n    '480p': 36,\n    '360p': 38\n  }\n}\n\n/**\n * Bitrate thresholds for CRF adjustment (in bits per second)\n *\n * If source bitrate is below these thresholds, we raise CRF to avoid\n * over-compressing already-compressed content. This prevents quality loss\n * from re-encoding low-bitrate sources.\n *\n * - Below `low`: Source is very compressed, raise CRF by 3\n * - Below `medium`: Source is moderately compressed, raise CRF by 1\n * - Above `medium`: High bitrate source, use default CRF\n */\nexport const BITRATE_THRESHOLDS: Record<\n  Exclude<ArchivalResolution, 'source'>,\n  { low: number; medium: number }\n> = {\n  '4k': { low: 8_000_000, medium: 15_000_000 }, // 8 Mbps / 15 Mbps\n  '1440p': { low: 4_000_000, medium: 8_000_000 }, // 4 Mbps / 8 Mbps\n  '1080p': { low: 2_500_000, medium: 5_000_000 }, // 2.5 Mbps / 5 Mbps\n  '720p': { low: 1_500_000, medium: 3_000_000 }, // 1.5 Mbps / 3 Mbps\n  '480p': { low: 800_000, medium: 1_500_000 }, // 800 kbps / 1.5 Mbps\n  '360p': { low: 400_000, medium: 800_000 } // 400 kbps / 800 kbps\n}\n\n/**\n * Adjust CRF based on source bitrate to avoid over-compression\n *\n * Low-bitrate sources are already compressed and re-encoding them with\n * aggressive CRF can cause generation loss. This function raises CRF\n * for such sources to preserve quality.\n *\n * @returns Object with adjusted CRF, the adjustment amount, and optional reason\n */\nexport function getBitrateAdjustedCrf(\n  sourceInfo: VideoSourceInfo,\n  baseCrf: number\n): { adjustedCrf: number; adjustment: number; reason?: string } {\n  if (!sourceInfo.bitrate || sourceInfo.bitrate <= 0) {\n    return { adjustedCrf: baseCrf, adjustment: 0 }\n  }\n\n  const resolution = getResolutionCategory(sourceInfo.width, sourceInfo.height)\n  if (resolution === 'source') {\n    return { adjustedCrf: baseCrf, adjustment: 0 }\n  }\n\n  const thresholds = BITRATE_THRESHOLDS[resolution]\n  if (!thresholds) {\n    return { adjustedCrf: baseCrf, adjustment: 0 }\n  }\n\n  const bitrateMbps = (sourceInfo.bitrate / 1_000_000).toFixed(1)\n\n  if (sourceInfo.bitrate < thresholds.low) {\n    // Very low bitrate source - significant CRF increase to avoid artifacts\n    const adjustment = 3\n    return {\n      adjustedCrf: Math.min(baseCrf + adjustment, 45), // Cap at CRF 45\n      adjustment,\n      reason: `Low bitrate source (${bitrateMbps} Mbps) - raising CRF to avoid over-compression`\n    }\n  }\n\n  if (sourceInfo.bitrate < thresholds.medium) {\n    // Moderately compressed source - small CRF increase\n    const adjustment = 1\n    return {\n      adjustedCrf: Math.min(baseCrf + adjustment, 45),\n      adjustment,\n      reason: `Moderate bitrate source (${bitrateMbps} Mbps) - slight CRF adjustment`\n    }\n  }\n\n  // High bitrate source - use default CRF\n  return { adjustedCrf: baseCrf, adjustment: 0 }\n}\n\n/**\n * Video codec type for archival encoding\n * - av1: Best compression, ideal for long-term archival storage\n * - h265: HEVC, better compatibility for web delivery and playback\n */\nexport type ArchivalCodec = 'av1' | 'h265'\n\n/**\n * AV1 encoder type\n * - libaom-av1: Higher quality, slower (default, widely available)\n * - libsvtav1: Faster encoding, slightly lower quality (if available)\n */\nexport type Av1Encoder = 'libaom-av1' | 'libsvtav1'\n\n/**\n * H.265 (HEVC) encoder type\n * - libx265: Software encoder, widely available, good quality\n */\nexport type H265Encoder = 'libx265'\n\n/**\n * AV1 encoding options\n * Supports both libaom-av1 and libsvtav1 encoders\n */\nexport interface Av1Options {\n  // Encoder to use (libaom-av1 is more widely available)\n  encoder: Av1Encoder\n\n  // CPU usage preset\n  // For libaom-av1: 0-8 (lower = slower/better, 4-6 recommended for archival)\n  // For libsvtav1: 0-13 (lower = slower/better, 4-6 recommended for archival)\n  preset: number\n\n  // Keyframe interval (GOP size) - max frames between keyframes\n  // Using scene-change detection to avoid crossing scene cuts\n  keyframeInterval: number\n\n  // Enable scene change detection to prevent GOP crossing scene boundaries\n  sceneChangeDetection: boolean\n\n  // Film grain synthesis level (0-50, 0 = disabled)\n  // Only supported by libsvtav1; ignored for libaom-av1\n  filmGrainSynthesis: number\n\n  // Tune for specific content types\n  // 0 = VQ/PSNR, 1 = SSIM (libaom uses different values)\n  tune: 0 | 1 | 2\n\n  // Enable adaptive quantization for better perceptual quality\n  adaptiveQuantization: boolean\n\n  // CRF value (0-63, lower = higher quality)\n  crf: number\n\n  // Two-pass encoding for better quality/size efficiency\n  // Takes longer but provides more consistent quality across the video\n  twoPass?: boolean\n}\n\n/**\n * H.265 (HEVC) encoding options\n * Optimized for web delivery with broad compatibility\n */\nexport interface H265Options {\n  // Encoder to use (libx265 is the standard software encoder)\n  encoder: H265Encoder\n\n  // Preset speed (ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow)\n  // For archival/web delivery, 'medium' to 'slow' is recommended\n  preset: 'ultrafast' | 'superfast' | 'veryfast' | 'faster' | 'fast' | 'medium' | 'slow' | 'slower' | 'veryslow'\n\n  // Tune for specific content types\n  // - none: Default, good for general content\n  // - film: Optimized for film grain preservation\n  // - animation: Better for animated content\n  // - grain: Preserves film grain\n  tune?: 'film' | 'animation' | 'grain' | 'fastdecode' | 'zerolatency'\n\n  // CRF value (0-51, lower = higher quality)\n  // 18-23 is considered visually lossless, 23-28 is good quality\n  crf: number\n\n  // Keyframe interval (GOP size) - max frames between keyframes\n  keyframeInterval: number\n\n  // Enable B-frames for better compression (default: enabled)\n  bframes: number\n\n  // Two-pass encoding for better quality/size efficiency\n  // Takes longer but provides more consistent quality across the video\n  twoPass?: boolean\n}\n\n/**\n * Complete archival encoding configuration\n */\nexport interface ArchivalEncodingConfig {\n  // Video settings\n  resolution: ArchivalResolution\n  colorMode: ArchivalColorMode\n\n  // Codec selection - AV1 for maximum compression, H.265 for web compatibility\n  codec: ArchivalCodec\n\n  // AV1 encoder settings (supports libaom-av1 and libsvtav1)\n  av1: Av1Options\n\n  // H.265 encoder settings (for web delivery)\n  h265: H265Options\n\n  // Audio settings - copy by default to preserve quality\n  audioCopy: boolean\n  audioCodec?: 'opus' | 'flac' | 'aac' // fallback if copy fails\n  audioBitrate?: number // for lossy codecs\n\n  // Container - MKV recommended for AV1 + various audio\n  container: 'mkv' | 'mp4' | 'webm'\n\n  // Output settings\n  outputDir: string\n  preserveStructure: boolean // Keep subfolder structure from input\n\n  // Processing\n  overwriteExisting: boolean\n  fillMode: boolean // Skip files that would conflict with existing output names\n  deleteOriginal: boolean // Dangerous - disabled by default\n  deleteOutputIfLarger: boolean // Delete output and keep original if output is larger\n\n  // Thumbnail extraction\n  extractThumbnail: boolean // Extract a thumbnail from the encoded video\n  thumbnailTimestamp?: number // Timestamp in seconds to extract thumbnail (default: 10% into video)\n\n  // Caption extraction\n  extractCaptions: boolean // Extract captions/subtitles using Whisper\n  captionLanguage?: string // Language code for transcription (e.g., 'en', 'es', 'auto')\n\n  // Resource management\n  threadLimit: 0 | 4 | 6 // Limit encoder threads (0 = no limit)\n}\n\n/**\n * Encoding presets for common use cases\n */\nexport type ArchivalPreset = 'archive' | 'max-compression' | 'fast'\n\n/**\n * Default archival configuration\n *\n * These defaults are optimized for long-term video archival:\n * - SVT-AV1 (libsvtav1): Fast encoding with excellent quality\n * - Preset 6: Balanced quality/speed (recommended for archival)\n * - 240-frame GOP with scene detection: Good compression without crossing scene cuts\n * - enable-tf (temporal filtering): Reduces bitrate for noisy/low-light footage\n * - Film grain synthesis: Preserves grain appearance while improving compression\n * - Audio copy: Preserves original audio losslessly\n * - MKV container: Best compatibility with AV1 and various audio codecs\n */\nexport const DEFAULT_ARCHIVAL_CONFIG: Omit<ArchivalEncodingConfig, 'outputDir'> = {\n  resolution: 'source',\n  colorMode: 'auto',\n\n  codec: 'av1', // Default to AV1 for best compression\n\n  av1: {\n    encoder: 'libsvtav1', // Faster than libaom with excellent quality\n    preset: 6, // SVT-AV1: 0-13, lower=slower/better. 6 is balanced\n    keyframeInterval: 240, // ~8-10 seconds at 24-30fps\n    sceneChangeDetection: true, // CRITICAL: prevents GOP crossing scene cuts\n    filmGrainSynthesis: 10, // Helps with noisy footage, disable for screen recordings\n    tune: 0, // VQ (visual quality) - best for archival viewing\n    adaptiveQuantization: true, // Better detail in complex areas\n    crf: 30, // Will be auto-adjusted based on resolution/HDR\n    twoPass: false // Single-pass by default for faster encoding\n  },\n\n  h265: {\n    encoder: 'libx265',\n    preset: 'medium', // Balanced speed/quality for web delivery\n    crf: 23, // Visually transparent for most content\n    keyframeInterval: 250, // ~10 seconds, good for streaming\n    bframes: 4, // Standard B-frame count for good compression\n    twoPass: false // Single-pass by default for faster encoding\n  },\n\n  audioCopy: true, // Preserve original audio losslessly\n  audioCodec: 'aac', // AAC is best for H.265/MP4 web delivery\n  audioBitrate: 160, // 160kbps for music, 128k for speech\n\n  container: 'mkv', // Best for AV1 + various audio formats\n  preserveStructure: false,\n  overwriteExisting: false,\n  fillMode: false,\n  deleteOriginal: false, // Safety: never auto-delete originals\n  deleteOutputIfLarger: true, // Smart: delete output if it's larger than original\n  extractThumbnail: false, // Disabled by default\n  extractCaptions: false, // Disabled by default - uses Whisper for transcription\n  threadLimit: 0 // Use all available threads by default\n}\n\n/**\n * Preset configurations\n */\nexport const ARCHIVAL_PRESETS: Record<ArchivalPreset, Partial<Omit<ArchivalEncodingConfig, 'outputDir'>>> = {\n  // Recommended: Good balance of quality and speed\n  archive: {\n    av1: {\n      ...DEFAULT_ARCHIVAL_CONFIG.av1,\n      preset: 6,\n      filmGrainSynthesis: 10,\n      twoPass: false\n    },\n    h265: {\n      ...DEFAULT_ARCHIVAL_CONFIG.h265,\n      preset: 'medium',\n      crf: 23,\n      twoPass: false\n    }\n  },\n\n  // Maximum compression: Slower but smaller files (~3-5% smaller)\n  'max-compression': {\n    av1: {\n      ...DEFAULT_ARCHIVAL_CONFIG.av1,\n      preset: 4, // Slower, better compression\n      filmGrainSynthesis: 12, // More aggressive grain synthesis\n      twoPass: false\n    },\n    h265: {\n      ...DEFAULT_ARCHIVAL_CONFIG.h265,\n      preset: 'slow', // Slower for better compression\n      crf: 24, // Slightly higher CRF for smaller files\n      twoPass: false\n    }\n  },\n\n  // Fast: Faster encoding, slightly larger files\n  fast: {\n    av1: {\n      ...DEFAULT_ARCHIVAL_CONFIG.av1,\n      preset: 8, // Faster\n      filmGrainSynthesis: 8,\n      twoPass: false\n    },\n    h265: {\n      ...DEFAULT_ARCHIVAL_CONFIG.h265,\n      preset: 'fast', // Faster encoding\n      crf: 22, // Lower CRF to compensate for speed\n      twoPass: false\n    }\n  }\n}\n\n/**\n * Job status for batch archival processing\n */\nexport type ArchivalJobStatus =\n  | 'queued'\n  | 'analyzing'\n  | 'encoding'\n  | 'completed'\n  | 'failed'\n  | 'cancelled'\n  | 'skipped'\n\n/**\n * Individual file in the archival batch\n */\nexport interface ArchivalBatchItem {\n  id: string\n  inputPath: string\n  outputPath: string\n  status: ArchivalJobStatus\n  progress: number // 0-100\n  sourceInfo?: VideoSourceInfo\n  effectiveCrf?: number\n  error?: string\n  errorType?: ArchivalErrorType\n  startedAt?: string\n  completedAt?: string\n  inputSize?: number\n  outputSize?: number\n  compressionRatio?: number\n  // ETA tracking\n  encodingSpeed?: number // fps or x realtime\n  etaSeconds?: number // estimated seconds remaining for this item\n  elapsedSeconds?: number // elapsed encoding time\n  // Thumbnail\n  thumbnailPath?: string // Path to extracted thumbnail\n  // Captions\n  captionPath?: string // Path to extracted captions (.vtt file)\n  // Deletion tracking\n  originalDeleted?: boolean // True if the original file was deleted after successful encoding\n  outputDeleted?: boolean // True if output was deleted (e.g., larger than original)\n}\n\n/**\n * Error types for better error handling and user feedback\n */\nexport type ArchivalErrorType =\n  | 'disk_full'\n  | 'permission_denied'\n  | 'file_not_found'\n  | 'codec_unsupported'\n  | 'corrupt_input'\n  | 'encoder_error'\n  | 'cancelled'\n  | 'output_larger'\n  | 'unknown'\n\n/**\n * Batch archival job\n */\nexport interface ArchivalBatchJob {\n  id: string\n  items: ArchivalBatchItem[]\n  config: ArchivalEncodingConfig\n  status: 'pending' | 'running' | 'completed' | 'cancelled'\n  totalItems: number\n  completedItems: number\n  failedItems: number\n  skippedItems: number\n  createdAt: string\n  startedAt?: string\n  completedAt?: string\n  // Batch-level ETA tracking\n  totalDurationSeconds?: number // total duration of all videos in batch\n  processedDurationSeconds?: number // total processed duration so far\n  batchEtaSeconds?: number // estimated seconds remaining for entire batch\n  averageSpeed?: number // average encoding speed (x realtime)\n  // Disk space tracking\n  estimatedTotalOutputBytes?: number\n  actualOutputBytes?: number\n}\n\n/**\n * Queue state for pause/resume functionality\n */\nexport type ArchivalQueueState = 'running' | 'paused' | 'pending' | 'completed' | 'cancelled'\n\n/**\n * Persisted state for crash recovery\n * Saved to disk to allow resuming after app restart or crash\n */\nexport interface PersistedArchivalState {\n  /** Schema version for future migrations */\n  version: 1\n  /** When this state was saved */\n  savedAt: string\n  /** The batch job state */\n  job: ArchivalBatchJob\n  /** ID of the item that was being encoded when paused/crashed (if any) */\n  currentItemId: string | null\n  /** Two-pass encoding state (if applicable) */\n  twoPassState?: {\n    passNumber: 1 | 2\n    passLogDir: string\n  }\n}\n\n/**\n * Progress event kinds including pause/resume\n */\nexport type ArchivalProgressKind =\n  | 'item_start'\n  | 'item_progress'\n  | 'item_complete'\n  | 'item_error'\n  | 'batch_complete'\n  | 'queue_paused'\n  | 'queue_resumed'\n\n/**\n * Progress event for archival batch processing\n */\nexport interface ArchivalProgressEvent {\n  batchId: string\n  itemId: string\n  kind: ArchivalProgressKind\n  progress?: number\n  status?: ArchivalJobStatus\n  error?: string\n  errorType?: ArchivalErrorType\n  sourceInfo?: VideoSourceInfo\n  effectiveCrf?: number\n  outputSize?: number\n  compressionRatio?: number\n  // ETA fields\n  encodingSpeed?: number // current encoding speed (fps or x realtime)\n  itemEtaSeconds?: number // estimated seconds remaining for current item\n  batchEtaSeconds?: number // estimated seconds remaining for entire batch\n  elapsedSeconds?: number // elapsed encoding time for current item\n  // Batch progress\n  batchProgress?: number // 0-100 overall batch progress\n  processedItems?: number // number of items processed so far\n  totalItems?: number // total items in batch\n  // Thumbnail\n  thumbnailPath?: string // Path to extracted thumbnail\n  // Captions\n  captionPath?: string // Path to extracted captions (.vtt file)\n  // Queue state for pause/resume events\n  queueState?: ArchivalQueueState\n}\n\n/**\n * Determine resolution category from video dimensions\n */\nexport function getResolutionCategory(width: number, height: number): ArchivalResolution {\n  const pixels = Math.max(width, height)\n\n  if (pixels >= 3840) return '4k'\n  if (pixels >= 2560) return '1440p'\n  if (pixels >= 1920) return '1080p'\n  if (pixels >= 1280) return '720p'\n  if (pixels >= 854) return '480p'\n  return '360p'\n}\n\n/**\n * Get optimal CRF for given video parameters\n */\nexport function getOptimalCrf(\n  sourceInfo: VideoSourceInfo,\n  customMatrix?: Partial<ArchivalCrfMatrix>,\n  enableBitrateAdjustment: boolean = true\n): number {\n  const matrix = { ...ARCHIVAL_CRF_DEFAULTS, ...customMatrix }\n  const resolution = getResolutionCategory(sourceInfo.width, sourceInfo.height)\n\n  // Handle 'source' resolution by defaulting to 1080p CRF\n  const lookupResolution = resolution === 'source' ? '1080p' : resolution\n\n  let baseCrf: number\n  if (sourceInfo.isHdr) {\n    baseCrf = matrix.hdr[lookupResolution] ?? matrix.hdr['1080p']\n  } else {\n    baseCrf = matrix.sdr[lookupResolution] ?? matrix.sdr['1080p']\n  }\n\n  // Apply bitrate-aware adjustment if enabled and bitrate is available\n  if (enableBitrateAdjustment && sourceInfo.bitrate) {\n    const { adjustedCrf } = getBitrateAdjustedCrf(sourceInfo, baseCrf)\n    return adjustedCrf\n  }\n\n  return baseCrf\n}\n\n/**\n * Detect if video is HDR based on metadata\n */\nexport function detectHdr(colorSpace?: string, hdrFormat?: string | null, bitDepth?: number): boolean {\n  // Check explicit HDR format\n  if (hdrFormat) {\n    const hdrFormats = ['hdr10', 'hdr10+', 'hlg', 'dolby vision', 'dv', 'pq']\n    if (hdrFormats.some(fmt => hdrFormat.toLowerCase().includes(fmt))) {\n      return true\n    }\n  }\n\n  // Check color space\n  if (colorSpace) {\n    const hdrColorSpaces = ['bt2020', 'rec2020', 'smpte2084', 'arib-std-b67']\n    if (hdrColorSpaces.some(cs => colorSpace.toLowerCase().includes(cs))) {\n      return true\n    }\n  }\n\n  // 10-bit or higher often indicates HDR (but not always)\n  // Only use as hint when combined with other factors\n  if (bitDepth && bitDepth >= 10 && colorSpace?.toLowerCase().includes('2020')) {\n    return true\n  }\n\n  return false\n}\n\n/**\n * Check if a video is already efficiently encoded and might not benefit from re-encoding\n * Returns a reason string if skipping is recommended, null otherwise\n */\nexport function shouldSkipEncoding(\n  sourceInfo: VideoSourceInfo,\n  codec: string,\n  bitrate: number\n): string | null {\n  const resolution = getResolutionCategory(sourceInfo.width, sourceInfo.height)\n  const isHevc = codec.toLowerCase().includes('hevc') || codec.toLowerCase().includes('h265')\n  const isAv1 = codec.toLowerCase().includes('av1')\n\n  // Already AV1 encoded - skip unless very high bitrate\n  if (isAv1) {\n    return 'Already encoded with AV1. Re-encoding is unlikely to provide significant savings.'\n  }\n\n  // Check bitrate thresholds for HEVC (already efficient codec)\n  if (isHevc) {\n    const bitrateKbps = bitrate / 1000\n    const thresholds: Record<string, number> = {\n      '4k': 15000,   // 15 Mbps\n      '1440p': 8000, // 8 Mbps\n      '1080p': 4000, // 4 Mbps\n      '720p': 2000,  // 2 Mbps\n      '480p': 1000,  // 1 Mbps\n      '360p': 500    // 0.5 Mbps\n    }\n\n    const threshold = thresholds[resolution]\n    if (threshold && bitrateKbps <= threshold) {\n      return `Already efficient HEVC at ${(bitrateKbps / 1000).toFixed(1)} Mbps. Re-encoding may not provide significant savings.`\n    }\n  }\n\n  // Very low resolution and already small\n  if (resolution === '360p' && bitrate < 500000) { // < 500 kbps\n    return 'Very low resolution with low bitrate. Re-encoding may not improve quality or size.'\n  }\n\n  return null\n}\n\n/**\n * Check if source has Dolby Vision which cannot be preserved in AV1\n */\nexport function hasDolbyVision(hdrFormat?: string | null): boolean {\n  if (!hdrFormat) return false\n  const lower = hdrFormat.toLowerCase()\n  return lower.includes('dolby') || lower.includes('dv')\n}\n\n/**\n * Classify error from FFmpeg stderr or error message\n */\nexport function classifyError(errorMessage: string): ArchivalErrorType {\n  const lower = errorMessage.toLowerCase()\n\n  // Disk space errors\n  if (\n    lower.includes('no space left') ||\n    lower.includes('disk full') ||\n    lower.includes('not enough space') ||\n    lower.includes('enospc')\n  ) {\n    return 'disk_full'\n  }\n\n  // Permission errors\n  if (\n    lower.includes('permission denied') ||\n    lower.includes('access denied') ||\n    lower.includes('eacces') ||\n    lower.includes('eperm')\n  ) {\n    return 'permission_denied'\n  }\n\n  // File not found\n  if (\n    lower.includes('no such file') ||\n    lower.includes('file not found') ||\n    lower.includes('enoent') ||\n    lower.includes('does not exist')\n  ) {\n    return 'file_not_found'\n  }\n\n  // Codec/format errors\n  if (\n    lower.includes('decoder') ||\n    lower.includes('codec not found') ||\n    lower.includes('unsupported codec') ||\n    lower.includes('unknown encoder')\n  ) {\n    return 'codec_unsupported'\n  }\n\n  // Corrupt input\n  if (\n    lower.includes('invalid data') ||\n    lower.includes('corrupt') ||\n    lower.includes('moov atom not found') ||\n    lower.includes('invalid nal unit')\n  ) {\n    return 'corrupt_input'\n  }\n\n  // Encoder errors\n  if (\n    lower.includes('encoder') ||\n    lower.includes('encoding') ||\n    lower.includes('svtav1') ||\n    lower.includes('libaom')\n  ) {\n    return 'encoder_error'\n  }\n\n  // Cancelled\n  if (lower.includes('cancel') || lower.includes('abort') || lower.includes('killed')) {\n    return 'cancelled'\n  }\n\n  return 'unknown'\n}\n\n/**\n * Get user-friendly error message for error type\n */\nexport function getErrorMessage(errorType: ArchivalErrorType, details?: string): string {\n  const messages: Record<ArchivalErrorType, string> = {\n    disk_full: 'Not enough disk space to complete encoding. Free up space and try again.',\n    permission_denied: 'Cannot write to output location. Check folder permissions.',\n    file_not_found: 'Input file not found. It may have been moved or deleted.',\n    codec_unsupported: 'Video format not supported. The input file may use an unsupported codec.',\n    corrupt_input: 'Input file appears to be corrupted or incomplete.',\n    encoder_error: 'Encoder error occurred. Try a different encoder preset.',\n    cancelled: 'Encoding was cancelled.',\n    output_larger: 'Output file is larger than original. Source may already be well-optimized.',\n    unknown: 'An unexpected error occurred.'\n  }\n\n  const base = messages[errorType]\n  return details ? `${base} (${details})` : base\n}\n\n/**\n * Format seconds to human-readable duration (e.g., \"2h 15m\" or \"45s\")\n */\nexport function formatEta(seconds: number): string {\n  if (!isFinite(seconds) || seconds < 0) return '--'\n  if (seconds < 60) return `${Math.round(seconds)}s`\n  if (seconds < 3600) {\n    const mins = Math.floor(seconds / 60)\n    const secs = Math.round(seconds % 60)\n    return secs > 0 ? `${mins}m ${secs}s` : `${mins}m`\n  }\n  const hours = Math.floor(seconds / 3600)\n  const mins = Math.round((seconds % 3600) / 60)\n  return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`\n}\n\n/**\n * Format encoding speed (e.g., \"0.5x realtime\" or \"2.3x realtime\")\n */\nexport function formatSpeed(speed: number): string {\n  if (!isFinite(speed) || speed <= 0) return '--'\n  return `${speed.toFixed(1)}x`\n}\n\n/**\n * Encoding speed multipliers for different codecs and presets\n * These are approximate values based on typical encoding performance\n * Speed is relative to realtime (1.0x = encodes as fast as playback)\n *\n * Factors affecting speed:\n * - Codec: H.265 is generally faster than AV1\n * - Preset: Faster presets = higher speed multiplier\n * - Resolution: Higher resolution = slower encoding (normalized in estimateEncodingTime)\n * - Two-pass: Approximately doubles encoding time\n */\nconst ENCODING_SPEED_MULTIPLIERS = {\n  // AV1 SVT speed multipliers by preset (0-12)\n  // Based on typical 1080p encoding speeds\n  av1_svt: {\n    0: 0.05,  // Very slow\n    1: 0.08,\n    2: 0.12,\n    3: 0.18,\n    4: 0.25,\n    5: 0.35,\n    6: 0.5,   // Default balanced\n    7: 0.7,\n    8: 1.0,\n    9: 1.4,\n    10: 2.0,\n    11: 2.8,\n    12: 4.0   // Very fast\n  } as Record<number, number>,\n\n  // AV1 libaom speed multipliers by preset (0-8)\n  av1_libaom: {\n    0: 0.02,  // Extremely slow\n    1: 0.04,\n    2: 0.07,\n    3: 0.12,\n    4: 0.2,\n    5: 0.3,\n    6: 0.45,\n    7: 0.65,\n    8: 0.9\n  } as Record<number, number>,\n\n  // H.265 libx265 speed multipliers by preset\n  h265: {\n    'ultrafast': 5.0,\n    'superfast': 3.5,\n    'veryfast': 2.5,\n    'faster': 1.8,\n    'fast': 1.3,\n    'medium': 0.9,\n    'slow': 0.5,\n    'slower': 0.3,\n    'veryslow': 0.15\n  } as Record<string, number>\n}\n\n/**\n * Resolution scaling factors for encoding speed\n * Higher resolutions take proportionally longer to encode\n */\nconst RESOLUTION_SPEED_FACTORS: Record<ArchivalResolution, number> = {\n  '360p': 4.0,    // Much faster\n  '480p': 2.5,\n  '720p': 1.5,\n  '1080p': 1.0,   // Reference baseline\n  '1440p': 0.6,\n  '4k': 0.35,     // Much slower\n  'source': 1.0   // Assume 1080p for source\n}\n\n/**\n * Estimate encoding time in seconds\n * Returns an estimate with min/max range\n *\n * @param durationSeconds - Total video duration in seconds\n * @param codec - 'av1' or 'h265'\n * @param preset - Encoder preset (number for AV1, string for H.265)\n * @param encoder - 'libsvtav1', 'libaom-av1', or 'libx265'\n * @param resolution - Target resolution\n * @param twoPass - Whether two-pass encoding is enabled\n * @returns Object with estimated, min, and max encoding times in seconds\n */\nexport function estimateEncodingTime(\n  durationSeconds: number,\n  codec: ArchivalCodec,\n  preset: number | string,\n  encoder: Av1Encoder | H265Encoder,\n  resolution: ArchivalResolution = '1080p',\n  twoPass: boolean = false\n): { estimatedSeconds: number; minSeconds: number; maxSeconds: number } {\n  // Get base speed multiplier based on codec and preset\n  let speedMultiplier: number\n\n  if (codec === 'h265') {\n    const presetStr = preset as string\n    speedMultiplier = ENCODING_SPEED_MULTIPLIERS.h265[presetStr] ?? 0.9\n  } else {\n    // AV1\n    const presetNum = preset as number\n    if (encoder === 'libsvtav1') {\n      speedMultiplier = ENCODING_SPEED_MULTIPLIERS.av1_svt[presetNum] ?? 0.5\n    } else {\n      speedMultiplier = ENCODING_SPEED_MULTIPLIERS.av1_libaom[presetNum] ?? 0.2\n    }\n  }\n\n  // Apply resolution factor\n  const resolutionFactor = RESOLUTION_SPEED_FACTORS[resolution] ?? 1.0\n  const adjustedSpeed = speedMultiplier * resolutionFactor\n\n  // Calculate base encoding time\n  // If speed is 0.5x realtime, encoding 60s video takes 120s\n  let encodingTime = durationSeconds / adjustedSpeed\n\n  // Double time for two-pass encoding\n  if (twoPass) {\n    encodingTime *= 2\n  }\n\n  // Add 10% variance for min/max estimates\n  return {\n    estimatedSeconds: Math.round(encodingTime),\n    minSeconds: Math.round(encodingTime * 0.7),\n    maxSeconds: Math.round(encodingTime * 1.5)\n  }\n}\n\n/**\n * Format estimated encoding time as human-readable string\n * Returns format like \"~2h 30m\" or \"~45m\"\n */\nexport function formatEstimatedTime(seconds: number): string {\n  if (!isFinite(seconds) || seconds <= 0) return '--'\n  if (seconds < 60) return `~${Math.round(seconds)}s`\n  if (seconds < 3600) {\n    const mins = Math.round(seconds / 60)\n    return `~${mins}m`\n  }\n  const hours = Math.floor(seconds / 3600)\n  const mins = Math.round((seconds % 3600) / 60)\n  return mins > 0 ? `~${hours}h ${mins}m` : `~${hours}h`\n}\n", "import type {\n  ArchivalEncodingConfig,\n  VideoSourceInfo,\n  Av1Options,\n  H265Options,\n  HdrMasteringDisplayMetadata,\n  HdrContentLightLevel\n} from '../../../shared/types/archival.types'\nimport { getOptimalCrf, getResolutionCategory } from '../../../shared/types/archival.types'\nimport type { CPUSIMDCapabilities } from '../hw-accel-detector'\n\n/**\n * Determine the appropriate H.265 level based on resolution\n * Uses actual pixel count (luma samples) rather than just width/height\n *\n * Level limits (MaxLumaSamples):\n * - Level 4.0: 2,228,224 (~2048x1088)\n * - Level 4.1: 2,228,224 (~2048x1088) - higher bitrate than 4.0\n * - Level 5.0: 8,912,896 (~4096x2176)\n * - Level 5.1: 8,912,896 (~4096x2176) - higher bitrate than 5.0\n *\n * @returns level-idc value (40, 41, 50, or 51)\n */\nfunction getH265Level(width: number, height: number): number {\n  const lumaSamples = width * height\n\n  // Level 4.1 max: 2,228,224 samples\n  // Level 5.0/5.1 max: 8,912,896 samples\n  if (lumaSamples > 8_912_896) {\n    // Beyond 5.1 - use highest available\n    return 62 // Level 6.2 for 8K\n  } else if (lumaSamples > 2_228_224) {\n    // Exceeds Level 4.1, need Level 5.x\n    // Use 5.1 for higher bitrate headroom\n    return 51\n  } else if (lumaSamples > 983_040) {\n    // Exceeds 720p (1280x720), use Level 4.1\n    return 41\n  }\n  // Default for smaller resolutions\n  return 40\n}\n\n/**\n * Two-pass encoding arguments\n * Contains separate argument arrays for each pass\n */\nexport interface TwoPassArgs {\n  pass1: string[]\n  pass2: string[]\n  passLogFile: string\n}\n\n/**\n * Builds FFmpeg command arguments for archival encoding\n *\n * Supports two codecs:\n * - AV1 (libaom-av1, libsvtav1): Best compression for archival\n * - H.265/HEVC (libx265): Better compatibility for web delivery\n *\n * Key features:\n * - Scene-change aware keyframe placement (prevents GOP crossing scene cuts)\n * - Film grain synthesis (SVT-AV1 only)\n * - HDR passthrough with proper color metadata and HDR10 static metadata preservation\n * - Audio stream copy by default\n * - Two-pass encoding for better quality/size efficiency (optional)\n * - AVX-512 optimizations when available (for x265)\n *\n * @param inputPath - Path to input video file\n * @param outputPath - Path to output video file\n * @param config - Archival encoding configuration\n * @param sourceInfo - Source video metadata including HDR info\n * @param cpuCapabilities - Optional CPU SIMD capabilities for optimization\n */\nexport function buildArchivalFFmpegArgs(\n  inputPath: string,\n  outputPath: string,\n  config: ArchivalEncodingConfig,\n  sourceInfo: VideoSourceInfo,\n  cpuCapabilities?: CPUSIMDCapabilities | null\n): string[] {\n  // Dispatch to codec-specific builder\n  if (config.codec === 'h265') {\n    return buildH265FFmpegArgs(inputPath, outputPath, config, sourceInfo, cpuCapabilities)\n  }\n  return buildAv1FFmpegArgs(inputPath, outputPath, config, sourceInfo)\n}\n\n/**\n * Check if two-pass encoding is enabled for the current config\n */\nexport function isTwoPassEnabled(config: ArchivalEncodingConfig): boolean {\n  if (config.codec === 'h265') {\n    return config.h265.twoPass === true\n  }\n  // For SVT-AV1, two-pass through FFmpeg isn't well supported\n  // Only enable for libaom-av1\n  if (config.av1.encoder === 'libaom-av1') {\n    return config.av1.twoPass === true\n  }\n  return false\n}\n\n/**\n * Builds FFmpeg arguments for two-pass encoding\n * Returns separate argument arrays for pass 1 and pass 2\n *\n * @param inputPath - Path to input video file\n * @param outputPath - Path to output video file\n * @param config - Archival encoding configuration\n * @param sourceInfo - Source video metadata\n * @param passLogDir - Directory to store pass log files\n * @param cpuCapabilities - Optional CPU SIMD capabilities for optimization\n * @returns TwoPassArgs with pass1, pass2, and passLogFile paths\n */\nexport function buildTwoPassArgs(\n  inputPath: string,\n  outputPath: string,\n  config: ArchivalEncodingConfig,\n  sourceInfo: VideoSourceInfo,\n  passLogDir: string,\n  cpuCapabilities?: CPUSIMDCapabilities | null\n): TwoPassArgs {\n  const { basename, join } = require('node:path')\n  const inputName = basename(inputPath, require('node:path').extname(inputPath))\n  const passLogFile = join(passLogDir, `${inputName}-pass`)\n\n  if (config.codec === 'h265') {\n    return buildH265TwoPassArgs(inputPath, outputPath, config, sourceInfo, passLogFile, cpuCapabilities)\n  }\n  return buildAv1TwoPassArgs(inputPath, outputPath, config, sourceInfo, passLogFile)\n}\n\n/**\n * Build two-pass arguments for AV1 (libaom-av1 only)\n */\nfunction buildAv1TwoPassArgs(\n  inputPath: string,\n  outputPath: string,\n  config: ArchivalEncodingConfig,\n  sourceInfo: VideoSourceInfo,\n  passLogFile: string\n): TwoPassArgs {\n  const options = config.av1\n  const encoder = options.encoder\n\n  // Determine effective CRF\n  const effectiveCrf = options.crf !== 30 ? options.crf : getOptimalCrf(sourceInfo)\n\n  // ===== PASS 1 =====\n  const pass1: string[] = []\n  pass1.push('-i', inputPath)\n\n  // Apply configured thread limit\n  if (config.threadLimit > 0) {\n    pass1.push('-threads', String(config.threadLimit))\n  }\n\n  pass1.push('-c:v', encoder)\n  pass1.push('-crf', effectiveCrf.toString())\n\n  if (encoder === 'libaom-av1') {\n    pass1.push('-cpu-used', options.preset.toString())\n    pass1.push(...buildLibaomParams(options, sourceInfo))\n    pass1.push('-pass', '1')\n    pass1.push('-passlogfile', passLogFile)\n  }\n\n  // HDR handling\n  if (sourceInfo.isHdr) {\n    pass1.push(...buildHdrArgs(sourceInfo))\n  } else {\n    pass1.push('-pix_fmt', 'yuv420p')\n  }\n\n  // No audio for pass 1\n  pass1.push('-an')\n\n  // Null output for pass 1\n  pass1.push('-f', 'null')\n  pass1.push('-y')\n  pass1.push(process.platform === 'win32' ? 'NUL' : '/dev/null')\n\n  // ===== PASS 2 =====\n  const pass2: string[] = []\n  pass2.push('-i', inputPath)\n\n  // Apply configured thread limit\n  if (config.threadLimit > 0) {\n    pass2.push('-threads', String(config.threadLimit))\n  }\n\n  pass2.push('-c:v', encoder)\n  pass2.push('-crf', effectiveCrf.toString())\n\n  if (encoder === 'libaom-av1') {\n    pass2.push('-cpu-used', options.preset.toString())\n    pass2.push(...buildLibaomParams(options, sourceInfo))\n    pass2.push('-pass', '2')\n    pass2.push('-passlogfile', passLogFile)\n  }\n\n  // HDR handling\n  if (sourceInfo.isHdr) {\n    pass2.push(...buildHdrArgs(sourceInfo))\n  } else {\n    pass2.push('-pix_fmt', 'yuv420p')\n  }\n\n  // Audio handling (same as single-pass)\n  const needsWebmAudioReencode = config.container === 'webm' &&\n    config.audioCopy &&\n    !isWebmCompatibleAudio(sourceInfo.audioCodec)\n\n  const needsMp4AudioReencode = config.container === 'mp4' &&\n    config.audioCopy &&\n    isPcmAudio(sourceInfo.audioCodec)\n\n  if (needsWebmAudioReencode) {\n    pass2.push('-c:a', 'libopus')\n    pass2.push('-b:a', `${config.audioBitrate ?? 128}k`)\n    pass2.push('-ar', '48000')\n  } else if (needsMp4AudioReencode) {\n    // PCM audio must be transcoded for MP4 container\n    pass2.push('-c:a', 'aac')\n    pass2.push('-b:a', `${config.audioBitrate ?? 192}k`)\n  } else if (config.audioCopy) {\n    pass2.push('-c:a', 'copy')\n  } else {\n    pass2.push(...buildAudioArgs(config))\n  }\n\n  // Map streams\n  pass2.push('-map', '0:v:0')\n  pass2.push('-map', '0:a?')\n\n  // Container options\n  if (config.container === 'mp4') {\n    pass2.push('-movflags', '+faststart')\n  }\n\n  pass2.push('-y')\n  pass2.push(outputPath)\n\n  return { pass1, pass2, passLogFile }\n}\n\n/**\n * Build two-pass arguments for H.265\n */\nfunction buildH265TwoPassArgs(\n  inputPath: string,\n  outputPath: string,\n  config: ArchivalEncodingConfig,\n  sourceInfo: VideoSourceInfo,\n  passLogFile: string,\n  cpuCapabilities?: CPUSIMDCapabilities | null\n): TwoPassArgs {\n  const options = config.h265\n\n  // ===== PASS 1 =====\n  const pass1: string[] = []\n  pass1.push('-i', inputPath)\n\n  // Apply configured thread limit\n  if (config.threadLimit > 0) {\n    pass1.push('-threads', String(config.threadLimit))\n  }\n\n  pass1.push('-c:v', options.encoder)\n  pass1.push('-crf', options.crf.toString())\n  pass1.push('-preset', options.preset)\n\n  // Build x265-params with pass=1\n  const x265ParamsPass1 = buildX265ParamsWithPass(options, sourceInfo, 1, passLogFile, cpuCapabilities)\n  if (x265ParamsPass1) {\n    pass1.push('-x265-params', x265ParamsPass1)\n  }\n\n  if (options.tune) {\n    pass1.push('-tune', options.tune)\n  }\n\n  // HDR handling\n  if (sourceInfo.isHdr) {\n    pass1.push(...buildHdrArgsH265(sourceInfo))\n  } else {\n    pass1.push('-pix_fmt', 'yuv420p')\n  }\n\n  // No audio for pass 1\n  pass1.push('-an')\n\n  // Null output for pass 1\n  pass1.push('-f', 'null')\n  pass1.push('-y')\n  pass1.push(process.platform === 'win32' ? 'NUL' : '/dev/null')\n\n  // ===== PASS 2 =====\n  const pass2: string[] = []\n  pass2.push('-i', inputPath)\n\n  // Apply configured thread limit\n  if (config.threadLimit > 0) {\n    pass2.push('-threads', String(config.threadLimit))\n  }\n\n  pass2.push('-c:v', options.encoder)\n  pass2.push('-crf', options.crf.toString())\n  pass2.push('-preset', options.preset)\n\n  // Build x265-params with pass=2\n  const x265ParamsPass2 = buildX265ParamsWithPass(options, sourceInfo, 2, passLogFile, cpuCapabilities)\n  if (x265ParamsPass2) {\n    pass2.push('-x265-params', x265ParamsPass2)\n  }\n\n  if (options.tune) {\n    pass2.push('-tune', options.tune)\n  }\n\n  // HDR handling\n  if (sourceInfo.isHdr) {\n    pass2.push(...buildHdrArgsH265(sourceInfo))\n  } else {\n    pass2.push('-pix_fmt', 'yuv420p')\n  }\n\n  // Audio handling (same as single-pass)\n  // MP4 containers cannot store PCM audio - must transcode to AAC\n  const needsMp4AudioReencode = config.container === 'mp4' &&\n    config.audioCopy &&\n    isPcmAudio(sourceInfo.audioCodec)\n\n  if (needsMp4AudioReencode) {\n    // PCM audio must be transcoded for MP4 container\n    pass2.push('-c:a', 'aac')\n    pass2.push('-b:a', `${config.audioBitrate ?? 192}k`)\n  } else if (config.audioCopy) {\n    pass2.push('-c:a', 'copy')\n  } else {\n    pass2.push(...buildAudioArgs(config))\n  }\n\n  // Map streams\n  pass2.push('-map', '0:v:0')\n  pass2.push('-map', '0:a?')\n\n  // Container options\n  if (config.container === 'mp4') {\n    pass2.push('-movflags', '+faststart')\n    pass2.push('-tag:v', 'hvc1')\n  }\n\n  pass2.push('-y')\n  pass2.push(outputPath)\n\n  return { pass1, pass2, passLogFile }\n}\n\n/**\n * Build x265-params string with pass information for two-pass encoding\n *\n * Note: x265 two-pass with CRF requires VBV settings (vbv-maxrate and vbv-bufsize)\n * We use \"capped CRF\" mode which provides consistent quality with bitrate limits\n *\n * @param options - H.265 encoding options\n * @param sourceInfo - Source video metadata including HDR info\n * @param passNumber - Which pass (1 or 2)\n * @param statsFile - Path to stats file for two-pass\n * @param cpuCapabilities - Optional CPU SIMD capabilities for optimization\n */\nfunction buildX265ParamsWithPass(\n  options: H265Options,\n  sourceInfo: VideoSourceInfo,\n  passNumber: 1 | 2,\n  statsFile: string,\n  cpuCapabilities?: CPUSIMDCapabilities | null\n): string {\n  const params: string[] = []\n\n  // Pass control\n  params.push(`pass=${passNumber}`)\n  params.push(`stats=${statsFile}.log`)\n\n  // VBV settings required for two-pass with CRF\n  // Estimate reasonable bitrate based on resolution for \"capped CRF\" mode\n  const vbvMaxrate = estimateVbvMaxrate(sourceInfo.width, sourceInfo.height, sourceInfo.frameRate)\n  params.push(`vbv-maxrate=${vbvMaxrate}`)\n  params.push(`vbv-bufsize=${vbvMaxrate * 2}`) // Buffer = 2x maxrate for smoother output\n\n  // Standard params (same as single-pass)\n  params.push(`keyint=${options.keyframeInterval}`)\n  params.push(`min-keyint=${Math.min(options.keyframeInterval, 25)}`)\n  params.push(`bframes=${options.bframes}`)\n  params.push('scenecut=40')\n  params.push('ref=4')\n  params.push('rc-lookahead=40')\n  params.push('sao=1')\n\n  // HDR handling with full metadata preservation\n  if (sourceInfo.isHdr) {\n    params.push('hdr10=1')\n    params.push('hdr10-opt=1')\n\n    // Add HDR10 static metadata if available\n    const masterDisplayStr = buildMasterDisplayString(sourceInfo.masteringDisplay)\n    if (masterDisplayStr) {\n      params.push(`master-display=${masterDisplayStr}`)\n    }\n\n    // Add content light level if available\n    const maxCllStr = buildMaxCllString(sourceInfo.contentLightLevel)\n    if (maxCllStr) {\n      params.push(`max-cll=${maxCllStr}`)\n    }\n  }\n\n  params.push('aq-mode=3')\n\n  // Set appropriate level based on actual pixel count\n  const level = getH265Level(sourceInfo.width, sourceInfo.height)\n  params.push(`level-idc=${level}`)\n\n  // Enable AVX-512 optimizations if available\n  if (cpuCapabilities?.avx512) {\n    params.push('asm=avx512')\n  }\n\n  return params.join(':')\n}\n\n/**\n * Estimate VBV maxrate (in kbps) based on resolution and frame rate\n * These are generous limits that allow CRF to work normally while enabling two-pass\n */\nfunction estimateVbvMaxrate(width: number, height: number, frameRate: number): number {\n  const pixels = width * height\n  const fps = frameRate || 30\n\n  // Base bitrates for different resolutions (in kbps)\n  // These are high enough to not constrain CRF quality much\n  let baseBitrate: number\n  if (pixels >= 3840 * 2160) {\n    baseBitrate = 40000 // 4K: 40 Mbps max\n  } else if (pixels >= 2560 * 1440) {\n    baseBitrate = 20000 // 1440p: 20 Mbps max\n  } else if (pixels >= 1920 * 1080) {\n    baseBitrate = 12000 // 1080p: 12 Mbps max\n  } else if (pixels >= 1280 * 720) {\n    baseBitrate = 8000 // 720p: 8 Mbps max\n  } else {\n    baseBitrate = 4000 // SD: 4 Mbps max\n  }\n\n  // Adjust for high frame rate content\n  if (fps > 30) {\n    baseBitrate = Math.round(baseBitrate * (fps / 30))\n  }\n\n  return baseBitrate\n}\n\n/**\n * Builds FFmpeg command arguments for AV1 encoding\n */\nfunction buildAv1FFmpegArgs(\n  inputPath: string,\n  outputPath: string,\n  config: ArchivalEncodingConfig,\n  sourceInfo: VideoSourceInfo\n): string[] {\n  const args: string[] = []\n\n  // Input\n  args.push('-i', inputPath)\n\n  // Apply configured thread limit\n  if (config.threadLimit > 0) {\n    args.push('-threads', String(config.threadLimit))\n  }\n\n  // Video encoding with selected AV1 encoder\n  const encoder = config.av1.encoder\n  args.push('-c:v', encoder)\n\n  // Determine effective CRF based on source info and config\n  const effectiveCrf = config.av1.crf !== 30\n    ? config.av1.crf\n    : getOptimalCrf(sourceInfo)\n\n  // CRF quality\n  args.push('-crf', effectiveCrf.toString())\n\n  // Build encoder-specific parameters\n  if (encoder === 'libsvtav1') {\n    // SVT-AV1 preset (0-13, lower = slower/better)\n    args.push('-preset', config.av1.preset.toString())\n\n    // Build SVT-AV1 params string\n    const svtParams = buildSvtAv1Params(config.av1, sourceInfo)\n    if (svtParams) {\n      args.push('-svtav1-params', svtParams)\n    }\n  } else {\n    // libaom-av1 parameters\n    // cpu-used: 0-8 (lower = slower/better quality)\n    args.push('-cpu-used', config.av1.preset.toString())\n\n    // Build libaom params\n    args.push(...buildLibaomParams(config.av1, sourceInfo))\n  }\n\n  // Handle HDR passthrough\n  if (sourceInfo.isHdr) {\n    args.push(...buildHdrArgs(sourceInfo))\n  } else {\n    // SDR: Use standard 8-bit pixel format\n    args.push('-pix_fmt', 'yuv420p')\n  }\n\n  // Preserve frame rate from source\n  // No explicit -r flag means FFmpeg uses source frame rate\n\n  // Preserve resolution from source (no scaling)\n  // No -vf scale filter needed\n\n  // Audio handling\n  // WebM container only supports Opus and Vorbis audio codecs\n  // MP4 container cannot store PCM audio\n  // If audioCopy is enabled but source audio is incompatible, re-encode appropriately\n  const needsWebmAudioReencode = config.container === 'webm' &&\n    config.audioCopy &&\n    !isWebmCompatibleAudio(sourceInfo.audioCodec)\n\n  const needsMp4AudioReencode = config.container === 'mp4' &&\n    config.audioCopy &&\n    isPcmAudio(sourceInfo.audioCodec)\n\n  if (needsWebmAudioReencode) {\n    // Source audio is incompatible with WebM, re-encode to Opus\n    args.push('-c:a', 'libopus')\n    args.push('-b:a', `${config.audioBitrate ?? 128}k`)\n    args.push('-ar', '48000')\n  } else if (needsMp4AudioReencode) {\n    // PCM audio must be transcoded for MP4 container - use AAC for best compatibility\n    args.push('-c:a', 'aac')\n    args.push('-b:a', `${config.audioBitrate ?? 192}k`)\n  } else if (config.audioCopy) {\n    args.push('-c:a', 'copy')\n  } else {\n    args.push(...buildAudioArgs(config))\n  }\n\n  // Map video and audio streams explicitly\n  // Don't try to copy subtitle streams from containers that may not support them (like MOV)\n  args.push('-map', '0:v:0') // First video stream\n  args.push('-map', '0:a?')  // All audio streams (optional - ? means don't fail if none)\n\n  // Container-specific options\n  if (config.container === 'mp4') {\n    // Enable faststart for MP4 (moves moov atom to beginning)\n    args.push('-movflags', '+faststart')\n  }\n\n  // Overwrite output\n  args.push('-y')\n\n  // Output\n  args.push(outputPath)\n\n  return args\n}\n\n/**\n * Builds FFmpeg command arguments for H.265/HEVC encoding\n * Optimized for web delivery with broad compatibility\n */\nfunction buildH265FFmpegArgs(\n  inputPath: string,\n  outputPath: string,\n  config: ArchivalEncodingConfig,\n  sourceInfo: VideoSourceInfo,\n  cpuCapabilities?: CPUSIMDCapabilities | null\n): string[] {\n  const args: string[] = []\n\n  // Input\n  args.push('-i', inputPath)\n\n  // Apply configured thread limit\n  if (config.threadLimit > 0) {\n    args.push('-threads', String(config.threadLimit))\n  }\n\n  // Video encoding with libx265\n  args.push('-c:v', config.h265.encoder)\n\n  // CRF quality (H.265 uses 0-51 scale, 23 is default)\n  args.push('-crf', config.h265.crf.toString())\n\n  // Preset for encoding speed/quality tradeoff\n  args.push('-preset', config.h265.preset)\n\n  // Build x265-params string (includes AVX-512 optimization when available)\n  const x265Params = buildX265Params(config.h265, sourceInfo, cpuCapabilities)\n  if (x265Params) {\n    args.push('-x265-params', x265Params)\n  }\n\n  // Tune for specific content (optional)\n  if (config.h265.tune) {\n    args.push('-tune', config.h265.tune)\n  }\n\n  // Handle HDR passthrough\n  if (sourceInfo.isHdr) {\n    args.push(...buildHdrArgsH265(sourceInfo))\n  } else {\n    // SDR: Use standard 8-bit pixel format\n    args.push('-pix_fmt', 'yuv420p')\n  }\n\n  // Audio handling for H.265 (typically paired with AAC for web delivery)\n  // MP4 containers cannot store PCM audio - must transcode to AAC\n  const needsMp4AudioReencode = config.container === 'mp4' &&\n    config.audioCopy &&\n    isPcmAudio(sourceInfo.audioCodec)\n\n  if (needsMp4AudioReencode) {\n    // PCM audio must be transcoded for MP4 container\n    args.push('-c:a', 'aac')\n    args.push('-b:a', `${config.audioBitrate ?? 192}k`)\n  } else if (config.audioCopy) {\n    args.push('-c:a', 'copy')\n  } else {\n    args.push(...buildAudioArgs(config))\n  }\n\n  // Map video and audio streams explicitly\n  args.push('-map', '0:v:0') // First video stream\n  args.push('-map', '0:a?')  // All audio streams (optional)\n\n  // Container-specific options\n  if (config.container === 'mp4') {\n    // Enable faststart for MP4 (moves moov atom to beginning for web streaming)\n    args.push('-movflags', '+faststart')\n  }\n\n  // Tag for better compatibility (hvc1 is more widely supported than hev1)\n  if (config.container === 'mp4') {\n    args.push('-tag:v', 'hvc1')\n  }\n\n  // Overwrite output\n  args.push('-y')\n\n  // Output\n  args.push(outputPath)\n\n  return args\n}\n\n/**\n * Build libaom-av1 specific parameters\n * These are passed directly as FFmpeg arguments\n */\nfunction buildLibaomParams(options: Av1Options, sourceInfo: VideoSourceInfo): string[] {\n  const args: string[] = []\n\n  // Keyframe interval (GOP size)\n  // -g sets max keyframe interval\n  args.push('-g', options.keyframeInterval.toString())\n\n  // Scene change detection - libaom handles this automatically\n  // but we can influence it with -sc_threshold\n  if (options.sceneChangeDetection) {\n    args.push('-sc_threshold', '40') // Default is 40, 0 disables\n  } else {\n    args.push('-sc_threshold', '0')\n  }\n\n  // Tile columns and rows for parallel encoding\n  // Helps with encoding speed on multi-core systems\n  if (sourceInfo.width >= 1920) {\n    args.push('-tile-columns', '2')\n    args.push('-tile-rows', '1')\n  }\n\n  // Row-based multi-threading\n  args.push('-row-mt', '1')\n\n  // Adaptive quantization for better perceptual quality\n  if (options.adaptiveQuantization) {\n    args.push('-aq-mode', '1') // Variance-based AQ\n  }\n\n  // For HDR content\n  if (sourceInfo.isHdr) {\n    // libaom handles HDR automatically when given correct pixel format\n    // Additional tuning for HDR\n    args.push('-enable-cdef', '1')\n  }\n\n  // Usage mode: 0=good (default), 1=realtime\n  // Good mode is better for archival\n  args.push('-usage', 'good')\n\n  // Lag-in-frames: allows encoder to look ahead for better decisions\n  // Higher = better quality, more memory. 48 is a good balance\n  args.push('-lag-in-frames', '48')\n\n  // Auto-alt-ref: enables automatic alternate reference frames\n  args.push('-auto-alt-ref', '1')\n\n  return args\n}\n\n/**\n * Build SVT-AV1 specific parameters string\n * These go into the -svtav1-params option\n *\n * Optimized for archival use with focus on:\n * - Maximum quality preservation\n * - Scene-aware keyframes for better seeking without crossing scenes\n * - Film grain synthesis for natural appearance and better compression\n * - Proper HDR handling with full metadata preservation\n */\nfunction buildSvtAv1Params(options: Av1Options, sourceInfo: VideoSourceInfo): string {\n  const params: string[] = []\n\n  // Keyframe interval (GOP size)\n  // Use keyint for max interval, with scene detection to prevent crossing scene cuts\n  // 240 frames (~8-10 seconds at 24-30fps) is good for archival - long enough for\n  // compression efficiency but not so long that seeking becomes problematic\n  params.push(`keyint=${options.keyframeInterval}`)\n\n  // Scene change detection - CRITICAL for archival\n  // scd=1 enables scene change detection, inserting keyframes at scene changes\n  // This prevents the encoder from trying to predict across scene cuts\n  if (options.sceneChangeDetection) {\n    params.push('scd=1')\n  } else {\n    params.push('scd=0')\n  }\n\n  // Film grain synthesis\n  // 0 = disabled, 1-50 = synthesis level\n  // This is a key feature for archival - it analyzes and removes grain during encode,\n  // then synthesizes it at decode time. This significantly improves compression\n  // while maintaining the original film-like appearance.\n  // Level 8-12 is good for most content; higher for very grainy footage\n  if (options.filmGrainSynthesis > 0) {\n    params.push(`film-grain=${options.filmGrainSynthesis}`)\n    // Enable film grain denoising to work with synthesis\n    params.push('film-grain-denoise=1')\n  }\n\n  // Tune mode for archival\n  // 0 = VQ (visual quality) - best for archival as it optimizes for perceptual quality\n  // 1 = PSNR - objective metric, not ideal for viewing\n  // 2 = SSIM - structural similarity, better than PSNR but VQ is still preferred\n  params.push(`tune=${options.tune}`)\n\n  // Adaptive quantization for better perceptual quality\n  if (options.adaptiveQuantization) {\n    // enable-qm enables quantization matrices for better detail preservation\n    params.push('enable-qm=1')\n    // aq-mode=2 (deltaq) provides the best perceptual quality\n    // by adjusting quantization based on spatial complexity\n    params.push('aq-mode=2')\n  }\n\n  // Lookahead distance - more frames = better rate control decisions\n  // For archival, we want maximum quality so use full lookahead\n  // Default is 120 at preset 6, but we can be explicit\n  params.push('lookahead=120')\n\n  // For HDR content, ensure proper handling with full metadata preservation\n  if (sourceInfo.isHdr) {\n    // Enable HDR metadata passthrough\n    params.push('enable-hdr=1')\n\n    // SVT-AV1 HDR10 static metadata passthrough\n    // Format for mastering-display: G(x,y)B(x,y)R(x,y)WP(x,y)L(max,min)\n    // Note: SVT-AV1 uses the same format as x265\n    const masterDisplayStr = buildMasterDisplayString(sourceInfo.masteringDisplay)\n    if (masterDisplayStr) {\n      params.push(`mastering-display=${masterDisplayStr}`)\n    }\n\n    // Content light level: maxCLL,maxFALL\n    const maxCllStr = buildMaxCllString(sourceInfo.contentLightLevel)\n    if (maxCllStr) {\n      params.push(`content-light=${maxCllStr}`)\n    }\n  }\n\n  // fast-decode=0 means no decode optimizations that would hurt quality\n  // For archival we prioritize quality over decode speed\n  params.push('fast-decode=0')\n\n  // enable-tf (temporal filtering) - helps with grain and noise\n  // Good for archival as it can smooth out compression artifacts\n  params.push('enable-tf=1')\n\n  return params.join(':')\n}\n\n/**\n * Build x265-specific parameters string\n * Optimized for web delivery with good compression\n *\n * @param options - H.265 encoding options\n * @param sourceInfo - Source video metadata including HDR info\n * @param cpuCapabilities - Optional CPU SIMD capabilities for optimization\n */\nfunction buildX265Params(\n  options: H265Options,\n  sourceInfo: VideoSourceInfo,\n  cpuCapabilities?: CPUSIMDCapabilities | null\n): string {\n  const params: string[] = []\n\n  // Keyframe interval (GOP size)\n  // For web delivery, shorter GOPs are better for seeking\n  params.push(`keyint=${options.keyframeInterval}`)\n  params.push(`min-keyint=${Math.min(options.keyframeInterval, 25)}`)\n\n  // B-frames for better compression\n  params.push(`bframes=${options.bframes}`)\n\n  // Scene cut detection for better keyframe placement\n  params.push('scenecut=40')\n\n  // Reference frames for better compression\n  params.push('ref=4')\n\n  // Lookahead for better rate control\n  params.push('rc-lookahead=40')\n\n  // Enable SAO (Sample Adaptive Offset) for better quality\n  params.push('sao=1')\n\n  // For HDR content, ensure proper handling with full metadata preservation\n  if (sourceInfo.isHdr) {\n    params.push('hdr10=1')\n    params.push('hdr10-opt=1')\n\n    // Add HDR10 static metadata if available\n    const masterDisplayStr = buildMasterDisplayString(sourceInfo.masteringDisplay)\n    if (masterDisplayStr) {\n      params.push(`master-display=${masterDisplayStr}`)\n    }\n\n    // Add content light level if available\n    const maxCllStr = buildMaxCllString(sourceInfo.contentLightLevel)\n    if (maxCllStr) {\n      params.push(`max-cll=${maxCllStr}`)\n    }\n  }\n\n  // Adaptive quantization for better perceptual quality\n  params.push('aq-mode=3') // Auto-variance AQ\n\n  // Set appropriate level based on actual pixel count\n  const level = getH265Level(sourceInfo.width, sourceInfo.height)\n  params.push(`level-idc=${level}`)\n\n  // Enable AVX-512 optimizations if available\n  // x265 auto-detects, but we can force it for maximum performance\n  if (cpuCapabilities?.avx512) {\n    params.push('asm=avx512')\n  }\n\n  return params.join(':')\n}\n\n/**\n * Build x265 master-display string from HDR metadata\n * Format: G(x,y)B(x,y)R(x,y)WP(x,y)L(max,min)\n * All chromaticity values are in 0.00002 units (multiply by 50000)\n * Luminance is in 0.0001 cd/m\u00B2 units\n */\nfunction buildMasterDisplayString(metadata?: HdrMasteringDisplayMetadata): string | null {\n  if (!metadata) return null\n\n  // Ensure we have valid data\n  if (!metadata.greenX || !metadata.blueX || !metadata.redX) return null\n\n  // Format: G(gx,gy)B(bx,by)R(rx,ry)WP(wpx,wpy)L(maxL,minL)\n  // x265 expects coordinates as integers where 50000 = 1.0\n  // and luminance where 10000 = 1 cd/m\u00B2\n  const maxL = Math.round(metadata.maxLuminance * 10000)\n  const minL = Math.round(metadata.minLuminance * 10000)\n\n  return `G(${metadata.greenX},${metadata.greenY})B(${metadata.blueX},${metadata.blueY})R(${metadata.redX},${metadata.redY})WP(${metadata.whitePointX},${metadata.whitePointY})L(${maxL},${minL})`\n}\n\n/**\n * Build x265 max-cll string from content light level metadata\n * Format: maxCLL,maxFALL (both in cd/m\u00B2)\n */\nfunction buildMaxCllString(metadata?: HdrContentLightLevel): string | null {\n  if (!metadata) return null\n  if (metadata.maxCll === 0 && metadata.maxFall === 0) return null\n\n  return `${metadata.maxCll},${metadata.maxFall}`\n}\n\n/**\n * Build HDR passthrough arguments for H.265\n * Preserves HDR metadata with proper color parameters\n */\nfunction buildHdrArgsH265(sourceInfo: VideoSourceInfo): string[] {\n  const args: string[] = []\n\n  // Use 10-bit pixel format for HDR\n  args.push('-pix_fmt', 'yuv420p10le')\n\n  // Use precise color metadata from source if available\n  if (sourceInfo.colorPrimaries || sourceInfo.colorTransfer || sourceInfo.colorMatrix) {\n    // Use exact values from source\n    if (sourceInfo.colorPrimaries) {\n      args.push('-color_primaries', sourceInfo.colorPrimaries)\n    }\n    if (sourceInfo.colorTransfer) {\n      args.push('-color_trc', sourceInfo.colorTransfer)\n    }\n    if (sourceInfo.colorMatrix) {\n      args.push('-colorspace', sourceInfo.colorMatrix)\n    }\n  } else if (sourceInfo.colorSpace) {\n    // Fall back to parsing combined color space string\n    const colorParams = parseColorSpace(sourceInfo.colorSpace)\n    if (colorParams.primaries) {\n      args.push('-color_primaries', colorParams.primaries)\n    }\n    if (colorParams.transfer) {\n      args.push('-color_trc', colorParams.transfer)\n    }\n    if (colorParams.matrix) {\n      args.push('-colorspace', colorParams.matrix)\n    }\n  } else {\n    // Default HDR color space (BT.2020 with PQ)\n    args.push('-color_primaries', 'bt2020')\n    args.push('-color_trc', 'smpte2084')\n    args.push('-colorspace', 'bt2020nc')\n  }\n\n  return args\n}\n\n/**\n * Build HDR passthrough arguments\n * Preserves HDR metadata and uses appropriate pixel format\n */\nfunction buildHdrArgs(sourceInfo: VideoSourceInfo): string[] {\n  const args: string[] = []\n\n  // Use 10-bit pixel format for HDR\n  args.push('-pix_fmt', 'yuv420p10le')\n\n  // Use precise color metadata from source if available\n  if (sourceInfo.colorPrimaries || sourceInfo.colorTransfer || sourceInfo.colorMatrix) {\n    // Use exact values from source\n    if (sourceInfo.colorPrimaries) {\n      args.push('-color_primaries', sourceInfo.colorPrimaries)\n    }\n    if (sourceInfo.colorTransfer) {\n      args.push('-color_trc', sourceInfo.colorTransfer)\n    }\n    if (sourceInfo.colorMatrix) {\n      args.push('-colorspace', sourceInfo.colorMatrix)\n    }\n  } else if (sourceInfo.colorSpace) {\n    // Fall back to parsing combined color space string\n    const colorParams = parseColorSpace(sourceInfo.colorSpace)\n    if (colorParams.primaries) {\n      args.push('-color_primaries', colorParams.primaries)\n    }\n    if (colorParams.transfer) {\n      args.push('-color_trc', colorParams.transfer)\n    }\n    if (colorParams.matrix) {\n      args.push('-colorspace', colorParams.matrix)\n    }\n  } else {\n    // Default HDR color space (BT.2020 with PQ)\n    args.push('-color_primaries', 'bt2020')\n    args.push('-color_trc', 'smpte2084')\n    args.push('-colorspace', 'bt2020nc')\n  }\n\n  return args\n}\n\n/**\n * Parse color space string to FFmpeg color parameters\n */\nfunction parseColorSpace(colorSpace: string): {\n  primaries?: string\n  transfer?: string\n  matrix?: string\n} {\n  const lower = colorSpace.toLowerCase()\n\n  // BT.2020 / Rec. 2020 (common HDR)\n  if (lower.includes('bt2020') || lower.includes('rec2020') || lower.includes('2020')) {\n    return {\n      primaries: 'bt2020',\n      transfer: lower.includes('hlg') ? 'arib-std-b67' : 'smpte2084',\n      matrix: 'bt2020nc'\n    }\n  }\n\n  // BT.709 / Rec. 709 (SDR standard)\n  if (lower.includes('bt709') || lower.includes('rec709') || lower.includes('709')) {\n    return {\n      primaries: 'bt709',\n      transfer: 'bt709',\n      matrix: 'bt709'\n    }\n  }\n\n  // PQ transfer (HDR10)\n  if (lower.includes('pq') || lower.includes('smpte2084') || lower.includes('2084')) {\n    return {\n      primaries: 'bt2020',\n      transfer: 'smpte2084',\n      matrix: 'bt2020nc'\n    }\n  }\n\n  // HLG transfer\n  if (lower.includes('hlg') || lower.includes('arib') || lower.includes('b67')) {\n    return {\n      primaries: 'bt2020',\n      transfer: 'arib-std-b67',\n      matrix: 'bt2020nc'\n    }\n  }\n\n  return {}\n}\n\n/**\n * Check if an audio codec is compatible with WebM container\n * WebM only supports Vorbis and Opus audio codecs\n */\nfunction isWebmCompatibleAudio(audioCodec?: string): boolean {\n  if (!audioCodec) return false\n  const codec = audioCodec.toLowerCase()\n  return codec === 'opus' || codec === 'vorbis'\n}\n\n/**\n * Check if an audio codec is PCM (uncompressed)\n * PCM audio cannot be stored in MP4 containers - needs transcoding\n */\nfunction isPcmAudio(audioCodec?: string): boolean {\n  if (!audioCodec) return false\n  const codec = audioCodec.toLowerCase()\n  // PCM formats: pcm_s16le, pcm_s24le, pcm_s32le, pcm_f32le, pcm_s16be, etc.\n  return codec.startsWith('pcm_')\n}\n\n/**\n * Check if an audio codec is compatible with MP4 container\n * MP4 supports AAC, AC3, EAC3, ALAC, MP3, Opus, and FLAC (in some players)\n * PCM audio is NOT supported in MP4\n */\nfunction isMp4CompatibleAudio(audioCodec?: string): boolean {\n  if (!audioCodec) return false\n  const codec = audioCodec.toLowerCase()\n  // Common MP4-compatible audio codecs\n  const compatible = ['aac', 'mp3', 'ac3', 'eac3', 'alac', 'opus', 'flac']\n  return compatible.includes(codec) || !isPcmAudio(audioCodec)\n}\n\n/**\n * Build audio encoding arguments when not copying\n */\nfunction buildAudioArgs(config: ArchivalEncodingConfig): string[] {\n  const args: string[] = []\n\n  switch (config.audioCodec) {\n    case 'opus':\n      args.push('-c:a', 'libopus')\n      args.push('-b:a', `${config.audioBitrate ?? 128}k`)\n      // Opus works best with 48kHz\n      args.push('-ar', '48000')\n      break\n\n    case 'flac':\n      args.push('-c:a', 'flac')\n      // FLAC is lossless, no bitrate needed\n      break\n\n    case 'aac':\n      args.push('-c:a', 'aac')\n      args.push('-b:a', `${config.audioBitrate ?? 192}k`)\n      break\n\n    default:\n      args.push('-c:a', 'copy')\n  }\n\n  return args\n}\n\n/**\n * Get a human-readable description of the encoding settings\n */\nexport function describeArchivalSettings(\n  config: ArchivalEncodingConfig,\n  sourceInfo?: VideoSourceInfo\n): string {\n  const lines: string[] = []\n\n  // Codec selection\n  lines.push(`Codec: ${config.codec === 'h265' ? 'H.265/HEVC' : 'AV1'}`)\n\n  if (config.codec === 'h265') {\n    // H.265 settings\n    lines.push(`Encoder: libx265`)\n    lines.push(`Preset: ${config.h265.preset}`)\n\n    if (sourceInfo) {\n      const resolution = getResolutionCategory(sourceInfo.width, sourceInfo.height)\n      lines.push(`Resolution: ${sourceInfo.width}x${sourceInfo.height} (${resolution})`)\n      lines.push(`CRF: ${config.h265.crf}`)\n      lines.push(`Frame Rate: ${sourceInfo.frameRate.toFixed(2)} fps`)\n      lines.push(`Color: ${sourceInfo.isHdr ? 'HDR (10-bit)' : 'SDR (8-bit)'}`)\n    } else {\n      lines.push(`CRF: ${config.h265.crf}`)\n    }\n\n    lines.push(`GOP Size: ${config.h265.keyframeInterval} frames`)\n    lines.push(`B-frames: ${config.h265.bframes}`)\n\n    if (config.h265.tune) {\n      lines.push(`Tune: ${config.h265.tune}`)\n    }\n  } else {\n    // AV1 settings\n    const encoder = config.av1.encoder\n    const encoderName = encoder === 'libsvtav1' ? 'SVT-AV1 (libsvtav1)' : 'libaom-av1'\n    lines.push(`Encoder: ${encoderName}`)\n    lines.push(`Preset: ${config.av1.preset} (${describePreset(config.av1.preset, encoder)})`)\n\n    if (sourceInfo) {\n      const effectiveCrf = getOptimalCrf(sourceInfo)\n      const resolution = getResolutionCategory(sourceInfo.width, sourceInfo.height)\n      lines.push(`Resolution: ${sourceInfo.width}x${sourceInfo.height} (${resolution})`)\n      lines.push(`CRF: ${effectiveCrf} (${sourceInfo.isHdr ? 'HDR' : 'SDR'} profile)`)\n      lines.push(`Frame Rate: ${sourceInfo.frameRate.toFixed(2)} fps`)\n      lines.push(`Color: ${sourceInfo.isHdr ? 'HDR (10-bit)' : 'SDR (8-bit)'}`)\n    } else {\n      lines.push(`CRF: ${config.av1.crf} (auto-adjusted per video)`)\n    }\n\n    lines.push(`GOP Size: ${config.av1.keyframeInterval} frames (scene-aware)`)\n\n    // Film grain only applies to SVT-AV1\n    if (encoder === 'libsvtav1') {\n      lines.push(`Film Grain: ${config.av1.filmGrainSynthesis > 0 ? `Level ${config.av1.filmGrainSynthesis}` : 'Disabled'}`)\n    }\n  }\n\n  // Determine audio handling description\n  let audioDesc: string\n  if (config.audioCopy) {\n    // Check if WebM would need re-encoding\n    const needsWebmReencode = config.container === 'webm' &&\n      sourceInfo &&\n      !isWebmCompatibleAudio(sourceInfo.audioCodec)\n    // Check if MP4 has PCM audio that needs re-encoding\n    const needsMp4Reencode = config.container === 'mp4' &&\n      sourceInfo &&\n      isPcmAudio(sourceInfo.audioCodec)\n    if (needsWebmReencode) {\n      audioDesc = `Opus (re-encoded for WebM, source: ${sourceInfo.audioCodec || 'unknown'})`\n    } else if (needsMp4Reencode) {\n      audioDesc = `AAC (re-encoded for MP4, source: ${sourceInfo.audioCodec || 'PCM'})`\n    } else {\n      audioDesc = 'Copy (lossless)'\n    }\n  } else {\n    audioDesc = config.audioCodec?.toUpperCase() ?? 'Copy'\n  }\n  lines.push(`Audio: ${audioDesc}`)\n  lines.push(`Container: ${config.container.toUpperCase()}`)\n\n  return lines.join('\\n')\n}\n\nfunction describePreset(preset: number, encoder: string): string {\n  if (encoder === 'libsvtav1') {\n    // SVT-AV1: 0-13\n    if (preset <= 2) return 'Very Slow - Maximum Quality'\n    if (preset <= 4) return 'Slow - High Quality'\n    if (preset <= 6) return 'Balanced Quality/Speed'\n    if (preset <= 8) return 'Fast - Good Quality'\n    if (preset <= 10) return 'Very Fast - Acceptable Quality'\n    return 'Ultra Fast - Lower Quality'\n  } else {\n    // libaom-av1: 0-8\n    if (preset <= 1) return 'Very Slow - Maximum Quality'\n    if (preset <= 3) return 'Slow - High Quality'\n    if (preset <= 5) return 'Balanced Quality/Speed'\n    if (preset <= 6) return 'Fast - Good Quality'\n    return 'Very Fast - Acceptable Quality'\n  }\n}\n\n/**\n * Estimate output file size based on source info and CRF\n * This is a rough estimate - actual size depends heavily on content\n */\nexport function estimateArchivalFileSize(\n  sourceInfo: VideoSourceInfo,\n  crf: number\n): { minMB: number; maxMB: number; estimatedMB: number } {\n  // Base bitrate estimation for AV1 at CRF 30, 1080p, 30fps\n  // AV1 is roughly 30-50% more efficient than HEVC\n  const baseBitrateKbps = 2500 // ~2.5 Mbps for 1080p CRF 30\n\n  // Resolution factor\n  const pixels = sourceInfo.width * sourceInfo.height\n  const basePixels = 1920 * 1080\n  const resolutionFactor = pixels / basePixels\n\n  // Frame rate factor\n  const baseFps = 30\n  const fpsFactor = sourceInfo.frameRate / baseFps\n\n  // CRF factor (each CRF point roughly changes size by ~10-15%)\n  const crfDiff = crf - 30\n  const crfFactor = Math.pow(0.87, crfDiff) // ~13% per CRF point\n\n  // HDR typically needs ~20% more bitrate for same perceptual quality\n  const hdrFactor = sourceInfo.isHdr ? 1.2 : 1.0\n\n  // Calculate estimated bitrate\n  const estimatedBitrateKbps = baseBitrateKbps * resolutionFactor * fpsFactor * crfFactor * hdrFactor\n\n  // Convert to file size\n  const durationSeconds = sourceInfo.duration\n  const estimatedBits = estimatedBitrateKbps * 1000 * durationSeconds\n  const estimatedMB = estimatedBits / 8 / 1024 / 1024\n\n  // Provide range (AV1 can vary significantly based on content complexity)\n  return {\n    minMB: Math.round(estimatedMB * 0.6),\n    maxMB: Math.round(estimatedMB * 1.5),\n    estimatedMB: Math.round(estimatedMB)\n  }\n}\n", "import { spawn } from 'node:child_process'\nimport { createWriteStream, existsSync, unlinkSync } from 'node:fs'\nimport { chmod, mkdir, rename, rm } from 'node:fs/promises'\nimport { join, dirname } from 'node:path'\nimport { pipeline } from 'node:stream/promises'\nimport { createGunzip } from 'node:zlib'\nimport { resolveBundledBinary, getBundledBinaryDir } from '../../utils/binary'\nimport { Logger } from '../../utils/logger'\nimport type { Av1Encoder, H265Encoder } from '../../../shared/types/archival.types'\n\nconst logger = new Logger('EncoderDetector')\n\nexport interface EncoderInfo {\n  available: Av1Encoder[]\n  recommended: Av1Encoder | null\n  hasAv1Support: boolean\n  // H.265 encoder info\n  h265Available: H265Encoder[]\n  hasH265Support: boolean\n  canUpgrade: boolean // True if we can download a better FFmpeg\n}\n\nexport interface UpgradeProgress {\n  stage: 'downloading' | 'extracting' | 'installing' | 'verifying' | 'complete' | 'error'\n  progress?: number // 0-100 for download progress\n  error?: string\n}\n\nlet cachedEncoderInfo: EncoderInfo | null = null\n\n/**\n * Detect available AV1 and H.265 encoders in the bundled FFmpeg\n * Results are cached after first detection\n */\nexport async function detectAv1Encoders(): Promise<EncoderInfo> {\n  if (cachedEncoderInfo) {\n    return cachedEncoderInfo\n  }\n\n  const ffmpegPath = resolveBundledBinary('ffmpeg')\n  const available: Av1Encoder[] = []\n  const h265Available: H265Encoder[] = []\n\n  try {\n    const encoders = await getEncoderList(ffmpegPath)\n\n    // Check for AV1 encoders\n    // Check for libaom-av1 (more widely available)\n    if (encoders.includes('libaom-av1')) {\n      available.push('libaom-av1')\n    }\n\n    // Check for libsvtav1 (faster, but less common)\n    if (encoders.includes('libsvtav1')) {\n      available.push('libsvtav1')\n    }\n\n    // Check for H.265/HEVC encoders\n    // libx265 is the standard software encoder for HEVC\n    if (encoders.includes('libx265')) {\n      h265Available.push('libx265')\n    }\n  } catch {\n    // If detection fails, assume no encoders available\n  }\n\n  // Recommend based on availability\n  // Prefer libsvtav1 if available (faster), otherwise libaom-av1\n  let recommended: Av1Encoder | null = null\n  if (available.includes('libsvtav1')) {\n    recommended = 'libsvtav1'\n  } else if (available.includes('libaom-av1')) {\n    recommended = 'libaom-av1'\n  }\n\n  // Determine if we can upgrade (only if we don't have SVT-AV1)\n  const canUpgrade = !available.includes('libsvtav1') &&\n    (process.platform === 'darwin' || process.platform === 'win32')\n\n  cachedEncoderInfo = {\n    available,\n    recommended,\n    hasAv1Support: available.length > 0,\n    h265Available,\n    hasH265Support: h265Available.length > 0,\n    canUpgrade\n  }\n\n  return cachedEncoderInfo\n}\n\n/**\n * Get the best available encoder, with fallback\n */\nexport async function getBestEncoder(preferred?: Av1Encoder): Promise<Av1Encoder | null> {\n  const info = await detectAv1Encoders()\n\n  if (!info.hasAv1Support) {\n    return null\n  }\n\n  // If preferred encoder is available, use it\n  if (preferred && info.available.includes(preferred)) {\n    return preferred\n  }\n\n  // Otherwise use recommended\n  return info.recommended\n}\n\n/**\n * Check if a specific encoder is available\n */\nexport async function isEncoderAvailable(encoder: Av1Encoder): Promise<boolean> {\n  const info = await detectAv1Encoders()\n  return info.available.includes(encoder)\n}\n\n/**\n * Clear the encoder cache (useful if FFmpeg is updated)\n */\nexport function clearEncoderCache(): void {\n  cachedEncoderInfo = null\n}\n\n/**\n * Get list of available encoders from FFmpeg\n */\nfunction getEncoderList(ffmpegPath: string): Promise<string[]> {\n  return new Promise((resolve, reject) => {\n    const proc = spawn(ffmpegPath, ['-encoders', '-hide_banner'])\n\n    let stdout = ''\n    proc.stdout.on('data', (data: Buffer) => {\n      stdout += data.toString()\n    })\n\n    proc.on('close', (code) => {\n      if (code !== 0) {\n        reject(new Error(`FFmpeg exited with code ${code}`))\n        return\n      }\n\n      // Parse encoder list - each line starts with encoder type and name\n      // Format: \" V..... libx264          libx264 H.264...\"\n      const encoders: string[] = []\n      const lines = stdout.split('\\n')\n\n      for (const line of lines) {\n        // Match video encoders (start with V)\n        const match = line.match(/^\\s*V[.\\w]+\\s+(\\S+)/)\n        if (match) {\n          encoders.push(match[1])\n        }\n      }\n\n      resolve(encoders)\n    })\n\n    proc.on('error', reject)\n  })\n}\n\n/**\n * FFmpeg download URLs for builds with SVT-AV1 support\n * These are static builds from trusted sources with modern AV1 encoders\n */\nconst FFMPEG_DOWNLOAD_URLS: Record<string, { url: string; type: 'zip' | 'tar.xz' | 'dmg' }> = {\n  // macOS arm64 (Apple Silicon) - evermeet.cx builds include SVT-AV1\n  'darwin-arm64': {\n    url: 'https://evermeet.cx/ffmpeg/ffmpeg-7.1.1.zip',\n    type: 'zip'\n  },\n  // macOS x64 (Intel)\n  'darwin-x64': {\n    url: 'https://evermeet.cx/ffmpeg/ffmpeg-7.1.1.zip',\n    type: 'zip'\n  },\n  // Windows x64 - gyan.dev builds include SVT-AV1\n  'win32-x64': {\n    url: 'https://www.gyan.dev/ffmpeg/builds/ffmpeg-release-essentials.zip',\n    type: 'zip'\n  }\n}\n\nexport type UpgradeProgressCallback = (progress: UpgradeProgress) => void\n\n/**\n * Upgrade FFmpeg to a build with better AV1 encoder support (SVT-AV1)\n * Downloads and installs an enhanced FFmpeg build\n */\nexport async function upgradeFFmpeg(\n  onProgress?: UpgradeProgressCallback\n): Promise<{ success: boolean; error?: string }> {\n  const platform = process.platform\n  const arch = process.arch\n  const key = `${platform}-${arch}`\n\n  const downloadInfo = FFMPEG_DOWNLOAD_URLS[key]\n  if (!downloadInfo) {\n    return {\n      success: false,\n      error: `No FFmpeg upgrade available for ${platform}-${arch}`\n    }\n  }\n\n  const binaryDir = getBundledBinaryDir()\n  const ffmpegPath = resolveBundledBinary('ffmpeg')\n  const backupPath = `${ffmpegPath}.backup`\n  const tempDir = join(binaryDir, '.ffmpeg-upgrade-temp')\n\n  try {\n    // Create temp directory\n    await mkdir(tempDir, { recursive: true })\n\n    // Step 1: Download\n    onProgress?.({ stage: 'downloading', progress: 0 })\n    logger.info('Downloading enhanced FFmpeg', { url: downloadInfo.url })\n\n    const downloadPath = join(tempDir, `ffmpeg-download.${downloadInfo.type}`)\n    await downloadFile(downloadInfo.url, downloadPath, (progress) => {\n      onProgress?.({ stage: 'downloading', progress })\n    })\n\n    // Step 2: Extract\n    onProgress?.({ stage: 'extracting' })\n    logger.info('Extracting FFmpeg')\n\n    const extractedBinary = await extractFFmpeg(downloadPath, tempDir, downloadInfo.type, platform)\n    if (!extractedBinary) {\n      throw new Error('Failed to find FFmpeg binary in downloaded archive')\n    }\n\n    // Step 3: Install\n    onProgress?.({ stage: 'installing' })\n    logger.info('Installing enhanced FFmpeg')\n\n    // Backup existing FFmpeg\n    if (existsSync(ffmpegPath)) {\n      await rename(ffmpegPath, backupPath)\n    }\n\n    // Move new FFmpeg to binary directory\n    await rename(extractedBinary, ffmpegPath)\n\n    // Set executable permissions on Unix\n    if (platform !== 'win32') {\n      await chmod(ffmpegPath, 0o755)\n    }\n\n    // Step 4: Verify\n    onProgress?.({ stage: 'verifying' })\n    logger.info('Verifying new FFmpeg')\n\n    // Clear cache and re-detect encoders\n    clearEncoderCache()\n    const newInfo = await detectAv1Encoders()\n\n    if (!newInfo.available.includes('libsvtav1')) {\n      // Verification failed, restore backup\n      logger.warn('New FFmpeg does not have SVT-AV1, restoring backup')\n      if (existsSync(backupPath)) {\n        await rm(ffmpegPath, { force: true })\n        await rename(backupPath, ffmpegPath)\n      }\n      throw new Error('Downloaded FFmpeg does not include SVT-AV1 encoder')\n    }\n\n    // Clean up backup\n    if (existsSync(backupPath)) {\n      await rm(backupPath, { force: true })\n    }\n\n    // Clean up temp directory\n    await rm(tempDir, { recursive: true, force: true })\n\n    onProgress?.({ stage: 'complete' })\n    logger.info('FFmpeg upgrade complete', { encoders: newInfo.available })\n\n    return { success: true }\n\n  } catch (error) {\n    const message = error instanceof Error ? error.message : 'Unknown error'\n    logger.error('FFmpeg upgrade failed', { error: message })\n\n    // Restore backup if it exists\n    if (existsSync(backupPath)) {\n      try {\n        await rm(ffmpegPath, { force: true })\n        await rename(backupPath, ffmpegPath)\n      } catch {\n        // Ignore restore errors\n      }\n    }\n\n    // Clean up temp directory\n    try {\n      await rm(tempDir, { recursive: true, force: true })\n    } catch {\n      // Ignore cleanup errors\n    }\n\n    onProgress?.({ stage: 'error', error: message })\n    return { success: false, error: message }\n  }\n}\n\n/**\n * Download a file with progress tracking\n */\nasync function downloadFile(\n  url: string,\n  destPath: string,\n  onProgress?: (percent: number) => void\n): Promise<void> {\n  const response = await fetch(url, {\n    headers: {\n      'User-Agent': 'Drapp/1.0'\n    }\n  })\n\n  if (!response.ok) {\n    throw new Error(`Download failed: ${response.status} ${response.statusText}`)\n  }\n\n  const contentLength = Number(response.headers.get('content-length') || 0)\n  const reader = response.body?.getReader()\n  if (!reader) {\n    throw new Error('No response body')\n  }\n\n  const writer = createWriteStream(destPath)\n  let downloadedBytes = 0\n\n  try {\n    while (true) {\n      const { done, value } = await reader.read()\n      if (done) break\n\n      writer.write(Buffer.from(value))\n      downloadedBytes += value.length\n\n      if (contentLength > 0) {\n        onProgress?.(Math.round((downloadedBytes / contentLength) * 100))\n      }\n    }\n  } finally {\n    writer.end()\n    await new Promise<void>((resolve) => writer.on('finish', resolve))\n  }\n}\n\n/**\n * Extract FFmpeg binary from downloaded archive\n */\nasync function extractFFmpeg(\n  archivePath: string,\n  tempDir: string,\n  type: 'zip' | 'tar.xz' | 'dmg',\n  platform: string\n): Promise<string | null> {\n  const binaryName = platform === 'win32' ? 'ffmpeg.exe' : 'ffmpeg'\n\n  if (type === 'zip') {\n    // Use unzip command (available on macOS and Windows with PowerShell)\n    const extractDir = join(tempDir, 'extracted')\n    await mkdir(extractDir, { recursive: true })\n\n    await new Promise<void>((resolve, reject) => {\n      let proc\n      if (platform === 'win32') {\n        // Windows: Use PowerShell\n        proc = spawn('powershell', [\n          '-Command',\n          `Expand-Archive -Path \"${archivePath}\" -DestinationPath \"${extractDir}\" -Force`\n        ])\n      } else {\n        // macOS/Linux: Use unzip\n        proc = spawn('unzip', ['-o', archivePath, '-d', extractDir])\n      }\n\n      proc.on('close', (code) => {\n        if (code === 0) {\n          resolve()\n        } else {\n          reject(new Error(`Extraction failed with code ${code}`))\n        }\n      })\n      proc.on('error', reject)\n    })\n\n    // Find ffmpeg binary in extracted files\n    return findBinaryInDir(extractDir, binaryName)\n  }\n\n  // For tar.xz (Linux), we'd use tar -xJf\n  // For dmg (macOS alternative), we'd need to mount and copy\n  // For now, we only support zip which covers macOS and Windows\n\n  return null\n}\n\n/**\n * Recursively find a binary in a directory\n */\nasync function findBinaryInDir(dir: string, binaryName: string): Promise<string | null> {\n  const { readdir, stat } = await import('node:fs/promises')\n\n  const entries = await readdir(dir, { withFileTypes: true })\n\n  for (const entry of entries) {\n    const fullPath = join(dir, entry.name)\n\n    if (entry.isDirectory()) {\n      const found = await findBinaryInDir(fullPath, binaryName)\n      if (found) return found\n    } else if (entry.name === binaryName || entry.name.toLowerCase() === binaryName.toLowerCase()) {\n      return fullPath\n    }\n  }\n\n  return null\n}\n", "import { readFile, writeFile, unlink, access } from 'node:fs/promises'\nimport { join } from 'node:path'\nimport { app } from 'electron'\nimport { Logger } from '../../utils/logger'\nimport type { PersistedArchivalState } from '../../../shared/types/archival.types'\n\nconst STATE_FILE_NAME = 'archival-queue-state.json'\nconst CURRENT_VERSION = 1\n\n/**\n * Handles persistence of archival queue state for crash recovery\n * Saves state to a JSON file in the user data directory\n */\nexport class ArchivalStatePersistence {\n  private readonly logger = new Logger('ArchivalStatePersistence')\n  private readonly statePath: string\n  private saveDebounceTimer: NodeJS.Timeout | null = null\n  private readonly saveDebounceMs = 30000 // 30 seconds for periodic saves during encoding\n\n  constructor() {\n    this.statePath = join(app.getPath('userData'), STATE_FILE_NAME)\n  }\n\n  /**\n   * Save state to disk immediately\n   */\n  async saveState(state: PersistedArchivalState): Promise<void> {\n    // Cancel any pending debounced save\n    if (this.saveDebounceTimer) {\n      clearTimeout(this.saveDebounceTimer)\n      this.saveDebounceTimer = null\n    }\n\n    try {\n      const stateWithMeta: PersistedArchivalState = {\n        ...state,\n        version: CURRENT_VERSION,\n        savedAt: new Date().toISOString()\n      }\n      await writeFile(this.statePath, JSON.stringify(stateWithMeta, null, 2), 'utf-8')\n      this.logger.debug('State saved', { itemCount: state.job.items.length })\n    } catch (error) {\n      this.logger.error('Failed to save state', { error })\n      throw error\n    }\n  }\n\n  /**\n   * Schedule a debounced save (used during encoding for periodic saves)\n   * The save will be executed after saveDebounceMs unless another save is triggered\n   */\n  scheduleSave(state: PersistedArchivalState): void {\n    // Cancel any existing timer\n    if (this.saveDebounceTimer) {\n      clearTimeout(this.saveDebounceTimer)\n    }\n\n    this.saveDebounceTimer = setTimeout(() => {\n      this.saveDebounceTimer = null\n      void this.saveState(state)\n    }, this.saveDebounceMs)\n  }\n\n  /**\n   * Cancel any pending debounced save\n   */\n  cancelPendingSave(): void {\n    if (this.saveDebounceTimer) {\n      clearTimeout(this.saveDebounceTimer)\n      this.saveDebounceTimer = null\n    }\n  }\n\n  /**\n   * Load state from disk\n   * Returns null if no state file exists or if it's corrupted\n   */\n  async loadState(): Promise<PersistedArchivalState | null> {\n    try {\n      const content = await readFile(this.statePath, 'utf-8')\n      const state = JSON.parse(content) as PersistedArchivalState\n\n      // Validate version\n      if (state.version !== CURRENT_VERSION) {\n        this.logger.warn('State file version mismatch, discarding', {\n          fileVersion: state.version,\n          currentVersion: CURRENT_VERSION\n        })\n        await this.clearState()\n        return null\n      }\n\n      // Validate required fields\n      if (!state.job || !state.job.id || !Array.isArray(state.job.items)) {\n        this.logger.warn('State file is corrupted, discarding')\n        await this.clearState()\n        return null\n      }\n\n      this.logger.info('State loaded', {\n        jobId: state.job.id,\n        itemCount: state.job.items.length,\n        savedAt: state.savedAt\n      })\n\n      return state\n    } catch (error) {\n      // File doesn't exist or can't be read - this is normal on first run\n      if ((error as NodeJS.ErrnoException).code === 'ENOENT') {\n        return null\n      }\n      this.logger.warn('Failed to load state', { error })\n      return null\n    }\n  }\n\n  /**\n   * Clear state file from disk\n   */\n  async clearState(): Promise<void> {\n    // Cancel any pending save\n    this.cancelPendingSave()\n\n    try {\n      await unlink(this.statePath)\n      this.logger.debug('State file cleared')\n    } catch (error) {\n      // Ignore if file doesn't exist\n      if ((error as NodeJS.ErrnoException).code !== 'ENOENT') {\n        this.logger.warn('Failed to clear state', { error })\n      }\n    }\n  }\n\n  /**\n   * Check if a persisted state file exists\n   */\n  async hasPersistedState(): Promise<boolean> {\n    try {\n      await access(this.statePath)\n      return true\n    } catch {\n      return false\n    }\n  }\n\n  /**\n   * Get the path to the state file (for debugging/logging)\n   */\n  getStatePath(): string {\n    return this.statePath\n  }\n}\n", "import { execFile } from 'node:child_process'\nimport { promisify } from 'node:util'\nimport os from 'node:os'\nimport type { HWAccelerator } from '../../shared/types/encoding.types'\n\nconst execFileAsync = promisify(execFile)\n\nexport type CPUSIMDCapabilities = {\n  // x86 SIMD extensions\n  sse: boolean\n  sse2: boolean\n  sse3: boolean\n  ssse3: boolean\n  sse41: boolean\n  sse42: boolean\n  avx: boolean\n  avx2: boolean\n  avx512: boolean\n  // ARM SIMD extensions\n  neon: boolean\n  sve: boolean\n  sve2: boolean\n  // CPU info\n  cpuModel: string | null\n  architecture: 'x86_64' | 'arm64' | 'unknown'\n}\n\nexport type HWAccelInfo = {\n  available: HWAccelerator[]\n  recommended: HWAccelerator\n  platform: 'darwin' | 'win32' | 'linux'\n  gpuVendor: string | null\n  gpuModel: string | null\n  cpuCapabilities: CPUSIMDCapabilities | null\n}\n\n/**\n * Detect available hardware acceleration options based on platform and GPU\n */\nexport async function detectHWAccelerators(ffmpegPath: string): Promise<HWAccelInfo> {\n  const platform = os.platform() as 'darwin' | 'win32' | 'linux'\n  const available: HWAccelerator[] = ['none'] // Software encoding is always available\n  let gpuVendor: string | null = null\n  let gpuModel: string | null = null\n\n  try {\n    // Query FFmpeg for available hardware encoders\n    const { stdout } = await execFileAsync(ffmpegPath, ['-hide_banner', '-encoders'], {\n      timeout: 10000\n    })\n\n    const encoderList = stdout.toLowerCase()\n\n    // Platform-specific detection\n    if (platform === 'darwin') {\n      // Apple VideoToolbox\n      if (encoderList.includes('h264_videotoolbox') || encoderList.includes('hevc_videotoolbox')) {\n        available.push('videotoolbox')\n        gpuVendor = 'Apple'\n        gpuModel = await detectMacGPU()\n      }\n    } else if (platform === 'win32' || platform === 'linux') {\n      // NVIDIA NVENC\n      if (encoderList.includes('h264_nvenc') || encoderList.includes('hevc_nvenc')) {\n        available.push('nvenc')\n        gpuVendor = 'NVIDIA'\n        gpuModel = await detectNvidiaGPU()\n      }\n\n      // AMD AMF (Windows only typically)\n      if (encoderList.includes('h264_amf') || encoderList.includes('hevc_amf')) {\n        available.push('amf')\n        if (!gpuVendor) {\n          gpuVendor = 'AMD'\n          gpuModel = await detectAMDGPU()\n        }\n      }\n\n      // Intel QuickSync\n      if (encoderList.includes('h264_qsv') || encoderList.includes('hevc_qsv')) {\n        available.push('qsv')\n        if (!gpuVendor) {\n          gpuVendor = 'Intel'\n        }\n      }\n    }\n  } catch (error) {\n    // If detection fails, just return software-only\n    console.warn('HW acceleration detection failed:', error)\n  }\n\n  // Determine recommended accelerator\n  const recommended = getRecommendedAccelerator(available, platform)\n\n  // Detect CPU SIMD capabilities\n  const cpuCapabilities = await detectCPUSIMDCapabilities()\n\n  return {\n    available,\n    recommended,\n    platform,\n    gpuVendor,\n    gpuModel,\n    cpuCapabilities\n  }\n}\n\n/**\n * Get the recommended accelerator based on what's available\n */\nfunction getRecommendedAccelerator(\n  available: HWAccelerator[],\n  platform: 'darwin' | 'win32' | 'linux'\n): HWAccelerator {\n  // Prefer platform-native acceleration\n  if (platform === 'darwin' && available.includes('videotoolbox')) {\n    return 'videotoolbox'\n  }\n\n  // NVENC is generally the best quality HW encoder\n  if (available.includes('nvenc')) {\n    return 'nvenc'\n  }\n\n  // AMD AMF is good on Windows\n  if (available.includes('amf')) {\n    return 'amf'\n  }\n\n  // QuickSync is decent for quick encodes\n  if (available.includes('qsv')) {\n    return 'qsv'\n  }\n\n  // Fall back to software\n  return 'none'\n}\n\n/**\n * Detect Mac GPU model (Apple Silicon or AMD)\n */\nasync function detectMacGPU(): Promise<string | null> {\n  try {\n    const { stdout } = await execFileAsync('system_profiler', ['SPDisplaysDataType', '-json'], {\n      timeout: 5000\n    })\n    const data = JSON.parse(stdout)\n    const displays = data.SPDisplaysDataType\n    if (displays && displays.length > 0) {\n      return displays[0].sppci_model || displays[0]._name || null\n    }\n  } catch {\n    // Ignore errors\n  }\n  return null\n}\n\n/**\n * Detect NVIDIA GPU model\n */\nasync function detectNvidiaGPU(): Promise<string | null> {\n  try {\n    const { stdout } = await execFileAsync('nvidia-smi', ['--query-gpu=name', '--format=csv,noheader'], {\n      timeout: 5000\n    })\n    return stdout.trim().split('\\n')[0] || null\n  } catch {\n    // nvidia-smi not available\n  }\n  return null\n}\n\n/**\n * Detect AMD GPU model (Windows)\n */\nasync function detectAMDGPU(): Promise<string | null> {\n  if (os.platform() !== 'win32') return null\n\n  try {\n    // Use WMIC on Windows\n    const { stdout } = await execFileAsync('wmic', ['path', 'win32_VideoController', 'get', 'name'], {\n      timeout: 5000\n    })\n    const lines = stdout.trim().split('\\n').filter(l => l.trim() && !l.includes('Name'))\n    const amdGpu = lines.find(l => l.toLowerCase().includes('amd') || l.toLowerCase().includes('radeon'))\n    return amdGpu?.trim() || null\n  } catch {\n    // WMIC not available\n  }\n  return null\n}\n\n/**\n * Detect CPU SIMD capabilities (SSE, AVX, AVX-512)\n */\nexport async function detectCPUSIMDCapabilities(): Promise<CPUSIMDCapabilities | null> {\n  const platform = os.platform()\n\n  const capabilities: CPUSIMDCapabilities = {\n    // x86\n    sse: false,\n    sse2: false,\n    sse3: false,\n    ssse3: false,\n    sse41: false,\n    sse42: false,\n    avx: false,\n    avx2: false,\n    avx512: false,\n    // ARM\n    neon: false,\n    sve: false,\n    sve2: false,\n    // Info\n    cpuModel: null,\n    architecture: 'unknown'\n  }\n\n  try {\n    if (platform === 'win32') {\n      await detectWindowsCPUCapabilities(capabilities)\n    } else if (platform === 'linux') {\n      await detectLinuxCPUCapabilities(capabilities)\n    } else if (platform === 'darwin') {\n      await detectMacOSCPUCapabilities(capabilities)\n    }\n  } catch (error) {\n    console.warn('CPU SIMD detection failed:', error)\n    return null\n  }\n\n  return capabilities\n}\n\n/**\n * Detect CPU capabilities on Windows\n */\nasync function detectWindowsCPUCapabilities(capabilities: CPUSIMDCapabilities): Promise<void> {\n  // Get CPU name via WMIC\n  try {\n    const { stdout: cpuName } = await execFileAsync('wmic', ['cpu', 'get', 'name'], {\n      timeout: 5000\n    })\n    const lines = cpuName.trim().split('\\n').filter(l => l.trim() && !l.includes('Name'))\n    capabilities.cpuModel = lines[0]?.trim() || null\n  } catch {\n    // Ignore - will try PowerShell fallback\n  }\n\n  // Use PowerShell for more detailed detection\n  try {\n    const { stdout: psOutput } = await execFileAsync('powershell', [\n      '-NoProfile',\n      '-Command',\n      `\n      $cpu = Get-CimInstance -ClassName Win32_Processor\n      $procName = $cpu.Name.ToLower()\n\n      # Conservative heuristics for AVX-512 capable CPUs\n      # Intel: Only specific generations have AVX-512 enabled\n      #   - Ice Lake (10th gen mobile): i[3579]-10xxGx patterns\n      #   - Tiger Lake (11th gen mobile): i[3579]-11xxGx patterns\n      #   - Rocket Lake (11th gen desktop): i[3579]-11xxx (non-G suffix)\n      #   - Xeon Scalable (various gens), Xeon W\n      # Note: Intel 12th+ gen (Alder Lake, Raptor Lake) had AVX-512 disabled via microcode\n      # AMD: Zen 4+ (Ryzen 7000/8000/9000 series, EPYC Genoa)\n\n      $hasAVX512 = $false\n\n      # Intel 10th gen mobile (Ice Lake) - pattern: i7-1065G7, i5-1035G1, etc.\n      if ($procName -match 'i[3579]-10[0-9]{2}g') { $hasAVX512 = $true }\n\n      # Intel 11th gen (Tiger Lake mobile + Rocket Lake desktop)\n      if ($procName -match 'i[3579]-11[0-9]{2,3}') { $hasAVX512 = $true }\n\n      # Intel Xeon W series (various generations with AVX-512)\n      if ($procName -match 'xeon.*w-[0-9]{4,5}') { $hasAVX512 = $true }\n\n      # Intel Xeon Scalable (Gold, Platinum, Silver, Bronze)\n      if ($procName -match 'xeon.*(gold|platinum|silver|bronze)') { $hasAVX512 = $true }\n\n      # Intel Xeon with 4-5 digit model numbers (Scalable, etc.)\n      if ($procName -match 'xeon.*[0-9]{4,5}' -and $procName -notmatch 'e[357]-') { $hasAVX512 = $true }\n\n      # AMD Ryzen 7000 series (Zen 4) - pattern: Ryzen 5 7600, Ryzen 9 7950X, etc.\n      if ($procName -match 'ryzen.*[3579].*7[0-9]{3}') { $hasAVX512 = $true }\n\n      # AMD Ryzen 8000 series (Zen 4 APUs, e.g., 8700G)\n      if ($procName -match 'ryzen.*[3579].*8[0-9]{3}') { $hasAVX512 = $true }\n\n      # AMD Ryzen 9000 series (Zen 5)\n      if ($procName -match 'ryzen.*[3579].*9[0-9]{3}') { $hasAVX512 = $true }\n\n      # AMD Ryzen AI 300 series (Strix Point, Zen 5)\n      if ($procName -match 'ryzen.*ai.*3[0-9]{2}') { $hasAVX512 = $true }\n\n      # AMD EPYC 9000 series (Genoa, Zen 4)\n      if ($procName -match 'epyc.*9[0-9]{3}') { $hasAVX512 = $true }\n\n      # AMD EPYC 8000 series (Siena, Zen 4c)\n      if ($procName -match 'epyc.*8[0-9]{3}') { $hasAVX512 = $true }\n\n      Write-Output \"MODEL:$($cpu.Name)\"\n      Write-Output \"AVX512:$hasAVX512\"\n      `\n    ], { timeout: 10000 })\n\n    // Parse output\n    const modelMatch = psOutput.match(/MODEL:(.+)/i)\n    if (modelMatch && !capabilities.cpuModel) {\n      capabilities.cpuModel = modelMatch[1].trim()\n    }\n\n    if (psOutput.toLowerCase().includes('avx512:true')) {\n      capabilities.avx512 = true\n    }\n  } catch {\n    // PowerShell detection failed - continue with baseline assumptions\n    console.warn('PowerShell CPU detection failed, using baseline assumptions')\n  }\n\n  // Set architecture - Windows on ARM is rare but possible\n  const arch = os.arch()\n  if (arch === 'arm64') {\n    capabilities.architecture = 'arm64'\n    capabilities.neon = true // All ARM64 has NEON\n    // Windows on ARM doesn't expose SVE detection easily\n    // Reset x86 flags\n    capabilities.sse = false\n    capabilities.sse2 = false\n    capabilities.sse3 = false\n    capabilities.ssse3 = false\n    capabilities.sse41 = false\n    capabilities.sse42 = false\n    capabilities.avx = false\n    capabilities.avx2 = false\n    capabilities.avx512 = false\n  } else {\n    capabilities.architecture = 'x86_64'\n    // Modern x86-64 CPUs (2013+) have at least AVX2\n    // Set baseline capabilities for any modern CPU\n    capabilities.sse = true\n    capabilities.sse2 = true\n    capabilities.sse3 = true\n    capabilities.ssse3 = true\n    capabilities.sse41 = true\n    capabilities.sse42 = true\n    capabilities.avx = true\n    capabilities.avx2 = true\n  }\n}\n\n/**\n * Detect CPU capabilities on Linux by reading /proc/cpuinfo\n * Supports both x86_64 and ARM64 architectures\n */\nasync function detectLinuxCPUCapabilities(capabilities: CPUSIMDCapabilities): Promise<void> {\n  const { stdout } = await execFileAsync('cat', ['/proc/cpuinfo'], {\n    timeout: 5000\n  })\n\n  // Detect architecture\n  const arch = os.arch()\n  const isARM = arch === 'arm64' || arch === 'aarch64'\n\n  if (isARM) {\n    capabilities.architecture = 'arm64'\n\n    // ARM: Extract CPU model from \"CPU part\" or \"model name\" or \"Hardware\"\n    const modelMatch = stdout.match(/model name\\s*:\\s*(.+)/i) ||\n                       stdout.match(/Hardware\\s*:\\s*(.+)/i) ||\n                       stdout.match(/CPU implementer\\s*:\\s*(.+)/i)\n    capabilities.cpuModel = modelMatch ? modelMatch[1].trim() : null\n\n    // ARM: Look for Features line (different from x86 flags)\n    const featuresMatch = stdout.match(/^Features\\s*:\\s*(.+)$/im)\n    if (featuresMatch) {\n      const features = ` ${featuresMatch[1].toLowerCase()} `\n\n      // NEON/ASIMD is standard on all ARM64\n      capabilities.neon = / asimd /.test(features) || / neon /.test(features)\n      if (!capabilities.neon) {\n        // All ARM64 Linux systems have NEON, it might just not be listed\n        capabilities.neon = true\n      }\n\n      // SVE (Scalable Vector Extension) - ARM's answer to AVX-512\n      // Used in: Graviton3, A64FX, Neoverse V1\n      capabilities.sve = / sve /.test(features)\n\n      // SVE2 - Enhanced SVE, used in: Graviton4, Neoverse V2/N2, Google Axion\n      capabilities.sve2 = / sve2 /.test(features)\n    } else {\n      // If no Features line, assume basic NEON\n      capabilities.neon = true\n    }\n\n    // Try to get more specific CPU info for ARM\n    if (!capabilities.cpuModel) {\n      try {\n        const { stdout: lscpuOut } = await execFileAsync('lscpu', [], { timeout: 3000 })\n        const modelNameMatch = lscpuOut.match(/Model name:\\s*(.+)/i)\n        if (modelNameMatch) {\n          capabilities.cpuModel = modelNameMatch[1].trim()\n        }\n      } catch {\n        // lscpu not available\n      }\n    }\n  } else {\n    // x86_64 detection\n    capabilities.architecture = 'x86_64'\n\n    // Extract CPU model\n    const modelMatch = stdout.match(/model name\\s*:\\s*(.+)/i)\n    capabilities.cpuModel = modelMatch ? modelMatch[1].trim() : null\n\n    // Extract flags line - more reliable than searching whole output\n    const flagsMatch = stdout.match(/^flags\\s*:\\s*(.+)$/im)\n    if (flagsMatch) {\n      const flags = ` ${flagsMatch[1].toLowerCase()} ` // Pad with spaces for word boundary matching\n\n      // Check for SIMD flags using word boundaries\n      capabilities.sse = / sse /.test(flags)\n      capabilities.sse2 = / sse2 /.test(flags)\n      capabilities.sse3 = / sse3 /.test(flags) || / pni /.test(flags)\n      capabilities.ssse3 = / ssse3 /.test(flags)\n      capabilities.sse41 = / sse4_1 /.test(flags)\n      capabilities.sse42 = / sse4_2 /.test(flags)\n      capabilities.avx = / avx /.test(flags)\n      capabilities.avx2 = / avx2 /.test(flags)\n\n      // AVX-512 has multiple feature flags - check for any of them\n      capabilities.avx512 = /avx512/.test(flags)\n    }\n  }\n}\n\n/**\n * Detect CPU capabilities on macOS using sysctl\n */\nasync function detectMacOSCPUCapabilities(capabilities: CPUSIMDCapabilities): Promise<void> {\n  // First check if this is Apple Silicon\n  try {\n    const { stdout: archOutput } = await execFileAsync('uname', ['-m'], { timeout: 2000 })\n    const isAppleSilicon = archOutput.trim().toLowerCase() === 'arm64'\n\n    if (isAppleSilicon) {\n      capabilities.architecture = 'arm64'\n\n      // Apple Silicon - get CPU brand\n      try {\n        const { stdout: brandOutput } = await execFileAsync(\n          'sysctl',\n          ['-n', 'machdep.cpu.brand_string'],\n          { timeout: 2000 }\n        )\n        capabilities.cpuModel = brandOutput.trim() || 'Apple Silicon'\n      } catch {\n        // brand_string might not work on Apple Silicon, try chip info\n        try {\n          const { stdout: chipOutput } = await execFileAsync(\n            'sysctl',\n            ['-n', 'hw.chip'],\n            { timeout: 2000 }\n          )\n          capabilities.cpuModel = chipOutput.trim() || 'Apple Silicon'\n        } catch {\n          capabilities.cpuModel = 'Apple Silicon'\n        }\n      }\n\n      // Apple Silicon uses NEON (ARM SIMD)\n      // Note: Apple Silicon does NOT support SVE - it uses Apple's custom AMX instead\n      capabilities.neon = true\n      capabilities.sve = false\n      capabilities.sve2 = false\n\n      // All x86 SIMD capabilities remain false\n      return\n    }\n  } catch {\n    // If uname fails, continue with Intel detection\n  }\n\n  // Intel Mac - use sysctl to get CPU features\n  capabilities.architecture = 'x86_64'\n\n  try {\n    const { stdout: brandOutput } = await execFileAsync(\n      'sysctl',\n      ['-n', 'machdep.cpu.brand_string'],\n      { timeout: 2000 }\n    )\n    capabilities.cpuModel = brandOutput.trim()\n  } catch {\n    // Ignore - we'll try to get features anyway\n  }\n\n  // Get CPU features\n  try {\n    const { stdout: featuresOutput } = await execFileAsync(\n      'sysctl',\n      ['-n', 'machdep.cpu.features'],\n      { timeout: 2000 }\n    )\n    const features = ` ${featuresOutput.toLowerCase()} `\n\n    capabilities.sse = features.includes('sse')\n    capabilities.sse2 = features.includes('sse2')\n    capabilities.sse3 = features.includes('sse3')\n    capabilities.ssse3 = features.includes('ssse3') || features.includes('supplementalsse3')\n    capabilities.sse41 = features.includes('sse4.1')\n    capabilities.sse42 = features.includes('sse4.2')\n    capabilities.avx = features.includes('avx1.0') || / avx /.test(features)\n  } catch {\n    // No features available\n  }\n\n  // Get leaf7 features (AVX2, AVX-512)\n  try {\n    const { stdout: leaf7Output } = await execFileAsync(\n      'sysctl',\n      ['-n', 'machdep.cpu.leaf7_features'],\n      { timeout: 2000 }\n    )\n    const leaf7 = leaf7Output.toLowerCase()\n\n    capabilities.avx2 = leaf7.includes('avx2')\n    capabilities.avx512 = leaf7.includes('avx512')\n  } catch {\n    // leaf7 not available on older CPUs\n  }\n}\n\n/**\n * Check if FFmpeg's x265 encoder supports AVX-512\n */\nexport async function checkX265AVX512Support(ffmpegPath: string): Promise<boolean> {\n  try {\n    const { stderr } = await execFileAsync(\n      ffmpegPath,\n      ['-hide_banner', '-f', 'lavfi', '-i', 'nullsrc=s=64x64:d=0.1', '-c:v', 'libx265', '-f', 'null', '-'],\n      { timeout: 15000 }\n    )\n\n    // x265 logs detected CPU capabilities to stderr\n    const output = stderr.toLowerCase()\n    return output.includes('avx512') || output.includes('avx-512')\n  } catch (error) {\n    // Check if the error output contains the info we need\n    const errorOutput = (error as { stderr?: string })?.stderr?.toLowerCase() || ''\n    return errorOutput.includes('avx512') || errorOutput.includes('avx-512')\n  }\n}\n\n/**\n * Test if a specific hardware encoder works\n */\nexport async function testHWEncoder(\n  ffmpegPath: string,\n  encoder: string\n): Promise<boolean> {\n  try {\n    // Try to initialize the encoder with a null input\n    await execFileAsync(\n      ffmpegPath,\n      [\n        '-hide_banner',\n        '-f', 'lavfi',\n        '-i', 'nullsrc=s=256x256:d=0.1',\n        '-c:v', encoder,\n        '-f', 'null',\n        '-'\n      ],\n      { timeout: 10000 }\n    )\n    return true\n  } catch {\n    return false\n  }\n}\n\n/**\n * Get encoder name for a codec and accelerator combination\n */\nexport function getEncoderName(\n  codec: 'h264' | 'h265' | 'av1' | 'vp9' | 'prores',\n  hwAccel: HWAccelerator\n): string {\n  if (hwAccel === 'none') {\n    switch (codec) {\n      case 'h264': return 'libx264'\n      case 'h265': return 'libx265'\n      case 'av1': return 'libaom-av1'\n      case 'vp9': return 'libvpx-vp9'\n      case 'prores': return 'prores_ks'\n      default: return 'libx264'\n    }\n  }\n\n  if (hwAccel === 'videotoolbox') {\n    switch (codec) {\n      case 'h264': return 'h264_videotoolbox'\n      case 'h265': return 'hevc_videotoolbox'\n      case 'prores': return 'prores_videotoolbox'\n      default: return 'h264_videotoolbox'\n    }\n  }\n\n  if (hwAccel === 'nvenc') {\n    switch (codec) {\n      case 'h264': return 'h264_nvenc'\n      case 'h265': return 'hevc_nvenc'\n      case 'av1': return 'av1_nvenc'\n      default: return 'h264_nvenc'\n    }\n  }\n\n  if (hwAccel === 'amf') {\n    switch (codec) {\n      case 'h264': return 'h264_amf'\n      case 'h265': return 'hevc_amf'\n      default: return 'h264_amf'\n    }\n  }\n\n  if (hwAccel === 'qsv') {\n    switch (codec) {\n      case 'h264': return 'h264_qsv'\n      case 'h265': return 'hevc_qsv'\n      case 'av1': return 'av1_qsv'\n      case 'vp9': return 'vp9_qsv'\n      default: return 'h264_qsv'\n    }\n  }\n\n  // Fallback\n  return 'libx264'\n}\n", "/**\n * Terminal UI Components\n * Friendly, visual interface for terminal-averse users\n */\n\n// ANSI escape codes\nconst ESC = '\\x1b['\nconst HIDE_CURSOR = `${ESC}?25l`\nconst SHOW_CURSOR = `${ESC}?25h`\nconst CLEAR_SCREEN = `${ESC}2J${ESC}H`\nconst MOVE_TO = (row: number, col: number) => `${ESC}${row};${col}H`\nconst CLEAR_LINE = `${ESC}2K`\n\n// Colors\nexport const style = {\n  reset: `${ESC}0m`,\n  bold: `${ESC}1m`,\n  dim: `${ESC}2m`,\n  // Colors\n  green: `${ESC}38;5;114m`,\n  blue: `${ESC}38;5;75m`,\n  cyan: `${ESC}38;5;80m`,\n  yellow: `${ESC}38;5;221m`,\n  red: `${ESC}38;5;203m`,\n  gray: `${ESC}38;5;245m`,\n  white: `${ESC}38;5;255m`,\n  // Backgrounds\n  bgDark: `${ESC}48;5;236m`,\n  bgGreen: `${ESC}48;5;114m`,\n  bgBlue: `${ESC}48;5;75m`\n}\n\n// Box drawing characters\nconst box = {\n  topLeft: '\u256D',\n  topRight: '\u256E',\n  bottomLeft: '\u2570',\n  bottomRight: '\u256F',\n  horizontal: '\u2500',\n  vertical: '\u2502',\n  teeRight: '\u251C',\n  teeLeft: '\u2524'\n}\n\n// Progress bar characters\nconst progressChars = {\n  filled: '\u2588',\n  partial: ['', '\u258F', '\u258E', '\u258D', '\u258C', '\u258B', '\u258A', '\u2589'],\n  empty: '\u2591'\n}\n\nexport interface TUIState {\n  title: string\n  subtitle?: string\n  currentFile: string\n  currentFileIndex: number\n  totalFiles: number\n  fileProgress: number\n  batchProgress: number\n  speed: string\n  fileEta: string\n  batchEta: string\n  completed: number\n  skipped: number\n  failed: number\n  savedBytes: number\n  status: 'idle' | 'scanning' | 'encoding' | 'analyzing' | 'complete' | 'error'\n  statusMessage?: string\n  codec: string\n  preset: string\n}\n\nexport class TUI {\n  private state: TUIState\n  private width: number\n  private lastRender = 0\n  private renderThrottle = 50 // ms\n  private isRendering = false\n  private resizeHandler: (() => void) | null = null\n  private cleanupBound: (() => void) | null = null\n\n  constructor() {\n    this.width = Math.min(process.stdout.columns || 60, 70)\n    this.state = {\n      title: 'Drapp Archive',\n      currentFile: '',\n      currentFileIndex: 0,\n      totalFiles: 0,\n      fileProgress: 0,\n      batchProgress: 0,\n      speed: '--',\n      fileEta: '--',\n      batchEta: '--',\n      completed: 0,\n      skipped: 0,\n      failed: 0,\n      savedBytes: 0,\n      status: 'idle',\n      codec: 'AV1',\n      preset: 'archive'\n    }\n  }\n\n  private formatBytes(bytes: number): string {\n    if (bytes < 1024) return `${bytes} B`\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(2)} GB`\n  }\n\n  private truncate(str: string, maxLen: number): string {\n    if (str.length <= maxLen) return str\n    return '...' + str.slice(-(maxLen - 3))\n  }\n\n  private progressBar(percent: number, width: number): string {\n    const filledWidth = (percent / 100) * width\n    const fullBlocks = Math.floor(filledWidth)\n    const partialIndex = Math.floor((filledWidth - fullBlocks) * 8)\n    const emptyBlocks = width - fullBlocks - (partialIndex > 0 ? 1 : 0)\n\n    return (\n      `${style.green}${progressChars.filled.repeat(fullBlocks)}` +\n      `${partialIndex > 0 ? progressChars.partial[partialIndex] : ''}` +\n      `${style.gray}${progressChars.empty.repeat(Math.max(0, emptyBlocks))}${style.reset}`\n    )\n  }\n\n  private boxTop(width: number): string {\n    return `${style.cyan}${box.topLeft}${box.horizontal.repeat(width - 2)}${box.topRight}${style.reset}`\n  }\n\n  private boxBottom(width: number): string {\n    return `${style.cyan}${box.bottomLeft}${box.horizontal.repeat(width - 2)}${box.bottomRight}${style.reset}`\n  }\n\n  private boxLine(content: string, width: number): string {\n    const visibleLen = this.visibleLength(content)\n    const padding = Math.max(0, width - 4 - visibleLen)\n    return `${style.cyan}${box.vertical}${style.reset} ${content}${' '.repeat(padding)} ${style.cyan}${box.vertical}${style.reset}`\n  }\n\n  private boxDivider(width: number): string {\n    return `${style.cyan}${box.teeRight}${box.horizontal.repeat(width - 2)}${box.teeLeft}${style.reset}`\n  }\n\n  private visibleLength(str: string): number {\n    // Remove ANSI escape codes to get visible length\n    return str.replace(/\\x1b\\[[0-9;]*m/g, '').length\n  }\n\n  private centerText(text: string, width: number): string {\n    const visibleLen = this.visibleLength(text)\n    const padding = Math.max(0, Math.floor((width - 4 - visibleLen) / 2))\n    return ' '.repeat(padding) + text\n  }\n\n  private getStatusIcon(): string {\n    switch (this.state.status) {\n      case 'scanning': return `${style.blue}\u25C9${style.reset}`\n      case 'analyzing': return `${style.yellow}\u25C9${style.reset}`\n      case 'encoding': return `${style.green}\u25C9${style.reset}`\n      case 'complete': return `${style.green}\u2713${style.reset}`\n      case 'error': return `${style.red}\u2717${style.reset}`\n      default: return `${style.gray}\u25CB${style.reset}`\n    }\n  }\n\n  private getStatusText(): string {\n    switch (this.state.status) {\n      case 'scanning': return `${style.blue}Scanning for videos...${style.reset}`\n      case 'analyzing': return `${style.yellow}Analyzing video...${style.reset}`\n      case 'encoding': return `${style.green}Encoding${style.reset}`\n      case 'complete': return `${style.green}${style.bold}All done!${style.reset}`\n      case 'error': return `${style.red}Error occurred${style.reset}`\n      default: return `${style.gray}Ready${style.reset}`\n    }\n  }\n\n  render(): void {\n    // Throttle rendering\n    const now = Date.now()\n    if (now - this.lastRender < this.renderThrottle) return\n    if (this.isRendering) return\n    this.isRendering = true\n    this.lastRender = now\n\n    const w = this.width\n    const lines: string[] = []\n\n    // Header\n    lines.push('')\n    lines.push(this.boxTop(w))\n\n    // Title with codec badge\n    const badge = `${style.bgBlue}${style.white}${style.bold} ${this.state.codec} ${style.reset}`\n    const title = `${style.bold}${style.white}${this.state.title}${style.reset}`\n    lines.push(this.boxLine(`${title}  ${badge}`, w))\n\n    if (this.state.subtitle) {\n      lines.push(this.boxLine(`${style.dim}${this.state.subtitle}${style.reset}`, w))\n    }\n\n    lines.push(this.boxDivider(w))\n\n    // Status\n    lines.push(this.boxLine(`${this.getStatusIcon()} ${this.getStatusText()}`, w))\n\n    if (this.state.status === 'encoding' || this.state.status === 'analyzing') {\n      lines.push(this.boxLine('', w))\n\n      // Current file\n      const fileNum = `[${this.state.currentFileIndex}/${this.state.totalFiles}]`\n      const fileName = this.truncate(this.state.currentFile, w - 20)\n      lines.push(this.boxLine(`${style.dim}File:${style.reset} ${fileName} ${style.gray}${fileNum}${style.reset}`, w))\n\n      // File progress bar\n      const barWidth = w - 24\n      const fileBar = this.progressBar(this.state.fileProgress, barWidth)\n      const filePct = `${this.state.fileProgress.toString().padStart(3)}%`\n      lines.push(this.boxLine(`     ${fileBar} ${filePct}`, w))\n\n      // Speed and ETA\n      lines.push(this.boxLine(\n        `     ${style.dim}Speed:${style.reset} ${this.state.speed}  ${style.dim}ETA:${style.reset} ${this.state.fileEta}`,\n        w\n      ))\n\n      lines.push(this.boxLine('', w))\n\n      // Batch progress\n      lines.push(this.boxLine(`${style.dim}Overall Progress${style.reset}`, w))\n      const batchBar = this.progressBar(this.state.batchProgress, barWidth)\n      const batchPct = `${this.state.batchProgress.toString().padStart(3)}%`\n      lines.push(this.boxLine(`     ${batchBar} ${batchPct}`, w))\n      lines.push(this.boxLine(`     ${style.dim}Remaining:${style.reset} ${this.state.batchEta}`, w))\n    }\n\n    lines.push(this.boxDivider(w))\n\n    // Stats row\n    const statsLine =\n      `${style.green}\u2713 ${this.state.completed}${style.reset}  ` +\n      `${style.yellow}\u25CB ${this.state.skipped}${style.reset}  ` +\n      `${style.red}\u2717 ${this.state.failed}${style.reset}  ` +\n      `${style.dim}\u2502${style.reset}  ` +\n      `${style.cyan}Saved: ${this.formatBytes(this.state.savedBytes)}${style.reset}`\n    lines.push(this.boxLine(statsLine, w))\n\n    lines.push(this.boxBottom(w))\n    lines.push('')\n\n    // Render\n    process.stdout.write(HIDE_CURSOR)\n    process.stdout.write(MOVE_TO(1, 1))\n    for (const line of lines) {\n      process.stdout.write(CLEAR_LINE + line + '\\n')\n    }\n\n    this.isRendering = false\n  }\n\n  update(partial: Partial<TUIState>): void {\n    this.state = { ...this.state, ...partial }\n    this.render()\n  }\n\n  start(): void {\n    process.stdout.write(CLEAR_SCREEN)\n    process.stdout.write(HIDE_CURSOR)\n    this.render()\n\n    // Handle terminal resize\n    this.resizeHandler = () => {\n      this.width = Math.min(process.stdout.columns || 60, 70)\n      process.stdout.write(CLEAR_SCREEN)\n      this.render()\n    }\n    process.stdout.on('resize', this.resizeHandler)\n\n    // Handle Ctrl+C and other exit signals to restore cursor\n    this.cleanupBound = () => this.cleanup()\n    process.on('SIGINT', this.cleanupBound)\n    process.on('SIGTERM', this.cleanupBound)\n    process.on('exit', this.cleanupBound)\n  }\n\n  private cleanup(): void {\n    // Restore cursor - this is idempotent so safe to call multiple times\n    process.stdout.write(SHOW_CURSOR)\n  }\n\n  stop(): void {\n    // Restore cursor\n    this.cleanup()\n\n    // Remove event listeners to prevent memory leaks\n    if (this.resizeHandler) {\n      process.stdout.removeListener('resize', this.resizeHandler)\n      this.resizeHandler = null\n    }\n\n    if (this.cleanupBound) {\n      process.removeListener('SIGINT', this.cleanupBound)\n      process.removeListener('SIGTERM', this.cleanupBound)\n      process.removeListener('exit', this.cleanupBound)\n      this.cleanupBound = null\n    }\n  }\n\n  // Print a message below the TUI\n  log(message: string): void {\n    // Move below the TUI and print\n    console.log(message)\n  }\n}\n\n/**\n * Simple welcome banner for non-TUI mode\n */\nexport function printWelcome(codec: string, preset: string): void {\n  console.log(`\n${style.cyan}\u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.bold}${style.white}Drapp Archive${style.reset}                         ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.dim}Video encoding made simple${style.reset}              ${style.cyan}\u2502${style.reset}\n${style.cyan}\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524${style.reset}\n${style.cyan}\u2502${style.reset}  Codec: ${style.green}${codec.toUpperCase().padEnd(8)}${style.reset}  Preset: ${style.green}${preset.padEnd(8)}${style.reset}  ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F${style.reset}\n`)\n}\n\n/**\n * Print a friendly error message\n */\nexport function printError(message: string, hint?: string): void {\n  console.log(`\n${style.red}\u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E${style.reset}\n${style.red}\u2502${style.reset}  ${style.red}${style.bold}Oops! Something went wrong${style.reset}              ${style.red}\u2502${style.reset}\n${style.red}\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524${style.reset}\n${style.red}\u2502${style.reset}  ${message.slice(0, 40).padEnd(40)} ${style.red}\u2502${style.reset}\n${hint ? `${style.red}\u2502${style.reset}  ${style.dim}${hint.slice(0, 40).padEnd(40)}${style.reset} ${style.red}\u2502${style.reset}\\n` : ''}${style.red}\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F${style.reset}\n`)\n}\n\n/**\n * Print completion summary\n */\nexport function printSummary(completed: number, skipped: number, failed: number, savedBytes: number): void {\n  const formatBytes = (bytes: number): string => {\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(2)} GB`\n  }\n\n  const total = completed + skipped + failed\n  const successRate = total > 0 ? Math.round((completed / total) * 100) : 0\n\n  console.log(`\n${style.green}\u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E${style.reset}\n${style.green}\u2502${style.reset}  ${style.green}${style.bold}\u2713 Encoding Complete!${style.reset}                    ${style.green}\u2502${style.reset}\n${style.green}\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524${style.reset}\n${style.green}\u2502${style.reset}  ${style.green}Completed:${style.reset}  ${completed.toString().padEnd(6)}  ${style.dim}(${successRate}% success)${style.reset}     ${style.green}\u2502${style.reset}\n${style.green}\u2502${style.reset}  ${style.yellow}Skipped:${style.reset}    ${skipped.toString().padEnd(6)}                      ${style.green}\u2502${style.reset}\n${style.green}\u2502${style.reset}  ${style.red}Failed:${style.reset}     ${failed.toString().padEnd(6)}                      ${style.green}\u2502${style.reset}\n${style.green}\u251C\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524${style.reset}\n${style.green}\u2502${style.reset}  ${style.cyan}Space Saved:${style.reset} ${formatBytes(savedBytes).padEnd(27)} ${style.green}\u2502${style.reset}\n${style.green}\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F${style.reset}\n`)\n}\n", "/**\n * Interactive File Browser\n * Terminal-based file explorer for selecting videos\n * Features: multi-select, mouse support, keyboard navigation\n */\n\nimport { readdir, stat } from 'node:fs/promises'\nimport { join, dirname, basename, extname } from 'node:path'\nimport { homedir } from 'node:os'\nimport { createInterface } from 'node:readline'\nimport { style } from './tui.js'\n\n// Video extensions\nconst VIDEO_EXTENSIONS = new Set([\n  '.mp4', '.mkv', '.mov', '.webm', '.avi',\n  '.m4v', '.ts', '.mts', '.m2ts', '.flv', '.wmv'\n])\n\n// ANSI escape codes\nconst ESC = '\\x1b['\nconst CLEAR_SCREEN = `${ESC}2J${ESC}H`\nconst HIDE_CURSOR = `${ESC}?25l`\nconst SHOW_CURSOR = `${ESC}?25h`\nconst MOVE_TO = (row: number, col: number) => `${ESC}${row};${col}H`\nconst CLEAR_LINE = `${ESC}2K`\n\n// Mouse support escape codes\nconst ENABLE_MOUSE = '\\x1b[?1000h\\x1b[?1002h\\x1b[?1015h\\x1b[?1006h'\nconst DISABLE_MOUSE = '\\x1b[?1006l\\x1b[?1015l\\x1b[?1002l\\x1b[?1000l'\n\ninterface FileEntry {\n  name: string\n  path: string\n  isDirectory: boolean\n  isVideo: boolean\n  size?: number\n}\n\ninterface BrowserState {\n  currentPath: string\n  entries: FileEntry[]\n  selectedIndex: number\n  selectedFiles: Set<string>\n  scrollOffset: number\n  mode: 'browse' | 'select-input' | 'select-output'\n  message?: string\n  lastSelectedIndex?: number // For range selection\n  listHeight: number\n  headerOffset: number // Row offset where file list starts\n}\n\nfunction formatSize(bytes: number): string {\n  if (bytes < 1024) return `${bytes} B`\n  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(0)} KB`\n  if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`\n  return `${(bytes / (1024 * 1024 * 1024)).toFixed(2)} GB`\n}\n\nasync function getEntries(dirPath: string): Promise<FileEntry[]> {\n  const entries: FileEntry[] = []\n\n  try {\n    const items = await readdir(dirPath, { withFileTypes: true })\n\n    // Add parent directory option (unless at root)\n    if (dirPath !== '/') {\n      entries.push({\n        name: '..',\n        path: dirname(dirPath),\n        isDirectory: true,\n        isVideo: false\n      })\n    }\n\n    // Sort: directories first, then files\n    const dirs: FileEntry[] = []\n    const files: FileEntry[] = []\n\n    for (const item of items) {\n      // Skip hidden files\n      if (item.name.startsWith('.')) continue\n\n      const fullPath = join(dirPath, item.name)\n\n      if (item.isDirectory()) {\n        dirs.push({\n          name: item.name,\n          path: fullPath,\n          isDirectory: true,\n          isVideo: false\n        })\n      } else {\n        const ext = extname(item.name).toLowerCase()\n        const isVideo = VIDEO_EXTENSIONS.has(ext)\n\n        try {\n          const stats = await stat(fullPath)\n          files.push({\n            name: item.name,\n            path: fullPath,\n            isDirectory: false,\n            isVideo,\n            size: stats.size\n          })\n        } catch {\n          // Skip files we can't stat\n        }\n      }\n    }\n\n    // Sort alphabetically\n    dirs.sort((a, b) => a.name.localeCompare(b.name))\n    files.sort((a, b) => a.name.localeCompare(b.name))\n\n    entries.push(...dirs, ...files)\n  } catch {\n    // If we can't read directory, just show parent\n    if (dirPath !== '/') {\n      entries.push({\n        name: '..',\n        path: dirname(dirPath),\n        isDirectory: true,\n        isVideo: false\n      })\n    }\n  }\n\n  return entries\n}\n\nfunction countVideos(entries: FileEntry[]): number {\n  return entries.filter(e => e.isVideo).length\n}\n\nfunction renderBrowser(state: BrowserState, height: number): void {\n  const width = Math.min(process.stdout.columns || 80, 100)\n  state.listHeight = height - 10 // Reserve space for header and footer\n  state.headerOffset = 6 // Row where file list starts (after header)\n\n  process.stdout.write(MOVE_TO(1, 1))\n\n  // Header\n  const modeText = state.mode === 'select-input'\n    ? 'Select Videos (multi-select enabled)'\n    : 'Select Output Folder'\n\n  console.log(CLEAR_LINE + `${style.cyan}\u256D${'\u2500'.repeat(width - 2)}\u256E${style.reset}`)\n  console.log(CLEAR_LINE + `${style.cyan}\u2502${style.reset} ${style.bold}${modeText}${style.reset}${' '.repeat(Math.max(0, width - 4 - modeText.length))} ${style.cyan}\u2502${style.reset}`)\n  console.log(CLEAR_LINE + `${style.cyan}\u251C${'\u2500'.repeat(width - 2)}\u2524${style.reset}`)\n\n  // Current path\n  const pathDisplay = state.currentPath.length > width - 10\n    ? '...' + state.currentPath.slice(-(width - 13))\n    : state.currentPath\n  console.log(CLEAR_LINE + `${style.cyan}\u2502${style.reset} ${style.dim}${pathDisplay}${style.reset}${' '.repeat(Math.max(0, width - 4 - pathDisplay.length))} ${style.cyan}\u2502${style.reset}`)\n  console.log(CLEAR_LINE + `${style.cyan}\u251C${'\u2500'.repeat(width - 2)}\u2524${style.reset}`)\n\n  // File list\n  const visibleEntries = state.entries.slice(state.scrollOffset, state.scrollOffset + state.listHeight)\n\n  for (let i = 0; i < state.listHeight; i++) {\n    const entry = visibleEntries[i]\n    const absoluteIndex = state.scrollOffset + i\n\n    if (entry) {\n      const isSelected = absoluteIndex === state.selectedIndex\n      const isChecked = state.selectedFiles.has(entry.path)\n\n      let icon = '  '\n      let nameStyle = ''\n\n      if (entry.isDirectory) {\n        icon = `${style.blue}\uD83D\uDCC1${style.reset}`\n        nameStyle = style.blue\n      } else if (entry.isVideo) {\n        icon = `${style.green}\uD83C\uDFAC${style.reset}`\n        nameStyle = style.green\n      } else {\n        icon = `${style.dim}\uD83D\uDCC4${style.reset}`\n        nameStyle = style.dim\n      }\n\n      const checkbox = state.mode === 'select-input'\n        ? (isChecked ? `${style.green}[\u2713]${style.reset} ` : `${style.dim}[ ]${style.reset} `)\n        : ''\n\n      const cursor = isSelected ? `${style.bgDark}` : ''\n      const cursorEnd = isSelected ? `${style.reset}` : ''\n\n      const sizeStr = entry.size ? ` ${style.dim}${formatSize(entry.size)}${style.reset}` : ''\n      const maxNameLen = width - 24 - (entry.size ? 10 : 0)\n      const displayName = entry.name.length > maxNameLen\n        ? entry.name.slice(0, maxNameLen - 3) + '...'\n        : entry.name\n\n      const line = `${cursor}${checkbox}${icon} ${nameStyle}${displayName}${style.reset}${sizeStr}${cursorEnd}`\n      const visibleLen = displayName.length + (entry.size ? formatSize(entry.size).length + 1 : 0) + 6 + (state.mode === 'select-input' ? 4 : 0)\n      const padding = Math.max(0, width - 4 - visibleLen)\n\n      console.log(CLEAR_LINE + `${style.cyan}\u2502${style.reset} ${line}${' '.repeat(padding)} ${style.cyan}\u2502${style.reset}`)\n    } else {\n      console.log(CLEAR_LINE + `${style.cyan}\u2502${style.reset}${' '.repeat(width - 2)}${style.cyan}\u2502${style.reset}`)\n    }\n  }\n\n  // Footer\n  console.log(CLEAR_LINE + `${style.cyan}\u251C${'\u2500'.repeat(width - 2)}\u2524${style.reset}`)\n\n  // Selection count and video count\n  if (state.mode === 'select-input') {\n    const videoCount = countVideos(state.entries)\n    const selectedCount = state.selectedFiles.size\n    const countText = selectedCount > 0\n      ? `${style.green}${selectedCount} selected${style.reset} \u2502 ${videoCount} videos in folder`\n      : `${videoCount} videos in folder`\n    console.log(CLEAR_LINE + `${style.cyan}\u2502${style.reset} ${countText}${' '.repeat(Math.max(0, width - 4 - countText.length + (selectedCount > 0 ? 11 : 0)))} ${style.cyan}\u2502${style.reset}`)\n  } else {\n    console.log(CLEAR_LINE + `${style.cyan}\u2502${style.reset}${' '.repeat(width - 2)}${style.cyan}\u2502${style.reset}`)\n  }\n\n  // Controls - show different controls based on mode\n  let controls: string\n  if (state.mode === 'select-input') {\n    controls = '\u2191\u2193 Navigate \u2502 Space Select \u2502 a All \u2502 c Next \u2502 q Cancel'\n  } else {\n    controls = '\u2191\u2193 Navigate \u2502 Enter Open \u2502 c Confirm \u2502 n New \u2502 q Cancel'\n  }\n\n  const controlsDisplay = controls.length > width - 4\n    ? controls.slice(0, width - 7) + '...'\n    : controls\n\n  console.log(CLEAR_LINE + `${style.cyan}\u2502${style.reset} ${style.dim}${controlsDisplay}${style.reset}${' '.repeat(Math.max(0, width - 4 - controlsDisplay.length))} ${style.cyan}\u2502${style.reset}`)\n  console.log(CLEAR_LINE + `${style.cyan}\u2570${'\u2500'.repeat(width - 2)}\u256F${style.reset}`)\n\n  // Message\n  if (state.message) {\n    console.log(CLEAR_LINE + `\\n${state.message}`)\n  } else {\n    console.log(CLEAR_LINE)\n  }\n}\n\nexport interface BrowserResult {\n  cancelled: boolean\n  paths: string[]\n}\n\nexport async function browseForInput(startPath?: string): Promise<BrowserResult> {\n  return browse(startPath || homedir(), 'select-input')\n}\n\nexport async function browseForOutput(startPath?: string): Promise<BrowserResult> {\n  return browse(startPath || homedir(), 'select-output')\n}\n\n// Parse mouse events from SGR format (\\x1b[<Cb;Cx;CyM or \\x1b[<Cb;Cx;Cym)\nfunction parseMouseEvent(data: string): { button: number; x: number; y: number; release: boolean } | null {\n  // SGR format: \\x1b[<button;x;yM (press) or \\x1b[<button;x;ym (release)\n  const sgrMatch = data.match(/\\x1b\\[<(\\d+);(\\d+);(\\d+)([Mm])/)\n  if (sgrMatch) {\n    return {\n      button: parseInt(sgrMatch[1], 10),\n      x: parseInt(sgrMatch[2], 10),\n      y: parseInt(sgrMatch[3], 10),\n      release: sgrMatch[4] === 'm'\n    }\n  }\n  return null\n}\n\nasync function browse(startPath: string, mode: 'select-input' | 'select-output'): Promise<BrowserResult> {\n  const height = process.stdout.rows || 24\n\n  const state: BrowserState = {\n    currentPath: startPath,\n    entries: await getEntries(startPath),\n    selectedIndex: 0,\n    selectedFiles: new Set(),\n    scrollOffset: 0,\n    mode,\n    message: undefined,\n    lastSelectedIndex: undefined,\n    listHeight: height - 10,\n    headerOffset: 6\n  }\n\n  // Setup terminal\n  process.stdout.write(CLEAR_SCREEN)\n  process.stdout.write(HIDE_CURSOR)\n  process.stdout.write(ENABLE_MOUSE)\n\n  // Enable raw mode for key input\n  if (process.stdin.isTTY) {\n    process.stdin.setRawMode(true)\n  }\n  process.stdin.resume()\n\n  return new Promise((resolve) => {\n    const cleanup = () => {\n      process.stdout.write(DISABLE_MOUSE)\n      process.stdout.write(SHOW_CURSOR)\n      if (process.stdin.isTTY) {\n        process.stdin.setRawMode(false)\n      }\n      process.stdin.removeListener('data', onKeypress)\n      process.stdin.pause()\n    }\n\n    const onKeypress = async (key: Buffer) => {\n      const keyStr = key.toString()\n      const listHeight = state.listHeight\n\n      // Check for mouse events first\n      const mouseEvent = parseMouseEvent(keyStr)\n      if (mouseEvent && !mouseEvent.release) {\n        const { button, y } = mouseEvent\n\n        // Calculate which entry was clicked\n        const clickedRow = y - state.headerOffset\n        if (clickedRow >= 0 && clickedRow < listHeight) {\n          const clickedIndex = state.scrollOffset + clickedRow\n\n          if (clickedIndex < state.entries.length) {\n            const entry = state.entries[clickedIndex]\n\n            if (button === 0) {\n              // Left click\n              if (entry.isDirectory && entry.name !== '..') {\n                // Navigate into directory\n                state.currentPath = entry.path\n                state.entries = await getEntries(entry.path)\n                state.selectedIndex = 0\n                state.scrollOffset = 0\n              } else if (entry.isDirectory && entry.name === '..') {\n                // Go to parent\n                state.currentPath = entry.path\n                state.entries = await getEntries(entry.path)\n                state.selectedIndex = 0\n                state.scrollOffset = 0\n              } else if (mode === 'select-input' && entry.isVideo) {\n                // Toggle selection - only allow selecting video files\n                state.selectedIndex = clickedIndex\n                if (state.selectedFiles.has(entry.path)) {\n                  state.selectedFiles.delete(entry.path)\n                } else {\n                  state.selectedFiles.add(entry.path)\n                  state.lastSelectedIndex = clickedIndex\n                }\n              } else if (mode === 'select-input' && !entry.isVideo && !entry.isDirectory) {\n                // Clicked on non-video file - just move cursor, don't select\n                state.selectedIndex = clickedIndex\n              }\n            } else if (button === 64) {\n              // Scroll up (mouse wheel)\n              if (state.scrollOffset > 0) {\n                state.scrollOffset--\n                if (state.selectedIndex > state.scrollOffset + listHeight - 1) {\n                  state.selectedIndex = state.scrollOffset + listHeight - 1\n                }\n              }\n            } else if (button === 65) {\n              // Scroll down (mouse wheel)\n              const maxScroll = Math.max(0, state.entries.length - listHeight)\n              if (state.scrollOffset < maxScroll) {\n                state.scrollOffset++\n                if (state.selectedIndex < state.scrollOffset) {\n                  state.selectedIndex = state.scrollOffset\n                }\n              }\n            }\n          }\n        }\n\n        renderBrowser(state, height)\n        return\n      }\n\n      // Handle special keys\n      if (keyStr === '\\x03' || keyStr === 'q') {\n        // Ctrl+C or q - cancel\n        cleanup()\n        resolve({ cancelled: true, paths: [] })\n        return\n      }\n\n      if (keyStr === '\\x1b[A' || keyStr === 'k') {\n        // Up arrow or k\n        if (state.selectedIndex > 0) {\n          state.selectedIndex--\n          if (state.selectedIndex < state.scrollOffset) {\n            state.scrollOffset = state.selectedIndex\n          }\n        }\n      } else if (keyStr === '\\x1b[B' || keyStr === 'j') {\n        // Down arrow or j\n        if (state.selectedIndex < state.entries.length - 1) {\n          state.selectedIndex++\n          if (state.selectedIndex >= state.scrollOffset + listHeight) {\n            state.scrollOffset = state.selectedIndex - listHeight + 1\n          }\n        }\n      } else if (keyStr === '\\x1b[5~') {\n        // Page Up\n        state.selectedIndex = Math.max(0, state.selectedIndex - listHeight)\n        state.scrollOffset = Math.max(0, state.scrollOffset - listHeight)\n      } else if (keyStr === '\\x1b[6~') {\n        // Page Down\n        state.selectedIndex = Math.min(state.entries.length - 1, state.selectedIndex + listHeight)\n        if (state.selectedIndex >= state.scrollOffset + listHeight) {\n          // Ensure scrollOffset doesn't go negative when entries < listHeight\n          const maxScroll = Math.max(0, state.entries.length - listHeight)\n          state.scrollOffset = Math.min(maxScroll, state.scrollOffset + listHeight)\n        }\n      } else if (keyStr === '\\x1b[H' || keyStr === '\\x1b[1~') {\n        // Home\n        state.selectedIndex = 0\n        state.scrollOffset = 0\n      } else if (keyStr === '\\x1b[F' || keyStr === '\\x1b[4~') {\n        // End\n        state.selectedIndex = state.entries.length - 1\n        state.scrollOffset = Math.max(0, state.entries.length - listHeight)\n      } else if (keyStr === ' ' && mode === 'select-input') {\n        // Space - toggle selection (only for video files)\n        const entry = state.entries[state.selectedIndex]\n        if (entry && entry.isVideo) {\n          if (state.selectedFiles.has(entry.path)) {\n            state.selectedFiles.delete(entry.path)\n          } else {\n            state.selectedFiles.add(entry.path)\n            state.lastSelectedIndex = state.selectedIndex\n          }\n          // Move to next item after selection\n          if (state.selectedIndex < state.entries.length - 1) {\n            state.selectedIndex++\n            if (state.selectedIndex >= state.scrollOffset + listHeight) {\n              state.scrollOffset = state.selectedIndex - listHeight + 1\n            }\n          }\n        } else if (entry && entry.isDirectory) {\n          // Space on directory - navigate into it\n          state.currentPath = entry.path\n          state.entries = await getEntries(entry.path)\n          state.selectedIndex = 0\n          state.scrollOffset = 0\n        }\n      } else if ((keyStr === 'a' || keyStr === 'A') && mode === 'select-input') {\n        // Select/deselect all videos in current directory\n        const allVideosSelected = state.entries\n          .filter(e => e.isVideo)\n          .every(e => state.selectedFiles.has(e.path))\n\n        if (allVideosSelected) {\n          // Deselect all videos in this folder\n          for (const entry of state.entries) {\n            if (entry.isVideo) {\n              state.selectedFiles.delete(entry.path)\n            }\n          }\n          state.message = `${style.yellow}Deselected all videos in this folder${style.reset}`\n        } else {\n          // Select all videos\n          for (const entry of state.entries) {\n            if (entry.isVideo) {\n              state.selectedFiles.add(entry.path)\n            }\n          }\n          const count = countVideos(state.entries)\n          state.message = `${style.green}Selected ${count} video(s) in this folder${style.reset}`\n        }\n        setTimeout(() => {\n          state.message = undefined\n          renderBrowser(state, height)\n        }, 1500)\n      } else if ((keyStr === 'd' || keyStr === 'D') && mode === 'select-input') {\n        // Deselect all\n        const count = state.selectedFiles.size\n        state.selectedFiles.clear()\n        state.message = `${style.yellow}Cleared ${count} selection(s)${style.reset}`\n        setTimeout(() => {\n          state.message = undefined\n          renderBrowser(state, height)\n        }, 1500)\n      } else if (keyStr === '*' && mode === 'select-input') {\n        // Invert selection for videos\n        for (const entry of state.entries) {\n          if (entry.isVideo) {\n            if (state.selectedFiles.has(entry.path)) {\n              state.selectedFiles.delete(entry.path)\n            } else {\n              state.selectedFiles.add(entry.path)\n            }\n          }\n        }\n        state.message = `${style.cyan}Inverted selection${style.reset}`\n        setTimeout(() => {\n          state.message = undefined\n          renderBrowser(state, height)\n        }, 1500)\n      } else if (keyStr === 'c' || keyStr === 'C') {\n        // c - Confirm/Next: proceed with current selection or highlighted folder\n        const entry = state.entries[state.selectedIndex]\n\n        if (mode === 'select-input') {\n          if (state.selectedFiles.size > 0) {\n            // Return selected files\n            cleanup()\n            resolve({ cancelled: false, paths: Array.from(state.selectedFiles) })\n            return\n          } else if (entry?.isDirectory && entry.name !== '..') {\n            // No files selected, but folder is highlighted - use that folder\n            cleanup()\n            resolve({ cancelled: false, paths: [entry.path] })\n            return\n          } else {\n            // No files selected, no folder highlighted - use current directory\n            cleanup()\n            resolve({ cancelled: false, paths: [state.currentPath] })\n            return\n          }\n        } else if (mode === 'select-output') {\n          // Select current directory as output\n          cleanup()\n          resolve({ cancelled: false, paths: [state.currentPath] })\n          return\n        }\n      } else if (keyStr === '\\r' || keyStr === '\\n') {\n        // Enter - navigate into folders, or select single file\n        const entry = state.entries[state.selectedIndex]\n\n        if (entry?.isDirectory) {\n          // Navigate into directory\n          state.currentPath = entry.path\n          state.entries = await getEntries(entry.path)\n          state.selectedIndex = 0\n          state.scrollOffset = 0\n        } else if (mode === 'select-input' && entry && !entry.isDirectory) {\n          // Toggle selection on file (same as Space)\n          if (entry.isVideo) {\n            if (state.selectedFiles.has(entry.path)) {\n              state.selectedFiles.delete(entry.path)\n            } else {\n              state.selectedFiles.add(entry.path)\n              state.lastSelectedIndex = state.selectedIndex\n            }\n          }\n        } else if (mode === 'select-output' && !entry?.isDirectory) {\n          // In output mode with no folder selected, confirm current path\n          cleanup()\n          resolve({ cancelled: false, paths: [state.currentPath] })\n          return\n        }\n      } else if (keyStr === 'n' && mode === 'select-output') {\n        // Create new folder\n        cleanup()\n\n        const rl = createInterface({\n          input: process.stdin,\n          output: process.stdout\n        })\n\n        rl.question('New folder name: ', async (name) => {\n          rl.close()\n          if (name && name.trim()) {\n            const newPath = join(state.currentPath, name.trim())\n            resolve({ cancelled: false, paths: [newPath] })\n          } else {\n            // Re-open browser\n            const result = await browse(state.currentPath, mode)\n            resolve(result)\n          }\n        })\n        return\n      } else if (keyStr === 'g' || keyStr === '~') {\n        // Go to home\n        state.currentPath = homedir()\n        state.entries = await getEntries(state.currentPath)\n        state.selectedIndex = 0\n        state.scrollOffset = 0\n      } else if (keyStr === '-' || keyStr === 'h') {\n        // Go to parent directory\n        const parentPath = dirname(state.currentPath)\n        if (parentPath !== state.currentPath) {\n          state.currentPath = parentPath\n          state.entries = await getEntries(parentPath)\n          state.selectedIndex = 0\n          state.scrollOffset = 0\n        }\n      } else if (keyStr === 'l' || keyStr === '\\x1b[C') {\n        // Right arrow or l - enter directory\n        const entry = state.entries[state.selectedIndex]\n        if (entry?.isDirectory) {\n          state.currentPath = entry.path\n          state.entries = await getEntries(entry.path)\n          state.selectedIndex = 0\n          state.scrollOffset = 0\n        }\n      } else if (keyStr === '\\x1b[D') {\n        // Left arrow - go to parent\n        const parentPath = dirname(state.currentPath)\n        if (parentPath !== state.currentPath) {\n          state.currentPath = parentPath\n          state.entries = await getEntries(parentPath)\n          state.selectedIndex = 0\n          state.scrollOffset = 0\n        }\n      }\n\n      renderBrowser(state, height)\n    }\n\n    process.stdin.on('data', onKeypress)\n    renderBrowser(state, height)\n  })\n}\n\n/**\n * Simple prompt for confirmation\n */\nexport function confirm(message: string, defaultValue?: boolean): Promise<boolean> {\n  const rl = createInterface({\n    input: process.stdin,\n    output: process.stdout\n  })\n\n  // Show Y/n or y/N based on default\n  const hint = defaultValue === true ? '(Y/n)' : '(y/N)'\n\n  return new Promise((resolve) => {\n    rl.question(`${message} ${hint} `, (answer) => {\n      rl.close()\n      const trimmed = answer.trim().toLowerCase()\n      if (trimmed === '') {\n        // Empty input uses default\n        resolve(defaultValue ?? false)\n      } else {\n        resolve(trimmed === 'y' || trimmed === 'yes')\n      }\n    })\n  })\n}\n\n/**\n * Simple prompt for text input\n */\nexport function prompt(message: string, defaultValue?: string): Promise<string> {\n  const rl = createInterface({\n    input: process.stdin,\n    output: process.stdout\n  })\n\n  const displayDefault = defaultValue ? ` [${defaultValue}]` : ''\n\n  return new Promise((resolve) => {\n    rl.question(`${message}${displayDefault}: `, (answer) => {\n      rl.close()\n      resolve(answer.trim() || defaultValue || '')\n    })\n  })\n}\n\n/**\n * Menu selection with arrow key support\n */\nexport interface MenuOption<T> {\n  label: string\n  value: T\n  description?: string\n}\n\nexport async function menu<T>(title: string, options: MenuOption<T>[]): Promise<T> {\n  // Check if we're in a TTY for interactive mode\n  if (!process.stdin.isTTY) {\n    // Non-interactive: just show options and use first as default\n    console.log(`\\n${style.bold}${title}${style.reset}\\n`)\n    for (let i = 0; i < options.length; i++) {\n      console.log(`  ${style.cyan}${i + 1}.${style.reset} ${options[i].label}`)\n    }\n    return options[0].value\n  }\n\n  return new Promise((resolve) => {\n    let selectedIndex = 0\n    const height = options.length\n\n    const render = () => {\n      // Move cursor up to re-render\n      if (selectedIndex > 0 || options.some(o => o.description)) {\n        process.stdout.write(`\\x1b[${height + 2}A`)\n      }\n\n      console.log(`\\n${style.bold}${title}${style.reset}\\n`)\n\n      for (let i = 0; i < options.length; i++) {\n        const opt = options[i]\n        const isSelected = i === selectedIndex\n        const prefix = isSelected ? `${style.cyan}\u25B6${style.reset}` : ' '\n        const labelStyle = isSelected ? style.cyan : ''\n        const labelEnd = isSelected ? style.reset : ''\n\n        console.log(`  ${prefix} ${labelStyle}${opt.label}${labelEnd}`)\n        if (opt.description) {\n          console.log(`     ${style.dim}${opt.description}${style.reset}`)\n        }\n      }\n    }\n\n    // Initial render\n    console.log(`\\n${style.bold}${title}${style.reset}\\n`)\n    for (let i = 0; i < options.length; i++) {\n      const opt = options[i]\n      const isSelected = i === selectedIndex\n      const prefix = isSelected ? `${style.cyan}\u25B6${style.reset}` : ' '\n      const labelStyle = isSelected ? style.cyan : ''\n      const labelEnd = isSelected ? style.reset : ''\n\n      console.log(`  ${prefix} ${labelStyle}${opt.label}${labelEnd}`)\n      if (opt.description) {\n        console.log(`     ${style.dim}${opt.description}${style.reset}`)\n      }\n    }\n    console.log(`\\n${style.dim}\u2191\u2193 Navigate \u2502 Enter Select${style.reset}`)\n\n    // Setup raw mode\n    process.stdin.setRawMode(true)\n    process.stdin.resume()\n\n    const onKey = (key: Buffer) => {\n      const keyStr = key.toString()\n\n      if (keyStr === '\\x03' || keyStr === 'q') {\n        // Ctrl+C or q - use first option\n        process.stdin.setRawMode(false)\n        process.stdin.removeListener('data', onKey)\n        process.stdin.pause()\n        resolve(options[0].value)\n        return\n      }\n\n      if (keyStr === '\\x1b[A' || keyStr === 'k') {\n        // Up\n        if (selectedIndex > 0) {\n          selectedIndex--\n          render()\n        }\n      } else if (keyStr === '\\x1b[B' || keyStr === 'j') {\n        // Down\n        if (selectedIndex < options.length - 1) {\n          selectedIndex++\n          render()\n        }\n      } else if (keyStr === '\\r' || keyStr === '\\n' || keyStr === ' ') {\n        // Enter or Space - select\n        process.stdin.setRawMode(false)\n        process.stdin.removeListener('data', onKey)\n        process.stdin.pause()\n        console.log() // New line after selection\n        resolve(options[selectedIndex].value)\n        return\n      } else if (keyStr >= '1' && keyStr <= '9') {\n        // Number key - direct select\n        const index = parseInt(keyStr, 10) - 1\n        if (index < options.length) {\n          process.stdin.setRawMode(false)\n          process.stdin.removeListener('data', onKey)\n          process.stdin.pause()\n          console.log()\n          resolve(options[index].value)\n          return\n        }\n      }\n    }\n\n    process.stdin.on('data', onKey)\n  })\n}\n", "/**\n * Interactive Wizard\n * Guided setup for archival encoding\n */\n\nimport { browseForInput, browseForOutput, menu, prompt, confirm } from './browser.js'\nimport { style } from './tui.js'\nimport { stat, readdir } from 'node:fs/promises'\nimport { join, extname, relative, basename, dirname, sep } from 'node:path'\nimport type {\n  ArchivalCodec,\n  ArchivalPreset,\n  ArchivalResolution,\n  Av1Encoder\n} from '../../shared/types/archival.types.js'\n\n// Video extensions\nconst VIDEO_EXTENSIONS = new Set([\n  '.mp4', '.mkv', '.mov', '.webm', '.avi',\n  '.m4v', '.ts', '.mts', '.m2ts', '.flv', '.wmv'\n])\n\n/**\n * Find the common ancestor directory of multiple file paths\n */\nfunction findCommonAncestor(paths: string[]): string {\n  if (paths.length === 0) return ''\n  if (paths.length === 1) return dirname(paths[0])\n\n  // Split all paths into segments\n  const splitPaths = paths.map(p => dirname(p).split(sep))\n\n  // Find the shortest path length\n  const minLength = Math.min(...splitPaths.map(p => p.length))\n\n  // Find common prefix\n  const commonParts: string[] = []\n  for (let i = 0; i < minLength; i++) {\n    const segment = splitPaths[0][i]\n    if (splitPaths.every(p => p[i] === segment)) {\n      commonParts.push(segment)\n    } else {\n      break\n    }\n  }\n\n  return commonParts.join(sep) || sep\n}\n\n/**\n * Recursively find all video files in a directory\n */\nasync function findVideoFilesRecursive(\n  rootPath: string,\n  basePath: string = rootPath\n): Promise<Array<{ absolutePath: string; relativePath: string }>> {\n  const files: Array<{ absolutePath: string; relativePath: string }> = []\n  const ignoredDirs = new Set(['.drapp', '.git', 'node_modules', '$RECYCLE.BIN', 'System Volume Information'])\n\n  async function walk(dir: string): Promise<void> {\n    try {\n      const entries = await readdir(dir, { withFileTypes: true })\n\n      for (const entry of entries) {\n        const fullPath = join(dir, entry.name)\n\n        if (entry.isDirectory()) {\n          if (ignoredDirs.has(entry.name) || entry.name.startsWith('.')) {\n            continue\n          }\n          await walk(fullPath)\n        } else if (entry.isFile()) {\n          const ext = extname(entry.name).toLowerCase()\n          if (VIDEO_EXTENSIONS.has(ext)) {\n            files.push({\n              absolutePath: fullPath,\n              relativePath: relative(basePath, fullPath)\n            })\n          }\n        }\n      }\n    } catch {\n      // Skip directories we can't read\n    }\n  }\n\n  await walk(rootPath)\n  return files\n}\n\nexport interface WizardResult {\n  cancelled: boolean\n  inputPaths: string[]\n  outputPath: string\n  folderRoot?: string\n  relativePaths?: string[]\n  options: WizardOptions\n}\n\nexport interface WizardOptions {\n  codec: ArchivalCodec\n  preset: ArchivalPreset\n  resolution: ArchivalResolution\n  container: 'mkv' | 'mp4' | 'webm'\n  av1Encoder: Av1Encoder\n  av1Preset: number\n  av1Crf?: number\n  filmGrain: number\n  h265Preset: string\n  h265Crf?: number\n  h265Tune?: string\n  audioCopy: boolean\n  audioCodec: 'opus' | 'aac' | 'flac'\n  audioBitrate: number\n  twoPass: boolean\n  overwrite: boolean\n  fillMode: boolean\n  deleteIfLarger: boolean\n  deleteOriginal: boolean\n  preserveStructure: boolean\n  extractThumbnail: boolean\n  extractCaptions: boolean\n  captionLanguage: string\n  threadLimit: 0 | 4 | 6\n  simple: boolean\n}\n\nfunction clearScreen(): void {\n  process.stdout.write('\\x1b[2J\\x1b[H')\n}\n\nfunction printSection(title: string): void {\n  console.log(`\\n${style.cyan}\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500${style.reset}`)\n  console.log(`${style.bold}${title}${style.reset}`)\n  console.log(`${style.cyan}\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500${style.reset}\\n`)\n}\n\nexport async function runWizard(): Promise<WizardResult> {\n  clearScreen()\n\n  // Welcome\n  console.log(`\n${style.cyan}\u256D\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256E${style.reset}\n${style.cyan}\u2502${style.reset}                                                  ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.bold}Welcome to Drapp Archive${style.reset}                       ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.dim}Video encoding made simple${style.reset}                      ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}                                                  ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  This wizard will help you:                      ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.green}1.${style.reset} Select videos to encode                     ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.green}2.${style.reset} Choose where to save them                   ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}  ${style.green}3.${style.reset} Pick encoding settings                      ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2502${style.reset}                                                  ${style.cyan}\u2502${style.reset}\n${style.cyan}\u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256F${style.reset}\n`)\n\n  const proceed = await confirm('Ready to begin?')\n  if (!proceed) {\n    return { cancelled: true, inputPaths: [], outputPath: '', options: {} as WizardOptions }\n  }\n\n  // Step 1: Select Input\n  printSection('Step 1: Select Videos')\n  console.log('Choose how to select your videos:\\n')\n\n  const inputMethod = await menu('Input method', [\n    { label: 'Browse files', value: 'browse', description: 'Navigate and select individual files' },\n    { label: 'Select folder', value: 'folder', description: 'Select a folder to encode all videos recursively' },\n    { label: 'Enter path', value: 'path', description: 'Type or paste a file/folder path' },\n    { label: 'Current folder', value: 'current', description: 'Encode all videos in current directory' }\n  ])\n\n  let inputPaths: string[] = []\n  let folderRoot: string | undefined\n  let relativePaths: string[] | undefined\n  let preserveStructure = false\n\n  if (inputMethod === 'browse') {\n    const result = await browseForInput()\n    if (result.cancelled) {\n      return { cancelled: true, inputPaths: [], outputPath: '', options: {} as WizardOptions }\n    }\n\n    // Check if a folder was selected (user pressed Enter on a folder)\n    if (result.paths.length === 1) {\n      try {\n        const pathStat = await stat(result.paths[0])\n        if (pathStat.isDirectory()) {\n          // Scan the folder for videos\n          clearScreen()\n          printSection('Step 1: Select Videos')\n          console.log(`${style.dim}Scanning folder for videos...${style.reset}\\n`)\n\n          const files = await findVideoFilesRecursive(result.paths[0])\n\n          if (files.length === 0) {\n            console.log(`${style.yellow}No video files found in ${result.paths[0]}${style.reset}`)\n            const tryAgain = await confirm('Try again?')\n            if (tryAgain) {\n              return runWizard()\n            }\n            return { cancelled: true, inputPaths: [], outputPath: '', options: {} as WizardOptions }\n          }\n\n          inputPaths = files.map(f => f.absolutePath)\n          relativePaths = files.map(f => f.relativePath)\n          folderRoot = result.paths[0]\n\n          // Check if there are subfolders\n          const hasSubfolders = files.some(f => f.relativePath.includes('/') || f.relativePath.includes('\\\\'))\n\n          console.log(`Found ${style.cyan}${files.length}${style.reset} videos`)\n          if (hasSubfolders) {\n            console.log(`${style.dim}Including files in subfolders${style.reset}\\n`)\n            preserveStructure = await confirm('Preserve folder structure in output? (recommended for organized libraries)')\n          }\n        } else {\n          // Single file selected\n          inputPaths = result.paths\n          relativePaths = result.paths.map(p => basename(p))\n        }\n      } catch {\n        inputPaths = result.paths\n        relativePaths = result.paths.map(p => basename(p))\n      }\n    } else {\n      // Multiple files selected - calculate common ancestor for preserve structure\n      inputPaths = result.paths\n      folderRoot = findCommonAncestor(result.paths)\n      relativePaths = result.paths.map(p => relative(folderRoot!, p))\n\n      // Check if files are from different subfolders\n      const hasSubfolders = relativePaths.some(p => p.includes(sep) || p.includes('/'))\n\n      if (hasSubfolders) {\n        clearScreen()\n        printSection('Step 1: Select Videos')\n        console.log(`Selected ${style.cyan}${inputPaths.length}${style.reset} videos from multiple folders`)\n        console.log(`${style.dim}Common root: ${folderRoot}${style.reset}\\n`)\n        preserveStructure = await confirm('Preserve folder structure in output? (recommended for organized libraries)')\n      }\n    }\n  } else if (inputMethod === 'folder') {\n    const result = await browseForOutput() // Use output browser for folder selection\n    if (result.cancelled) {\n      return { cancelled: true, inputPaths: [], outputPath: '', options: {} as WizardOptions }\n    }\n    const selectedFolder = result.paths[0]\n\n    clearScreen()\n    printSection('Step 1: Select Videos')\n    console.log(`${style.dim}Scanning folder for videos...${style.reset}\\n`)\n\n    const files = await findVideoFilesRecursive(selectedFolder)\n\n    if (files.length === 0) {\n      console.log(`${style.yellow}No video files found in ${selectedFolder}${style.reset}`)\n      const tryAgain = await confirm('Try a different folder?')\n      if (tryAgain) {\n        return runWizard() // Restart wizard\n      }\n      return { cancelled: true, inputPaths: [], outputPath: '', options: {} as WizardOptions }\n    }\n\n    inputPaths = files.map(f => f.absolutePath)\n    relativePaths = files.map(f => f.relativePath)\n    folderRoot = selectedFolder\n\n    // Check if there are subfolders\n    const hasSubfolders = files.some(f => f.relativePath.includes('/') || f.relativePath.includes('\\\\'))\n\n    if (hasSubfolders) {\n      console.log(`Found ${style.cyan}${files.length}${style.reset} videos in ${style.cyan}${selectedFolder}${style.reset}`)\n      console.log(`${style.dim}Including files in subfolders${style.reset}\\n`)\n\n      preserveStructure = await confirm('Preserve folder structure in output? (recommended for organized libraries)')\n    } else {\n      console.log(`Found ${style.cyan}${files.length}${style.reset} videos\\n`)\n    }\n  } else if (inputMethod === 'path') {\n    clearScreen()\n    printSection('Step 1: Select Videos')\n    const inputPath = await prompt('Enter path to video file or folder')\n    if (!inputPath) {\n      return { cancelled: true, inputPaths: [], outputPath: '', options: {} as WizardOptions }\n    }\n\n    // Check if it's a directory\n    try {\n      const pathStat = await stat(inputPath)\n      if (pathStat.isDirectory()) {\n        console.log(`\\n${style.dim}Scanning folder for videos...${style.reset}`)\n\n        const files = await findVideoFilesRecursive(inputPath)\n        if (files.length === 0) {\n          console.log(`${style.yellow}No video files found${style.reset}`)\n          return { cancelled: true, inputPaths: [], outputPath: '', options: {} as WizardOptions }\n        }\n\n        inputPaths = files.map(f => f.absolutePath)\n        relativePaths = files.map(f => f.relativePath)\n        folderRoot = inputPath\n\n        const hasSubfolders = files.some(f => f.relativePath.includes('/') || f.relativePath.includes('\\\\'))\n        if (hasSubfolders) {\n          console.log(`Found ${style.cyan}${files.length}${style.reset} videos\\n`)\n          preserveStructure = await confirm('Preserve folder structure in output?')\n        }\n      } else {\n        inputPaths = [inputPath]\n      }\n    } catch {\n      inputPaths = [inputPath]\n    }\n  } else {\n    // Current folder\n    const currentDir = process.cwd()\n    console.log(`\\n${style.dim}Scanning current folder for videos...${style.reset}`)\n\n    const files = await findVideoFilesRecursive(currentDir)\n    if (files.length === 0) {\n      console.log(`${style.yellow}No video files found in current directory${style.reset}`)\n      return { cancelled: true, inputPaths: [], outputPath: '', options: {} as WizardOptions }\n    }\n\n    inputPaths = files.map(f => f.absolutePath)\n    relativePaths = files.map(f => f.relativePath)\n    folderRoot = currentDir\n\n    const hasSubfolders = files.some(f => f.relativePath.includes('/') || f.relativePath.includes('\\\\'))\n    if (hasSubfolders) {\n      console.log(`Found ${style.cyan}${files.length}${style.reset} videos\\n`)\n      preserveStructure = await confirm('Preserve folder structure in output?')\n    }\n  }\n\n  clearScreen()\n  console.log(`\\n${style.green}\u2713${style.reset} Selected ${inputPaths.length} item(s)`)\n  if (inputPaths.length <= 3) {\n    for (const p of inputPaths) {\n      console.log(`  ${style.dim}${p}${style.reset}`)\n    }\n  } else {\n    console.log(`  ${style.dim}${inputPaths[0]}${style.reset}`)\n    console.log(`  ${style.dim}...and ${inputPaths.length - 1} more${style.reset}`)\n  }\n  if (preserveStructure) {\n    console.log(`  ${style.cyan}(preserving folder structure)${style.reset}`)\n  }\n\n  // Step 2: Select Output\n  printSection('Step 2: Choose Output Location')\n  console.log('Where should the encoded videos be saved?\\n')\n\n  const outputMethod = await menu('Output location', [\n    { label: 'Browse folders', value: 'browse', description: 'Navigate to select a folder' },\n    { label: 'Enter path', value: 'path', description: 'Type or paste a folder path' },\n    { label: 'Same as input', value: 'same', description: 'Save alongside original files' }\n  ])\n\n  let outputPath: string\n\n  if (outputMethod === 'browse') {\n    const result = await browseForOutput()\n    if (result.cancelled) {\n      return { cancelled: true, inputPaths: [], outputPath: '', options: {} as WizardOptions }\n    }\n    outputPath = result.paths[0]\n  } else if (outputMethod === 'path') {\n    clearScreen()\n    printSection('Step 2: Choose Output Location')\n    const path = await prompt('Enter output folder path')\n    if (!path) {\n      return { cancelled: true, inputPaths: [], outputPath: '', options: {} as WizardOptions }\n    }\n    outputPath = path\n  } else {\n    // Same as input - use the folder root or directory of the first input\n    outputPath = folderRoot || dirname(inputPaths[0])\n  }\n\n  clearScreen()\n  console.log(`\\n${style.green}\u2713${style.reset} Output: ${outputPath}`)\n\n  // Step 3: Encoding Settings\n  printSection('Step 3: Encoding Settings')\n  console.log('How would you like to configure encoding?\\n')\n\n  const configMode = await menu('Configuration', [\n    { label: 'Quick (Recommended)', value: 'quick', description: 'Just choose quality level, we handle the rest' },\n    { label: 'Standard', value: 'standard', description: 'Choose codec and basic settings' },\n    { label: 'Advanced', value: 'advanced', description: 'Full control over all settings' }\n  ])\n\n  // Default options\n  const options: WizardOptions = {\n    codec: 'av1',\n    preset: 'archive',\n    resolution: 'source',\n    container: 'mkv',\n    av1Encoder: 'libsvtav1',\n    av1Preset: 6,\n    filmGrain: 10,\n    h265Preset: 'medium',\n    audioCopy: true,\n    audioCodec: 'aac',\n    audioBitrate: 160,\n    twoPass: false,\n    overwrite: false,\n    fillMode: false,\n    deleteIfLarger: true,\n    deleteOriginal: false,\n    preserveStructure: false,\n    extractThumbnail: false,\n    extractCaptions: false,\n    captionLanguage: 'auto',\n    threadLimit: 0,\n    simple: false\n  }\n\n  if (configMode === 'quick') {\n    clearScreen()\n    printSection('Quick Setup')\n\n    const quality = await menu('Quality vs Speed', [\n      { label: 'Balanced (Recommended)', value: 'balanced', description: 'Good compression, reasonable speed' },\n      { label: 'Maximum Compression', value: 'max', description: 'Smallest files, slowest encoding' },\n      { label: 'Fast', value: 'fast', description: 'Quick encoding, larger files' }\n    ])\n\n    if (quality === 'max') {\n      options.preset = 'max-compression'\n    } else if (quality === 'fast') {\n      options.preset = 'fast'\n    }\n  } else if (configMode === 'standard') {\n    clearScreen()\n    printSection('Standard Setup')\n\n    // Codec selection\n    options.codec = await menu<ArchivalCodec>('Video Codec', [\n      { label: 'AV1 (Recommended)', value: 'av1', description: 'Best compression, modern codec' },\n      { label: 'H.265/HEVC', value: 'h265', description: 'Wide compatibility, good compression' }\n    ])\n\n    // Quality preset\n    options.preset = await menu<ArchivalPreset>('Quality Preset', [\n      { label: 'Archive (Recommended)', value: 'archive', description: 'Balanced quality and size' },\n      { label: 'Maximum Compression', value: 'max-compression', description: 'Smallest files' },\n      { label: 'Fast', value: 'fast', description: 'Quick encoding' }\n    ])\n\n    // Resolution\n    console.log()\n    const changeRes = await confirm('Resize videos? (default: keep original)')\n    if (changeRes) {\n      options.resolution = await menu<ArchivalResolution>('Target Resolution', [\n        { label: 'Keep Original', value: 'source' },\n        { label: '4K (2160p)', value: '4k' },\n        { label: '1440p', value: '1440p' },\n        { label: '1080p', value: '1080p' },\n        { label: '720p', value: '720p' }\n      ])\n    }\n\n    // File organization\n    console.log()\n    if (folderRoot && inputPaths.length > 1) {\n      // Only ask if we have a folder with multiple files\n      preserveStructure = await confirm('Preserve folder structure in output?', preserveStructure)\n    }\n\n    // Extras (also in standard mode)\n    console.log()\n    const wantExtras = await confirm('Enable extras? (thumbnails, captions)')\n    if (wantExtras) {\n      options.extractThumbnail = await confirm('Extract thumbnail from each video?')\n      options.extractCaptions = await confirm('Extract captions using AI transcription?')\n\n      if (options.extractCaptions) {\n        options.captionLanguage = await menu('Caption language', [\n          { label: 'Auto-detect', value: 'auto' },\n          { label: 'English', value: 'en' },\n          { label: 'Spanish', value: 'es' }\n        ])\n      }\n    }\n  } else {\n    // Advanced mode\n    clearScreen()\n    printSection('Advanced Setup')\n\n    // Codec\n    options.codec = await menu<ArchivalCodec>('Video Codec', [\n      { label: 'AV1', value: 'av1' },\n      { label: 'H.265/HEVC', value: 'h265' }\n    ])\n\n    if (options.codec === 'av1') {\n      console.log(`\\n${style.bold}AV1 Settings${style.reset}\\n`)\n\n      options.av1Encoder = await menu<Av1Encoder>('AV1 Encoder', [\n        { label: 'SVT-AV1 (Recommended)', value: 'libsvtav1', description: 'Fast, good quality' },\n        { label: 'libaom-av1', value: 'libaom-av1', description: 'Reference encoder, slower' }\n      ])\n\n      const presetStr = await prompt('Speed preset (0-13 for SVT, lower=slower/better)', '6')\n      options.av1Preset = parseInt(presetStr, 10) || 6\n\n      const crfStr = await prompt('CRF (0-63, lower=better quality, leave empty for preset default)', '')\n      if (crfStr) {\n        options.av1Crf = parseInt(crfStr, 10)\n      }\n\n      const grainStr = await prompt('Film grain synthesis (0-50, 0=off)', '10')\n      options.filmGrain = parseInt(grainStr, 10) || 0\n    } else {\n      console.log(`\\n${style.bold}H.265 Settings${style.reset}\\n`)\n\n      options.h265Preset = await menu('Speed Preset', [\n        { label: 'medium (Recommended)', value: 'medium' },\n        { label: 'slow (Better quality)', value: 'slow' },\n        { label: 'fast (Quicker)', value: 'fast' },\n        { label: 'veryslow (Best quality)', value: 'veryslow' }\n      ])\n\n      const crfStr = await prompt('CRF (0-51, lower=better quality, leave empty for default)', '')\n      if (crfStr) {\n        options.h265Crf = parseInt(crfStr, 10)\n      }\n\n      const tune = await menu('Tune (optimize for content type)', [\n        { label: 'None (Default)', value: '' },\n        { label: 'Film', value: 'film', description: 'For live action content' },\n        { label: 'Animation', value: 'animation', description: 'For animated content' },\n        { label: 'Grain', value: 'grain', description: 'For grainy/noisy video' }\n      ])\n      if (tune) {\n        options.h265Tune = tune\n      }\n    }\n\n    // Resolution\n    console.log()\n    options.resolution = await menu<ArchivalResolution>('Target Resolution', [\n      { label: 'Keep Original', value: 'source' },\n      { label: '4K (2160p)', value: '4k' },\n      { label: '1440p', value: '1440p' },\n      { label: '1080p', value: '1080p' },\n      { label: '720p', value: '720p' },\n      { label: '480p', value: '480p' }\n    ])\n\n    // Container\n    options.container = await menu('Output Container', [\n      { label: 'MKV (Recommended)', value: 'mkv', description: 'Best compatibility with AV1' },\n      { label: 'MP4', value: 'mp4', description: 'Wide device support' },\n      { label: 'WebM', value: 'webm', description: 'Web optimized' }\n    ])\n\n    // Audio\n    console.log(`\\n${style.bold}Audio Settings${style.reset}\\n`)\n    options.audioCopy = await confirm('Copy audio without re-encoding? (recommended)')\n\n    if (!options.audioCopy) {\n      options.audioCodec = await menu('Audio Codec', [\n        { label: 'AAC', value: 'aac' },\n        { label: 'Opus', value: 'opus' },\n        { label: 'FLAC (Lossless)', value: 'flac' }\n      ])\n\n      const bitrateStr = await prompt('Audio bitrate (kbps)', '160')\n      options.audioBitrate = parseInt(bitrateStr, 10) || 160\n    }\n\n    // Other options\n    console.log(`\\n${style.bold}Encoding Options${style.reset}\\n`)\n    options.twoPass = await confirm('Enable two-pass encoding? (better quality, slower)')\n\n    // Thread limit\n    const threadChoice = await menu('Thread limit', [\n      { label: 'Unlimited (Default)', value: '0', description: 'Use all available CPU cores' },\n      { label: '6 threads', value: '6', description: 'Good balance for multi-tasking' },\n      { label: '4 threads', value: '4', description: 'Light CPU usage' }\n    ])\n    options.threadLimit = parseInt(threadChoice, 10) as 0 | 4 | 6\n\n    // Extras\n    console.log(`\\n${style.bold}Extras${style.reset}\\n`)\n    options.extractThumbnail = await confirm('Extract thumbnail from each video?')\n    options.extractCaptions = await confirm('Extract captions using AI transcription (Whisper)?')\n\n    if (options.extractCaptions) {\n      options.captionLanguage = await menu('Caption language', [\n        { label: 'Auto-detect', value: 'auto', description: 'Automatically detect spoken language' },\n        { label: 'English', value: 'en' },\n        { label: 'Spanish', value: 'es' },\n        { label: 'French', value: 'fr' },\n        { label: 'German', value: 'de' },\n        { label: 'Japanese', value: 'ja' },\n        { label: 'Chinese', value: 'zh' }\n      ])\n    }\n\n    // Output behavior\n    console.log(`\\n${style.bold}Output Behavior${style.reset}\\n`)\n\n    // Preserve structure option (only if we have a folder with files)\n    if (folderRoot && inputPaths.length > 1) {\n      preserveStructure = await confirm('Preserve folder structure in output?', preserveStructure)\n    }\n\n    options.overwrite = await confirm('Overwrite existing output files?')\n\n    if (!options.overwrite) {\n      options.fillMode = await confirm('Fill mode? (skip files that would conflict with existing outputs)')\n    }\n\n    options.deleteIfLarger = await confirm('Delete output if larger than input? (recommended)')\n    options.deleteOriginal = await confirm('Delete original files after successful encoding? (DANGEROUS)')\n\n    if (options.deleteOriginal) {\n      const confirmDelete = await confirm(`${style.red}WARNING:${style.reset} This will permanently delete original files. Are you sure?`)\n      if (!confirmDelete) {\n        options.deleteOriginal = false\n      }\n    }\n  }\n\n  // Set preserve structure from folder selection\n  options.preserveStructure = preserveStructure\n\n  // Confirmation\n  clearScreen()\n  printSection('Summary')\n\n  console.log(`${style.bold}Input:${style.reset}`)\n  if (inputPaths.length === 1) {\n    console.log(`  ${inputPaths[0]}`)\n  } else {\n    console.log(`  ${inputPaths.length} items selected`)\n    if (folderRoot) {\n      console.log(`  ${style.dim}from: ${folderRoot}${style.reset}`)\n    }\n  }\n\n  console.log(`\\n${style.bold}Output:${style.reset}`)\n  console.log(`  ${outputPath}`)\n  if (options.preserveStructure) {\n    console.log(`  ${style.cyan}(preserving folder structure)${style.reset}`)\n  }\n\n  console.log(`\\n${style.bold}Settings:${style.reset}`)\n  console.log(`  Codec: ${style.cyan}${options.codec.toUpperCase()}${style.reset}`)\n  console.log(`  Quality: ${style.cyan}${options.preset}${style.reset}`)\n  console.log(`  Resolution: ${style.cyan}${options.resolution}${style.reset}`)\n  console.log(`  Container: ${style.cyan}${options.container}${style.reset}`)\n  console.log(`  Audio: ${style.cyan}${options.audioCopy ? 'copy' : options.audioCodec}${style.reset}`)\n  if (options.twoPass) {\n    console.log(`  Two-pass: ${style.cyan}yes${style.reset}`)\n  }\n  if (options.threadLimit > 0) {\n    console.log(`  Thread limit: ${style.cyan}${options.threadLimit}${style.reset}`)\n  }\n\n  // Show extras\n  const extras: string[] = []\n  if (options.extractThumbnail) extras.push('thumbnails')\n  if (options.extractCaptions) extras.push(`captions (${options.captionLanguage})`)\n  if (extras.length > 0) {\n    console.log(`  Extras: ${style.cyan}${extras.join(', ')}${style.reset}`)\n  }\n\n  // Show output behavior\n  if (options.overwrite) {\n    console.log(`  ${style.yellow}Will overwrite existing files${style.reset}`)\n  } else if (options.fillMode) {\n    console.log(`  Fill mode: ${style.cyan}skip existing${style.reset}`)\n  }\n  if (options.deleteOriginal) {\n    console.log(`  ${style.red}Will delete original files after encoding${style.reset}`)\n  }\n\n  console.log()\n  const confirmed = await confirm('Start encoding?')\n\n  if (!confirmed) {\n    return { cancelled: true, inputPaths: [], outputPath: '', options: {} as WizardOptions }\n  }\n\n  return {\n    cancelled: false,\n    inputPaths,\n    outputPath,\n    folderRoot,\n    relativePaths,\n    options\n  }\n}\n"],
  "mappings": "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",
  "names": ["exports", "CommanderError", "InvalidArgumentError", "exports", "InvalidArgumentError", "Argument", "exports", "Help", "cmd", "args", "exports", "InvalidArgumentError", "Option", "str", "exports", "exports", "process", "Argument", "CommanderError", "Help", "Option", "Command", "args", "config", "option", "path", "exports", "Argument", "Command", "CommanderError", "InvalidArgumentError", "Help", "Option", "commander", "import_node_fs", "import_node_path", "import_node_os", "import_promises", "import_node_path", "import_node_child_process", "import_promises", "import_node_path", "app", "import_node_child_process", "import_node_fs", "args", "import_node_child_process", "import_node_fs", "import_node_path", "args", "mins", "config", "basename", "join", "args", "config", "args", "import_node_child_process", "import_node_path", "import_node_child_process", "platform", "os", "import_node_os", "import_node_child_process", "import_node_util", "os", "config", "args", "readFile", "writeFile", "import_promises", "import_node_path", "import_node_os", "ESC", "CLEAR_SCREEN", "HIDE_CURSOR", "SHOW_CURSOR", "MOVE_TO", "CLEAR_LINE", "import_promises", "import_node_path", "VIDEO_EXTENSIONS", "VIDEO_EXTENSIONS", "config", "config", "program"]
}
